var Ovoid={_inst:[],_curBrower:"null"};Ovoid._ua=navigator.userAgent.toLowerCase();
Ovoid._err=function(a,b,c){var e=null,f=null;if(b){if(f=b.opt_customErrContent,b.opt_debugMode||!f)e="Ovoid.JS '"+b.name+"' Instance "}else e="Ovoid.JS Global ";if(e){switch(a){case 1:e+="WebGL context error";break;case 2:e+="init error";break;case 3:e+="preload error";break;case 4:e+="onload error";break;case 5:e+="runtime error";break;case 6:e+="aborted";break;case 7:e+="browser error";break;default:e+="general error"}e+=" :: "+c+"<br><br>"}3>a||5<a?(b._runstat=3,a=b.Frame.canvas?b.Frame.canvas.parentNode:
document.getElementsByTagName("BODY")[0],e?b?(b=b._log,b=b.replace(/    /g,"&nbsp;&nbsp;&nbsp;&nbsp;"),b=b.replace(/</g,"&lt;"),b=b.replace(/>/g,"&gt;"),b=b.replace(/\n/g,"<br>"),a.innerHTML=e+"Logs backtrace:<br>"+b):a.innerHTML=e:a.innerHTML=f):console.log(e)};
Ovoid._log=function(a,b,c,e){if(e&&!(b&&a>b.opt_logLevel)){var f,g,h;h="["+(new Date).getHours()+":"+(new Date).getMinutes()+":"+(new Date).getSeconds()+"]";b?f=b.name:f="Ovoid";switch(a){case 0:g="FATAL:";b&&b._nerror++;break;case 1:g="ERROR:";b&&b._nerror++;break;case 2:g="WARNING:";break;case 3:g="NOTICE:"}a=h+" "+g+" @"+f+c+"::"+e;console.log(a);if(b)b._log=a+"\n"+b._log,10<b._nerror&&Ovoid._err(6,b,"Too many errors")}};if(/opera/.test(Ovoid._ua))Ovoid._curBrower="opera";
if(/safari/.test(Ovoid._ua))Ovoid._curBrower="safari";if(/chrome/.test(Ovoid._ua))Ovoid._curBrower="chrome";if(/msie/.test(Ovoid._ua))Ovoid._curBrower="msie";if(/firefox/.test(Ovoid._ua))Ovoid._curBrower="firefox";Ovoid._log(3,null,""," user agent: "+Ovoid._ua+"");Ovoid._log(3,null,""," browser '"+Ovoid._curBrower+"' detected");Ovoid.opt_vsync=!1;if("firefox"==Ovoid._curBrower)Ovoid.opt_vsync=!0;
window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame;Ovoid._run=function(){for(var a=Ovoid._inst.length;a--;)switch(Ovoid._inst[a]._runstat){case 3:break;case 2:Ovoid._inst[a]._mainloop();break;case 1:Ovoid._inst[a]._loadstep();break;case 0:Ovoid._inst[a]._loadstart();break;case -1:break;default:var b=Ovoid._inst[a];b.gl=null;b.al=null;Ovoid._inst.splice(a,1)}Ovoid._anim(Ovoid.opt_vsync)};
Ovoid._anim=function(a){a?window.requestAnimationFrame(Ovoid._run):window.setTimeout(Ovoid._run,0)};Ovoid.newConfig=function(){return new Ovoid.Config};
Ovoid.newInstance=function(a,b,c){var e=document.getElementById(b);if(e){if("CANVAS"==e.tagName.toUpperCase()){var f=new Ovoid.Instance(a);Ovoid._log(3,null,""," new instance '"+a+"' on canvas '"+b+"'");c instanceof Ovoid.Config&&f._setoptions(c);f._init(e)?(Ovoid._inst.push(f),Ovoid._log(3,null,""," instance '"+a+"' added in stack.")):f=null;return f}Ovoid._log(3,null,""," '"+b+"' is not a CANVAS.");return null}Ovoid._log(3,null,""," DOM object '"+b+"' not found.");return null};
Ovoid.deg2Rad=function(a){return 0.017453293*a};Ovoid.rad2Deg=function(a){return 57.295779513*a};Ovoid.isPowerOfTwo=function(a){return 0==(a&a-1)};Ovoid.noise=function(a){return 1-(a*(15731*a*a+789221)+1376312589&2147483647)/1073741824};Ovoid.randInt=function(a,b){return a+Math.round(Math.random()*(b-a))};Ovoid.randFloat=function(a,b){return a+Math.random()*(b-a)};Ovoid.frnd=function(a){return Math.round(1E3*a)/1E3};
Ovoid.genFontmap=function(a,b,c,e,f){var g=document.createElement("canvas");g.width=a;g.height=a;g=g.getContext("2d");g.font=f;g.fillStyle="rgba(255,255,255,255)";g.textAlign="center";g.textBaseline="middle";var h,k=a/b*(a/b),j,m;for(f=32,h=0;h<k;f++,h++)j=Math.floor(h%(a/b)),m=Math.floor(h/(a/b)),g.fillText(String.fromCharCode(f),j*b+c,m*b+e);a=g.getImageData(0,0,a,a);b=0;for(c=a.data.length;b<c;b+=4)a.data[b]=255,a.data[b+1]=255,a.data[b+2]=255;return a};
Ovoid.extractName=function(a,b){var c=a.split("/"),c=c[c.length-1];b||(c=c.split("."),c=c[c.length-2]);return c};Ovoid.extractExt=function(a){a=a.split("/");a=a[a.length-1];a=a.split(".");return a[a.length-1]};
Ovoid.compact=function(a){for(var a=new String(a),a=a.replace(/ in /g,"`in`"),a=a.replace(/var /g,"var`"),a=a.replace(/new /g,"new`"),a=a.replace(/const /g,"const`"),a=a.replace(/delete /g,"delete`"),a=a.replace(/ typeof /g,"`typeof`"),a=a.replace(/ instanceof /g,"`instanceof`"),a=a.split(""),b="",c=a.length,e=0;e<c;){if('"'==a[e])for(b+=a[e++];'"'!=a[e];)b+=a[e++];if("'"==a[e])for(b+=a[e++];"'"!=a[e];)b+=a[e++];if("/"==a[e]&&"/"==a[e+1])for(;"\n"!=a[e];)e++;if("/"==a[e]&&"*"==a[e+1]){for(;!("*"==
a[e]&&"/"==a[e+1]);)e++;e+=2}"\n"==a[e]||"\r"==a[e]||" "==a[e]||"\t"==a[e]?e++:b+=a[e++]}b=b.replace(/`in`/g," in ");b=b.replace(/var`/g,"var ");b=b.replace(/new`/g,"new ");b=b.replace(/const`/g,"const ");b=b.replace(/delete`/g,"delete ");b=b.replace(/`typeof`/g," typeof ");return b=b.replace(/`instanceof`/g," instanceof ")};
Ovoid._eventMouseDn=function(a){for(var b=Ovoid._inst.length;b--;)Ovoid._inst[b].Input.intDn[a.button]=!0,Ovoid._inst[b].Input.intUp[a.button]=!1,Ovoid._inst[b].Input.intHl[a.button]=!0};Ovoid._eventMouseUp=function(a){for(var b=Ovoid._inst.length;b--;)Ovoid._inst[b].Input.intDn[a.button]=!1,Ovoid._inst[b].Input.intUp[a.button]=!0,Ovoid._inst[b].Input.intHl[a.button]=!1};
Ovoid._eventMouseMove=function(a){for(var b=Ovoid._inst.length;b--;){var c=a.clientX-Ovoid._inst[b].Frame.position.v[0]+Ovoid._inst[b].Frame.scroll.v[0],e=a.clientY-Ovoid._inst[b].Frame.position.v[1]+Ovoid._inst[b].Frame.scroll.v[1];Ovoid._inst[b].Input.mouseVelocity.set(Ovoid._inst[b].Input.mousePosition.v[0]-c,Ovoid._inst[b].Input.mousePosition.v[1]-e,0);Ovoid._inst[b].Input.mousePosition.set(c,e,0)}};
Ovoid._eventMouseWheel=function(a){for(var b=Ovoid._inst.length;b--;){if(!a)a=window.event;var c;a.wheelDelta?c=a.wheelDelta/120:a.detail&&(c=-a.detail/3);0<c?Ovoid._inst[b].Input.intUp[7]=!0:0>c&&(Ovoid._inst[b].Input.intDn[7]=!0);Ovoid._inst[b].Input.mouseWheelDelta=c}};Ovoid._eventKeyDn=function(a){for(var b=Ovoid._inst.length;b--;)Ovoid._inst[b].Input.intHl[a.keyCode]||(Ovoid._inst[b].Input.intDn[a.keyCode]=!0,Ovoid._inst[b].Input.intHl[a.keyCode]=!0)};
Ovoid._eventKeyUp=function(a){for(var b=Ovoid._inst.length;b--;)Ovoid._inst[b].Input.intHl[a.keyCode]&&(Ovoid._inst[b].Input.intUp[a.keyCode]=!0,Ovoid._inst[b].Input.intHl[a.keyCode]=!1)};Ovoid._eventGpAxis=function(){};Ovoid._eventGpConnect=function(){};Ovoid._handleResize=function(){for(var a=Ovoid._inst.length;a--;)switch(Ovoid._inst[a].Frame.mode){case 0:Ovoid._inst[a].Frame._updatepos();break;case 1:Ovoid._inst[a].Frame._updatesize(),Ovoid._inst[a].Frame._updatepos()}};
Ovoid._handleScroll=function(){for(var a=Ovoid._inst.length;a--;)Ovoid._inst[a].Frame._updatepos()};window.onmousedown=Ovoid._eventMouseDn;window.onmouseup=Ovoid._eventMouseUp;window.onmousemove=Ovoid._eventMouseMove;window.onmousewheel=Ovoid._eventMouseWheel;window.addEventListener("DOMMouseScroll",Ovoid._eventMouseWheel,!1);document.onkeydown=Ovoid._eventKeyDn;document.onkeyup=Ovoid._eventKeyUp;window.addEventListener("MozGamepadConnected",Ovoid._eventGpConnect,!1);
window.addEventListener("MozGamepadAxisMove",Ovoid._eventGpAxis,!1);window.onresize=Ovoid._handleResize;window.onscroll=Ovoid._handleScroll;Ovoid._run();Ovoid._log(3,null,""," API is now running");Ovoid.LIBRARY_URL="http://www.ovoid.org/js/src/2.0/ovoid.js/";Ovoid.DEFAULT_FONT_MAP="normal 9pt monospace";Ovoid.MAX_JOINT_BY_SKIN=24;Ovoid.MAX_VERTEX_ATTRIB=8;Ovoid.MAX_UNIFORM=64;Ovoid.MAX_UNIFORM_MATRIX=64;Ovoid.MAX_UNIFORM_SAMPLER=16;Ovoid.MAX_LIGHT_BY_DRAW=8;Ovoid.MAX_BODY_BY_DRAW=512;Ovoid.MAX_LAYER_BY_DRAW=512;Ovoid.MAX_CONTACT_BY_CYCLE=128;Ovoid.MAX_MESH_LOD=3;Ovoid.MAX_EMITTER_PARTICLES=1024;Ovoid.PICKING_OFFSCREEN_FRAME_X=1920;Ovoid.PICKING_OFFSCREEN_FRAME_Y=1080;
Ovoid.MAX_RENDER_LAYER=8;Ovoid.PHYSICS_MOTION_EPSILON=1;Ovoid.MAX_BODY_INTERSECT=64;Ovoid.BIT0=0;Ovoid.BIT1=1;Ovoid.BIT2=2;Ovoid.BIT3=4;Ovoid.BIT4=8;Ovoid.BIT5=16;Ovoid.BIT6=32;Ovoid.BIT7=64;Ovoid.BIT8=128;Ovoid.BIT9=256;Ovoid.BIT10=512;Ovoid.BIT11=1024;Ovoid.BIT12=2048;Ovoid.BIT13=4096;Ovoid.BIT14=8192;Ovoid.BIT15=16384;Ovoid.BIT16=32768;Ovoid.BIT17=65536;Ovoid.BIT18=131072;Ovoid.BIT19=262144;Ovoid.BIT20=524288;Ovoid.BIT21=1048576;Ovoid.BIT22=2097152;Ovoid.BIT23=4194304;Ovoid.BIT24=8388608;
Ovoid.BIT25=16777216;Ovoid.BIT26=33554432;Ovoid.BIT27=67108864;Ovoid.BIT28=134217728;Ovoid.BIT29=268435456;Ovoid.BIT30=536870912;Ovoid.BIT31=1073741824;Ovoid.BIT32=2147483648;Ovoid._PI=3.141592653589793;Ovoid._alfPI=1.5707963267948966;Ovoid._2PI=6.283185307179586;Ovoid.FLOAT_MAX=3.402823466E38;Ovoid.FLOAT_MIN=-107374180;Ovoid.INT_MIN=-2147483647;Ovoid.INT_MAX=2147483647;Ovoid.UINT_MAX=4294967295;Ovoid.FLOAT_EPSILON=1.1920929E-7;Ovoid.NODE=Ovoid.BIT1;Ovoid.TEXTURE=Ovoid.BIT2;Ovoid.MATERIAL=Ovoid.BIT3;
Ovoid.TRANSFORM=Ovoid.BIT4;Ovoid.BODY=Ovoid.BIT5;Ovoid.JOINT=Ovoid.BIT6;Ovoid.CAMERA=Ovoid.BIT7;Ovoid.LIGHT=Ovoid.BIT8;Ovoid.MESH=Ovoid.BIT9;Ovoid.SKIN=Ovoid.BIT10;Ovoid.ANIMATION=Ovoid.BIT11;Ovoid.AIM=Ovoid.BIT12;Ovoid.ACTION=Ovoid.BIT13;Ovoid.CONSTRAINT=Ovoid.BIT14;Ovoid.PHYSICS=Ovoid.BIT15;Ovoid.EMITTER=Ovoid.BIT16;Ovoid.TRACK=Ovoid.BIT17;Ovoid.EXPRESSION=Ovoid.BIT18;Ovoid.TEXT=Ovoid.BIT20;Ovoid.LAYER=Ovoid.BIT21;Ovoid.AUDIO=Ovoid.BIT30;Ovoid.SOUND=Ovoid.BIT31;Ovoid.CACH_ALL=Ovoid.BIT0;
Ovoid.CACH_MATRIX=Ovoid.BIT1;Ovoid.CACH_TRANSFORM=Ovoid.BIT2;Ovoid.CACH_WORLD=Ovoid.BIT3;Ovoid.CACH_VIEWPROJ=Ovoid.BIT4;Ovoid.CACH_GEOMETRY=Ovoid.BIT5;Ovoid.CACH_LIGHT=Ovoid.BIT6;Ovoid.CACH_BOUNDING_SHAPE=Ovoid.BIT7;Ovoid.CACH_SKIN=Ovoid.BIT8;Ovoid.CACH_LAYER=Ovoid.BIT9;Ovoid.CACH_ACTION=Ovoid.BIT10;Ovoid.CACH_INFLUENCES=Ovoid.BIT11;Ovoid.CACH_PHYSICS=Ovoid.BIT12;Ovoid.CACH_SOUND=Ovoid.BIT13;Ovoid.CACH_EXPRESSION=Ovoid.BIT14;Ovoid.WORLD=0;Ovoid.LOCAL=1;Ovoid.ABSOLUTE=1;Ovoid.RELATIVE=0;
Ovoid.LIGHT_AMBIENT=0;Ovoid.LIGHT_DIRECTIONAL=1;Ovoid.LIGHT_POINT=2;Ovoid.LIGHT_SPOT=3;Ovoid.AMBIENT=0;Ovoid.DIFFUSE=1;Ovoid.SPECULAR=2;Ovoid.EMISSIVE=3;Ovoid.REFLECT=4;Ovoid.NORMAL=5;Ovoid.INTERPOLATION_CSPLINE=0;Ovoid.INTERPOLATION_HSPLINE=1;Ovoid.INTERPOLATION_BSPLINE=2;Ovoid.ANIMATION_CHANNEL_TRANSLATE=Ovoid.BIT21;Ovoid.ANIMATION_CHANNEL_TRANSLATE_X=Ovoid.BIT1|Ovoid.BIT21;Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y=Ovoid.BIT2|Ovoid.BIT21;Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z=Ovoid.BIT3|Ovoid.BIT21;
Ovoid.ANIMATION_CHANNEL_ROTATE=Ovoid.BIT22;Ovoid.ANIMATION_CHANNEL_ROTATE_X=Ovoid.BIT4|Ovoid.BIT22;Ovoid.ANIMATION_CHANNEL_ROTATE_Y=Ovoid.BIT5|Ovoid.BIT22;Ovoid.ANIMATION_CHANNEL_ROTATE_Z=Ovoid.BIT6|Ovoid.BIT22;Ovoid.ANIMATION_CHANNEL_ORIENTE=Ovoid.BIT23;Ovoid.ANIMATION_CHANNEL_ORIENTE_X=Ovoid.BIT7|Ovoid.BIT23;Ovoid.ANIMATION_CHANNEL_ORIENTE_Y=Ovoid.BIT8|Ovoid.BIT23;Ovoid.ANIMATION_CHANNEL_ORIENTE_Z=Ovoid.BIT9|Ovoid.BIT23;Ovoid.ANIMATION_CHANNEL_SCALE=Ovoid.BIT24;
Ovoid.ANIMATION_CHANNEL_SCALE_X=Ovoid.BIT10|Ovoid.BIT24;Ovoid.ANIMATION_CHANNEL_SCALE_Y=Ovoid.BIT11|Ovoid.BIT24;Ovoid.ANIMATION_CHANNEL_SCALE_Z=Ovoid.BIT12|Ovoid.BIT24;Ovoid.ANIMATION_CHANNEL_COLOR=Ovoid.BIT25;Ovoid.ANIMATION_CHANNEL_COLOR_R=Ovoid.BIT13|Ovoid.BIT25;Ovoid.ANIMATION_CHANNEL_COLOR_G=Ovoid.BIT14|Ovoid.BIT25;Ovoid.ANIMATION_CHANNEL_COLOR_B=Ovoid.BIT15|Ovoid.BIT25;Ovoid.ANIMATION_CHANNEL_COLOR_A=Ovoid.BIT16|Ovoid.BIT25;Ovoid.ANIMATION_CHANNEL_VISIBILITY=Ovoid.BIT17;
Ovoid.ANIMATION_CHANNEL_TRANSFORM=Ovoid.BIT26;Ovoid.COLLADA=0;Ovoid.OJSON=1;Ovoid.DAE_TRANSFORMS=Ovoid.BIT1;Ovoid.DAE_MESHS=Ovoid.BIT2;Ovoid.DAE_LIGHTS=Ovoid.BIT3;Ovoid.DAE_CAMERAS=Ovoid.BIT4;Ovoid.DAE_JOINTS=Ovoid.BIT5;Ovoid.DAE_ANIMATIONS=Ovoid.BIT6;Ovoid.DAE_MATERIALS=Ovoid.BIT7;Ovoid.DAE_CONTROLLERS=Ovoid.BIT8;Ovoid.DAE_WORLD_NODES=Ovoid.BIT1|Ovoid.BIT3|Ovoid.BIT4|Ovoid.BIT5;Ovoid.DAE_DEPENDENCY_NODES=Ovoid.BIT2|Ovoid.BIT6|Ovoid.BIT7|Ovoid.BIT8;
Ovoid.DAE_ALL_NODES=Ovoid.BIT1|Ovoid.BIT2|Ovoid.BIT3|Ovoid.BIT4|Ovoid.BIT5|Ovoid.BIT6|Ovoid.BIT7|Ovoid.BIT8;Ovoid.DAE_FORCE_CSPLINE=Ovoid.BIT9;Ovoid.DAE_OPTIMIZE_MESH_VERTICES=Ovoid.BIT10;Ovoid.DAE_OPTIMIZE_MESH_TRIANGLES=Ovoid.BIT11;Ovoid.DAE_OPTIMIZE_ALL=Ovoid.BIT10|Ovoid.BIT11;Ovoid.DAE_MAYA_FIXS=Ovoid.BIT13;Ovoid.DAE_BLENDER_FIXS=Ovoid.BIT14;Ovoid.DAE_REPARENT_SKIN=Ovoid.BIT15;Ovoid.DAE_MERGE_DEPENDENCIES=Ovoid.BIT16;Ovoid.DAE_CREATE_TRACK=Ovoid.BIT17;Ovoid.DAE_CONVERT_UPAXIS=Ovoid.BIT18;
Ovoid.FRAME_MANUAL_SIZE=0;Ovoid.FRAME_CLIENT_SIZE=1;Ovoid.FRAME_FULL_SCREEN=2;Ovoid.FRAME_STRETCHED=3;Ovoid.HTML5_AUDIO=1;Ovoid.MOZ_AUDIO_API=2;Ovoid.WEB_AUDIO_API=3;Ovoid.PIPE_RP_GEOMETRY=20;Ovoid.PIPE_RP_PARTICLE=22;Ovoid.PIPE_RP_LAYER=23;Ovoid.PIPE_RP_STRING=24;Ovoid.PIPE_RP_BILLBOARD=27;Ovoid.PIPE_L2_GEOMETRY_LP=0;Ovoid.PIPE_L2_GEOMETRY_1P=1;Ovoid.PIPE_L1_GEOMETRY_LP=10;Ovoid.PIPE_L1_GEOMETRY_1P=11;Ovoid.PIPE_L0_GEOMETRY_LP=13;Ovoid.PIPE_L0_GEOMETRY_1P=14;Ovoid.PIPE_PARTICLE=2;
Ovoid.PIPE_LAYER=3;Ovoid.PIPE_STRING=4;Ovoid.PIPE_HELPER=5;Ovoid.PIPE_SHADOW_VOLUME=6;Ovoid.PIPE_BILLBOARD=7;Ovoid.PIPE_FOG_LP=8;Ovoid.RP_OVERLAY=Ovoid.BIT1;Ovoid.RP_WORLD=Ovoid.BIT2;Ovoid.VERTEX_VEC4_P=Ovoid.BIT1;Ovoid.VERTEX_VEC3_N=Ovoid.BIT2;Ovoid.VERTEX_VEC3_U=Ovoid.BIT3;Ovoid.VERTEX_VEC3_T=Ovoid.BIT4;Ovoid.VERTEX_VEC3_B=Ovoid.BIT5;Ovoid.VERTEX_VEC4_C=Ovoid.BIT6;Ovoid.VERTEX_VEC4_I=Ovoid.BIT7;Ovoid.VERTEX_VEC4_W=Ovoid.BIT8;Ovoid.VERTEX_PARTICLE=Ovoid.BIT1|Ovoid.BIT3|Ovoid.BIT6;
Ovoid.GLSL_FRAGMENT=0;Ovoid.GLSL_VERTEX=1;Ovoid.GLSL_GEOMETRY=2;Ovoid.SAMPLER_AMBIENT=0;Ovoid.SAMPLER_DEFAULT=1;Ovoid.SAMPLER_DIFFUSE=1;Ovoid.SAMPLER_SPECULAR=2;Ovoid.SAMPLER_EMISSIVE=3;Ovoid.SAMPLER_REFLECT=4;Ovoid.SAMPLER_NORMAL=5;Ovoid.UNIFORM_ENABLE_DIFFUSE_LIGHTING_BOOL=0;Ovoid.UNIFORM_ENABLE_AMBIENT_LIGHTING_BOOL=1;Ovoid.UNIFORM_ENABLE_SPECULAR_BOOL=2;Ovoid.UNIFORM_ENABLE_REFLECT_BOOL=3;Ovoid.UNIFORM_ENABLE_PARALAX_BOOL=4;Ovoid.UNIFORM_ENABLE_MATERIAL_BOOL=5;
Ovoid.UNIFORM_ENABLE_VERTEX_WEIGHT_BOOL=6;Ovoid.UNIFORM_ENABLE_COMPUT_TANGENT_BOOL=7;Ovoid.UNIFORM_ZOFFSET_FLOAT=8;Ovoid.UNIFORM_COLOR_VEC4=9;Ovoid.UNIFORM_MATERIAL_AMBIENT_VEC4=10;Ovoid.UNIFORM_MATERIAL_DIFFUSE_VEC4=11;Ovoid.UNIFORM_MATERIAL_SPECULAR_VEC4=12;Ovoid.UNIFORM_MATERIAL_EMISSIVE_VEC4=13;Ovoid.UNIFORM_MATERIAL_REFLECT_VEC4=14;Ovoid.UNIFORM_MATERIAL_SHININESS_FLOAT=15;Ovoid.UNIFORM_MATERIAL_OPACITY_FLOAT=16;Ovoid.UNIFORM_MATERIAL_REFLECTIVITY_FLOAT=17;
Ovoid.UNIFORM_MATERIAL_BUMPINESS_FLOAT=18;Ovoid.UNIFORM_LIGHT_WEIGHT_FLOAT=19;Ovoid.UNIFORM_LIGHT_POSITION_VEC4=20;Ovoid.UNIFORM_LIGHT_DIRECTION_VEC3=21;Ovoid.UNIFORM_LIGHT_COLOR_VEC4=22;Ovoid.UNIFORM_LIGHT_INTENSITY_FLOAT=23;Ovoid.UNIFORM_LIGHT_CONSTANT_ATTENUATION_FLOAT=23;Ovoid.UNIFORM_LIGHT_RANGE_FLOAT=24;Ovoid.UNIFORM_LIGHT_FALLOFF_FLOAT=25;Ovoid.UNIFORM_LIGHT_SPOTANGLE_FLOAT=26;Ovoid.UNIFORM_LIGHT_LINEAR_ATTENUATION_FLOAT=27;Ovoid.UNIFORM_LIGHT_ENABLED_BOOL=28;
Ovoid.UNIFORM_LIGHT_QUADRIC_ATTENUATION_FLOAT=29;Ovoid.UNIFORM_EYE_POSITION_VEC4=30;Ovoid.UNIFORM_EYE_DIRECTION_VEC4=31;Ovoid.UNIFORM_EYE_VIEWSIZE_VEC3=32;Ovoid.UNIFORM_AMBIENT_COLOR_VEC4=40;Ovoid.UNIFORM_LAYER_SIZE_VEC3=42;Ovoid.UNIFORM_MATRIX_TRANSFORM_MAT4=0;Ovoid.UNIFORM_MATRIX_NORMAL_MAT3=1;Ovoid.UNIFORM_MATRIX_MODELVIEW_MAT4=2;Ovoid.UNIFORM_MATRIX_EYEVIEW_MAT4=3;Ovoid.UNIFORM_MATRIX_PROJECTION_MAT4=4;Ovoid.UNIFORM_MATRIX_LOOKAT_MAT4=5;Ovoid.UNIFORM_MATRIX_JOINTS_MAT4=6;Ovoid.BOOL=35670;
Ovoid.INT=5124;Ovoid.FLOAT=5126;Ovoid.DOUBLE=5130;Ovoid.INT_VEC2=35667;Ovoid.INT_VEC3=35668;Ovoid.INT_VEC4=35669;Ovoid.FLOAT_VEC2=35664;Ovoid.FLOAT_VEC3=35665;Ovoid.FLOAT_VEC4=35666;Ovoid.FLOAT_MAT2=35674;Ovoid.FLOAT_MAT3=35675;Ovoid.FLOAT_MAT4=35676;Ovoid.BUFFER_STATIC=35044;Ovoid.BUFFER_DYNAMIC=35048;Ovoid.BUFFER_STREAM=35040;Ovoid.BUFFER_READ=35E3;Ovoid.BUFFER_WRITE=35001;Ovoid.BUFFER_READ_WRTIE=35002;Ovoid.POINTS=0;Ovoid.LINES=1;Ovoid.TRIANGLES=4;Ovoid.FILTER_NEAREST=0;Ovoid.FILTER_LINEAR=1;
Ovoid.RIGID_MASSIVE_BOX=1;Ovoid.RIGID_MASSIVE_SPHERE=2;Ovoid.GHOST_MASSIVE=3;Ovoid.RIGID_LANDSCAPE=0;Ovoid.MOUSE_ENTER=0;Ovoid.MOUSE_LEAVE=1;Ovoid.MOUSE_OVER=2;Ovoid.MOUSE_OVER_LEFT_DOWN=3;Ovoid.MOUSE_OVER_LEFT_UP=4;Ovoid.MOUSE_OVER_LEFT_HELD=5;Ovoid.MOUSE_OVER_MIDDLE_DOWN=6;Ovoid.MOUSE_OVER_MIDDLE_UP=7;Ovoid.MOUSE_OVER_MIDDLE_HELD=8;Ovoid.MOUSE_OVER_RIGHT_DOWN=9;Ovoid.MOUSE_OVER_RIGHT_UP=10;Ovoid.MOUSE_OVER_RIGHT_HELD=11;Ovoid.ON_GRABBED=12;Ovoid.ON_UNGRABBED=13;Ovoid.ON_INTERSECT=14;
Ovoid.ON_INTERSECT_ENTER=15;Ovoid.ON_INTERSECT_LEAVE=16;Ovoid.UP=0;Ovoid.DOWN=1;Ovoid.HELD=2;Ovoid.MB_LEFT=0;Ovoid.MB_MIDDLE=1;Ovoid.MB_RIGHT=2;Ovoid.MOUSE_WHEEL=7;Ovoid.CTR_HELD=1;Ovoid.ALT_HELD=2;Ovoid.SHF_HELD=3;Ovoid.LSU_HELD=4;Ovoid.RSU_HELD=5;Ovoid.KB_BACKSPACE=8;Ovoid.KB_TAB=9;Ovoid.KB_ENTER=13;Ovoid.KB_SHIFT=16;Ovoid.KB_CTRL=17;Ovoid.KB_ALT=18;Ovoid.KB_BREAK=19;Ovoid.KB_CAPSLOCK=20;Ovoid.KB_ESCAPE=27;Ovoid.KB_PGUP=33;Ovoid.KB_PGDN=34;Ovoid.KB_END=35;Ovoid.KB_HOME=36;Ovoid.KB_LARROW=37;
Ovoid.KB_UARROW=38;Ovoid.KB_RARROW=39;Ovoid.KB_DARROW=40;Ovoid.KB_INS=45;Ovoid.KB_DEL=46;Ovoid.KB_0=48;Ovoid.KB_1=49;Ovoid.KB_2=50;Ovoid.KB_3=51;Ovoid.KB_4=52;Ovoid.KB_5=53;Ovoid.KB_6=54;Ovoid.KB_7=55;Ovoid.KB_8=56;Ovoid.KB_9=57;Ovoid.KB_A=65;Ovoid.KB_B=66;Ovoid.KB_C=67;Ovoid.KB_D=68;Ovoid.KB_E=69;Ovoid.KB_F=70;Ovoid.KB_G=71;Ovoid.KB_H=72;Ovoid.KB_I=73;Ovoid.KB_J=74;Ovoid.KB_K=75;Ovoid.KB_L=76;Ovoid.KB_M=77;Ovoid.KB_N=78;Ovoid.KB_O=79;Ovoid.KB_P=80;Ovoid.KB_Q=81;Ovoid.KB_R=82;Ovoid.KB_S=83;
Ovoid.KB_T=84;Ovoid.KB_U=85;Ovoid.KB_V=86;Ovoid.KB_W=87;Ovoid.KB_X=88;Ovoid.KB_Y=89;Ovoid.KB_Z=90;Ovoid.KB_LSUPER=91;Ovoid.KB_RSUPER=92;Ovoid.KB_SELECT=93;Ovoid.KB_NP0=96;Ovoid.KB_NP1=97;Ovoid.KB_NP2=98;Ovoid.KB_NP3=99;Ovoid.KB_NP4=100;Ovoid.KB_NP5=101;Ovoid.KB_NP6=102;Ovoid.KB_NP7=103;Ovoid.KB_NP8=104;Ovoid.KB_NP9=105;Ovoid.KB_NPMUL=106;Ovoid.KB_NPADD=107;Ovoid.KB_NPSUB=109;Ovoid.KB_NPDOT=110;Ovoid.KB_NPDIV=111;Ovoid.KB_F1=112;Ovoid.KB_F2=113;Ovoid.KB_F3=114;Ovoid.KB_F4=115;Ovoid.KB_F5=116;
Ovoid.KB_F6=117;Ovoid.KB_F7=118;Ovoid.KB_F8=119;Ovoid.KB_F9=120;Ovoid.KB_F10=121;Ovoid.KB_F11=122;Ovoid.KB_F12=123;Ovoid.KB_NUMLOCK=144;Ovoid.KB_SCROLLLOCK=145;Ovoid.KB_SEMICOLON=186;Ovoid.KB_EQUAL=187;Ovoid.KB_DASH=189;Ovoid.KB_PERIOD=190;Ovoid.KB_SLASH=191;Ovoid.KB_GACCENT=192;Ovoid.KB_LBRACKET=219;Ovoid.KB_BACKSLASH=220;Ovoid.KB_RBRACKET=221;Ovoid.KB_SQUOTE=222;Ovoid.GLSL_WRAPMAP='{"OJSON":1,"type":"glslmap","wrapmap": {"attribute":[{"id":1,"name":"p"},{"id":2,"name":"n"},{"id":4,"name":"u"},{"id":8,"name":"t"},{"id":16,"name":"b"},{"id":32,"name":"c"},{"id":64,"name":"i"},{"id":128,"name":"w"}],"uniform":[{"id":0,"name":"ENd"},{"id":1,"name":"ENa"},{"id":2,"name":"ENs"},{"id":3,"name":"ENr"},{"id":4,"name":"ENp"},{"id":5,"name":"ENm"},{"id":6,"name":"ENw"},{"id":7,"name":"ENt"},{"id":8,"name":"Z"},{"id":9,"name":"C"},{"id":10,"name":"Ma"},{"id":11,"name":"Md"},{"id":12,"name":"Ms"},{"id":13,"name":"Me"},{"id":14,"name":"Mr"},{"id":15,"name":"Mi"},{"id":16,"name":"Mo"},{"id":17,"name":"My"},{"id":18,"name":"Mb"},{"id":19,"name":"Lw"},{"id":20,"name":"Lp"},{"id":21,"name":"Ld"},{"id":22,"name":"Lc"},{"id":23,"name":"Li"},{"id":23,"name":"Lac"},{"id":24,"name":"Lr"},{"id":25,"name":"Lf"},{"id":26,"name":"La"},{"id":27,"name":"Lal"},{"id":28,"name":"Le"},{"id":29,"name":"Laq"},{"id":30,"name":"Ep"},{"id":31,"name":"Ed"},{"id":32,"name":"Es"},{"id":40,"name":"Ac"},{"id":42,"name":"Ls"},{"symbol":"UNIFORM_FOG_COLOR_VEC4","id":44,"name":"Fc"},{"symbol":"UNIFORM_FOG_DENSITY_FLOAT","id":45,"name":"Fd"}],"uniformMatrix":[{"id":0,"name":"MXF"},{"id":1,"name":"MNR"},{"id":2,"name":"MMV"},{"id":3,"name":"MEV"},{"id":4,"name":"MPJ"},{"id":5,"name":"MLA"},{"id":6,"name":"MJT"}],"uniformSampler":[{"id":1,"name":"Sd"},{"id":0,"name":"Sa"},{"id":1,"name":"Sd"},{"id":2,"name":"Ss"},{"id":3,"name":"Se"},{"id":4,"name":"Sr"},{"id":5,"name":"Sn"}]}}';
Ovoid.GLSL_P_VS="attribute vec4 p;uniform mat4 MXF;uniform mat4 MEV;void main(void){gl_Position=MEV*MXF*p;}";Ovoid.GLSL_PU_VS="attribute vec4 p;attribute vec3 u;uniform mat4 MXF;uniform mat4 MEV;varying vec2 Vu;void main(void){Vu=u.xy;gl_Position=MEV*MXF*p;}";Ovoid.GLSL_PC_VS="attribute vec4 p;attribute vec4 c;uniform mat4 MEV;uniform mat4 MXF;varying vec4 Vc;void main(void){Vc=c;gl_Position=MEV*(MXF*p);}";Ovoid.GLSL_P_ZSTRING_VS="attribute vec4 p;uniform mat4 MXF;uniform mat4 MEV;uniform vec4 Ep;void main(void){gl_PointSize=p.z;gl_Position=MEV*MXF*vec4(p.xy,0.0,1.0);}";
Ovoid.GLSL_P_ZWSTRING_VS="attribute vec4 p;uniform mat4 MXF;uniform mat4 MEV;varying float a;void main(void){a=p.w;gl_PointSize=p.z;gl_Position=MEV*MXF*vec4(p.xy,0.0,1.0);}";Ovoid.GLSL_C_TEX_STRING_FS="precision highp float;uniform vec4 C;uniform sampler2D Sd;varying float a;vec2 Gu;void main(void){Gu.s=(gl_PointCoord.s*0.0625)+(floor(mod(a,16.0))*0.0625);Gu.t=(1.0-(gl_PointCoord.t*0.0625))-(floor(a/16.0)*0.0625);gl_FragColor=texture2D(Sd, Gu)*C;}";Ovoid.GLSL_PU_PARTICLE_VS="attribute vec4 p;attribute vec3 u;uniform mat4 MEV;uniform vec4 Ep;void main(void){gl_PointSize=((u.z*640.0)/distance(p,Ep));gl_Position=MEV*p;}";
Ovoid.GLSL_PUC_PARTICLE_VS="attribute vec4 p;attribute vec3 u;attribute vec4 c;uniform mat4 MEV;uniform vec4 Ep;varying vec4 Vc;void main(void){Vc=c;gl_PointSize=((u.z*640.0)/abs(distance(p,Ep)));gl_Position=MEV*p;}";Ovoid.GLSL_PU_BILLBOARD_VS="attribute vec4 p;attribute vec3 u;uniform mat4 MPJ;uniform mat4 MLA;uniform mat4 MXF;varying vec2 Vu;varying float z;void main(void){Vu=u.xy;gl_Position=MPJ*((MLA*MXF)*vec4(0.0,0.0,0.0,1.0)+(p*MXF[0][0]));}";
Ovoid.GLSL_PIW_HYBRID_VS="#define MA "+Ovoid.MAX_JOINT_BY_SKIN+"\nattribute vec4 p;attribute vec4 i;attribute vec4 w;uniform bool ENw;uniform mat4 MEV;uniform mat4 MXF[MA];vec4 Vp;void main(void){if(ENw){Vp=vec4(0.0,0.0,0.0,0.0);Vp+=(MXF[int(i.x)]*p)*w.x;Vp+=(MXF[int(i.y)]*p)*w.y;Vp+=(MXF[int(i.z)]*p)*w.z;Vp+=(MXF[int(i.w)]*p)*w.w;}else{Vp=MXF[0]*p;}gl_Position=MEV*Vp;}";Ovoid.GLSL_PNUIW_HYBRID_VS="#define MA "+Ovoid.MAX_JOINT_BY_SKIN+"\nattribute vec4 p;attribute vec3 n;attribute vec3 u;attribute vec4 i;attribute vec4 w;uniform bool ENw;uniform mat4 MEV;uniform mat4 MXF[MA];uniform mat3 MNR[MA];varying vec4 Vp;varying vec3 Vn;varying vec2 Vu;void main(void){if(ENw){Vp=vec4(0.0,0.0,0.0,0.0);Vn=vec3(0.0,0.0,0.0);Vp+=(MXF[int(i.x)]*p)*w.x;Vn+=(MNR[int(i.x)]*n)*w.x;Vp+=(MXF[int(i.y)]*p)*w.y;Vn+=(MNR[int(i.y)]*n)*w.y;Vp+=(MXF[int(i.z)]*p)*w.z;Vn+=(MNR[int(i.z)]*n)*w.z;Vp+=(MXF[int(i.w)]*p)*w.w;Vn+=(MNR[int(i.w)]*n)*w.w;}else{Vp=MXF[0]*p;Vn=MNR[0]*n;}Vu=u.xy;gl_Position=MEV*Vp;}";
Ovoid.GLSL_VL_PNUIW_HYBRID_LP_VS="#define MA "+Ovoid.MAX_JOINT_BY_SKIN+"\nattribute vec4 p;attribute vec3 n;attribute vec3 u;attribute vec4 i;attribute vec4 w;uniform bool ENd;uniform bool ENw;uniform mat4 MEV;uniform mat4 MXF[MA];uniform mat3 MNR[MA];uniform vec4 Ep;uniform vec4 Lp;uniform vec3 Ld;uniform vec4 Lc;uniform float Li;uniform float Lr;uniform float Lf;uniform float La;uniform float My;uniform float Mi;varying vec4 Vp;varying vec3 Vn;varying vec2 Vu;varying vec4 Cd;varying vec4 Cs;vec3 LV, R, EV;float LT, Fw;void main(void){if(ENw){Vp=vec4(0.0,0.0,0.0,0.0);Vn=vec3(0.0,0.0,0.0);Vp+=(MXF[int(i.x)]*p)*w.x;Vn+=(MNR[int(i.x)]*n)*w.x;Vp+=(MXF[int(i.y)]*p)*w.y;Vn+=(MNR[int(i.y)]*n)*w.y;Vp+=(MXF[int(i.z)]*p)*w.z;Vn+=(MNR[int(i.z)]*n)*w.z;Vp+=(MXF[int(i.w)]*p)*w.w;Vn+=(MNR[int(i.w)]*n)*w.w;}else{Vp=MXF[0]*p;Vn=MNR[0]*n;}Vu=u.xy;gl_Position=MEV*Vp;Cd=vec4(0.0,0.0,0.0,0.0);Cs=vec4(0.0,0.0,0.0,0.0);if(ENd){EV=normalize(Ep-Vp).xyz;if(Lp.w==1.0){LV=normalize(Lp-Vp).xyz;LT=max(dot(Vn,LV),0.0);Fw=clamp((-dot(LV,Ld)-(cos(La)))/(Lf),0.0,1.0);}else{LV=Ld*-1.0;LT=max(dot(Vn,LV),0.0);Fw=1.0;}Cd+=(Lc*Li*LT)*Fw;R=normalize(reflect(-LV,Vn));Cs+=Lc*Li*(pow(max(dot(R,EV),0.0),Mi))*Fw;}}";
Ovoid.GLSL_VL_PNUIW_HYBRID_1P_VS="#define MA "+Ovoid.MAX_JOINT_BY_SKIN+"\n#define ML "+Ovoid.MAX_LIGHT_BY_DRAW+"\nattribute vec4 p;attribute vec3 n;attribute vec3 u;attribute vec4 i;attribute vec4 w;uniform bool ENw;uniform mat4 MEV;uniform mat4 MXF[MA];uniform mat3 MNR[MA];uniform vec4 Ep;uniform vec4 Lp[ML];uniform vec3 Ld[ML];uniform vec4 Lc[ML];uniform float Li[ML];uniform float Lr[ML];uniform float Lf[ML];uniform float La[ML];uniform bool Le[ML];uniform float My;uniform float Mi;varying vec4 Vp;varying vec3 Vn;varying vec2 Vu;varying vec4 Cd;varying vec4 Cs;vec3 LV, R, EV;float LT, Fw;void main(void){if(ENw){Vp=vec4(0.0,0.0,0.0,0.0);Vn=vec3(0.0,0.0,0.0);Vp+=(MXF[int(i.x)]*p)*w.x;Vn+=(MNR[int(i.x)]*n)*w.x;Vp+=(MXF[int(i.y)]*p)*w.y;Vn+=(MNR[int(i.y)]*n)*w.y;Vp+=(MXF[int(i.z)]*p)*w.z;Vn+=(MNR[int(i.z)]*n)*w.z;Vp+=(MXF[int(i.w)]*p)*w.w;Vn+=(MNR[int(i.w)]*n)*w.w;}else{Vp=MXF[0]*p;Vn=MNR[0]*n;}Vu=u.xy;gl_Position=MEV*Vp;Cd=vec4(0.0,0.0,0.0,0.0);Cs=vec4(0.0,0.0,0.0,0.0);EV=normalize(Ep-Vp).xyz;for(int i=0;i<ML;i++){if(Le[i]){if(Lp[i].w==1.0){LV=normalize(Lp[i]-Vp).xyz;LT=max(dot(Vn,LV),0.0);Fw=clamp((-dot(LV,Ld[i])-(cos(La[i])))/(Lf[i]), 0.0, 1.0);}else{LV=Ld[i]*-1.0;LT=max(dot(Vn,LV),0.0);Fw=1.0;}Cd+=(Lc[i]*Li[i]*LT)*Fw;R=normalize(reflect(-LV,Vn));Cs+=Lc[i]*Li[i]*(pow(max(dot(R,EV),0.0),Mi))*Fw;}}}";
Ovoid.GLSL_C_FS="precision highp float;uniform vec4 C;void main(void){gl_FragColor=C;}";Ovoid.GLSL_C_ADEPTH_FS="precision highp float;uniform vec4 C;void main(void){gl_FragColor=C;gl_FragColor.a=gl_FragCoord.z;}";Ovoid.GLSL_BLACK_FS="precision highp float;void main(void){gl_FragColor=vec4(0.0,0.0,0.0,1.0);}";Ovoid.GLSL_VCC_FS="precision highp float;uniform vec4 C;varying vec4 Vc;void main(void){gl_FragColor=Vc*C;}";Ovoid.GLSL_C_TEX_FS="precision highp float;uniform vec4 C;uniform sampler2D Sd;varying vec2 Vu;void main(void){gl_FragColor=texture2D(Sd,Vu)*C;}";
Ovoid.GLSL_VC_TEX_PARTICLE_FS="precision highp float;uniform sampler2D Sd;varying vec4 Vc;void main(void){gl_FragColor=texture2D(Sd,gl_PointCoord)*Vc;}";Ovoid.GLSL_C_TEX_BILLBOARD_FS="precision highp float;uniform sampler2D Sd;uniform vec4 C;varying vec2 Vu;varying float z;void main(void){gl_FragColor=texture2D(Sd,Vu)*C;}";Ovoid.GLSL_VL_ADS_1TEX_FS="precision highp float;uniform vec4 Ac;uniform sampler2D Sd;uniform bool ENa;uniform bool ENd;uniform vec4 Md;uniform vec4 Ms;uniform float Mo;uniform vec4 Fc;uniform float Fd;varying vec2 Vu;varying vec4 Cd;varying vec4 Cs;vec4 D;float Fz, Ff;void main(void){gl_FragColor=vec4(0.0,0.0,0.0,0.0);D=Md*texture2D(Sd,Vu);if(ENa)gl_FragColor+=(D*Ac);if(ENd){gl_FragColor+=(D*Cd)+(Ms*Cs);if(Fd>0.0){Fz=gl_FragCoord.z/gl_FragCoord.w;Ff=clamp(exp2(-Fd*Fd*Fz*Fz*1.442695),0.0,1.0);gl_FragColor=mix(Fc,gl_FragColor,Ff);}}gl_FragColor.a=Mo;}";
Ovoid.GLSL_VL_AERDS_FULLTEX_FS="precision highp float;uniform vec4 Ac;uniform sampler2D Sd;uniform sampler2D Ss;uniform sampler2D Se;uniform sampler2D Sr;uniform vec4 Ep;uniform bool ENa;uniform bool ENd;uniform vec4 Md;uniform vec4 Ma;uniform vec4 Ms;uniform vec4 Me;uniform vec4 Mr;uniform float My;uniform float Mo;uniform vec4 Fc;uniform float Fd;varying vec2 Vu;varying vec4 Cd;varying vec4 Cs;varying vec3 Vn;varying vec4 Vp;float Fz, Ff;vec4 Td;vec3 R, EV;vec2 Ru;void main(void){gl_FragColor=vec4(0.0,0.0,0.0,0.0);Td=texture2D(Sd,Vu);if(ENa){gl_FragColor=(Md*Ma*Td)*Ac;gl_FragColor+=(texture2D(Se,Vu)*Me);if(My!=0.0){EV=normalize(Ep-Vp).xyz;R=normalize(reflect(EV,Vn));Ru=(R.xy/(2.0*(1.0+abs(R.z))))+0.5;gl_FragColor+=(Mr*texture2D(Sr,Ru))*My;}gl_FragColor.a=Mo*Td.a;}if(ENd){gl_FragColor+=(Md*Td)*Cd;gl_FragColor.a=Mo*Td.a;gl_FragColor+=(Ms*texture2D(Ss,Vu))*Cs;if(Fd>0.0){Fz=gl_FragCoord.z/gl_FragCoord.w;Ff=clamp(exp2(-Fd*Fd*Fz*Fz*1.442695),0.0,1.0);gl_FragColor=mix(Fc,gl_FragColor,Ff);}}}";
Ovoid.GLSL_AERDS_FULLTEX_LP_FS="precision highp float;uniform bool ENd;uniform bool ENa;uniform vec4 Ep;uniform vec4 Ac;uniform vec4 Lp;uniform vec3 Ld;uniform vec4 Lc;uniform float Li;uniform float Lr;uniform float Lf;uniform float La;uniform vec4 Md;uniform vec4 Ma;uniform vec4 Ms;uniform vec4 Me;uniform vec4 Mr;uniform float Mi;uniform float My;uniform float Mo;uniform sampler2D Sa;uniform sampler2D Sd;uniform sampler2D Ss;uniform sampler2D Se;uniform sampler2D Sr;uniform vec4 Fc;uniform float Fd;varying vec4 Vp;varying vec3 Vn;varying vec2 Vu;vec4 Td;float LT, Fw, Dw, Sw, Fz, Ff;vec3 EV, R, LV;vec2 Ru;void main(void){EV=normalize(Ep-Vp).xyz;gl_FragColor=vec4(0.0,0.0,0.0,0.0);Td=texture2D(Sd,Vu);if(ENa){gl_FragColor=(Ma*Md*Td)*Ac;gl_FragColor+=(Me*texture2D(Se,Vu));if(My!=0.0){R=normalize(reflect(EV,Vn));Ru=(R.xy/(2.0*(1.0+abs(R.z))))+0.5;gl_FragColor+=(Mr*texture2D(Sr,Ru))*My;}gl_FragColor.a=Td.a*Mo;}if(ENd){if(Lp.w==1.0){LV=normalize(Lp-Vp).xyz;LT=max(dot(Vn,LV),0.0);Fw=clamp((-dot(LV,Ld)-(cos(La)))/(Lf),0.0,1.0);}else{LV=Ld*-1.0;LT=max(dot(Vn,LV),0.0);Fw=1.0;}Dw=LT*Li*Fw;R=normalize(reflect(-LV,Vn));Sw=(pow(max(dot(R,EV),0.0),Mi))*Fw;gl_FragColor+=(Md*Td)*((Lc*Li)*Dw);gl_FragColor.a=Td.a*Mo;gl_FragColor+=(Ms*texture2D(Ss,Vu))*((Lc*Li)*Sw);}}";
Ovoid.GLSL_AERDS_FULLTEX_1P_FS="#define ML "+Ovoid.MAX_LIGHT_BY_DRAW+"\nprecision highp float;uniform vec4 Ep;uniform vec4 Ac;uniform vec4 Lp[ML];uniform vec3 Ld[ML];uniform vec4 Lc[ML];uniform float Li[ML];uniform float Lr[ML];uniform float Lf[ML];uniform float La[ML];uniform bool Le[ML];uniform vec4 Md;uniform vec4 Ma;uniform vec4 Ms;uniform vec4 Me;uniform vec4 Mr;uniform float Mi;uniform float My;uniform float Mo;uniform sampler2D Sa;uniform sampler2D Sd;uniform sampler2D Ss;uniform sampler2D Se;uniform sampler2D Sr;uniform vec4 Fc;uniform float Fd;varying vec4 Vp;varying vec3 Vn;varying vec2 Vu;vec4 Td;float LT, Fw, Dw, Sw, Fz, Ff;vec3 EV, R, LV;vec2 Ru;void main(void){EV=normalize(Ep-Vp).xyz;Td=texture2D(Sd,Vu);gl_FragColor=(Ma*Md*Td)*Ac;gl_FragColor+=(Me*texture2D(Se,Vu));if(My!=0.0){R=normalize(reflect(EV,Vn));Ru=(R.xy/(2.0*(1.0+abs(R.z))))+0.5;gl_FragColor+=(Mr*texture2D(Sr,Ru))*My;}for(int i=0;i<ML;i++){if(Le[i]){if(Lp[i].w==1.0){LV=normalize(Lp[i]-Vp).xyz;LT=max(dot(Vn,LV),0.0);Fw=clamp((-dot(LV,Ld[i])-(cos(La[i])))/(Lf[i]),0.0,1.0);}else{LV=Ld[i]*-1.0;LT=max(dot(Vn,LV),0.0);Fw=1.0;}Dw=LT*Li[i]*Fw;R=normalize(reflect(-LV,Vn));Sw=(pow(max(dot(R,EV),0.0),Mi))*Fw;gl_FragColor+=(Md*Td)*((Lc[i]*Li[i])*Dw);gl_FragColor.a=Td.a*Mo;gl_FragColor+=(Ms*texture2D(Ss,Vu))*((Lc[i]*Li[i])*Sw);}}if(Fd>0.0){Fz=gl_FragCoord.z/gl_FragCoord.w;Ff=clamp(exp2(-Fd*Fd*Fz*Fz*1.442695),0.0,1.0);gl_FragColor=mix(Fc,gl_FragColor,Ff);}}";
Ovoid.GLSL_FOG_FS="precision highp float;uniform vec4 Fc;uniform float Fd;float Fz, Ff;void main(void){gl_FragColor=vec4(0.0,0.0,0.0,0.0);Fz=gl_FragCoord.z/gl_FragCoord.w;Ff=clamp(exp2(-Fd*Fd*Fz*Fz*1.442695),0.0,1.0);gl_FragColor=mix(Fc,gl_FragColor,Ff);}";Ovoid.VERSION="2.0";Ovoid.FIRSTBUILD_DATE="16-07-2012";Ovoid.RELEASE_DATE="24-06-2014";Ovoid.Stack=function(a){Array.call(this);this.count=0;this.length=a};Ovoid.Stack.prototype=[];Ovoid.Stack.prototype.constructor=Ovoid.Stack;Ovoid.Stack.prototype.add=function(a){this.count!=this.length&&(this[this.count]=a,this.count++)};Ovoid.Stack.prototype.empty=function(){this.count=0};Ovoid.Stack.prototype.has=function(a){for(var b=this.count;b--;)if(this[b]===a)return!0;return!1};Ovoid.Stack.prototype.isFull=function(){return this.count===this.length};Ovoid.Stack.prototype.isEmpty=function(){return!this.count};
Ovoid.Stack.prototype.current=function(){return this[this.count]};Ovoid.Stack.prototype.forward=function(){this.count!=this.length&&this.count++};Ovoid.Stack.prototype.backward=function(){this.count&&this.count--};Ovoid.Vector=function(a,b,c){this.v=new Float32Array(3);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c)};Ovoid.Vector.prototype.set=function(a,b,c){this.v[0]=a;this.v[1]=b;this.v[2]=c};Ovoid.Vector.prototype.setv=function(a){this.v.set(a)};Ovoid.Vector.prototype.copy=function(a){this.v.set(a.v.subarray(0,3))};Ovoid.Vector.prototype.equal=function(a){return this.v[0]==a.v[0]&&this.v[1]==a.v[1]&&this.v[2]==a.v[2]};
Ovoid.Vector.prototype.subBy=function(a){this.v[0]-=a.v[0];this.v[1]-=a.v[1];this.v[2]-=a.v[2]};Ovoid.Vector.prototype.scaleBy=function(a){this.v[0]*=a;this.v[1]*=a;this.v[2]*=a};Ovoid.Vector.prototype.addBy=function(a){this.v[0]+=a.v[0];this.v[1]+=a.v[1];this.v[2]+=a.v[2]};Ovoid.Vector.prototype.crossBy=function(a){var b=this.v[2]*a.v[0]-this.v[0]*a.v[2],c=this.v[0]*a.v[1]-this.v[1]*a.v[0];this.v[0]=this.v[1]*a.v[2]-this.v[2]*a.v[1];this.v[1]=b;this.v[2]=c};
Ovoid.Vector.prototype.subOf=function(a,b){this.v[0]=a.v[0]-b.v[0];this.v[1]=a.v[1]-b.v[1];this.v[2]=a.v[2]-b.v[2]};Ovoid.Vector.prototype.addOf=function(a,b){this.v[0]=a.v[0]+b.v[0];this.v[1]=a.v[1]+b.v[1];this.v[2]=a.v[2]+b.v[2]};Ovoid.Vector.prototype.normalize=function(){var a=Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]);this.v[0]/=a;this.v[1]/=a;this.v[2]/=a};Ovoid.Vector.prototype.dot=function(a){return this.v[0]*a.v[0]+this.v[1]*a.v[1]+this.v[2]*a.v[2]};
Ovoid.Vector.prototype.size=function(){return Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2])};Ovoid.Vector.prototype.size2=function(){return this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]};Ovoid.Vector.prototype.crossOf=function(a,b){this.v[0]=a.v[1]*b.v[2]-a.v[2]*b.v[1];this.v[1]=a.v[2]*b.v[0]-a.v[0]*b.v[2];this.v[2]=a.v[0]*b.v[1]-a.v[1]*b.v[0]};
Ovoid.Vector.prototype.dist=function(a){var b=this.v[0]-a.v[0],c=this.v[1]-a.v[1],a=this.v[2]-a.v[2];return Math.sqrt(b*b+c*c+a*a)};Ovoid.Vector.prototype.dist2=function(a){var b=this.v[0]-a.v[0],c=this.v[1]-a.v[1],a=this.v[2]-a.v[2];return b*b+c*c+a*a};Ovoid.Vector.prototype.transform4=function(a){var b=this.v[0]*a.m[1]+this.v[1]*a.m[5]+this.v[2]*a.m[9],c=this.v[0]*a.m[2]+this.v[1]*a.m[6]+this.v[2]*a.m[10];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[4]+this.v[2]*a.m[8];this.v[1]=b;this.v[2]=c};
Ovoid.Vector.prototype.transform4Of=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[4]+a.v[2]*b.m[8];this.v[1]=a.v[0]*b.m[1]+a.v[1]*b.m[5]+a.v[2]*b.m[9];this.v[2]=a.v[0]*b.m[2]+a.v[1]*b.m[6]+a.v[2]*b.m[10]};Ovoid.Vector.prototype.transform4Inverse=function(a){var b=this.v[0]*a.m[4]+this.v[1]*a.m[5]+this.v[2]*a.m[6],c=this.v[0]*a.m[8]+this.v[1]*a.m[9]+this.v[2]*a.m[10];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[1]+this.v[2]*a.m[2];this.v[1]=b;this.v[2]=c};
Ovoid.Vector.prototype.transform4InverseOf=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[1]+a.v[2]*b.m[2];this.v[1]=a.v[0]*b.m[4]+a.v[1]*b.m[5]+a.v[2]*b.m[6];this.v[2]=a.v[0]*b.m[8]+a.v[1]*b.m[9]+a.v[2]*b.m[10]};Ovoid.Vector.prototype.transform3=function(a){var b=this.v[0]*a.m[1]+this.v[1]*a.m[4]+this.v[2]*a.m[7],c=this.v[0]*a.m[2]+this.v[1]*a.m[5]+this.v[2]*a.m[8];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[3]+this.v[2]*a.m[6];this.v[1]=b;this.v[2]=c};
Ovoid.Vector.prototype.transform3Inverse=function(a){var b=this.v[0]*a.m[3]+this.v[1]*a.m[4]+this.v[2]*a.m[5],c=this.v[0]*a.m[6]+this.v[1]*a.m[7]+this.v[2]*a.m[8];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[1]+this.v[2]*a.m[2];this.v[1]=b;this.v[2]=c};Ovoid.Vector.prototype.transform3Of=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[3]+a.v[2]*b.m[6];this.v[1]=a.v[0]*b.m[1]+a.v[1]*b.m[4]+a.v[2]*b.m[7];this.v[2]=a.v[0]*b.m[2]+a.v[1]*b.m[5]+a.v[2]*b.m[8]};
Ovoid.Vector.prototype.transform3InverseOf=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[1]+a.v[2]*b.m[2];this.v[1]=a.v[0]*b.m[3]+a.v[1]*b.m[4]+a.v[2]*b.m[5];this.v[2]=a.v[0]*b.m[6]+a.v[1]*b.m[7]+a.v[2]*b.m[8]};Ovoid.Vector.prototype.addWeightTransform3Of=function(a,b,c){this.v[0]+=(a.v[0]*b.m[0]+a.v[1]*b.m[3]+a.v[2]*b.m[6])*c;this.v[1]+=(a.v[0]*b.m[1]+a.v[1]*b.m[4]+a.v[2]*b.m[7])*c;this.v[2]+=(a.v[0]*b.m[2]+a.v[1]*b.m[5]+a.v[2]*b.m[8])*c};
Ovoid.Vector.prototype.reflect=function(a){var b=-2*(this.v[0]*a.v[0]+this.v[1]*a.v[1]+this.v[2]*a.v[2]);this.v[0]+=a.v[0]*b;this.v[1]+=a.v[1]*b;this.v[2]+=a.v[2]*b};Ovoid.Vector.prototype.isNaN=function(){return isNaN(this.v[0])||isNaN(this.v[1])||isNaN(this.v[2])};Ovoid.Vector.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Vector);return b};Ovoid.Vector.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Point=function(a,b,c,e){this.v=new Float32Array(4);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c,this.v[3]=e)};Ovoid.Point.prototype.set=function(a,b,c,e){this.v[0]=a;this.v[1]=b;this.v[2]=c;this.v[3]=e};Ovoid.Point.prototype.setv=function(a){this.v.set(a)};Ovoid.Point.prototype.copy=function(a){this.v.set(a.v)};Ovoid.Point.prototype.equal=function(a){return this.v[0]==a.v[0]&&this.v[1]==a.v[1]&&this.v[2]==a.v[2]};
Ovoid.Point.prototype.subBy=function(a){this.v[0]-=a.v[0];this.v[1]-=a.v[1];this.v[2]-=a.v[2];this.v[3]-=a.v[3]};Ovoid.Point.prototype.addBy=function(a){this.v[0]+=a.v[0];this.v[1]+=a.v[1];this.v[2]+=a.v[2];this.v[3]+=a.v[3]};Ovoid.Point.prototype.scaleBy=function(a){this.v[0]*=a;this.v[1]*=a;this.v[2]*=a;this.v[3]*=a};Ovoid.Point.prototype.subOf=function(a,b){this.v[0]=a.v[0]-b.v[0];this.v[1]=a.v[1]-b.v[1];this.v[2]=a.v[2]-b.v[2];this.v[3]=a.v[3]-b.v[3]};
Ovoid.Point.prototype.addOf=function(a,b){this.v[0]=a.v[0]+b.v[0];this.v[1]=a.v[1]+b.v[1];this.v[2]=a.v[2]+b.v[2];this.v[3]=a.v[3]+b.v[3]};Ovoid.Point.prototype.normalize=function(){var a=Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]);this.v[0]/=a;this.v[1]/=a;this.v[2]/=a;this.v[3]=1};Ovoid.Point.prototype.normalizeWeight=function(){this.v[0]/=this.v[3];this.v[1]/=this.v[3];this.v[2]/=this.v[3];this.v[3]=1};
Ovoid.Point.prototype.dot=function(a){return this.v[0]*a.v[0]+this.v[1]*a.v[1]+this.v[2]*a.v[2]};Ovoid.Point.prototype.size=function(){return Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2])};Ovoid.Point.prototype.size2=function(){return this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]};Ovoid.Point.prototype.dist=function(a){var b=this.v[0]-a.v[0],c=this.v[1]-a.v[1],a=this.v[2]-a.v[2];return Math.sqrt(b*b+c*c+a*a)};
Ovoid.Point.prototype.dist2=function(a){var b=this.v[0]-a.v[0],c=this.v[1]-a.v[1],a=this.v[2]-a.v[2];return b*b+c*c+a*a};Ovoid.Point.prototype.transform4=function(a){var b=this.v[0]*a.m[1]+this.v[1]*a.m[5]+this.v[2]*a.m[9]+this.v[3]*a.m[13],c=this.v[0]*a.m[2]+this.v[1]*a.m[6]+this.v[2]*a.m[10]+this.v[3]*a.m[14];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[4]+this.v[2]*a.m[8]+this.v[3]*a.m[12];this.v[1]=b;this.v[2]=c};
Ovoid.Point.prototype.transform4Of=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[4]+a.v[2]*b.m[8]+a.v[3]*b.m[12];this.v[1]=a.v[0]*b.m[1]+a.v[1]*b.m[5]+a.v[2]*b.m[9]+a.v[3]*b.m[13];this.v[2]=a.v[0]*b.m[2]+a.v[1]*b.m[6]+a.v[2]*b.m[10]+a.v[3]*b.m[14]};
Ovoid.Point.prototype.transform4Inverse=function(a){var b=this.v[0]-a.m[12]*this.v[3],c=this.v[1]-a.m[13]*this.v[3],e=this.v[2]-a.m[14]*this.v[3];this.v[0]=b*a.m[0]+c*a.m[1]+e*a.m[2];this.v[1]=b*a.m[4]+c*a.m[5]+e*a.m[6];this.v[2]=b*a.m[8]+c*a.m[9]+e*a.m[10]};Ovoid.Point.prototype.transform4InverseOf=function(a,b){var c=a.v[0]-b.m[12]*a.v[3],e=a.v[1]-b.m[13]*a.v[3],f=a.v[2]-b.m[14]*a.v[3];this.v[0]=c*b.m[0]+e*b.m[1]+f*b.m[2];this.v[1]=c*b.m[4]+e*b.m[5]+f*b.m[6];this.v[2]=c*b.m[8]+e*b.m[9]+f*b.m[10]};
Ovoid.Point.prototype.addWeightTransform4Of=function(a,b,c){this.v[0]+=(a.v[0]*b.m[0]+a.v[1]*b.m[4]+a.v[2]*b.m[8]+b.m[12])*c;this.v[1]+=(a.v[0]*b.m[1]+a.v[1]*b.m[5]+a.v[2]*b.m[9]+b.m[13])*c;this.v[2]+=(a.v[0]*b.m[2]+a.v[1]*b.m[6]+a.v[2]*b.m[10]+b.m[14])*c;this.v[3]+=c};
Ovoid.Point.prototype.transform3=function(a){var b=this.v[0]*a.m[1]+this.v[1]*a.m[4]+this.v[2]*a.m[7],c=this.v[0]*a.m[2]+this.v[1]*a.m[5]+this.v[2]*a.m[8];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[3]+this.v[2]*a.m[6];this.v[1]=b;this.v[2]=c};Ovoid.Point.prototype.transform3Of=function(a,b){this.v[0]=a.v[0]*b.m[0]+a.v[1]*b.m[3]+a.v[2]*b.m[6];this.v[1]=a.v[0]*mat4.m[1]+a.v[1]*b.m[4]+a.v[2]*b.m[7];this.v[2]=a.v[0]*mat4.m[2]+a.v[1]*b.m[5]+a.v[2]*b.m[8]};
Ovoid.Point.prototype.transform3Inverse=function(a){var b=this.v[0]*a.m[3]+this.v[1]*a.m[4]+this.v[2]*a.m[5],c=this.v[0]*a.m[6]+this.v[1]*a.m[7]+this.v[2]*a.m[8];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[1]+this.v[2]*a.m[2];this.v[1]=b;this.v[2]=c};Ovoid.Point.prototype.transform3InverseOf=function(a){this.v[0]=a.v[0]*mat4.m[0]+a.v[1]*mat4.m[1]+a.v[2]*mat4.m[2];this.v[1]=a.v[0]*mat4.m[3]+a.v[1]*mat4.m[4]+a.v[2]*mat4.m[5];this.v[2]=a.v[0]*mat4.m[6]+a.v[1]*mat4.m[7]+a.v[2]*mat4.m[8]};
Ovoid.Point.prototype.isNaN=function(){return isNaN(this.v[0])||isNaN(this.v[1])||isNaN(this.v[2])||isNaN(this.v[3])};Ovoid.Point.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Point);return b};Ovoid.Point.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Coord=function(a,b,c){this.v=new Float32Array(3);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c)};Ovoid.Coord.prototype.set=function(a,b,c){this.v[0]=a;this.v[1]=b;this.v[2]=c};Ovoid.Coord.prototype.setv=function(a){this.v.set(a)};Ovoid.Coord.prototype.copy=function(a){this.v.set(a.v.subarray(0,3))};Ovoid.Coord.prototype.equal=function(a){return this.v[0]==a.v[0]&&this.v[1]==a.v[1]&&this.v[2]==a.v[2]};
Ovoid.Coord.prototype.subOf=function(a,b){this.v[0]=a.v[0]-b.v[0];this.v[1]=a.v[1]-b.v[1];this.v[2]=a.v[2]-b.v[2]};Ovoid.Coord.prototype.addOf=function(a,b){this.v[0]=a.v[0]-b.v[0];this.v[1]=a.v[1]-b.v[1];this.v[2]=a.v[2]-b.v[2]};Ovoid.Coord.prototype.scaleBy=function(a){this.v[0]*=a;this.v[1]*=a;this.v[2]*=a};
Ovoid.Coord.prototype.transform=function(a){var b=this.v[0]*a.m[1]+this.v[1]*a.m[5]+this.v[2]*a.m[9],c=this.v[0]*a.m[2]+this.v[1]*a.m[6]+this.v[2]*a.m[10];this.v[0]=this.v[0]*a.m[0]+this.v[1]*a.m[4]+this.v[2]*a.m[8];this.v[1]=b;this.v[2]=c};Ovoid.Coord.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Euler=function(a,b,c){this.v=new Float32Array(3);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c)};Ovoid.Euler.prototype.set=function(a,b,c){this.v[0]=a;this.v[1]=b;this.v[2]=c};Ovoid.Euler.prototype.setv=function(a){this.v.set(a)};Ovoid.Euler.prototype.copy=function(a){this.v[0]=a.v[0];this.v[1]=a.v[1];this.v[2]=a.v[2]};Ovoid.Euler.prototype.addBy=function(a){this.v[0]+=a.v[0];this.v[1]+=a.v[1];this.v[2]+=a.v[2]};
Ovoid.Euler.prototype.addByXyx=function(a,b,c){this.v[0]+=a;this.v[1]+=b;this.v[2]+=c};Ovoid.Euler.prototype.fromMat3=function(a){var b=Math.sqrt(a.m[0]*a.m[0]+a.m[1]*a.m[1]);0.001<b?(this.v[0]=Math.atan2(a.m[5],a.m[8]),this.v[1]=Math.atan2(-a.m[2],b),this.v[2]=Math.atan2(a.m[1],a.m[0])):(this.v[0]=Math.atan2(-a.m[7],a.m[4]),this.v[1]=Math.atan2(-a.m[2],b),this.v[2]=0)};
Ovoid.Euler.prototype.fromMat4=function(a){var b=Math.sqrt(a.m[0]*a.m[0]+a.m[1]*a.m[1]);0.001<b?(this.v[0]=Math.atan2(a.m[6],a.m[10]),this.v[1]=Math.atan2(-a.m[2],b),this.v[2]=Math.atan2(a.m[1],a.m[0])):(this.v[0]=Math.atan2(-a.m[9],a.m[5]),this.v[1]=Math.atan2(-a.m[2],b),this.v[2]=0)};
Ovoid.Euler.prototype.asMat4=function(){var a=new Ovoid.Matrix4,b=Math.cos(this.v[0]),c=Math.cos(this.v[1]),e=Math.cos(this.v[2]),f=Math.sin(this.v[0]),g=Math.sin(this.v[1]),h=Math.sin(this.v[2]),k=b*e,j=b*h,m=f*e,l=f*h;a.m[0]=c*e;a.m[1]=c*h;a.m[2]=-g;a.m[4]=g*m-j;a.m[5]=g*l+k;a.m[6]=c*f;a.m[8]=g*k+l;a.m[9]=g*j-m;a.m[10]=c*b;return a};
Ovoid.Euler.prototype.asQuat=function(){var a=new Ovoid.Quaternion,b=Math.sin(-0.5*this.v[0]),c=Math.cos(-0.5*this.v[0]),e=Math.sin(-0.5*this.v[1]),f=Math.cos(-0.5*this.v[1]),g=Math.sin(-0.5*this.v[2]),h=Math.cos(-0.5*this.v[2]),k=b*f,j=c*e,b=b*e,c=c*f;a.v[0]=k*h+j*g;a.v[1]=j*h-k*g;a.v[2]=c*g+b*h;a.v[3]=c*h-b*g;return a};Ovoid.Euler.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Euler);return b};Ovoid.Euler.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Quaternion=function(a,b,c,e){this.v=new Float32Array(4);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c,this.v[3]=e)};Ovoid.Quaternion.prototype.set=function(a,b,c,e){this.v[0]=a;this.v[1]=b;this.v[2]=c;this.v[3]=e};Ovoid.Quaternion.prototype.setv=function(a){this.v.set(a)};Ovoid.Quaternion.prototype.copy=function(a){this.v.set(a.v)};
Ovoid.Quaternion.prototype.multBy=function(a){var b=this.v[3]*a.v[1]+this.v[1]*a.v[3]+this.v[2]*a.v[0]-this.v[0]*a.v[2],c=this.v[3]*a.v[2]+this.v[2]*a.v[3]+this.v[0]*a.v[1]-this.v[1]*a.v[0],e=this.v[3]*a.v[3]-this.v[0]*a.v[0]-this.v[1]*a.v[1]-this.v[2]*a.v[2];this.v[0]=this.v[3]*a.v[0]+this.v[0]*a.v[3]+this.v[1]*a.v[2]-this.v[2]*a.v[1];this.v[1]=b;this.v[2]=c;this.v[3]=e};
Ovoid.Quaternion.prototype.multByXyzw=function(a,b,c,e){var f=this.v[3]*b+this.v[1]*e+this.v[2]*a-this.v[0]*c,g=this.v[3]*c+this.v[2]*e+this.v[0]*b-this.v[1]*a,h=this.v[3]*e-this.v[0]*a-this.v[1]*b-this.v[2]*c;this.v[0]=this.v[3]*a+this.v[0]*e+this.v[1]*c-this.v[2]*b;this.v[1]=f;this.v[2]=g;this.v[3]=h};
Ovoid.Quaternion.prototype.multOf=function(a,b){this.v[0]=a.v[3]*b.v[0]+a.v[0]*b.v[3]+a.v[1]*b.v[2]-a.v[2]*b.v[1];this.v[1]=a.v[3]*b.v[1]+a.v[1]*b.v[3]+a.v[2]*b.v[0]-a.v[0]*b.v[2];this.v[2]=a.v[3]*b.v[2]+a.v[2]*b.v[3]+a.v[0]*b.v[1]-a.v[1]*b.v[0];this.v[3]=a.v[3]*b.v[3]-a.v[0]*b.v[0]-a.v[1]*b.v[1]-a.v[2]*b.v[2]};
Ovoid.Quaternion.prototype.multSwapBy=function(a){var b=a.v[3]*this.v[1]+a.v[1]*this.v[3]+a.v[2]*this.v[0]-a.v[0]*this.v[2],c=a.v[3]*this.v[2]+a.v[2]*this.v[3]+a.v[0]*this.v[1]-a.v[1]*this.v[0],e=a.v[3]*this.v[3]-a.v[0]*this.v[0]-a.v[1]*this.v[1]-a.v[2]*this.v[2];this.v[0]=a.v[3]*this.v[0]+a.v[0]*this.v[3]+a.v[1]*this.v[2]-a.v[2]*this.v[1];this.v[1]=b;this.v[2]=c;this.v[3]=e};
Ovoid.Quaternion.prototype.multSwapByXyz=function(a,b,c,e){var f=e*this.v[1]+b*this.v[3]+c*this.v[0]-a*this.v[2],g=e*this.v[2]+c*this.v[3]+a*this.v[1]-b*this.v[0],h=e*this.v[3]-a*this.v[0]-b*this.v[1]-c*this.v[2];this.v[0]=e*this.v[0]+a*this.v[3]+b*this.v[2]-c*this.v[1];this.v[1]=f;this.v[2]=g;this.v[3]=h};
Ovoid.Quaternion.prototype.rotateBy=function(a){var b=Math.sin(-0.5*a.v[0]),c=Math.cos(-0.5*a.v[0]),e=Math.sin(-0.5*a.v[1]),f=Math.cos(-0.5*a.v[1]),g=Math.sin(-0.5*a.v[2]),a=Math.cos(-0.5*a.v[2]),h=b*f,k=c*e,b=b*e,f=c*f,c=h*a+k*g,h=k*a-h*g,k=f*g+b*a,g=f*a-b*g,a=this.v[3]*h+this.v[1]*g+this.v[2]*c-this.v[0]*k,b=this.v[3]*k+this.v[2]*g+this.v[0]*h-this.v[1]*c,f=this.v[3]*g-this.v[0]*c-this.v[1]*h-this.v[2]*k;this.v[0]=this.v[3]*c+this.v[0]*g+this.v[1]*k-this.v[2]*h;this.v[1]=a;this.v[2]=b;this.v[3]=
f};Ovoid.Quaternion.prototype.rotateByXyz=function(a,b,c){var e=Math.sin(-0.5*a),a=Math.cos(-0.5*a),f=Math.sin(-0.5*b),g=Math.cos(-0.5*b),b=Math.sin(-0.5*c),c=Math.cos(-0.5*c),h=e*g,k=a*f,f=e*f,g=a*g,e=h*c+k*b,a=k*c-h*b,h=g*b+f*c,b=g*c-f*b,c=this.v[3]*a+this.v[1]*b+this.v[2]*e-this.v[0]*h,k=this.v[3]*h+this.v[2]*b+this.v[0]*a-this.v[1]*e,f=this.v[3]*b-this.v[0]*e-this.v[1]*a-this.v[2]*h;this.v[0]=this.v[3]*e+this.v[0]*b+this.v[1]*h-this.v[2]*a;this.v[1]=c;this.v[2]=k;this.v[3]=f};
Ovoid.Quaternion.prototype.rotateSwapBy=function(a){var b=Math.sin(-0.5*a.v[0]),c=Math.cos(-0.5*a.v[0]),e=Math.sin(-0.5*a.v[1]),f=Math.cos(-0.5*a.v[1]),g=Math.sin(-0.5*a.v[2]),a=Math.cos(-0.5*a.v[2]),h=b*f,k=c*e,b=b*e,f=c*f,c=h*a+k*g,h=k*a-h*g,k=f*g+b*a,g=f*a-b*g,a=this.v[0],b=this.v[1],f=this.v[2],e=this.v[3];this.v[0]=g*a+c*e+h*f-k*b;this.v[1]=g*b+h*e+k*a-c*f;this.v[2]=g*f+k*e+c*b-h*a;this.v[3]=g*e-c*a-h*b-k*f};
Ovoid.Quaternion.prototype.rotateSwapByXyz=function(a,b,c){var e=Math.sin(-0.5*a),a=Math.cos(-0.5*a),f=Math.sin(-0.5*b),g=Math.cos(-0.5*b),b=Math.sin(-0.5*c),c=Math.cos(-0.5*c),h=e*g,k=a*f,f=e*f,g=a*g,e=h*c+k*b,a=k*c-h*b,h=g*b+f*c,b=g*c-f*b,c=this.v[0],k=this.v[1],f=this.v[2],g=this.v[3];this.v[0]=b*c+e*g+a*f-h*k;this.v[1]=b*k+a*g+h*c-e*f;this.v[2]=b*f+h*g+e*k-a*c;this.v[3]=b*g-e*c-a*k-h*f};
Ovoid.Quaternion.prototype.vectorRotateBy=function(a){var b=this.v[3]*a.v[0]+0*this.v[0]+this.v[1]*a.v[2]-this.v[2]*a.v[1],c=this.v[3]*a.v[1]+0*this.v[1]+this.v[2]*a.v[0]-this.v[0]*a.v[2],e=this.v[3]*a.v[2]+0*this.v[2]+this.v[0]*a.v[1]-this.v[1]*a.v[0];this.v[3]+=-0.5*(0*this.v[3]-this.v[0]*a.v[0]-this.v[1]*a.v[1]-this.v[2]*a.v[2]);this.v[0]+=-0.5*b;this.v[1]+=-0.5*c;this.v[2]+=-0.5*e};
Ovoid.Quaternion.prototype.vectorRotateSwapBy=function(a){var b=0*this.v[0]+a.v[0]*this.v[3]+a.v[1]*this.v[2]-a.v[2]*this.v[1],c=0*this.v[1]+a.v[1]*this.v[3]+a.v[2]*this.v[0]-a.v[0]*this.v[2],e=0*this.v[2]+a.v[2]*this.v[3]+a.v[0]*this.v[1]-a.v[1]*this.v[0];this.v[3]+=0.5*(0*this.v[3]-a.v[0]*this.v[0]-a.v[1]*this.v[1]-a.v[2]*this.v[2]);this.v[0]+=0.5*b;this.v[1]+=0.5*c;this.v[2]+=0.5*e};
Ovoid.Quaternion.prototype.normalize=function(){var a=Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]+this.v[3]*this.v[3]);this.v[0]/=a;this.v[1]/=a;this.v[2]/=a;this.v[3]/=a};Ovoid.Quaternion.prototype.fromEuler=function(a){var b=Math.sin(-0.5*a.v[0]),c=Math.cos(-0.5*a.v[0]),e=Math.sin(-0.5*a.v[1]),f=Math.cos(-0.5*a.v[1]),g=Math.sin(-0.5*a.v[2]),a=Math.cos(-0.5*a.v[2]),h=b*f,k=c*e,b=b*e,c=c*f;this.v[0]=h*a+k*g;this.v[1]=k*a-h*g;this.v[2]=c*g+b*a;this.v[3]=c*a-b*g};
Ovoid.Quaternion.prototype.fromEulerXyz=function(a,b,c){var e=Math.sin(-0.5*a),a=Math.cos(-0.5*a),f=Math.sin(-0.5*b),g=Math.cos(-0.5*b),b=Math.sin(-0.5*c),c=Math.cos(-0.5*c),h=e*g,k=a*f,e=e*f,a=a*g;this.v[0]=h*c+k*b;this.v[1]=k*c-h*b;this.v[2]=a*b+e*c;this.v[3]=a*c-e*b};
Ovoid.Quaternion.prototype.fromMat4=function(a){var b=1+a.m[0]+a.m[5]+a.m[10];0.001<b?(b=0.5/Math.sqrt(b),this.v[3]=0.25/b,this.v[0]=(a.m[9]-a.m[6])*b,this.v[1]=(a.m[2]-a.m[8])*b,this.v[2]=(a.m[4]-a.m[1])*b):a.m[0]>a.m[5]&&a.m[0]>a.m[8]?(b=2*Math.sqrt(1+a.m[0]-a.m[4]-a.m[10]),this.v[0]=0.25*b,this.v[1]=(a.m[1]+a.m[4])/b,this.v[2]=(a.m[2]+a.m[8])/b,this.v[3]=(a.m[6]-a.m[9])/b):a.m[4]>a.m[8]?(b=2*Math.sqrt(1+a.m[5]-a.m[0]-a.m[10]),this.v[0]=(a.m[1]+a.m[4])/b,this.v[1]=0.25*b,this.v[2]=(a.m[6]+a.m[9])/
b,this.v[3]=(a.m[2]-a.m[8])/b):(b=2*Math.sqrt(1+a.m[10]-a.m[0]-a.m[5]),this.v[0]=(a.m[2]+a.m[8])/b,this.v[1]=(a.m[6]+a.m[9])/b,this.v[2]=0.25*b,this.v[3]=(a.m[1]-a.m[4])/b);a=Math.sqrt(this.v[0]*this.v[0]+this.v[1]*this.v[1]+this.v[2]*this.v[2]+this.v[3]*this.v[3]);this.v[0]/=a;this.v[1]/=a;this.v[2]/=a;this.v[3]/=a};
Ovoid.Quaternion.prototype.asMat4=function(){var a=new Ovoid.Matrix4,b=this.v[0]+this.v[0],c=this.v[1]+this.v[1],e=this.v[2]+this.v[2],f=this.v[0]*b,g=this.v[0]*c,h=this.v[0]*e,k=this.v[1]*c,j=this.v[1]*e,m=this.v[1]*e,b=this.v[3]*b,c=this.v[3]*c,e=this.v[3]*e;a.m[0]=1-(k+m);a.m[1]=g-e;a.m[2]=h+c;a.m[4]=g+e;a.m[5]=1-(f+m);a.m[6]=j-b;a.m[8]=h-c;a.m[9]=j+b;a.m[10]=1-(f+k);return a};Ovoid.Quaternion.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Matrix3=function(a){this.m=new Float32Array(9);null!=a&&void 0!=a?(this.m[0]=a[0],this.m[1]=a[1],this.m[2]=a[2],this.m[3]=a[3],this.m[4]=a[4],this.m[5]=a[5],this.m[6]=a[6],this.m[7]=a[7],this.m[8]=a[8]):this.m[0]=this.m[4]=this[8]=1};Ovoid.Matrix3.prototype.setv=function(a){this.m.set(a)};Ovoid.Matrix3.prototype.copy=function(a){this.m.set(a.m)};
Ovoid.Matrix3.prototype.multBy=function(a){var b=Array(9);b[0]=this.m[0]*a.m[0]+this.m[1]*a.m[3]+this.m[2]*a.m[6];b[1]=this.m[0]*a.m[1]+this.m[1]*a.m[4]+this.m[2]*a.m[7];b[2]=this.m[0]*a.m[2]+this.m[1]*a.m[5]+this.m[2]*a.m[8];b[3]=this.m[3]*a.m[0]+this.m[4]*a.m[3]+this.m[5]*a.m[6];b[4]=this.m[3]*a.m[1]+this.m[4]*a.m[4]+this.m[5]*a.m[7];b[5]=this.m[3]*a.m[2]+this.m[4]*a.m[5]+this.m[5]*a.m[8];b[6]=this.m[6]*a.m[0]+this.m[7]*a.m[3]+this.m[8]*a.m[6];b[7]=this.m[6]*a.m[1]+this.m[7]*a.m[4]+this.m[8]*a.m[7];
b[8]=this.m[6]*a.m[2]+this.m[7]*a.m[5]+this.m[8]*a.m[8];this.m[0]=b[0];this.m[1]=b[1];this.m[2]=b[2];this.m[3]=b[3];this.m[4]=b[4];this.m[5]=b[5];this.m[6]=b[6];this.m[7]=b[7];this.m[8]=b[8]};
Ovoid.Matrix3.prototype.multOf=function(a,b){this.m[0]=a.m[0]*b.m[0]+a.m[1]*b.m[3]+a.m[2]*b.m[6];this.m[1]=a.m[0]*b.m[1]+a.m[1]*b.m[4]+a.m[2]*b.m[7];this.m[2]=a.m[0]*b.m[2]+a.m[1]*b.m[5]+a.m[2]*b.m[8];this.m[3]=a.m[3]*b.m[0]+a.m[4]*b.m[3]+a.m[5]*b.m[6];this.m[4]=a.m[3]*b.m[1]+a.m[4]*b.m[4]+a.m[5]*b.m[7];this.m[5]=a.m[3]*b.m[2]+a.m[4]*b.m[5]+a.m[5]*b.m[8];this.m[6]=a.m[6]*b.m[0]+a.m[7]*b.m[3]+a.m[8]*b.m[6];this.m[7]=a.m[6]*b.m[1]+a.m[7]*b.m[4]+a.m[8]*b.m[7];this.m[8]=a.m[6]*b.m[2]+a.m[7]*b.m[5]+a.m[8]*
b.m[8]};Ovoid.Matrix3.prototype.fromMat4=function(a){this.m[0]=a.m[0];this.m[1]=a.m[1];this.m[2]=a.m[2];this.m[3]=a.m[4];this.m[4]=a.m[5];this.m[5]=a.m[6];this.m[6]=a.m[8];this.m[7]=a.m[9];this.m[8]=a.m[10]};Ovoid.Matrix3.prototype.toTranspose=function(){var a;a=this.m[1];this.m[1]=this.m[3];this.m[3]=a;a=this.m[2];this.m[2]=this.m[6];this.m[6]=a;a=this.m[5];this.m[5]=this.m[7];this.m[7]=a};
Ovoid.Matrix3.prototype.toInverse=function(){var a=1/(this.m[0]*(this.m[4]*this.m[8]-this.m[7]*this.m[5])-this.m[1]*(this.m[3]*this.m[8]-this.m[6]*this.m[5])+this.m[2]*(this.m[3]*this.m[7]-this.m[6]*this.m[4])),b=Array(9);b[0]=(this.m[4]*this.m[8]-this.m[7]*this.m[5])*a;b[1]=-(this.m[1]*this.m[8]-this.m[7]*this.m[2])*a;b[2]=(this.m[1]*this.m[5]-this.m[4]*this.m[2])*a;b[3]=-(this.m[3]*this.m[8]-this.m[6]*this.m[5])*a;b[4]=(this.m[0]*this.m[8]-this.m[6]*this.m[2])*a;b[5]=-(this.m[0]*this.m[5]-this.m[3]*
this.m[2])*a;b[6]=(this.m[3]*this.m[7]-this.m[6]*this.m[4])*a;b[7]=-(this.m[0]*this.m[7]-this.m[6]*this.m[1])*a;b[8]=(this.m[0]*this.m[4]-this.m[3]*this.m[1])*a;this.m[0]=b[0];this.m[1]=b[1];this.m[2]=b[2];this.m[3]=b[3];this.m[4]=b[4];this.m[5]=b[5];this.m[6]=b[6];this.m[7]=b[7];this.m[8]=b[8]};Ovoid.Matrix3.prototype.toInverseTransform=function(){var a;a=this.m[1];this.m[1]=this.m[3];this.m[3]=a;a=this.m[2];this.m[2]=this.m[6];this.m[6]=a;a=this.m[5];this.m[5]=this.m[7];this.m[7]=a};
Ovoid.Matrix3.prototype.toNormalTransform=function(){var a;a=this.m[0]*this.m[0]+this.m[1]*this.m[1]+this.m[2]*this.m[2];1.0E-4<Math.abs(a-1)&&(a=1/Math.sqrt(a),this.m[0]*=a,this.m[1]*=a,this.m[2]*=a);a=this.m[3]*this.m[3]+this.m[4]*this.m[4]+this.m[5]*this.m[5];1.0E-4<Math.abs(a-1)&&(a=1/Math.sqrt(a),this.m[3]*=a,this.m[4]*=a,this.m[5]*=a);a=this.m[6]*this.m[6]+this.m[7]*this.m[7]+this.m[8]*this.m[8];1.0E-4<Math.abs(a-1)&&(a=1/Math.sqrt(a),this.m[6]*=a,this.m[7]*=a,this.m[8]*=a)};
Ovoid.Matrix3.prototype.toJSON=function(){for(var a=[],b=0;b<this.m.length;b++)a[b]=this.m[b];return a};Ovoid.Matrix4=function(a){this.m=new Float32Array(16);null!=a&&void 0!=a?(this.m[0]=a[0],this.m[1]=a[1],this.m[2]=a[2],this.m[3]=a[3],this.m[4]=a[4],this.m[5]=a[5],this.m[6]=a[6],this.m[7]=a[7],this.m[8]=a[8],this.m[9]=a[9],this.m[10]=a[10],this.m[11]=a[11],this.m[12]=a[12],this.m[13]=a[13],this.m[14]=a[14],this.m[15]=a[15]):this.m[0]=this.m[5]=this.m[10]=this.m[15]=1};Ovoid.Matrix4.prototype.setv=function(a){this.m.set(a)};Ovoid.Matrix4.prototype.copy=function(a){this.m.set(a.m)};
Ovoid.Matrix4.prototype.multBy=function(a){var b=Array(16);b[0]=this.m[0]*a.m[0]+this.m[1]*a.m[4]+this.m[2]*a.m[8]+this.m[3]*a.m[12];b[1]=this.m[0]*a.m[1]+this.m[1]*a.m[5]+this.m[2]*a.m[9]+this.m[3]*a.m[13];b[2]=this.m[0]*a.m[2]+this.m[1]*a.m[6]+this.m[2]*a.m[10]+this.m[3]*a.m[14];b[3]=this.m[0]*a.m[3]+this.m[1]*a.m[7]+this.m[2]*a.m[11]+this.m[3]*a.m[15];b[4]=this.m[4]*a.m[0]+this.m[5]*a.m[4]+this.m[6]*a.m[8]+this.m[7]*a.m[12];b[5]=this.m[4]*a.m[1]+this.m[5]*a.m[5]+this.m[6]*a.m[9]+this.m[7]*a.m[13];
b[6]=this.m[4]*a.m[2]+this.m[5]*a.m[6]+this.m[6]*a.m[10]+this.m[7]*a.m[14];b[7]=this.m[4]*a.m[3]+this.m[5]*a.m[7]+this.m[6]*a.m[11]+this.m[7]*a.m[15];b[8]=this.m[8]*a.m[0]+this.m[9]*a.m[4]+this.m[10]*a.m[8]+this.m[11]*a.m[12];b[9]=this.m[8]*a.m[1]+this.m[9]*a.m[5]+this.m[10]*a.m[9]+this.m[11]*a.m[13];b[10]=this.m[8]*a.m[2]+this.m[9]*a.m[6]+this.m[10]*a.m[10]+this.m[11]*a.m[14];b[11]=this.m[8]*a.m[3]+this.m[9]*a.m[7]+this.m[10]*a.m[11]+this.m[11]*a.m[15];b[12]=this.m[12]*a.m[0]+this.m[13]*a.m[4]+this.m[14]*
a.m[8]+this.m[15]*a.m[12];b[13]=this.m[12]*a.m[1]+this.m[13]*a.m[5]+this.m[14]*a.m[9]+this.m[15]*a.m[13];b[14]=this.m[12]*a.m[2]+this.m[13]*a.m[6]+this.m[14]*a.m[10]+this.m[15]*a.m[14];b[15]=this.m[12]*a.m[3]+this.m[13]*a.m[7]+this.m[14]*a.m[11]+this.m[15]*a.m[15];this.m[0]=b[0];this.m[1]=b[1];this.m[2]=b[2];this.m[3]=b[3];this.m[4]=b[4];this.m[5]=b[5];this.m[6]=b[6];this.m[7]=b[7];this.m[8]=b[8];this.m[9]=b[9];this.m[10]=b[10];this.m[11]=b[11];this.m[12]=b[12];this.m[13]=b[13];this.m[14]=b[14];this.m[15]=
b[15]};
Ovoid.Matrix4.prototype.multOf=function(a,b){this.m[0]=a.m[0]*b.m[0]+a.m[1]*b.m[4]+a.m[2]*b.m[8]+a.m[3]*b.m[12];this.m[1]=a.m[0]*b.m[1]+a.m[1]*b.m[5]+a.m[2]*b.m[9]+a.m[3]*b.m[13];this.m[2]=a.m[0]*b.m[2]+a.m[1]*b.m[6]+a.m[2]*b.m[10]+a.m[3]*b.m[14];this.m[3]=a.m[0]*b.m[3]+a.m[1]*b.m[7]+a.m[2]*b.m[11]+a.m[3]*b.m[15];this.m[4]=a.m[4]*b.m[0]+a.m[5]*b.m[4]+a.m[6]*b.m[8]+a.m[7]*b.m[12];this.m[5]=a.m[4]*b.m[1]+a.m[5]*b.m[5]+a.m[6]*b.m[9]+a.m[7]*b.m[13];this.m[6]=a.m[4]*b.m[2]+a.m[5]*b.m[6]+a.m[6]*b.m[10]+
a.m[7]*b.m[14];this.m[7]=a.m[4]*b.m[3]+a.m[5]*b.m[7]+a.m[6]*b.m[11]+a.m[7]*b.m[15];this.m[8]=a.m[8]*b.m[0]+a.m[9]*b.m[4]+a.m[10]*b.m[8]+a.m[11]*b.m[12];this.m[9]=a.m[8]*b.m[1]+a.m[9]*b.m[5]+a.m[10]*b.m[9]+a.m[11]*b.m[13];this.m[10]=a.m[8]*b.m[2]+a.m[9]*b.m[6]+a.m[10]*b.m[10]+a.m[11]*b.m[14];this.m[11]=a.m[8]*b.m[3]+a.m[9]*b.m[7]+a.m[10]*b.m[11]+a.m[11]*b.m[15];this.m[12]=a.m[12]*b.m[0]+a.m[13]*b.m[4]+a.m[14]*b.m[8]+a.m[15]*b.m[12];this.m[13]=a.m[12]*b.m[1]+a.m[13]*b.m[5]+a.m[14]*b.m[9]+a.m[15]*b.m[13];
this.m[14]=a.m[12]*b.m[2]+a.m[13]*b.m[6]+a.m[14]*b.m[10]+a.m[15]*b.m[14];this.m[15]=a.m[12]*b.m[3]+a.m[13]*b.m[7]+a.m[14]*b.m[11]+a.m[15]*b.m[15]};Ovoid.Matrix4.prototype.fromMatrix3=function(a){this.m[0]=a.m[0];this.m[1]=a.m[1];this.m[2]=a.m[2];this.m[4]=a.m[3];this.m[5]=a.m[4];this.m[6]=a.m[5];this.m[8]=a.m[6];this.m[9]=a.m[7];this.m[10]=a.m[8]};
Ovoid.Matrix4.prototype.toTranspose=function(){var a;a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=this.m[3];this.m[3]=this.m[12];this.m[12]=a;a=this.m[7];this.m[7]=this.m[13];this.m[13]=a;a=this.m[11];this.m[11]=this.m[14];this.m[14]=a};
Ovoid.Matrix4.prototype.toInverse=function(){var a=Array(12);a[0]=this.m[0]*this.m[5]-this.m[1]*this.m[4];a[1]=this.m[0]*this.m[6]-this.m[2]*this.m[4];a[2]=this.m[0]*this.m[7]-this.m[3]*this.m[4];a[3]=this.m[1]*this.m[6]-this.m[2]*this.m[5];a[4]=this.m[1]*this.m[7]-this.m[3]*this.m[5];a[5]=this.m[2]*this.m[7]-this.m[3]*this.m[6];a[11]=this.m[8]*this.m[13]-this.m[9]*this.m[12];a[10]=this.m[8]*this.m[14]-this.m[10]*this.m[12];a[9]=this.m[8]*this.m[15]-this.m[11]*this.m[12];a[8]=this.m[9]*this.m[14]-
this.m[10]*this.m[13];a[7]=this.m[9]*this.m[15]-this.m[11]*this.m[13];a[6]=this.m[10]*this.m[15]-this.m[11]*this.m[14];var b=1/(a[0]*a[6]-a[1]*a[7]+a[2]*a[8]+a[3]*a[9]-a[4]*a[10]+a[5]*a[11]),c=Array(16);c[0]=+this.m[5]*a[6]-this.m[6]*a[7]+this.m[7]*a[8];c[4]=-this.m[4]*a[6]+this.m[6]*a[9]-this.m[7]*a[10];c[8]=+this.m[4]*a[7]-this.m[5]*a[9]+this.m[7]*a[11];c[12]=-this.m[4]*a[8]+this.m[5]*a[10]-this.m[6]*a[11];c[1]=-this.m[1]*a[6]+this.m[2]*a[7]-this.m[3]*a[8];c[5]=+this.m[0]*a[6]-this.m[2]*a[9]+this.m[3]*
a[10];c[9]=-this.m[0]*a[7]+this.m[1]*a[9]-this.m[3]*a[11];c[13]=+this.m[0]*a[8]-this.m[1]*a[10]+this.m[2]*a[11];c[2]=+this.m[13]*a[5]-this.m[14]*a[4]+this.m[15]*a[3];c[6]=-this.m[12]*a[5]+this.m[14]*a[2]-this.m[15]*a[1];c[10]=+this.m[12]*a[4]-this.m[13]*a[2]+this.m[15]*a[0];c[14]=-this.m[12]*a[3]+this.m[13]*a[1]-this.m[14]*a[0];c[3]=-this.m[9]*a[5]+this.m[10]*a[4]-this.m[11]*a[3];c[7]=+this.m[8]*a[5]-this.m[10]*a[2]+this.m[11]*a[1];c[11]=-this.m[8]*a[4]+this.m[9]*a[2]-this.m[11]*a[0];c[15]=+this.m[8]*
a[3]-this.m[9]*a[1]+this.m[10]*a[0];c[0]*=b;c[1]*=b;c[2]*=b;c[3]*=b;c[4]*=b;c[5]*=b;c[6]*=b;c[7]*=b;c[8]*=b;c[9]*=b;c[10]*=b;c[11]*=b;c[12]*=b;c[13]*=b;c[14]*=b;c[15]*=b;this.m[0]=c[0];this.m[1]=c[1];this.m[2]=c[2];this.m[3]=c[3];this.m[4]=c[4];this.m[5]=c[5];this.m[6]=c[6];this.m[7]=c[7];this.m[8]=c[8];this.m[9]=c[9];this.m[10]=c[10];this.m[11]=c[11];this.m[12]=c[12];this.m[13]=c[13];this.m[14]=c[14];this.m[15]=c[15]};
Ovoid.Matrix4.prototype.toInverseTransform=function(){var a;a=this.m[1];this.m[1]=this.m[4];this.m[4]=a;a=this.m[2];this.m[2]=this.m[8];this.m[8]=a;a=this.m[6];this.m[6]=this.m[9];this.m[9]=a;a=-this.m[12];var b=-this.m[13],c=-this.m[14];this.m[12]=a*this.m[0]+b*this.m[4]+c*this.m[8];this.m[13]=a*this.m[1]+b*this.m[5]+c*this.m[9];this.m[14]=a*this.m[2]+b*this.m[6]+c*this.m[10]};Ovoid.Matrix4.prototype.toJSON=function(){for(var a=[],b=0;b<this.m.length;b++)a[b]=this.m[b];return a};Ovoid.Color=function(a,b,c,e){this.v=new Float32Array(4);void 0!=a&&(this.v[0]=a,this.v[1]=b,this.v[2]=c,this.v[3]=e)};Ovoid.Color.prototype.set=function(a,b,c,e){this.v[0]=a;this.v[1]=b;this.v[2]=c;this.v[3]=e};Ovoid.Color.prototype.setv=function(a){this.v.set(a)};Ovoid.Color.prototype.copy=function(a){this.v.set(a.v)};Ovoid.Color.prototype.equal=function(a){return this.v[0]==a.v[0]&&this.v[1]==a.v[1]&&this.v[2]==a.v[2]&&this.v[3]==a.v[3]};
Ovoid.Color.prototype.asInt=function(){return 0|255*this.v[0]<<16|255*this.v[1]<<8|255*this.v[2]};Ovoid.Color.prototype.fromInt=function(a){this.v[0]=(a>>16&255)/255;this.v[1]=(a>>8&255)/255;this.v[2]=(a&255)/255;this.v[3]=1};Ovoid.Color.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Color);return b};Ovoid.Color.prototype.toJSON=function(){for(var a=[],b=0;b<this.v.length;b++)a[b]=this.v[b];return a};Ovoid.Vertex=function(){this.p=new Ovoid.Point;this.n=new Ovoid.Vector;this.u=new Ovoid.Coord;this.t=new Ovoid.Vector;this.b=new Ovoid.Vector;this.c=new Ovoid.Color;this.i=new Ovoid.Point(-1,-1,-1,-1);this.w=new Ovoid.Point(0,0,0,0)};Ovoid.Vertex.prototype.copy=function(a){this.p.copy(a.p);this.n.copy(a.n);this.u.copy(a.u);this.t.copy(a.t);this.b.copy(a.b);this.c.copy(a.c);this.i.copy(a.i);this.w.copy(a.w)};
Ovoid.Vertex.prototype.equal=function(a){return this.p.equal(a.p)&&this.n.equal(a.n)&&this.u.equal(a.u)&&this.c.equal(a.c)?!0:!1};Ovoid.Vertex.getFormatStride=function(a){var b=0;a&Ovoid.VERTEX_VEC4_P&&(b+=4);a&Ovoid.VERTEX_VEC3_N&&(b+=3);a&Ovoid.VERTEX_VEC3_U&&(b+=3);a&Ovoid.VERTEX_VEC3_T&&(b+=3);a&Ovoid.VERTEX_VEC3_B&&(b+=3);a&Ovoid.VERTEX_VEC4_C&&(b+=4);a&Ovoid.VERTEX_VEC4_I&&(b+=4);a&Ovoid.VERTEX_VEC4_W&&(b+=4);return b};
Ovoid.Vertex.getFormatSize=function(a){var b=0;a&Ovoid.VERTEX_VEC4_P&&(b+=4);a&Ovoid.VERTEX_VEC3_N&&(b+=3);a&Ovoid.VERTEX_VEC3_U&&(b+=3);a&Ovoid.VERTEX_VEC3_T&&(b+=3);a&Ovoid.VERTEX_VEC3_B&&(b+=3);a&Ovoid.VERTEX_VEC4_C&&(b+=4);a&Ovoid.VERTEX_VEC4_I&&(b+=4);a&Ovoid.VERTEX_VEC4_W&&(b+=4);return 4*b};
Ovoid.Vertex.pack=function(a,b){for(var c=b.length,e=Ovoid.Vertex.getFormatStride(a),e=Array(c*e),f=0,g=0;g<c;g++)a&Ovoid.VERTEX_VEC4_P&&(e[f]=b[g].p.v[0],f++,e[f]=b[g].p.v[1],f++,e[f]=b[g].p.v[2],f++,e[f]=b[g].p.v[3],f++),a&Ovoid.VERTEX_VEC3_N&&(e[f]=b[g].n.v[0],f++,e[f]=b[g].n.v[1],f++,e[f]=b[g].n.v[2],f++),a&Ovoid.VERTEX_VEC3_U&&(e[f]=b[g].u.v[0],f++,e[f]=b[g].u.v[1],f++,e[f]=b[g].u.v[2],f++),a&Ovoid.VERTEX_VEC3_T&&(e[f]=b[g].t.v[0],f++,e[f]=b[g].t.v[1],f++,e[f]=b[g].t.v[2],f++),a&Ovoid.VERTEX_VEC3_B&&
(e[f]=b[g].b.v[0],f++,e[f]=b[g].b.v[1],f++,e[f]=b[g].b.v[2],f++),a&Ovoid.VERTEX_VEC4_C&&(e[f]=b[g].c.v[0],f++,e[f]=b[g].c.v[1],f++,e[f]=b[g].c.v[2],f++,e[f]=b[g].c.v[3],f++),a&Ovoid.VERTEX_VEC4_I&&(e[f]=b[g].i.v[0],f++,e[f]=b[g].i.v[1],f++,e[f]=b[g].i.v[2],f++,e[f]=b[g].i.v[3],f++),a&Ovoid.VERTEX_VEC4_W&&(e[f]=b[g].w.v[0],f++,e[f]=b[g].w.v[1],f++,e[f]=b[g].w.v[2],f++,e[f]=b[g].w.v[3],f++);return e};
Ovoid.Vertex.upack=function(a,b){for(var c=Ovoid.Vertex.getFormatStride(a),c=b.length/c,e=Ovoid.Vertex.newArray(c),f=0,g=0;g<c;g++)a&Ovoid.VERTEX_VEC4_P&&(e[g].p.v[0]=b[f],f++,e[g].p.v[1]=b[f],f++,e[g].p.v[2]=b[f],f++,e[g].p.v[3]=b[f],f++),a&Ovoid.VERTEX_VEC3_N&&(e[g].n.v[0]=b[f],f++,e[g].n.v[1]=b[f],f++,e[g].n.v[2]=b[f],f++),a&Ovoid.VERTEX_VEC3_U&&(e[g].u.v[0]=b[f],f++,e[g].u.v[1]=b[f],f++,e[g].u.v[2]=b[f],f++),a&Ovoid.VERTEX_VEC3_T&&(e[g].t.v[0]=b[f],f++,e[g].t.v[1]=b[f],f++,e[g].t.v[2]=b[f],f++),
a&Ovoid.VERTEX_VEC3_B&&(e[g].b.v[0]=b[f],f++,e[g].b.v[1]=b[f],f++,e[g].b.v[2]=b[f],f++),a&Ovoid.VERTEX_VEC4_C&&(e[g].c.v[0]=b[f],f++,e[g].c.v[1]=b[f],f++,e[g].c.v[2]=b[f],f++,e[g].c.v[3]=b[f],f++),a&Ovoid.VERTEX_VEC4_I&&(e[g].i.v[0]=b[f],f++,e[g].i.v[1]=b[f],f++,e[g].i.v[2]=b[f],f++,e[g].i.v[3]=b[f],f++),a&Ovoid.VERTEX_VEC4_W&&(e[g].w.v[0]=b[f],f++,e[g].w.v[1]=b[f],f++,e[g].w.v[2]=b[f],f++,e[g].w.v[3]=b[f],f++);return e};
Ovoid.Vertex.bufferize=function(a,b){var c=b.length,e,f,g,h,k,j,m,l,s=0;a&Ovoid.VERTEX_VEC4_P&&(e=s,s+=4);a&Ovoid.VERTEX_VEC3_N&&(f=s,s+=3);a&Ovoid.VERTEX_VEC3_U&&(g=s,s+=3);a&Ovoid.VERTEX_VEC3_T&&(h=s,s+=3);a&Ovoid.VERTEX_VEC3_B&&(k=s,s+=3);a&Ovoid.VERTEX_VEC4_C&&(j=s,s+=4);a&Ovoid.VERTEX_VEC4_I&&(m=s,s+=4);a&Ovoid.VERTEX_VEC4_W&&(l=s,s+=4);var u=new Float32Array(c*s),p;if(a&Ovoid.VERTEX_VEC4_P)for(p=0;p<c;p++)u.set(b[p].p.v,p*s+e);if(a&Ovoid.VERTEX_VEC3_N)for(p=0;p<c;p++)u.set(b[p].n.v,p*s+f);if(a&
Ovoid.VERTEX_VEC3_U)for(p=0;p<c;p++)u.set(b[p].u.v,p*s+g);if(a&Ovoid.VERTEX_VEC3_T)for(p=0;p<c;p++)u.set(b[p].t.v,p*s+h);if(a&Ovoid.VERTEX_VEC3_B)for(p=0;p<c;p++)u.set(b[p].b.v,p*s+k);if(a&Ovoid.VERTEX_VEC4_C)for(p=0;p<c;p++)u.set(b[p].c.v,p*s+j);if(a&Ovoid.VERTEX_VEC4_I)for(p=0;p<c;p++)u.set(b[p].i.v,p*s+m);if(a&Ovoid.VERTEX_VEC4_W)for(p=0;p<c;p++)u.set(b[p].w.v,p*s+l);return u};Ovoid.Vertex.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Vertex);return b};
Ovoid.Vertex.prototype.toJSON=function(){var a=Array(8);a[0]=this.p;a[1]=this.n;a[2]=this.u;a[3]=this.t;a[4]=this.b;a[5]=this.c;a[6]=this._i;a[7]=this.w;return a};Ovoid.Triangle=function(){this.index=new Uint16Array(3);this.normal=new Ovoid.Vector;this.center=new Ovoid.Point;this.adjacent=new Int16Array([-1,-1,-1]);this.equation=0};Ovoid.Triangle.prototype.copy=function(a){this.index.set(a.index);this.normal.copy(a.normal);this.center.copy(a.center);this.adjacent.set(a.adjacent);this.equation=a.equation};Ovoid.Triangle.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Triangle);return b};
Ovoid.Triangle.arrayAsIbo=function(a){var b=a.length,c=new Uint16Array(3*b),e;for(e=0;e<b;e++)c.set(a[e].index,3*e);return c};Ovoid.Triangle.prototype.toJSON=function(){var a=Array(6);a[0]=this.index[0];a[1]=this.index[1];a[2]=this.index[2];a[3]=this.adjacent[0];a[4]=this.adjacent[1];a[5]=this.adjacent[2];return a};Ovoid.Particle=function(){this.p=new Ovoid.Point;this.c=new Ovoid.Color;this.u=new Ovoid.Coord;this.v=new Ovoid.Vector;this.l=0};Ovoid.Particle.prototype.bufferCopy=function(a,b){a[b]=this.p.v[0];b++;a[b]=this.p.v[1];b++;a[b]=this.p.v[2];b++;a[b]=1;b++;a[b]=this.u.v[0];b++;a[b]=this.u.v[1];b++;a[b]=this.u.v[2];b++;a[b]=this.c.v[0];b++;a[b]=this.c.v[1];b++;a[b]=this.c.v[2];b++;a[b]=this.c.v[3]};
Ovoid.Particle.arrayAsVbo=function(a){var b=a.length,c=0,e=new Float32Array(11*b);for(i=0;i<b;i++)0<a[i].l&&(e.set(a[i].p.v,11*c),e.set(a[i].u.v,11*c+4),e.set(a[i].c.v,11*c+7),c++);return e};Ovoid.Particle.newArray=function(a){for(var b=[];a--;)b.push(new Ovoid.Particle);return b};Ovoid.Polyset=function(){this.icount=this.ioffset=0;this.material=null;this.mode=4;this.vbuffer=this.ibuffer=null;this.vfbytes=this.vformat=0};Ovoid.Polyset.prototype.toJSON=function(){var a=Array(3);a[0]=this.ioffset;a[1]=this.icount;a[2]=this.material?this.material.uid:"null";return a};Ovoid.Boundingbox=function(){this.min=new Ovoid.Point(-0.05,-0.05,-0.05,1);this.max=new Ovoid.Point(0.05,0.05,0.05,1);this.hsize=new Ovoid.Vector(0.1,0.1,0.1);this.center=new Ovoid.Point(0,0,0,1);this.worldCenter=new Ovoid.Point(0,0,0,1)};Ovoid.Boundingbox.prototype.copy=function(a){this.hsize.copy(a.hsize);this.min.copy(a.min);this.max.copy(a.max);this.center.copy(a.center)};
Ovoid.Boundingbox.prototype.setBound=function(a,b){this.min.copy(a);this.max.copy(b);this.hsize.set(0.5*(b.v[0]-a.v[0]),0.5*(b.v[1]-a.v[1]),0.5*(b.v[2]-a.v[2]));this.center.set(this.hsize.v[0]+this.min.v[0],this.hsize.v[1]+this.min.v[1],this.hsize.v[2]+this.min.v[2],1)};Ovoid.Boundingbox.prototype.transform=function(a){this.worldCenter.transform4Of(this.center,a)};
Ovoid.Boundingbox.prototype.axisProject=function(a,b){return this.hsize.v[0]*Math.abs(a.v[0]*b.m[0]+a.v[1]*b.m[1]+a.v[2]*b.m[2])+this.hsize.v[1]*Math.abs(a.v[0]*b.m[4]+a.v[1]*b.m[5]+a.v[2]*b.m[6])+this.hsize.v[2]*Math.abs(a.v[0]*b.m[8]+a.v[1]*b.m[9]+a.v[2]*b.m[10])};Ovoid.Boundingsphere=function(){this.radius=0.1;this.center=new Ovoid.Point(0,0,0,1);this.worldCenter=new Ovoid.Point(0,0,0,1)};Ovoid.Boundingsphere.prototype.copy=function(a){this.radius=a.radius;this.center.copy(a.center)};Ovoid.Boundingsphere.prototype.setBound=function(a,b,c){this.center.set(0.5*(b.v[0]-a.v[0])+a.v[0],0.5*(b.v[1]-a.v[1])+a.v[1],0.5*(b.v[2]-a.v[2])+a.v[2],1);this.radius=c};Ovoid.Boundingsphere.prototype.setRadius=function(a){this.radius=a};
Ovoid.Boundingsphere.prototype.transform=function(a){this.worldCenter.transform4Of(this.center,a)};Ovoid.Cspline=function(a,b){this._x=a;this._y=b;this._n=a.length;this._d=this._t=0;this._i=this._n;this._e=2*this._n-1;this._stop=!1;this._y3=this._y2=this._y1=this._y0=this._p=0;this.seekStart(!1,0)};
Ovoid.Cspline.prototype.seekStart=function(a,b){this._i=this._n;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._t=b;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];if(a)this._y0=this._y[(this._i-1)%this._n],this._y3=this._y[(this._i+2)%this._n];this._p=this._t/this._d};
Ovoid.Cspline.prototype.seekEnd=function(a,b){this._i=this._e-1;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t=this._d+b;if(a)this._y0=this._y[(this._i-1)%this._n],this._y3=this._y[(this._i+2)%this._n];this._p=this._t/this._d};
Ovoid.Cspline.prototype.seekForward=function(a,b){this._t+=b;if(this._t>=this._d){for(;this._t>=this._d;){this._i++;if(this._i>this._e-1){this._stop=!0;return}this._t-=this._d;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n]}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._y0=this._y[(this._i-1)%this._n],this._y3=this._y[(this._i+2)%this._n]}this._p=this._t/this._d};
Ovoid.Cspline.prototype.seekBackward=function(a,b){this._t+=b;if(0>=this._t){for(;0>=this._t;){this._i--;if(this._i<this._n){this._stop=!0;return}this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t+=this._d}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._y0=this._y[(this._i-1)%this._n],this._y3=this._y[(this._i+2)%this._n]}this._p=this._t/this._d};
Ovoid.Cspline.prototype.getOutput=function(a){if(a){var a=this._p*this._p,b=this._y3-this._y2-this._y0+this._y1;return b*this._p*a+(this._y0-this._y1-b)*a+(this._y2-this._y0)*this._p+this._y1}return this._y1+(this._y2-this._y1)*this._p};Ovoid.Cspline.prototype.toJSON=function(){for(var a={t:"Cspline",x:[]},b=0;b<this._x.length;b++)a.x[b]=this._x[b];a.y=[];for(b=0;b<this._y.length;b++)a.y[b]=this._y[b];a.n=this._n;return a};Ovoid.Hspline=function(a,b,c){this._x=a;this._y=b;this._v=c;this._n=a.length;this._nv=c.length;this._d=this._t=0;this._i=this._n;this._e=2*this._n-1;this._stop=!1;this._y2=this._y1=this._v2=this._v1=this._p=0;this.seekStart(!1,0)};
Ovoid.Hspline.prototype.seekStart=function(a,b){this._i=this._n;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._t=b;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];if(a)this._v1=this._v[(2*this._i+1)%this._nv],this._v2=this._v[(2*this._i+2)%this._nv];this._p=this._t/this._d};
Ovoid.Hspline.prototype.seekEnd=function(a,b){this._i=this._e-1;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t=this._d+b;if(a)this._v1=this._v[(2*this._i+1)%this._nv],this._v2=this._v[(2*this._i+2)%this._nv];this._p=this._t/this._d};
Ovoid.Hspline.prototype.seekForward=function(a,b){this._t+=b;if(this._t>this._d){for(;this._t>=this._d;){this._i++;if(this._i>this._e-1){this._stop=!0;return}this._t-=this._d;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n]}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._v1=this._v[(2*this._i+1)%this._nv],this._v2=this._v[(2*this._i+2)%this._nv]}this._p=this._t/this._d};
Ovoid.Hspline.prototype.seekBackward=function(a,b){this._t+=b;if(0>this._t){for(;0>=this._t;){this._i--;if(this._i<this._n){this._stop=!0;return}this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t+=this._d}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._v1=this._v[(2*this._i+1)%this._nv],this._v2=this._v[(2*this._i+2)%this._nv]}this._p=this._t/this._d};
Ovoid.Hspline.prototype.getOutput=function(a){if(a){var a=this._p*this._p,b=a*this._p;return(2*b-3*a+1)*this._y1+(-2*b+3*a)*this._y2+(b-2*a+this._p)*this._v1+(b-a)*this._v2}return this._y1+(this._y2-this._y1)*this._p};Ovoid.Hspline.prototype.toJSON=function(){for(var a={t:"Hspline",x:[]},b=0;b<this._x.length;b++)a.x[b]=this._x[b];a.y=[];for(b=0;b<this._y.length;b++)a.y[b]=this._y[b];a.v=[];for(b=0;b<this._v.length;b++)a.v[b]=this._v[b];a.n=this._n;a.nv=this._nv;return a};Ovoid.Bspline=function(a,b,c,e){this._x=a;this._y=b;this._cx=c;this._cy=e;this._n=a.length;this._nc=c.length;this._d=this._t=0;this._i=this._n;this._e=2*this._n-1;this._stop=!1;this._y2=this._y1=this._c2=this._c1=this._u2=this._u1=this._p=0;for(a=this._n;a<this._e;)b=this._x[(a+1)%this._n]-this._x[a%this._n],this._cx[(2*a+1)%this._nc]=(this._cx[(2*a+1)%this._nc]-this._x[a%this._n])/b,this._cx[(2*a+2)%this._nc]=(this._cx[(2*a+2)%this._nc]-this._x[a%this._n])/b,a++;this.seekStart(!1,0)};
Ovoid.Bspline.prototype.seekStart=function(a,b){this._i=this._n;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._t=b;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];if(a)this._c1=this._cy[(2*this._i+1)%this._nc],this._c2=this._cy[(2*this._i+2)%this._nc],this._u1=this._cx[(2*this._i+1)%this._nc],this._u2=this._cx[(2*this._i+2)%this._nc];this._p=this._t/this._d};
Ovoid.Bspline.prototype.seekEnd=function(a,b){this._i=this._e-1;this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t=this._d+b;if(a)this._c1=this._cy[(2*this._i+1)%this._nc],this._c2=this._cy[(2*this._i+2)%this._nc],this._u1=this._cx[(2*this._i+1)%this._nc],this._u2=this._cx[(2*this._i+2)%this._nc];this._p=this._t/this._d};
Ovoid.Bspline.prototype.seekForward=function(a,b){this._t+=b;if(this._t>this._d){for(;this._t>=this._d;){this._i++;if(this._i>this._e-1){this._stop=!0;return}this._t-=this._d;this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n]}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._c1=this._cy[(2*this._i+1)%this._nc],this._c2=this._cy[(2*this._i+2)%this._nc],this._u1=this._cx[(2*this._i+1)%this._nc],this._u2=this._cx[(2*this._i+2)%this._nc]}this._p=this._t/this._d};
Ovoid.Bspline.prototype.seekBackward=function(a,b){this._t+=b;if(0>this._t){for(;0>=this._t;){this._i--;if(this._i<this._n+1){this._stop=!0;return}this._d=this._x[(this._i+1)%this._n]-this._x[this._i%this._n];this._t+=this._d}this._y1=this._y[this._i%this._n];this._y2=this._y[(this._i+1)%this._n];if(a)this._c1=this._cy[(2*this._i+1)%this._nc],this._c2=this._cy[(2*this._i+2)%this._nc],this._u1=this._cx[(2*this._i+1)%this._nc],this._u2=this._cx[(2*this._i+2)%this._nc]}this._p=this._t/this._d};
Ovoid.Bspline.prototype.getOutput=function(a){return a?(a=3*this._u1*this._p*Math.pow(1-this._p,2)+3*this._u2*Math.pow(this._p,2)*(1-this._p)+1*Math.pow(this._p,3),this._y1*Math.pow(1-a,3)+3*this._c1*a*Math.pow(1-a,2)+3*this._c2*Math.pow(a,2)*(1-a)+this._y2*Math.pow(a,3)):this._y1+(this._y2-this._y1)*this._p};
Ovoid.Bspline.prototype.toJSON=function(){for(var a={t:"Bspline",x:[]},b=0;b<this._x.length;b++)a.x[b]=this._x[b];a.y=[];for(b=0;b<this._y.length;b++)a.y[b]=this._y[b];a.cx=[];for(b=0;b<this._cx.length;b++)a.cx[b]=this._cx[b];a.cy=[];for(b=0;b<this._cy.length;b++)a.cy[b]=this._cy[b];a.n=this._n;a.nc=this._nc;return a};Ovoid.Shader=function(a,b){this.name=a;this.fragsource=this.vertsource=this.wrapurl=this.fragurl=this.verturl="";this.wrapsource=Ovoid.GLSL_WRAPMAP;this.progstat=this.fragstat=this.vertstat="";this.proghandle=this.fraghandle=this.verthandle=-1;this.linkStatus=!1;this.attribute=Array(Ovoid.MAX_VERTEX_ATTRIB);for(var c=0;c<Ovoid.MAX_VERTEX_ATTRIB;c++)this.attribute[c]=-1;this.attrsize=new Uint16Array(Ovoid.MAX_VERTEX_ATTRIB);this.uniform=Array(Ovoid.MAX_UNIFORM);for(c=0;c<Ovoid.MAX_UNIFORM;c++)this.uniform[c]=
-1;this.uniformMatrix=Array(Ovoid.MAX_UNIFORM_MATRIX);for(c=0;c<Ovoid.MAX_UNIFORM_MATRIX;c++)this.uniformMatrix[c]=-1;this.uniformSampler=Array(Ovoid.MAX_UNIFORM_SAMPLER);for(c=0;c<Ovoid.MAX_UNIFORM_SAMPLER;c++)this.uniformSampler[c]=-1;this.outFragment=Array(Ovoid.MAX_OUT_FRAGMENT);for(c=0;c<Ovoid.MAX_OUT_FRAGMENT;c++)this.outFragment[c]=-1;this._wmlstatus=this._fslstatus=this._vslstatus=this.loadStatus=0;this._i=b};
Ovoid.Shader.prototype.loadSource=function(a,b,c,e){this.verturl=a;this.fragurl=b;this.wrapurl=c;if(void 0==c||null==c||""==c)c=null,this._wmlstatus=1;var f;this._i.opt_debugMode&&(b+="?"+Math.random());this._i.opt_debugMode&&(a+="?"+Math.random());c&&(f=c,this._i.opt_debugMode&&(f+="?"+Math.random()));var g=new XMLHttpRequest;g.id=0;g.o=this;g._i=this._i;var h=new XMLHttpRequest;h.id=1;h.o=this;h._i=this._i;if(c){var k=new XMLHttpRequest;k.id=2;k.o=this;k._i=this._i}if(e){var j=function(){if(4==
this.readyState)if(200==this.status||304==this.status){switch(this.id){case 0:this.o.vertsource=this.responseText;this.o._vslstatus=1;break;case 1:this.o.fragsource=this.responseText;this.o._fslstatus=1;break;case 2:this.o.wrapsource=this.responseText,this.o._wmlstatus=1}if(3==this.o._vslstatus+this.o._fslstatus+this.o._wmlstatus)this.o.loadStatus=1,this.o._linkWrap()}else switch(this.id){case 0:Ovoid._log(2,this._i," Shader.loadSource",this.o.name+":: unable to load source '"+this.o.verturl+"'");
this.o._vslstatus=-1;this.o.loadStatus=-1;break;case 1:Ovoid._log(2,this._i," Shader.loadSource",this.o.name+":: unable to load source '"+this.o.fragurl+"'");this.o._fslstatus=-1;this.o.loadStatus=-1;break;case 2:Ovoid._log(2,this._i," Shader.loadSource",this.o.name+":: unable to load source '"+this.o.wrapurl+"'"),this.o._wmlstatus=-1,this.o.loadStatus=-1}};g.onreadystatechange=j;h.onreadystatechange=j;if(c)k.onreadystatechange=j}h.open("GET",b,e);h.send();g.open("GET",a,e);g.send();c&&(k.open("GET",
f,e),k.send());if(!e&&(c?200==k.status||304==k.status?(this.wrapsource=k.responseText,this._wmlstatus=1):(this.loadStatus=this._wmlstatus=-1,Ovoid._log(2,this._i," Shader.loadSource",this.name+":: unable to load source '"+this.wrapurl+"'")):this._wmlstatus=1,200==h.status||304==h.status?(this.fragsource=h.responseText,this._fslstatus=1):(this.loadStatus=this._fslstatus=-1,Ovoid._log(2,this._i," Shader.loadSource",this.name+":: unable to load source '"+this.fragurl+"'")),200==g.status||304==g.status?
(this.vertsource=g.responseText,this._vslstatus=1):(this.loadStatus=this._vslstatus=-1,Ovoid._log(2,this._i," Shader.loadSource",this.name+":: unable to load source '"+this.verturl+"'")),3==this._vslstatus+this._fslstatus+this._wmlstatus))this.loadStatus=1,this._linkWrap()};Ovoid.Shader.prototype.setSources=function(a,b,c){if(void 0!=c&&null!=c&&""!=c)this.wrapsource=c;this.fragsource=b;this.vertsource=a;this.loadStatus=1;return this._linkWrap()};
Ovoid.Shader.prototype._linkWrap=function(){if(1!=this.loadStatus)return Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: link/compil error, sources not loaded."),!1;this.verthandle=this._i.gl.createShader(this._i.gl.VERTEX_SHADER);this.fraghandle=this._i.gl.createShader(this._i.gl.FRAGMENT_SHADER);this._i.gl.shaderSource(this.verthandle,this.vertsource);this._i.gl.compileShader(this.verthandle);this.vertstat=this._i.gl.getShaderInfoLog(this.verthandle);if(!this._i.gl.getShaderParameter(this.verthandle,
this._i.gl.COMPILE_STATUS))return this.clear(),Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: '"+this.verturl+"' compil error: "+this.vertstat),!1;this._i.gl.shaderSource(this.fraghandle,this.fragsource);this._i.gl.compileShader(this.fraghandle);this.fragstat=this._i.gl.getShaderInfoLog(this.fraghandle);if(!this._i.gl.getShaderParameter(this.fraghandle,this._i.gl.COMPILE_STATUS))return this.clear(),Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: '"+this.fragurl+"' compil error: "+this.fragstat),
!1;this.proghandle=this._i.gl.createProgram();this._i.gl.attachShader(this.proghandle,this.verthandle);this._i.gl.attachShader(this.proghandle,this.fraghandle);this._i.gl.linkProgram(this.proghandle);this.progstat=this._i.gl.getProgramInfoLog(this.proghandle);if(!this._i.gl.getProgramParameter(this.proghandle,this._i.gl.LINK_STATUS))return this.clear(),Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: link error: "+this.progstat),!1;Ovoid._log(3,this._i," Shader.linkWrap",this.name+":: link log: "+
this.progstat);this._i._logGlerror(" Shader.linkWrap::"+this.name);if(this.wrapurl)if("XML"==Ovoid.extractExt(this.wrapurl).toUpperCase()){if(!this._wrapXml())return Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: program wrap error."),!1}else{if(!this._wrapJson())return Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: program wrap error."),!1}else if(!this._wrapJson())return Ovoid._log(2,this._i," Shader.linkWrap",this.name+":: program wrap error."),!1;return this.linkStatus=!0};
Ovoid.Shader.prototype._wrapJson=function(){var a=JSON.parse(this.wrapsource);if(null==a)return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: unable to load Json wrap map '"+wm+"'"),!1;if(!a.OJSON)return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' is not a valid Ovoid JSON format"),!1;if("glslmap"!=a.type)return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' is not a valid Ovoid JSON glslmap"),!1;if(!a.wrapmap)return Ovoid._log(2,this._i," Shader._wrapJson",
this.name+":: '"+wm+"' no wrapmap object found in Ovoid JSON"),!1;a=a.wrapmap;if(a.attribute)if(0<a.attribute.length)for(i=a.attribute.length;i--;)this.plugVertexAttrib(a.attribute[i].id,a.attribute[i].name);else Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : no attribute slot.");else return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : missing attribute map."),!1;if(a.uniform)if(0<a.uniform.length)for(i=a.uniform.length;i--;)this.plugUniform(a.uniform[i].id,
a.uniform[i].name);else Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : no uniform slot.");else return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : missing uniform map."),!1;if(a.uniformMatrix)if(0<a.uniformMatrix.length)for(i=a.uniformMatrix.length;i--;)this.plugUniformMatrix(a.uniformMatrix[i].id,a.uniformMatrix[i].name);else Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : no uniformMatrix slot.");else return Ovoid._log(2,this._i,
" Shader._wrapJson",this.name+":: '"+wm+"' wrap : missing uniformMatrix map."),!1;if(a.uniformSampler)if(0<a.uniformSampler.length)for(i=a.uniformSampler.length;i--;)this.plugUniformSampler(a.uniformSampler[i].id,a.uniformSampler[i].name);else Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : no uniformSampler slot.");else return Ovoid._log(2,this._i," Shader._wrapJson",this.name+":: '"+wm+"' wrap : missing uniformSampler map."),!1;return!0};
Ovoid.Shader.prototype._wrapXml=function(){var a=(new DOMParser).parseFromString(this.wrapsource,"text/xml");if(null==a)return Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: unable to load Xml wrap map '"+wm+"'"),!1;var b=a.getElementsByTagName("attribute")[0],c=a.getElementsByTagName("uniform")[0],e=a.getElementsByTagName("uniformMatrix")[0],a=a.getElementsByTagName("uniformSampler")[0],f,g,h;if(null!=b)if(b=b.getElementsByTagName("s"),0<b.length)for(h=b.length;h--;)f=parseInt(b[h].getAttribute("id")),
g=b[h].childNodes[0].data,this.plugVertexAttrib(f,g);else Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : no attribute slot.");else return Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : missing attribute map."),!1;if(null!=c)if(b=c.getElementsByTagName("s"),0<b.length)for(h=b.length;h--;)f=parseInt(b[h].getAttribute("id")),g=b[h].childNodes[0].data,this.plugUniform(f,g);else Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : no uniform slot.");
else return Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : missing uniform map."),!1;if(null!=e)if(b=e.getElementsByTagName("s"),0<b.length)for(h=b.length;h--;)f=parseInt(b[h].getAttribute("id")),g=b[h].childNodes[0].data,this.plugUniformMatrix(f,g);else Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : no uniformMatrix slot.");else return Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : missing uniformMatrix map."),!1;if(null!=a)if(b=
a.getElementsByTagName("s"),0<b.length)for(h=b.length;h--;)f=parseInt(b[h].getAttribute("id")),g=b[h].childNodes[0].data,this.plugUniformSampler(f,g);else Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : no uniformSampler slot.");else return Ovoid._log(2,this._i," Shader._wrapXml",this.name+":: '"+wm+"' wrap : missing uniformSampler map."),!1;return!0};Ovoid.Shader.prototype.use=function(){this._i.gl.useProgram(this.proghandle)};
Ovoid.Shader.prototype.plugVertexAttrib=function(a,b){var c=this._i.gl.getAttribLocation(this.proghandle,b);switch(a){case Ovoid.VERTEX_VEC4_P:return this.attribute[0]=c,this.attrsize[0]=4,c;case Ovoid.VERTEX_VEC3_N:return this.attribute[1]=c,this.attrsize[1]=3,c;case Ovoid.VERTEX_VEC3_U:return this.attribute[2]=c,this.attrsize[2]=3,c;case Ovoid.VERTEX_VEC3_T:return this.attribute[3]=c,this.attrsize[3]=3,c;case Ovoid.VERTEX_VEC3_B:return this.attribute[4]=c,this.attrsize[4]=3,c;case Ovoid.VERTEX_VEC4_C:return this.attribute[5]=
c,this.attrsize[5]=4,c;case Ovoid.VERTEX_VEC4_I:return this.attribute[6]=c,this.attrsize[6]=4,c;case Ovoid.VERTEX_VEC4_W:return this.attribute[7]=c,this.attrsize[7]=4,c;default:return-1}};Ovoid.Shader.prototype.plugUniform=function(a,b){var c=this._i.gl.getUniformLocation(this.proghandle,b);return c?this.uniform[a]=c:-1};Ovoid.Shader.prototype.plugUniformMatrix=function(a,b){var c=this._i.gl.getUniformLocation(this.proghandle,b);return c?this.uniformMatrix[a]=c:-1};
Ovoid.Shader.prototype.plugUniformSampler=function(a,b){var c=this._i.gl.getUniformLocation(this.proghandle,b);return c?this.uniformSampler[a]=c:-1};Ovoid.Shader.prototype.setUniform1f=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform1f(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform1fv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform1fv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform2fv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform2fv(this.uniform[a],b)};
Ovoid.Shader.prototype.setUniform3fv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform3fv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform4fv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform4fv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform1i=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform1i(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform1iv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform1iv(this.uniform[a],b)};
Ovoid.Shader.prototype.setUniform2iv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform2iv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform3iv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform3iv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniform4iv=function(a,b){-1!=this.uniform[a]&&this._i.gl.uniform4iv(this.uniform[a],b)};Ovoid.Shader.prototype.setUniformMatrix3fv=function(a,b){-1!=this.uniformMatrix[a]&&this._i.gl.uniformMatrix3fv(this.uniformMatrix[a],0,b)};
Ovoid.Shader.prototype.setUniformMatrix4fv=function(a,b){-1!=this.uniformMatrix[a]&&this._i.gl.uniformMatrix4fv(this.uniformMatrix[a],0,b)};Ovoid.Shader.prototype.setUniformSampler=function(a){-1!=this.uniformSampler[a]&&this._i.gl.uniform1i(this.uniformSampler[a],a)};
Ovoid.Shader.prototype.setVertexAttribPointers=function(a,b){for(var c=0,e=1,f=0;c<Ovoid.MAX_VERTEX_ATTRIB;c++,e<<=1)a&e?(-1!=this.attribute[c]&&(this._i.gl.vertexAttribPointer(this.attribute[c],this.attrsize[c],this._i.gl.FLOAT,!1,b,f),this._i.gl.enableVertexAttribArray(this.attribute[c])),f+=4*this.attrsize[c]):-1!=this.attribute[c]&&this._i.gl.disableVertexAttribArray(this.attribute[c])};
Ovoid.Shader.prototype.clearOutFragment=function(){for(var a=0;a<Ovoid.MAX_OUT_FRAGMENT;a++)this.outFragment[a]=-1};Ovoid.Shader.prototype.clearVertexAttribs=function(){for(var a=0;a<Ovoid.MAX_VERTEX_ATTRIB;a++)this.attribute[a]=-1};Ovoid.Shader.prototype.clearUniforms=function(){for(var a=0;a<Ovoid.MAX_UNIFORM;a++)this.uniform[a]=-1};Ovoid.Shader.prototype.clearUniformMatrices=function(){for(var a=0;a<Ovoid.MAX_UNIFORM_MATRIX;a++)this.uniformMatrix[a]=-1};
Ovoid.Shader.prototype.clearUniformSamplers=function(){for(var a=0;a<Ovoid.MAX_UNIFORM_SAMPLER;a++)this.uniformSampler[a]=-1};Ovoid.Shader.prototype.clear=function(){if(-1!=this.verthandle)this._i.gl.deleteShader(this.verthandle),this.verthandle=-1;if(-1!=this.fraghandle)this._i.gl.deleteShader(this.fraghandle),this.fraghandle=-1;if(-1!=this.proghandle)this.proghandle=-1;this.clearVertexAttribs();this.clearUniforms();this.clearUniformMatrices();this.clearUniformSamplers()};
Ovoid.Shader.prototype.toJSON=function(){var a={};a.n=this.name;a.vs=this.vertsource;a.fs=this.fragsource;a.ws=this.wrapsource;return a};Ovoid.Node=function(a,b){this.type|=Ovoid.NODE;this.name=a;this.pickable=this.visible=!0;this.uid=0;this.parent=null;this.child=[];this.depend=[];this.link=[];this.cach=0;this.boundingBox=new Ovoid.Boundingbox;this.boundingSphere=new Ovoid.Boundingsphere;this._i=b};
Ovoid.Node.prototype.setParent=function(a){if(this.parent!=a){if(null!=this.parent)for(var b=this.parent.child.length;b--;)if(this.parent.child[b]===this){this.parent.child.splice(b,1);break}if(null!=a){for(b=a.child.length;b--;)if(a.child[b]===a)return;a.child.push(this)}this.parent=a}};Ovoid.Node.prototype.makeDepend=function(a){for(var b=this.depend.length;b--;)if(a===this.depend[b])return;this.depend.push(a);a.link.push(this)};
Ovoid.Node.prototype.breakDepend=function(a){for(var b=this.depend.length;b--;)if(a===this.depend[b]){this.depend.splice(b,1);for(b=a.link.length;b--;)if(this===a.link[b]){a.link.splice(b,1);break}break}};Ovoid.Node.prototype.addCach=function(a){this.cach|=a};Ovoid.Node.prototype.unCach=function(a){this.cach&=~a};Ovoid.Node.prototype.setTreeVisible=function(a){this.visible=a;for(var b=this.child.length;b--;)this.child[b].setTreeVisible(a)};
Ovoid.Node.prototype.toJSON=function(){var a={};a.t=Ovoid.NODE;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;return a};Ovoid.Transform=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.TRANSFORM;this.name=a;this.scaling=new Ovoid.Vector(1,1,1);this.translation=new Ovoid.Vector(0,0,0);this.orientation=new Ovoid.Quaternion(0,0,0,1);this.rotation=new Ovoid.Quaternion(0,0,0,1);this.matrix=new Ovoid.Matrix4;this.worldMatrix=new Ovoid.Matrix4;this.normalMatrix=new Ovoid.Matrix3;this.worldDirection=new Ovoid.Vector(0,0,0);this.worldPosition=new Ovoid.Point(0,0,0,1);this.rendered=!1;this._i=b;this.unCach(Ovoid.CACH_WORLD|
Ovoid.CACH_TRANSFORM)};Ovoid.Transform.prototype=new Ovoid.Node;Ovoid.Transform.prototype.constructor=Ovoid.Transform;Ovoid.Transform.prototype.distanceFrom=function(a){var b=this.worldPosition.v[0]-a.worldPosition.v[0],c=this.worldPosition.v[1]-a.worldPosition.v[1],a=this.worldPosition.v[2]-a.worldPosition.v[2];return Math.sqrt(b*b+c*c+a*a)};
Ovoid.Transform.prototype.directionTo=function(a){var b=this.worldPosition.v[0]-a.worldPosition.v[0],c=this.worldPosition.v[1]-a.worldPosition.v[1],a=this.worldPosition.v[2]-a.worldPosition.v[2],e=Math.sqrt(b*b+c*c+a*a);return new Ovoid.Vector(b/e,c/e,a/e)};
Ovoid.Transform.prototype.scale=function(a,b){switch(b){case 1:this.scaling.v[0]=a.v[0];this.scaling.v[1]=a.v[1];this.scaling.v[2]=a.v[2];break;default:this.scaling.v[0]+=a.v[0],this.scaling.v[1]+=a.v[1],this.scaling.v[2]+=a.v[2]}this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.scaleXyz=function(a,b,c,e){switch(e){case 1:this.scaling.v[0]=a;this.scaling.v[1]=b;this.scaling.v[2]=c;break;default:this.scaling.v[0]+=a,this.scaling.v[1]+=b,this.scaling.v[2]+=c}this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.move=function(a,b,c){switch(c){case 1:switch(b){case 1:this.translation.v[0]=a.v[0]*this.matrix.m[0]+a.v[1]*this.matrix.m[4]+a.v[2]*this.matrix.m[8];this.translation.v[1]=a.v[0]*this.matrix.m[1]+a.v[1]*this.matrix.m[5]+a.v[2]*this.matrix.m[9];this.translation.v[2]=a.v[0]*this.matrix.m[2]+a.v[1]*this.matrix.m[6]+a.v[2]*this.matrix.m[10];break;default:this.translation.v[0]=a.v[0],this.translation.v[1]=a.v[1],this.translation.v[2]=a.v[2]}break;default:switch(b){case 1:this.translation.v[0]+=
a.v[0]*this.matrix.m[0]+a.v[1]*this.matrix.m[4]+a.v[2]*this.matrix.m[8];this.translation.v[1]+=a.v[0]*this.matrix.m[1]+a.v[1]*this.matrix.m[5]+a.v[2]*this.matrix.m[9];this.translation.v[2]+=a.v[0]*this.matrix.m[2]+a.v[1]*this.matrix.m[6]+a.v[2]*this.matrix.m[10];break;default:this.translation.v[0]+=a.v[0],this.translation.v[1]+=a.v[1],this.translation.v[2]+=a.v[2]}}this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.moveXyz=function(a,b,c,e,f){switch(f){case 1:switch(e){case 1:this.translation.v[0]=a*this.matrix.m[0]+b*this.matrix.m[4]+c*this.matrix.m[8];this.translation.v[1]=a*this.matrix.m[1]+b*this.matrix.m[5]+c*this.matrix.m[9];this.translation.v[2]=a*this.matrix.m[2]+b*this.matrix.m[6]+c*this.matrix.m[10];break;default:this.translation.v[0]=a,this.translation.v[1]=b,this.translation.v[2]=c}break;default:switch(e){case 1:this.translation.v[0]+=a*this.matrix.m[0]+b*this.matrix.m[4]+
c*this.matrix.m[8];this.translation.v[1]+=a*this.matrix.m[1]+b*this.matrix.m[5]+c*this.matrix.m[9];this.translation.v[2]+=a*this.matrix.m[2]+b*this.matrix.m[6]+c*this.matrix.m[10];break;default:this.translation.v[0]+=a,this.translation.v[1]+=b,this.translation.v[2]+=c}}this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.orient=function(a,b,c){switch(c){case 1:this.orientation.fromEuler(a);break;default:switch(b){case 1:this.orientation.rotateSwapBy(a);break;default:this.orientation.rotateBy(a)}}this.orientation.normalize();this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.orientXyz=function(a,b,c,e,f){switch(f){case 1:this.orientation.fromEulerXyz(a,b,c);break;default:switch(e){case 1:this.orientation.rotateSwapByXyz(a,b,c);break;default:this.orientation.rotateByXyz(a,b,c)}}this.orientation.normalize();this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.rotate=function(a,b,c){switch(c){case 1:this.rotation.fromEuler(a);break;default:switch(b){case 1:this.rotation.rotateSwapBy(a);break;default:this.rotation.rotateBy(a)}}this.rotation.normalize();this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.rotateXyz=function(a,b,c,e,f){switch(f){case 1:this.rotation.fromEulerXyz(a,b,c);default:switch(e){case 1:this.rotation.rotateSwapByXyz(a,b,c);break;default:this.rotation.rotateByXyz(a,b,c)}}this.rotation.normalize();this.unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)};
Ovoid.Transform.prototype.cachTransform=function(){if(!(this.cach&Ovoid.CACH_TRANSFORM)){var a=this.rotation.v[3]*this.orientation.v[0]+this.rotation.v[0]*this.orientation.v[3]+this.rotation.v[1]*this.orientation.v[2]-this.rotation.v[2]*this.orientation.v[1],b=this.rotation.v[3]*this.orientation.v[1]+this.rotation.v[1]*this.orientation.v[3]+this.rotation.v[2]*this.orientation.v[0]-this.rotation.v[0]*this.orientation.v[2],c=this.rotation.v[3]*this.orientation.v[2]+this.rotation.v[2]*this.orientation.v[3]+
this.rotation.v[0]*this.orientation.v[1]-this.rotation.v[1]*this.orientation.v[0],e=this.rotation.v[3]*this.orientation.v[3]-this.rotation.v[0]*this.orientation.v[0]-this.rotation.v[1]*this.orientation.v[1]-this.rotation.v[2]*this.orientation.v[2],f=a+a,g=b+b,h=c+c,k=a*f,j=a*g,a=a*h,m=b*g,b=b*h,c=c*h,f=e*f,g=e*g,e=e*h;this.matrix.m[0]=(1-(m+c))*this.scaling.v[0];this.matrix.m[1]=(j-e)*this.scaling.v[0];this.matrix.m[2]=(a+g)*this.scaling.v[0];this.matrix.m[3]=0;this.matrix.m[4]=(j+e)*this.scaling.v[1];
this.matrix.m[5]=(1-(k+c))*this.scaling.v[1];this.matrix.m[6]=(b-f)*this.scaling.v[1];this.matrix.m[7]=0;this.matrix.m[8]=(a-g)*this.scaling.v[2];this.matrix.m[9]=(b+f)*this.scaling.v[2];this.matrix.m[10]=(1-(k+m))*this.scaling.v[2];this.matrix.m[11]=0;this.matrix.m[12]=this.translation.v[0];this.matrix.m[13]=this.translation.v[1];this.matrix.m[14]=this.translation.v[2];this.matrix.m[15]=1;this.addCach(Ovoid.CACH_TRANSFORM);this.unCach(Ovoid.CACH_MATRIX)}if(!(this.cach&Ovoid.CACH_MATRIX)){null!=this.parent?
this.parent.type&Ovoid.TRANSFORM?this.worldMatrix.multOf(this.matrix,this.parent.worldMatrix):this.worldMatrix.copy(this.matrix):this.worldMatrix.copy(this.matrix);this.normalMatrix.fromMat4(this.worldMatrix);this.normalMatrix.toNormalTransform();this.worldDirection.v[0]=-this.worldMatrix.m[8];this.worldDirection.v[1]=-this.worldMatrix.m[9];this.worldDirection.v[2]=-this.worldMatrix.m[10];this.worldPosition.v[0]=this.worldMatrix.m[12];this.worldPosition.v[1]=this.worldMatrix.m[13];this.worldPosition.v[2]=
this.worldMatrix.m[14];this.worldPosition.v[3]=1;this.boundingBox.transform(this.worldMatrix);this.boundingSphere.transform(this.worldMatrix);for(k=0;k<this.child.length;k++)this.child[k].unCach(Ovoid.CACH_MATRIX);this.addCach(Ovoid.CACH_MATRIX);this.unCach(Ovoid.CACH_WORLD)}};
Ovoid.Transform.prototype.toJSON=function(){var a={};a.t=Ovoid.TRANSFORM;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;
a.tr=this.rotation;return a};Ovoid.Body=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.BODY;this.name=a;this.shape=null;this.visibleRange=this.distFromEye=0;this.shadowCasting=!0;this.intersectable=!1;this.intersect=new Ovoid.Stack(Ovoid.MAX_BODY_INTERSECT);this.enter=new Ovoid.Stack(Ovoid.MAX_BODY_INTERSECT);this.leave=new Ovoid.Stack(Ovoid.MAX_BODY_INTERSECT);this.renderLayer=0;this.renderAlpha=!1;this._i=b};Ovoid.Body.prototype=new Ovoid.Transform;Ovoid.Body.prototype.constructor=Ovoid.Body;
Ovoid.Body.prototype.setShape=function(a){null!=this.shape&&this.breakDepend(this.shape);this.shape=a;this.makeDepend(a);if(a.type&Ovoid.MESH)this.renderAlpha=a.hasAlpha();if(a.type&Ovoid.EMITTER)this.renderAlpha=!0};
Ovoid.Body.prototype.cachBody=function(){this.cach&Ovoid.CACH_BOUNDING_SHAPE||(this.shape&&(this.boundingBox.copy(this.shape.boundingBox),this.boundingSphere.copy(this.shape.boundingSphere),this.shape.type&Ovoid.SKIN&&(this.boundingBox.center.transform4Inverse(this.worldMatrix),this.boundingSphere.center.transform4Inverse(this.worldMatrix))),this.addCach(Ovoid.CACH_BOUNDING_SHAPE))};
Ovoid.Body.prototype.toJSON=function(){var a={};a.t=Ovoid.BODY;a.n=this.name;a.v=this.visible;a.k=this.pickable;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;
a.tr=this.rotation;a.bs=this.shape?this.shape.uid:"null";a.bi=this.intersectable;a.bc=this.shadowCasting;a.bl=this.renderLayer;a.ba=this.renderAlpha;a.vr=this.visibleRange;return a};Ovoid.Joint=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.JOINT;this.name=a;this.skin=null;this.size=1;this._i=b};Ovoid.Joint.prototype=new Ovoid.Transform;Ovoid.Joint.prototype.constructor=Ovoid.Joint;Ovoid.Joint.prototype.cachJoint=function(){this.cach&Ovoid.CACH_WORLD||this.skin.unCach(Ovoid.CACH_SKIN)};
Ovoid.Joint.prototype.toJSON=function(){var a={};a.t=Ovoid.JOINT;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pivot=this.pivot;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;
a.tr=this.rotation;a.sz=this.size;a.sk=this.skin?this.skin.uid:"null";return a};Ovoid.Mesh=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.MESH;this.name=a;this.polyset=Array(Ovoid.MAX_MESH_LOD);for(var c=0;c<Ovoid.MAX_MESH_LOD;c++)this.polyset[c]=[];this.vertices=Array(Ovoid.MAX_MESH_LOD);for(c=0;c<Ovoid.MAX_MESH_LOD;c++)this.vertices[c]=[];this.triangles=Array(Ovoid.MAX_MESH_LOD);for(c=0;c<Ovoid.MAX_MESH_LOD;c++)this.triangles[c]=[];this._ibuffer=Array(Ovoid.MAX_MESH_LOD);this._vbuffer=Array(Ovoid.MAX_MESH_LOD);this._vfbytes=this._vformat=0;this._vbotype=Ovoid.BUFFER_STATIC;
this._lod=0;this._lodt=Array(Ovoid.MAX_MESH_LOD);for(c=0;c<Ovoid.MAX_MESH_LOD;c++)this._lodt[c]=-1;this._i=b};Ovoid.Mesh.prototype=new Ovoid.Node;Ovoid.Mesh.prototype.constructor=Ovoid.Mesh;
Ovoid.Mesh.prototype.addPolyset=function(a,b,c,e,f,g){if(a>=Ovoid.MAX_MESH_LOD)return Ovoid._log(1,this._i,"::Mesh.addPolyset",this.name+":: Lod index > MAX_MESH_LOD"),!1;if(4==e&&0!=b.length%3)return Ovoid._log(1,this._i,"::Mesh.addPolyset",this.name+":: wrong vertice count for TRIANGLES mode (not multple of 3) : "+b.length),!1;if(1==e&&0!=b.length%2)return Ovoid._log(1,this._i,"::Mesh.addPolyset",this.name+":: wrong vertice count for LINES mode (not multple of 2) : "+b.length),!1;var h=this.vertices[a].length,
k=new Ovoid.Polyset;k.ioffset=2*h;k.icount=b.length;k.material=c;k.mode=e;null!=c&&this.makeDepend(c);this.polyset[a].push(k);c=b.length;for(k=0;k<c;k++)this.vertices[a].push(b[k]);if(1==e)for(var j=h+b.length-1,c=Math.ceil(b.length/3),m=0;m<c;m++)k=new Ovoid.Triangle,k.index[0]=h,h<j&&h++,k.index[1]=h,h<j&&h++,k.index[2]=h,h<j&&h++,this.triangles[a].push(k);if(4==e)for(var l,s,e=new Ovoid.Vector,j=new Ovoid.Vector,c=b.length/3,m=0;m<c;m++)k=new Ovoid.Triangle,b=this.vertices[a][h].p,k.index[0]=h,
h++,l=this.vertices[a][h].p,k.index[1]=h,h++,s=this.vertices[a][h].p,k.index[2]=h,h++,e.subOf(b,l),j.subOf(b,s),k.normal.crossOf(e,j),k.normal.normalize(),k.center.set((b.v[0]+l.v[0]+s.v[0])/3,(b.v[1]+l.v[1]+s.v[1])/3,(b.v[2]+l.v[2]+s.v[2])/3,1),k.equation=-(k.normal.v[0]*k.center.v[0]+k.normal.v[1]*k.center.v[1]+k.normal.v[2]*k.center.v[2]),this.triangles[a].push(k);this._createBuffers(f,g);this.unCach(Ovoid.CACH_GEOMETRY);return!0};
Ovoid.Mesh.prototype.setMaterial=function(a,b,c){null!=this.polyset[a][b].material&&this.breakDepend(this.polyset[a][b].material);this.polyset[a][b].material=c;this.makeDepend(c)};Ovoid.Mesh.prototype.setLod=function(a,b){a<Ovoid.MAX_MESH_LOD&&(this._lodt[a]=b)};
Ovoid.Mesh.prototype.recalcTriangles=function(a){if(this.triangles[a].length){for(var b,c,e,f,g=new Ovoid.Vector,h=new Ovoid.Vector,k=0;k<this.triangles[a].length;k++)b=this.triangles[a][k],c=this.vertices[a][b.index[0]].p,e=this.vertices[a][b.index[1]].p,f=this.vertices[a][b.index[2]].p,g.subOf(c,e),h.subOf(c,f),b.normal.crossOf(g,h),b.normal.normalize(),b.center.set((c.v[0]+e.v[0]+f.v[0])/3,(c.v[1]+e.v[1]+f.v[1])/3,(c.v[2]+e.v[2]+f.v[2])/3,1),b.equation=-(b.normal.v[0]*b.center.v[0]+b.normal.v[1]*
b.center.v[1]+b.normal.v[2]*b.center.v[2]);this.unCach(Ovoid.CACH_GEOMETRY)}};
Ovoid.Mesh.prototype.recalcGeometry=function(a){if(this.vertices[a].length){for(var b,c,e,f,g,h,k,j=new Ovoid.Vector,m=new Ovoid.Vector,l=0;l<this.triangles[a].length;l++)b=this.triangles[a][l],c=this.vertices[a][b.index[0]].p,e=this.vertices[a][b.index[1]].p,f=this.vertices[a][b.index[2]].p,g=this.vertices[a][b.index[0]].n,h=this.vertices[a][b.index[1]].n,k=this.vertices[a][b.index[2]].n,j.subOf(c,e),m.subOf(c,f),b.normal.crossOf(j,m),b.normal.normalize(),g.addBy(b.normal),h.addBy(b.normal),k.addBy(b.normal),
b.center.set((c.v[0]+e.v[0]+f.v[0])/3,(c.v[1]+e.v[1]+f.v[1])/3,(c.v[2]+e.v[2]+f.v[2])/3,1),b.equation=-(b.normal.v[0]*b.center.v[0]+b.normal.v[1]*b.center.v[1]+b.normal.v[2]*b.center.v[2]);for(b=0;b<this.vertices[a].length;b++)this.vertices[a][b].n.normalize();this.unCach(Ovoid.CACH_GEOMETRY)}};
Ovoid.Mesh.prototype._createBuffers=function(a,b){this._i._clearGlerror();this._vformat=a;this._vfbytes=Ovoid.Vertex.getFormatSize(this._vformat);this._vbotype=b;for(var c,e,f=0;f<Ovoid.MAX_MESH_LOD;f++)if(0!=this.triangles[f].length&&(c=this._i.gl.createBuffer(),e=this._i.gl.createBuffer(),this._i.gl.bindBuffer(this._i.gl.ARRAY_BUFFER,e),this._i.gl.bufferData(this._i.gl.ARRAY_BUFFER,Ovoid.Vertex.bufferize(this._vformat,this.vertices[f]),this._vbotype),this._i.gl.bindBuffer(this._i.gl.ELEMENT_ARRAY_BUFFER,
c),this._i.gl.bufferData(this._i.gl.ELEMENT_ARRAY_BUFFER,Ovoid.Triangle.arrayAsIbo(this.triangles[f]),this._i.gl.STATIC_DRAW),Ovoid._log(3,this._i,"::Mesh._createBuffers",this.name+":: new buffers created on lod#"+f+" (Vbo:"+this.vertices[f].length*this._vfbytes+"B, Ibo:"+12*this.triangles[f].length+"B)"),this._ibuffer[f]=c,this._vbuffer[f]=e,this._i._logGlerror("::Mesh._createBuffers::"+this.name)))return!1};
Ovoid.Mesh.prototype.hasAlpha=function(){for(var a=!1,b=0;b<this.polyset[0].length;b++)if(this.polyset[0][b].material&&1>this.polyset[0][b].material.opacity){a=!0;break}return a};
Ovoid.Mesh.prototype.genDebugBox=function(a,b,c,e){var f,g,h,k,j,m,l,s,u,p,x,v,y,o,A,z,t,q,w,r;f=Ovoid.Vertex.newArray(6*6*c*c);v=b/c;y=1/c;x=-(0.5*b);j=-(0.5*b);m=0.5*b;t=new Float32Array([0,0,0,1]);q=new Float32Array([0,0,0]);w=new Float32Array([0,0,0]);r=new Float32Array([1,1,1,1]);for(A=o=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=A*y;s=y+A*y;for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[0]=b,t[1]=j,t[2]=h,q[0]=0,q[1]=-1,q[2]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),
f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=j,t[2]=k,q[0]=0,q[1]=-1,q[2]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[1]=j,t[2]=k,q[0]=0,q[1]=-1,q[2]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=j,t[2]=k,q[0]=0,q[1]=-1,q[2]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[1]=j,t[2]=h,
q[0]=0,q[1]=-1,q[2]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=j,t[2]=h,q[0]=0,q[1]=-1,q[2]=0,w[0]=s,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}for(A=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=1-A*y;s=1-(y+A*y);for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[0]=b,t[1]=m,t[2]=h,q[0]=0,q[1]=1,q[2]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),
f[o].c.setv(r),o++,t[0]=b,t[1]=m,t[2]=k,q[0]=0,q[1]=1,q[2]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=m,t[2]=k,q[0]=0,q[1]=1,q[2]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=m,t[2]=k,q[0]=0,q[1]=1,q[2]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[1]=m,t[2]=h,q[0]=0,q[1]=1,q[2]=
0,w[0]=s,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[1]=m,t[2]=h,q[0]=0,q[1]=1,q[2]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}for(A=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=A*y;s=y+A*y;for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[2]=b,t[0]=j,t[1]=h,q[2]=0,q[0]=-1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),
o++,t[2]=g,t[0]=j,t[1]=k,q[2]=0,q[0]=-1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=b,t[0]=j,t[1]=k,q[2]=0,q[0]=-1,q[1]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=g,t[0]=j,t[1]=k,q[2]=0,q[0]=-1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=b,t[0]=j,t[1]=h,q[2]=0,q[0]=-1,q[1]=0,w[0]=l,
w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=g,t[0]=j,t[1]=h,q[2]=0,q[0]=-1,q[1]=0,w[0]=s,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}for(A=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=1-A*y;s=1-(y+A*y);for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[2]=b,t[0]=m,t[1]=h,q[2]=0,q[0]=1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,
t[2]=b,t[0]=m,t[1]=k,q[2]=0,q[0]=1,q[1]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=g,t[0]=m,t[1]=k,q[2]=0,q[0]=1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=g,t[0]=m,t[1]=k,q[2]=0,q[0]=1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=g,t[0]=m,t[1]=h,q[2]=0,q[0]=1,q[1]=0,w[0]=s,w[1]=u,r[0]=
1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[2]=b,t[0]=m,t[1]=h,q[2]=0,q[0]=1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}for(A=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=1-A*y;s=1-(y+A*y);for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[0]=b,t[2]=j,t[1]=h,q[0]=0,q[2]=-1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[2]=
j,t[1]=k,q[0]=0,q[2]=-1,q[1]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=j,t[1]=k,q[0]=0,q[2]=-1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=j,t[1]=k,q[0]=0,q[2]=-1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=j,t[1]=h,q[0]=0,q[2]=-1,q[1]=0,w[0]=s,w[1]=u,r[0]=1,r[1]=
1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[2]=j,t[1]=h,q[0]=0,q[2]=-1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}for(A=0;A<c;A++){b=x+A*v;g=x+(v+A*v);l=A*y;s=y+A*y;for(z=0;z<c;z++)h=x+z*v,k=x+(v+z*v),u=z*y,p=y+z*y,t[0]=b,t[2]=m,t[1]=h,q[0]=0,q[2]=1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=m,t[1]=k,q[0]=
0,q[2]=1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[2]=m,t[1]=k,q[0]=0,q[2]=1,q[1]=0,w[0]=l,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=m,t[1]=k,q[0]=0,q[2]=1,q[1]=0,w[0]=s,w[1]=p,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=b,t[2]=m,t[1]=h,q[0]=0,q[2]=1,q[1]=0,w[0]=l,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,
f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++,t[0]=g,t[2]=m,t[1]=h,q[0]=0,q[2]=1,q[1]=0,w[0]=s,w[1]=u,r[0]=1,r[1]=1,r[2]=1,r[3]=1,f[o].p.setv(t),f[o].n.setv(q),f[o].u.setv(w),f[o].c.setv(r),o++}this.addPolyset(a,f,e,4,Ovoid.VERTEX_VEC4_P|Ovoid.VERTEX_VEC3_N|Ovoid.VERTEX_VEC3_U,Ovoid.BUFFER_STATIC)};
Ovoid.Mesh.prototype.genDebugGrid=function(a,b,c,e){var f,g,h,k,j,m,l,s,u,p,x,v,y,o,A,z,t,q;f=Ovoid.Vertex.newArray(6*6*c*c);p=b/c;x=1/c;u=-(0.5*b);A=new Float32Array([0,0,0,1]);z=new Float32Array([0,0,0]);t=new Float32Array([0,0,0]);q=new Float32Array([1,1,1,1]);for(y=v=0;y<c;y++){b=u+y*p;g=u+(p+y*p);j=1-y*x;m=1-(x+y*x);for(o=0;o<c;o++)h=u+o*p,k=u+(p+o*p),l=o*x,s=x+o*x,A[0]=b,A[1]=0,A[2]=h,z[0]=0,z[1]=1,z[2]=0,t[0]=j,t[1]=l,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),
f[v].c.setv(q),v++,A[0]=b,A[1]=0,A[2]=k,z[0]=0,z[1]=1,z[2]=0,t[0]=j,t[1]=s,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),f[v].c.setv(q),v++,A[0]=g,A[1]=0,A[2]=k,z[0]=0,z[1]=1,z[2]=0,t[0]=m,t[1]=s,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),f[v].c.setv(q),v++,A[0]=g,A[1]=0,A[2]=k,z[0]=0,z[1]=1,z[2]=0,t[0]=m,t[1]=s,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),f[v].c.setv(q),v++,A[0]=g,A[1]=0,A[2]=h,z[0]=0,z[1]=1,z[2]=
0,t[0]=m,t[1]=l,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),f[v].c.setv(q),v++,A[0]=b,A[1]=0,A[2]=h,z[0]=0,z[1]=1,z[2]=0,t[0]=j,t[1]=l,q[0]=1,q[1]=1,q[2]=1,q[3]=1,f[v].p.setv(A),f[v].n.setv(z),f[v].u.setv(t),f[v].c.setv(q),v++}this.addPolyset(a,f,e,4,Ovoid.VERTEX_VEC4_P|Ovoid.VERTEX_VEC3_N|Ovoid.VERTEX_VEC3_U,Ovoid.BUFFER_STATIC)};
Ovoid.Mesh.prototype.optimizeVertices=function(){for(var a,b,c,e=Array(3),f=Array(3),g=Ovoid.MAX_MESH_LOD;g--;)if(0!=this.triangles[g].length){var h=[],k=0,j=this.triangles[g].length;for(a=0;a<j;a++){e[0]=this.vertices[g][this.triangles[g][a].index[0]];e[1]=this.vertices[g][this.triangles[g][a].index[1]];e[2]=this.vertices[g][this.triangles[g][a].index[2]];f[0]=f[1]=f[2]=!0;for(b=0;b<k;b++)for(c=0;3>c;c++)h[b].equal(e[c])&&(this.triangles[g][a].index[c]=b,f[c]=!1);for(c=0;3>c;c++)f[c]&&(this.triangles[g][a].index[c]=
k,h.push(e[c]),k++)}this.vertices[g]=h}this._createBuffers(this._vformat,this._vbotype)};
Ovoid.Mesh.prototype.optimizeTriangles=function(){for(var a,b,c=Ovoid.MAX_MESH_LOD;c--;)if(0!=this.triangles[c].length){var e=Array(2),f=Array(2),g=Array(2),h=Array(2),k=Array(2),j=Array(2),m=this.triangles[c].length;for(a=0;a<m;a++){e[0]=this.vertices[c][this.triangles[c][a].index[0]].p;e[1]=this.vertices[c][this.triangles[c][a].index[1]].p;f[0]=this.vertices[c][this.triangles[c][a].index[1]].p;f[1]=this.vertices[c][this.triangles[c][a].index[2]].p;g[0]=this.vertices[c][this.triangles[c][a].index[2]].p;
g[1]=this.vertices[c][this.triangles[c][a].index[0]].p;for(b=0;b<m;b++)if(a!=b){h[0]=this.vertices[c][this.triangles[c][b].index[0]].p;h[1]=this.vertices[c][this.triangles[c][b].index[1]].p;k[0]=this.vertices[c][this.triangles[c][b].index[1]].p;k[1]=this.vertices[c][this.triangles[c][b].index[2]].p;j[0]=this.vertices[c][this.triangles[c][b].index[2]].p;j[1]=this.vertices[c][this.triangles[c][b].index[0]].p;if(-1==this.triangles[c][a].adjacent[0]){if(e[0].equal(h[0])&&e[1].equal(h[1])||e[0].equal(h[1])&&
e[1].equal(h[0]))this.triangles[c][a].adjacent[0]=b,this.triangles[c][b].adjacent[0]=a;if(e[0].equal(k[0])&&e[1].equal(k[1])||e[0].equal(k[1])&&e[1].equal(k[0]))this.triangles[c][a].adjacent[0]=b,this.triangles[c][b].adjacent[1]=a;if(e[0].equal(j[0])&&e[1].equal(j[1])||e[0].equal(j[1])&&e[1].equal(j[0]))this.triangles[c][a].adjacent[0]=b,this.triangles[c][b].adjacent[2]=a}if(-1==this.triangles[c][a].adjacent[1]){if(f[0].equal(h[0])&&f[1].equal(h[1])||f[0].equal(h[1])&&f[1].equal(h[0]))this.triangles[c][a].adjacent[1]=
b,this.triangles[c][b].adjacent[0]=a;if(f[0].equal(k[0])&&f[1].equal(k[1])||f[0].equal(k[1])&&f[1].equal(k[0]))this.triangles[c][a].adjacent[1]=b,this.triangles[c][b].adjacent[1]=a;if(f[0].equal(j[0])&&f[1].equal(j[1])||f[0].equal(j[1])&&f[1].equal(j[0]))this.triangles[c][a].adjacent[1]=b,this.triangles[c][b].adjacent[2]=a}if(-1==this.triangles[c][a].adjacent[2]){if(g[0].equal(h[0])&&g[1].equal(h[1])||g[0].equal(h[1])&&g[1].equal(h[0]))this.triangles[c][a].adjacent[2]=b,this.triangles[c][b].adjacent[0]=
a;if(g[0].equal(k[0])&&g[1].equal(k[1])||g[0].equal(k[1])&&g[1].equal(k[0]))this.triangles[c][a].adjacent[2]=b,this.triangles[c][b].adjacent[1]=a;if(g[0].equal(j[0])&&g[1].equal(j[1])||g[0].equal(j[1])&&g[1].equal(j[0]))this.triangles[c][a].adjacent[2]=b,this.triangles[c][b].adjacent[2]=a}}}}};
Ovoid.Mesh.prototype.cachMesh=function(){if(!(this.cach&Ovoid.CACH_GEOMETRY)){for(var a=new Ovoid.Point(Ovoid.FLOAT_MAX,Ovoid.FLOAT_MAX,Ovoid.FLOAT_MAX,1),b=new Ovoid.Point(Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,1),c=0,e,f,g=this.vertices[0].length,h=0;h<g;h++)e=this.vertices[0][h].p,f=e.size(),e.v[0]>b.v[0]&&(b.v[0]=e.v[0]),e.v[1]>b.v[1]&&(b.v[1]=e.v[1]),e.v[2]>b.v[2]&&(b.v[2]=e.v[2]),e.v[0]<a.v[0]&&(a.v[0]=e.v[0]),e.v[1]<a.v[1]&&(a.v[1]=e.v[1]),e.v[2]<a.v[2]&&(a.v[2]=e.v[2]),c<f&&(c=f);
this.boundingBox.setBound(a,b);this.boundingSphere.setBound(a,b,c);delete a;delete b;for(h=0;h<this.link.length;h++)this.link[h].unCach(Ovoid.CACH_BOUNDING_SHAPE);this.addCach(Ovoid.CACH_GEOMETRY)}};
Ovoid.Mesh.prototype.toJSON=function(){var a={};a.t=Ovoid.MESH;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.mp=this.polyset;a.mv=Array(Ovoid.MAX_MESH_LOD);for(b=0;b<Ovoid.MAX_MESH_LOD;b++)a.mv[b]=
Ovoid.Vertex.pack(this._vformat,this.vertices[b]);a.mt=this.triangles;a.mf=this._vformat;a.mb=this._vfbytes;a.mm=this.modifier?this.modifier.uid:"null";a.lt=Array(Ovoid.MAX_MESH_LOD);for(b=0;b<Ovoid.MAX_MESH_LOD;b++)a.lt[b]=this._lodt[b];return a};Ovoid.Texture=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.TEXTURE;this.name=a;this.url="";this.handle=null;this.target=3553;this.filter=!1;this.loadStatus=0;this.pixmap=null;this._i=b};Ovoid.Texture.prototype=new Ovoid.Node;Ovoid.Texture.prototype.constructor=Ovoid.Texture;Ovoid.Texture.prototype.bind=function(){this._i.gl.bindTexture(this.target,this.handle)};
Ovoid.Texture.prototype.setFilter=function(a){this._i._clearGlerror();this.filter=a;this._i.gl.bindTexture(this.target,this.handle);a?Ovoid.isPowerOfTwo(this.width)&&Ovoid.isPowerOfTwo(this.height)?(this._i.gl.texParameteri(this.target,10240,9729),this._i.gl.texParameteri(this.target,10241,9987)):(Ovoid._log(2,this._i,"::Texture.setFilter",this.name+":: is NPO2, unable to set filtering."),this._i.gl.texParameteri(this.target,10242,33071),this._i.gl.texParameteri(this.target,10243,33071),this._i.gl.texParameteri(this.target,
10240,9729),this._i.gl.texParameteri(this.target,10241,9729)):(this._i.gl.texParameteri(this.target,10240,9728),this._i.gl.texParameteri(this.target,10241,9728),this._i.gl.texParameteri(this.target,10242,33071),this._i.gl.texParameteri(this.target,10243,33071));this._i.gl.bindTexture(this.target,null);this._i._logGlerror("::Texture.setFilter::"+this.name)};
Ovoid.Texture.prototype.create2dFromRaw=function(a,b,c,e){this._i._clearGlerror();this.width=b;this.height=c;this.handle=this._i.gl.createTexture();this.target=3553;this._i.gl.bindTexture(this.target,this.handle);this._i.gl.texImage2D(this.target,0,a,b,c,0,a,5121,e);Ovoid.isPowerOfTwo(this.width)&&Ovoid.isPowerOfTwo(this.height)?this._i.gl.generateMipmap(this.target):Ovoid._log(2,this._i,"::Texture.create2dFromRaw",this.name+":: is NPO2, unable to create mipmaps.");this.setFilter(this.filter);this._i.gl.bindTexture(this.target,
null);if(this._i._logGlerror("::Texture.create2dFromRaw::"+this.name))return!1;Ovoid._log(3,this._i,"::Texture.create2dFromRaw",this.name+":: created");this.loadStatus=1;return!0};
Ovoid.Texture.prototype.create2dFromImg=function(a,b){this._i._clearGlerror();this.width=b.width;this.height=b.height;this.handle=this._i.gl.createTexture();this.target=3553;this._i.gl.bindTexture(this.target,this.handle);this._i.gl.texImage2D(this.target,0,a,a,5121,b);Ovoid.isPowerOfTwo(this.width)&&Ovoid.isPowerOfTwo(this.height)?this._i.gl.generateMipmap(this.target):Ovoid._log(2,this._i,"::Texture.create2dFromImg",this.name+":: is NPO2, unable to create mipmaps.");this.setFilter(this.filter);
this._i.gl.bindTexture(this.target,null);if(this._i._logGlerror("::Texture.create2dFromImg::"+this.name))return!1;Ovoid._log(3,this._i,"::Texture.create2dFromImg",this.name+":: created");this.loadStatus=1;return!0};
Ovoid.Texture.prototype._handleLoad=function(){this._i._clearGlerror();this.o.handle=this._i.gl.createTexture();this.o.width=this.width;this.o.height=this.height;this._i.gl.bindTexture(this.o.target,this.o.handle);this._i.gl.texImage2D(this.o.target,0,6408,6408,5121,this);Ovoid.isPowerOfTwo(this.width)&&Ovoid.isPowerOfTwo(this.height)?this._i.gl.generateMipmap(this.o.target):Ovoid._log(2,this._i,"::Texture.loadSource",this.o.name+":: is NPO2, unable to create mipmaps.");this.o.setFilter(this.o.filter);
this._i.gl.bindTexture(this.o.target,null);if(!this._i._logGlerror("::Texture.loadSource::"+this.o.name))Ovoid._log(3,this._i,"::Texture.loadSource",this.o.name+":: loaded"),this.o.loadStatus=1};Ovoid.Texture.prototype._handleError=function(){Ovoid._log(2,this._i,"::Texture.loadSource",this.o.name+":: unable to load '"+this.o.url+"'");this.o.loadStatus=-1};
Ovoid.Texture.prototype.loadSource=function(a,b){this.loadStatus=0;var c=this.url=a;this._i.opt_debugMode&&(c+="?"+Math.random());this.target=3553;this.filter=b;this.pixmap=new Image;this.pixmap.o=this;this.pixmap._i=this._i;this.pixmap.onload=this._handleLoad;this.pixmap.onerror=this._handleError;this.pixmap.src=c};
Ovoid.Texture.prototype.toJSON=function(){var a={};a.t=Ovoid.TEXTURE;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.url=this.url;a.fl=this.filter;return a};Ovoid.Material=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.MATERIAL;this.name=a;this.color=Ovoid.Color.newArray(5);this.color[0].set(1,1,1,1);this.color[1].set(1,1,1,1);this.color[2].set(1,1,1,1);this.color[3].set(0,0,0,1);this.color[4].set(1,1,1,1);this.texture=Array(6);for(var c=6;c--;)this.texture[c]=null;this.shininess=100;this.reflectivity=0;this.opacity=1;this.bumpiness=0;this._i=b};Ovoid.Material.prototype=new Ovoid.Node;Ovoid.Material.prototype.constructor=Ovoid.Material;
Ovoid.Material.prototype.setTexture=function(a,b){5<a||(null!=this.texture[a]&&this.breakDepend(this.texture[a]),this.texture[a]=b,null!=b&&this.makeDepend(b))};Ovoid.Material.prototype.setColor=function(a,b){this.color[a].copy(b)};Ovoid.Material.prototype.setColorRgba=function(a,b,c,e,f){this.color[a].v[0]=b;this.color[a].v[1]=c;this.color[a].v[2]=e;this.color[a].v[3]=f};Ovoid.Material.prototype.setColorv=function(a,b){this.color[a].v.set(b)};
Ovoid.Material.prototype.toJSON=function(){var a={};a.t=Ovoid.MATERIAL;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.name:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.cl=this.color;a.tx=Array(6);for(b=0;6>b;b++)a.tx[b]=this.texture[b]?
this.texture[b].uid:"null";a.sh=this.shininess;a.re=this.reflectivity;a.op=this.opacity;return a};Ovoid.Camera=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.CAMERA;this.name=a;this.viewY=this.viewX=1;this.fov=60;this.clipNear=this.aspect=1;this.clipFar=500;this.lookat=new Ovoid.Matrix4;this.perspective=new Ovoid.Matrix4;this.orthographic=new Ovoid.Matrix4;this.eyeview=new Ovoid.Matrix4;this._fstum=Ovoid.Point.newArray(6);this._i=b;this.setView(b.Frame.size.v[0],b.Frame.size.v[1])};Ovoid.Camera.prototype=new Ovoid.Transform;Ovoid.Camera.prototype.constructor=Ovoid.Camera;
Ovoid.Camera.prototype.setView=function(a,b){this.viewX=a;this.viewY=b;this.aspect=a/b;this.unCach(Ovoid.CACH_VIEWPROJ)};Ovoid.Camera.prototype.setFov=function(a){this.fov=a;this.unCach(Ovoid.CACH_VIEWPROJ)};Ovoid.Camera.prototype.setClipping=function(a,b){this.clipNear=a;this.clipFar=b;this.unCach(Ovoid.CACH_VIEWPROJ)};
Ovoid.Camera.prototype.isWatching=function(a){a.distFromEye=a.worldPosition.dist(this.worldPosition)-a.boundingSphere.radius;if(0>=a.distFromEye)return!0;for(var b=5;b--;)if(this._fstum[b].v[0]*a.boundingSphere.worldCenter.v[0]+this._fstum[b].v[1]*a.boundingSphere.worldCenter.v[1]+this._fstum[b].v[2]*a.boundingSphere.worldCenter.v[2]+this._fstum[b].v[3]<=-a.boundingSphere.radius)return!1;return!0};
Ovoid.Camera.prototype.unproject=function(a,b,c,e){var f=new Ovoid.Matrix4;f.copy(this.eyeview);f.toInverse();var g,a=2*(a/this.viewX)-1,b=2*(b/this.viewY)-1;g=2*c-1;c=new Ovoid.Point;c.v[0]=a*f.m[0]+b*f.m[4]+g*f.m[8]+f.m[12];c.v[1]=a*f.m[1]+b*f.m[5]+g*f.m[9]+f.m[13];c.v[2]=a*f.m[2]+b*f.m[6]+g*f.m[10]+f.m[14];c.v[3]=a*f.m[3]+b*f.m[7]+g*f.m[11]+f.m[15];delete f;c.v[0]/=c.v[3];c.v[1]/=c.v[3];c.v[2]/=c.v[3];c.v[3]=1;f=new Ovoid.Vector(0,1,0);a=new Ovoid.Vector;b=new Ovoid.Vector;g=new Ovoid.Vector;a.subOf(c,
this.worldPosition);a.normalize();g.crossOf(f,a);b.crossOf(a,g);e.m[0]=g.v[0];e.m[1]=g.v[1];e.m[2]=g.v[2];e.m[4]=b.v[0];e.m[5]=b.v[1];e.m[6]=b.v[2];e.m[8]=a.v[0];e.m[9]=a.v[1];e.m[10]=a.v[2];e.m[12]=c.v[0];e.m[13]=c.v[1];e.m[14]=c.v[2];e.m[15]=1;delete f;delete a;delete b;delete g;delete c;return!0};
Ovoid.Camera.prototype.cachCamera=function(){if(!(this.cach&Ovoid.CACH_VIEWPROJ)){var a=1/Math.tan(0.5*Ovoid.deg2Rad(this.fov));this.perspective.m[0]=a/this.aspect;this.perspective.m[5]=a;this.perspective.m[15]=0;this.perspective.m[11]=-1;this._i.opt_renderShadowCasting?(a=1/(this.clipNear- -1),this.perspective.m[10]=0,this.perspective.m[14]=-2*this.clipNear*a):(a=1/(this.clipNear-this.clipFar),this.perspective.m[10]=(this.clipFar+this.clipNear)*a,this.perspective.m[14]=2*this.clipFar*this.clipNear*
a);this.orthographic.m[0]=2/this.viewX;this.orthographic.m[5]=2/this.viewY;this.orthographic.m[10]=-2/(this.clipNear-this.clipFar);this.orthographic.m[3]=0;this.orthographic.m[7]=0;this.orthographic.m[11]=(this.clipNear+this.clipFar)/(this.clipNear-this.clipFar);this.orthographic.m[12]=-1;this.orthographic.m[13]=1;this.orthographic.m[14]=0;this.addCach(Ovoid.CACH_VIEWPROJ)}if(!(this.cach&Ovoid.CACH_WORLD)){var a=new Ovoid.Vector(this.worldMatrix.m[0],this.worldMatrix.m[1],this.worldMatrix.m[2]),b=
new Ovoid.Vector(this.worldMatrix.m[4],this.worldMatrix.m[5],this.worldMatrix.m[6]),c=new Ovoid.Vector(this.worldMatrix.m[8],this.worldMatrix.m[9],this.worldMatrix.m[10]),e=new Ovoid.Vector(this.worldMatrix.m[12],this.worldMatrix.m[13],this.worldMatrix.m[14]);this.lookat.m[0]=a.v[0];this.lookat.m[4]=a.v[1];this.lookat.m[8]=a.v[2];this.lookat.m[1]=b.v[0];this.lookat.m[5]=b.v[1];this.lookat.m[9]=b.v[2];this.lookat.m[2]=c.v[0];this.lookat.m[6]=c.v[1];this.lookat.m[10]=c.v[2];this.lookat.m[12]=-e.v[0]*
a.v[0]+-e.v[1]*a.v[1]+-e.v[2]*a.v[2];this.lookat.m[13]=-e.v[0]*b.v[0]+-e.v[1]*b.v[1]+-e.v[2]*b.v[2];this.lookat.m[14]=-e.v[0]*c.v[0]+-e.v[1]*c.v[1]+-e.v[2]*c.v[2];delete a;delete b;delete c;delete e;this.eyeview.multOf(this.lookat,this.perspective);if(this._i.opt_viewcull){for(b=a=0;3>b;b++)this._fstum[a].v[0]=this.eyeview.m[3]-this.eyeview.m[0+b],this._fstum[a].v[1]=this.eyeview.m[7]-this.eyeview.m[4+b],this._fstum[a].v[2]=this.eyeview.m[11]-this.eyeview.m[8+b],this._fstum[a].v[3]=this.eyeview.m[15]-
this.eyeview.m[12+b],a++,this._fstum[a].v[0]=this.eyeview.m[3]+this.eyeview.m[0+b],this._fstum[a].v[1]=this.eyeview.m[7]+this.eyeview.m[4+b],this._fstum[a].v[2]=this.eyeview.m[11]+this.eyeview.m[8+b],this._fstum[a].v[3]=this.eyeview.m[15]+this.eyeview.m[12+b],a++;for(a=6;a--;)b=Math.sqrt(this._fstum[a].v[0]*this._fstum[a].v[0]+this._fstum[a].v[1]*this._fstum[a].v[1]+this._fstum[a].v[2]*this._fstum[a].v[2]),this._fstum[a].v[0]/=b,this._fstum[a].v[1]/=b,this._fstum[a].v[2]/=b,this._fstum[a].v[3]/=b}}};
Ovoid.Camera.prototype.toJSON=function(){var a={};a.t=Ovoid.CAMERA;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;a.tr=
this.rotation;a.vx=this.viewX;a.vy=this.viewY;a.fv=this.fov;a.ar=this.aspect;a.cn=this.clipNear;a.cf=this.clipFar;return a};Ovoid.Light=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.LIGHT;this.name=a;this.model=Ovoid.LIGHT_POINT;this.color=new Ovoid.Color(1,1,1,1);this.attenuationC=this.intensity=1;this.attenuationL=0;this.attenuationQ=0.01;this.range=1/(0.01*this.attenuationL+Math.sqrt(0.01*this.attenuationQ));this.falloff=0;this.spotAngle=Ovoid.deg2Rad(180);this.shadowCasting=!0;this._i=b};Ovoid.Light.prototype=new Ovoid.Transform;Ovoid.Light.prototype.constructor=Ovoid.Light;
Ovoid.Light.prototype.setColor=function(a){this.color.copy(a)};Ovoid.Light.prototype.setColorRgba=function(a,b,c,e){this.color.set(a,b,c,e)};Ovoid.Light.prototype.setColorv=function(a){this.color.v.set(a)};Ovoid.Light.prototype.setRange=function(a){this.range=a;this.unCach(Ovoid.CACH_LIGHT)};
Ovoid.Light.prototype.setAttenuation=function(a,b,c){this.attenuationC=a;this.attenuationL=b;this.attenuationQ=c;if(0<this.attenuationQ||0<this.attenuationL)this.range=1/(0.01*this.attenuationL+Math.sqrt(0.01*this.attenuationQ));this.unCach(Ovoid.CACH_LIGHT)};Ovoid.Light.prototype.setSpotAngle=function(a,b){this.spotAngle=Ovoid.deg2Rad(a);if(b)this.falloff=b};
Ovoid.Light.prototype.isLightening=function(a){return this.boundingSphere.worldCenter.dist(a.boundingSphere.worldCenter)<=this.boundingSphere.radius+a.boundingSphere.radius};Ovoid.Light.prototype.cachLight=function(){1==this.model&&(this.worldPosition.v[3]=0);this.cach&Ovoid.CACH_LIGHT||(this.boundingSphere.setRadius(this.range),this.addCach(Ovoid.CACH_LIGHT))};
Ovoid.Light.prototype.toJSON=function(){var a={};a.t=Ovoid.LIGHT;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pivot=this.pivot;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;
a.tr=this.rotation;a.md=this.model;a.cl=this.color;a.it=this.intensity;a.ac=this.attenuationC;a.al=this.attenuationL;a.aq=this.attenuationQ;a.rn=this.range;a.ff=this.falloff;a.sa=this.spotAngle;a.sc=this.shadowCasting;return a};Ovoid.Action=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.ACTION;this.name=a;this.onEnter=function(){};this.onLeave=function(){};this.onOver=function(){};this.onLmbDn=function(){};this.onLmbUp=function(){};this.onLmbHl=function(){};this.onMmbDn=function(){};this.onMmbUp=function(){};this.onMmbHl=function(){};this.onRmbDn=function(){};this.onRmbUp=function(){};this.onRmbHl=function(){};this.onGrabd=function(){};this.onUgrabd=function(){};this.onIntersect=[[],[]];this.onIntersectEnter=[[],[]];
this.onIntersectLeave=[[],[]];this._i=b};Ovoid.Action.prototype=new Ovoid.Node;Ovoid.Action.prototype.constructor=Ovoid.Action;
Ovoid.Action.prototype.linkNode=function(a){for(i=this.link.length;i--;)if(this.link[i]===a)return;a.pickable=!0;this._i.opt_renderPickingMode||Ovoid._log(2,this._i,"::Action.linkNode",this.name+":: linked node '"+a.name+"' set as pickable but render picking mode is disabled, that will not work.");if((this.onIntersect.length||this.onIntersectEnter.length||this.onIntersectLeave.length)&&a.type&Ovoid.BODY)a.intersectable=!0,this._i.opt_sceneIntersectDetect||Ovoid._log(2,this._i,"::Action.linkNode",
this.name+":: linked node '"+a.name+"' set as intersectable but intersect detection is disabled, that will not work.");a.makeDepend(this)};
Ovoid.Action.prototype.setTrigger=function(a,b,c){switch(a){case 0:this.onEnter=b;break;case 1:this.onLeave=b;break;case 2:this.onOver=b;break;case 3:this.onLmbDn=b;break;case 4:this.onLmbUp=b;break;case 5:this.onLmbHl=b;break;case 6:this.onMmbDn=b;break;case 7:this.onMmbUp=b;break;case 8:this.onMmbHl=b;break;case 9:this.onRmbDn=b;break;case 10:this.onRmbUp=b;break;case 11:this.onRmbHl=b;break;case 12:this.onGrabd=b;break;case 13:this.onUgrabd=b;break;case 14:this.onIntersect[0].push(c);this.onIntersect[1].push(b);
for(a=this.link.length;a--;)this.link[a].intersectable=!0;if(c)c.intersectable=!0;break;case 15:this.onIntersectEnter[0].push(c);this.onIntersectEnter[1].push(b);for(a=this.link.length;a--;)this.link[a].intersectable=!0;if(c)c.intersectable=!0;break;case 16:this.onIntersectLeave[0].push(c);this.onIntersectLeave[1].push(b);for(a=this.link.length;a--;)this.link[a].intersectable=!0;if(c)c.intersectable=!0}};
Ovoid.Action.prototype.cachAction=function(){if(!(this.cach&Ovoid.CACH_ACTION)){var a,b,c,e,f=this._i.Input;try{for(a=this.link.length;a--;){e=this.link[a];if(e.uid==f.mouseLeaveUid)this.onLeave(e),document.body.style.cursor="default";if(e.uid==f.mouseEnterUid)this.onEnter(e),f.mouseOverNode=e;if(0==f.mouseOverUid)f.mouseOverNode=null;else if(e.uid==f.mouseOverUid&&(document.body.style.cursor="pointer",this.onOver(e),!f.grabbedNode)){if(f.intDn[0])this.onLmbDn(e);if(f.intUp[0])this.onLmbUp(e);if(f.intHl[0])this.onLmbHl(e);
if(f.intDn[1])this.onMmbDn(e);if(f.intUp[1])this.onMmbUp(e);if(f.intHl[1])this.onMmbHl(e);if(f.intDn[2])this.onRmbDn(e);if(f.intUp[2])this.onRmbUp(e);if(f.intHl[2])this.onRmbHl(e)}if(e==f.grabbedNode){document.body.style.cursor="crosshair";this.onGrabd(e);if(f.intDn[0])this.onLmbDn(e);if(f.intUp[0])this.onLmbUp(e);if(f.intHl[0])this.onLmbHl(e);if(f.intDn[1])this.onMmbDn(e);if(f.intUp[1])this.onMmbUp(e);if(f.intHl[1])this.onMmbHl(e);if(f.intDn[2])this.onRmbDn(e);if(f.intUp[2])this.onRmbUp(e);if(f.intHl[2])this.onRmbHl(e)}else this.onUgrabd(e);
if(this._i.opt_sceneIntersectDetect&&e.type&Ovoid.BODY){c=this.onIntersect[0].length;if(e.intersect.count&&c)for(;c--;)if(b=e.intersect.count,null==this.onIntersect[0][c])for(;b--;)this.onIntersect[1][c](e,e.intersect[b]);else for(;b--;)if(e.intersect[b]===this.onIntersect[0][c])this.onIntersect[1][c](e,e.intersect[b]);c=this.onIntersectEnter[0].length;if(e.enter.count&&c)for(;c--;)if(b=e.enter.count,null==this.onIntersectEnter[0][c])for(;b--;)this.onIntersectEnter[1][c](e,e.enter[b]);else for(;b--;)if(e.enter[b]===
this.onIntersectEnter[0][c])this.onIntersectEnter[1][c](e,e.enter[b]);c=this.onIntersectLeave[0].length;if(e.leave.count&&c)for(;c--;)if(b=e.leave.count,null==this.onIntersectLeave[0][c])for(;b--;)this.onIntersectLeave[1][c](e,e.leave[b]);else for(;b--;)if(e.leave[b]===this.onIntersectLeave[0][c])this.onIntersectLeave[1][c](e,e.leave[b])}}}catch(g){Ovoid._log(0,this._i,"::Action.cachAction",this.name+":: Custom function exception thrown:\n"+g.stack)}this.addCach(Ovoid.CACH_ACTION)}};
Ovoid.Action.prototype.toJSON=function(){var a={};a.t=Ovoid.ACTION;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.onEnter=Ovoid.compact(this.onEnter);a.onLeave=Ovoid.compact(this.onLeave);
a.onOver=Ovoid.compact(this.onOver);a.onLmbDn=Ovoid.compact(this.onLmbDn);a.onLmbUp=Ovoid.compact(this.onLmbUp);a.onLmbHl=Ovoid.compact(this.onLmbHl);a.onMmbDn=Ovoid.compact(this.onMmbDn);a.onMmbUp=Ovoid.compact(this.onMmbUp);a.onMmbHl=Ovoid.compact(this.onMmbHl);a.onRmbDn=Ovoid.compact(this.onRmbDn);a.onRmbUp=Ovoid.compact(this.onRmbUp);a.onRmbHl=Ovoid.compact(this.onRmbHl);a.onGrabd=Ovoid.compact(this.onGrabd);a.onUgrabd=Ovoid.compact(this.onUgrabd);a.onIntersect=[[],[]];for(b=0;b<this.onIntersect[0].length;b++)a.onIntersect[0][b]=
this.onIntersect[0][b].uid,a.onIntersect[1][b]=Ovoid.compact(this.onIntersect[1][b]);a.onIntersectEnter=[[],[]];for(b=0;b<this.onIntersectEnter[0].length;b++)a.onIntersectEnter[0][b]=this.onIntersectEnter[0][b].uid,a.onIntersectEnter[1][b]=Ovoid.compact(this.onIntersectEnter[1][b]);a.onIntersectLeave=[[],[]];for(b=0;b<this.onIntersectLeave[0].length;b++)a.onIntersectLeave[0][b]=this.onIntersectLeave[0][b].uid,a.onIntersectLeave[1][b]=Ovoid.compact(this.onIntersectLeave[1][b]);return a};Ovoid.Constraint=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.CONSTRAINT;this.name=a;this.target=[];this._i=b};Ovoid.Constraint.prototype=new Ovoid.Node;Ovoid.Constraint.prototype.constructor=Ovoid.Constraint;Ovoid.Constraint.prototype.setTarget=function(a){this.target.push(a);a.makeDepend(this)};Ovoid.Constraint.prototype.remTarget=function(a){for(var b=this.target.length;b--;)this.target[b]===a&&(this.target.splice(b,1),a.breakDepend(this))};
Ovoid.Constraint.prototype.toJSON=function(){var a={};a.t=Ovoid.CONSTRAINT;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ct=[];for(b=0;b<this.target.length;b++)a.ct[b]=this.target[b].uid;
return a};Ovoid.Animation=function(a,b){Ovoid.Constraint.call(this);this.type|=Ovoid.ANIMATION;this.name=a;this.ended=this.loop=this.playing=!1;this.smooth=!0;this.factor=1;this.onended=function(){};this._format=0;this._channel=Array(21);this._output=new Float32Array(21);this._time=0;this._i=b};Ovoid.Animation.prototype=new Ovoid.Constraint;Ovoid.Animation.prototype.constructor=Ovoid.Animation;
Ovoid.Animation.prototype.setCspline=function(a,b,c){this._format|=a;for(var e=0,f=1;21>e;e++,f<<=1)a&f&&(this._channel[e]=new Ovoid.Cspline(b,c))};Ovoid.Animation.prototype.setHspline=function(a,b,c,e){this._format|=a;for(var f=0,g=1;21>f;f++,g<<=1)a&g&&(this._channel[f]=new Ovoid.Hspline(b,c,e))};Ovoid.Animation.prototype.setBspline=function(a,b,c,e,f){this._format|=a;for(var g=0,h=1;21>g;g++,h<<=1)a&h&&(this._channel[g]=new Ovoid.Bspline(b,c,e,f))};
Ovoid.Animation.prototype.setLoop=function(a){this.loop=a};Ovoid.Animation.prototype.stop=function(){if(this.playing)this.playing=!1};Ovoid.Animation.prototype.play=function(a){if(a)this.factor=a;if(this.ended)for(;i--;)if(this._channel[i])this._channel[i]._stop=!1;this.playing=!0};
Ovoid.Animation.prototype.rewind=function(a){var b=32;if(a)this.factor=a;if(0<this.factor)for(;b--;){if(this._channel[b])this._channel[b].seekStart(this.smooth,0),this._channel[b]._stop=!1,this._output[b]=this._channel[b].getOutput(this.smooth)}else for(;b--;)if(this._channel[b])this._channel[b].seekEnd(this.smooth,0),this._channel[b]._stop=!1,this._output[b]=this._channel[b].getOutput(this.smooth);this.target[0]&&(this._format&Ovoid.ANIMATION_CHANNEL_TRANSLATE&&(this.target[0].translation.setv(this._output.subarray(0,
3)),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&Ovoid.ANIMATION_CHANNEL_ROTATE&&(this.target[0].rotation.fromEulerXyz(this._output[3],this._output[4],this._output[5]),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&Ovoid.ANIMATION_CHANNEL_ORIENTE&&(this.body.orientation.fromEulerXyz(this._output[6],this._output[7],this._output[8]),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&Ovoid.ANIMATION_CHANNEL_SCALE&&(this.target[0].scaling.setv(this._output.subarray(9,
12)),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)));this._time=0;this.ended=!1};Ovoid.Animation.prototype.time=function(){return this._time};
Ovoid.Animation.prototype.cachAnimation=function(){if(this.playing){this.playing=!1;var a=this._i.Timer.quantum*this.factor,b=32;if(0<this.factor)for(;b--;){if(this._channel[b]&&!this._channel[b]._stop)this._channel[b].seekForward(this.smooth,a),this._output[b]=this._channel[b].getOutput(this.smooth),this.playing=!0}else for(;b--;)if(this._channel[b]&&!this._channel[b]._stop)this._channel[b].seekBackward(this.smooth,a),this._output[b]=this._channel[b].getOutput(this.smooth),this.playing=!0;this._time+=
this._i.Timer.quantum*this.factor;if(!this.playing){try{this.onended(this)}catch(c){Ovoid._log(0,this._i,"::Animation.cachAnimation",this.name+":: Custom onended() function exception thrown:\n"+c.stack)}if(this.loop){if(0<this.factor)for(;b--;){if(this._channel[b])this._channel[b].seekStart(this.smooth,0),this._channel[b]._stop=!1,this._output[b]=this._channel[b].getOutput(this.smooth)}else for(;b--;)if(this._channel[b])this._channel[b].seekEnd(this.smooth,0),this._channel[b]._stop=!1,this._output[b]=
this._channel[b].getOutput(this.smooth);this._time=0;this.ended=!1;this.playing=!0}else{this.ended=!0;return}}this.target[0]&&(this._format&Ovoid.ANIMATION_CHANNEL_TRANSLATE&&(this.target[0].translation.setv(this._output.subarray(0,3)),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&Ovoid.ANIMATION_CHANNEL_ROTATE&&(this.target[0].rotation.fromEulerXyz(this._output[3],this._output[4],this._output[5]),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&
Ovoid.ANIMATION_CHANNEL_ORIENTE&&(this.body.orientation.fromEulerXyz(this._output[6],this._output[7],this._output[8]),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)),this._format&Ovoid.ANIMATION_CHANNEL_SCALE&&(this.target[0].scaling.setv(this._output.subarray(9,12)),this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)))}};
Ovoid.Animation.prototype.toJSON=function(){var a={};a.t=Ovoid.ANIMATION;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ct=[];for(b=0;b<this.target.length;b++)a.ct[b]=this.target[b].uid;
a.ft=this._format;a.pl=this.playing;a.lo=this.loop;a.en=this.ended;a.sm=this.smooth;a.fc=this.factor;a.cn=Array(21);for(b=0;21>b;b++)a.cn[b]=this._channel[b]?this._channel[b]:"null";a.oe=Ovoid.compact(this.onended);return a};Ovoid.Expression=function(a,b){Ovoid.Constraint.call(this);this.type|=Ovoid.EXPRESSION;this.name=a;this.playing=!1;this.timel=this.timeq=0;this.factor=1;this.exprfunc=[];this._i=b};Ovoid.Expression.prototype=new Ovoid.Constraint;Ovoid.Expression.prototype.constructor=Ovoid.Expression;Ovoid.Expression.prototype.addExpression=function(a){this.exprfunc.push(a)};Ovoid.Expression.prototype.stop=function(){this.playing=!1};Ovoid.Expression.prototype.play=function(a){if(a)this.factor=a;this.playing=!0};
Ovoid.Expression.prototype.cachExpression=function(){if(!(this.cach&Ovoid.CACH_EXPRESSION)){if(this.playing){this.timeq=this.factor*this._i.Timer.quantum;this.timel+=this.timeq;var a=this.target.length,b=this.exprfunc.length;try{for(;a--;)for(var c=0;c<b;c++)this.exprfunc[c](this.target[a],this.timeq,this.timel)}catch(e){Ovoid._log(0,this._i,"::Expression.cachExpression",this.name+":: Custom function exception thrown:\n"+e.stack)}}this.addCach(Ovoid.CACH_EXPRESSION)}};
Ovoid.Expression.prototype.toJSON=function(){var a={};a.t=Ovoid.EXPRESSION;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ct=[];for(b=0;b<this.target.length;b++)a.ct[b]=this.target[b].uid;
a.pl=this.playing;a.fc=this.factor;a.ex=[];for(b=0;b<this.exprfunc.length;b++)a.ex[b]=Ovoid.compact(this.exprfunc[b]);return a};Ovoid.Physics=function(a,b){Ovoid.Constraint.call(this);this.type|=Ovoid.PHYSICS;this.name=a;this.imass=10;this.itensor=new Ovoid.Matrix3;this.model=Ovoid.RIGID_MASSIVE_SPHERE;this.angularDamping=this.linearDamping=0.9;this.useFriction=!1;this.restitution=0.5;this.linearVelocity=new Ovoid.Vector(0,0,0);this.angularVelocity=new Ovoid.Vector(0,0,0);this.sleeping=0.4;this.oncontact=function(){};this._scaledLinear=new Ovoid.Vector(0,0,0);this._scaledTorque=new Ovoid.Vector(0,0,0);this.linearInfluence=
new Ovoid.Vector(0,0,0);this.torqueInfluence=new Ovoid.Vector(0,0,0);this._oldLinear=new Ovoid.Vector(0,0,0);this._oldTorque=new Ovoid.Vector(0,0,0);this._motion=10*Ovoid.PHYSICS_MOTION_EPSILON;this._i=b};Ovoid.Physics.prototype=new Ovoid.Constraint;Ovoid.Physics.prototype.constructor=Ovoid.Physics;Ovoid.Physics.prototype.setMass=function(a){0<a?this.imass=1/a:this.imass=0};Ovoid.Physics.prototype.setDamping=function(a,b){this.linearDamping=a;this.angularDamping=b};
Ovoid.Physics.prototype.newton=function(a){if(!(this.cach&Ovoid.CACH_PHYSICS)&&0<this.imass){var b=1/this.imass;this.linearInfluence.v[0]+=b*a.v[0];this.linearInfluence.v[1]+=b*a.v[1];this.linearInfluence.v[2]+=b*a.v[2];this.unCach(Ovoid.CACH_INFLUENCES)}};Ovoid.Physics.prototype.newtonXyz=function(a,b,c){if(!(this.cach&Ovoid.CACH_PHYSICS)&&0<this.imass){var e=1/this.imass;this.linearInfluence.v[0]+=e*a;this.linearInfluence.v[1]+=e*b;this.linearInfluence.v[2]+=e*c;this.unCach(Ovoid.CACH_INFLUENCES)}};
Ovoid.Physics.prototype.wind=function(a){this.cach&Ovoid.CACH_PHYSICS||(this.linearInfluence.addBy(a),this.unCach(Ovoid.CACH_INFLUENCES))};Ovoid.Physics.prototype.windXyz=function(a,b,c){this.cach&Ovoid.CACH_PHYSICS||(this.linearInfluence.v[0]+=a,this.linearInfluence.v[1]+=b,this.linearInfluence.v[2]+=c,this.unCach(Ovoid.CACH_INFLUENCES))};
Ovoid.Physics.prototype.impulse=function(a,b,c){if(0<a.size2()){this.linearInfluence.addBy(a);var e;switch(c){case 1:c=b.v[0]*this.target[0].worldMatrix.m[0]+b.v[1]*this.target[0].worldMatrix.m[4]+b.v[2]*this.target[0].worldMatrix.m[8];e=b.v[0]*this.target[0].worldMatrix.m[1]+b.v[1]*this.target[0].worldMatrix.m[5]+b.v[2]*this.target[0].worldMatrix.m[9];b=b.v[0]*this.target[0].worldMatrix.m[2]+b.v[1]*this.target[0].worldMatrix.m[6]+b.v[2]*this.target[0].worldMatrix.m[10];break;default:c=b.v[0]-this.target[0].worldPosition.v[0],
e=b.v[1]-this.target[0].worldPosition.v[1],b=b.v[2]-this.target[0].worldPosition.v[2]}this.torqueInfluence.v[0]+=e*a.v[2]-b*a.v[1];this.torqueInfluence.v[1]+=b*a.v[0]-c*a.v[2];this.torqueInfluence.v[2]+=c*a.v[1]-e*a.v[0];this.unCach(Ovoid.CACH_INFLUENCES|Ovoid.CACH_PHYSICS)}};Ovoid.Physics.prototype.spring=function(a,b,c,e,f){var g=new Ovoid.Vector;g.subOf(this.target[0].worldPosition,b);if(b=g.size())g.normalize(),g.scaleBy(-((b-e)*c)),this.impulse(g,a,f)};
Ovoid.Physics.prototype.clearInfluences=function(){this.linearVelocity.set(0,0,0);this.angularVelocity.set(0,0,0);this.linearInfluence.set(0,0,0);this.torqueInfluence.set(0,0,0);this._motion=10*this.sleeping};Ovoid.Physics.prototype.getMotion=function(){return this._motion};
Ovoid.Physics.prototype.cachPhysics=function(){if(this.model&&!(this.cach&Ovoid.CACH_PHYSICS)){if(0<this.target[0].boundingBox.hsize.v[0]+this.target[0].boundingBox.hsize.v[1]+this.target[0].boundingBox.hsize.v[2]&&0<this.imass){var a=1/this.imass,b,c,e;switch(this.model){case 1:e=2*this.target[0].boundingBox.hsize.v[0];var f=2*this.target[0].boundingBox.hsize.v[1];c=2*this.target[0].boundingBox.hsize.v[2];e*=e;f*=f;c*=c;b=1/(0.333*a*(f+c));c=1/(0.333*a*(e+c));e=1/(0.333*a*(e+f));break;default:e=
this.target[0].boundingSphere.radius,e*=e,b=1/(0.333*a*e),c=1/(0.333*a*e),e=1/(0.333*a*e)}f=Array(9);f[0]=this.target[0].worldMatrix.m[0]*b;f[1]=this.target[0].worldMatrix.m[1]*c;f[2]=this.target[0].worldMatrix.m[2]*e;f[3]=this.target[0].worldMatrix.m[4]*b;f[4]=this.target[0].worldMatrix.m[5]*c;f[5]=this.target[0].worldMatrix.m[6]*e;f[6]=this.target[0].worldMatrix.m[8]*b;f[7]=this.target[0].worldMatrix.m[9]*c;f[8]=this.target[0].worldMatrix.m[10]*e;this.itensor.m[0]=f[0]*this.target[0].worldMatrix.m[0]+
f[1]*this.target[0].worldMatrix.m[1]+f[2]*this.target[0].worldMatrix.m[2];this.itensor.m[1]=f[0]*this.target[0].worldMatrix.m[4]+f[1]*this.target[0].worldMatrix.m[5]+f[2]*this.target[0].worldMatrix.m[6];this.itensor.m[2]=f[0]*this.target[0].worldMatrix.m[8]+f[1]*this.target[0].worldMatrix.m[9]+f[2]*this.target[0].worldMatrix.m[10];this.itensor.m[3]=f[3]*this.target[0].worldMatrix.m[0]+f[4]*this.target[0].worldMatrix.m[1]+f[5]*this.target[0].worldMatrix.m[2];this.itensor.m[4]=f[3]*this.target[0].worldMatrix.m[4]+
f[4]*this.target[0].worldMatrix.m[5]+f[5]*this.target[0].worldMatrix.m[6];this.itensor.m[5]=f[3]*this.target[0].worldMatrix.m[8]+f[4]*this.target[0].worldMatrix.m[9]+f[5]*this.target[0].worldMatrix.m[10];this.itensor.m[6]=f[6]*this.target[0].worldMatrix.m[0]+f[7]*this.target[0].worldMatrix.m[1]+f[8]*this.target[0].worldMatrix.m[2];this.itensor.m[7]=f[6]*this.target[0].worldMatrix.m[4]+f[7]*this.target[0].worldMatrix.m[5]+f[8]*this.target[0].worldMatrix.m[6];this.itensor.m[8]=f[6]*this.target[0].worldMatrix.m[8]+
f[7]*this.target[0].worldMatrix.m[9]+f[8]*this.target[0].worldMatrix.m[10];delete f;this.linearInfluence.v[0]+=a*this._i.opt_gravity[0];this.linearInfluence.v[1]+=a*this._i.opt_gravity[1];this.linearInfluence.v[2]+=a*this._i.opt_gravity[2];this.unCach(Ovoid.CACH_INFLUENCES)}this.cach&Ovoid.CACH_INFLUENCES||(this.linearInfluence.scaleBy(this.imass),this.torqueInfluence.transform3(this.itensor),this.linearInfluence.scaleBy(this._i.Timer.quantum),this.torqueInfluence.scaleBy(this._i.Timer.quantum),this.linearVelocity.addBy(this.linearInfluence),
this.angularVelocity.addBy(this.torqueInfluence),this._oldLinear.copy(this.linearInfluence),this._oldTorque.copy(this.torqueInfluence),this.linearInfluence.set(0,0,0),this.torqueInfluence.set(0,0,0),this.addCach(Ovoid.CACH_INFLUENCES));this.linearVelocity.scaleBy(Math.pow(this.linearDamping,this._i.Timer.quantum));this.angularVelocity.scaleBy(Math.pow(this.angularDamping,this._i.Timer.quantum));this._scaledLinear.copy(this.linearVelocity);this._scaledLinear.scaleBy(this._i.Timer.quantum);this.target[0].translation.addBy(this._scaledLinear);
this._scaledTorque.copy(this.angularVelocity);this._scaledTorque.scaleBy(this._i.Timer.quantum);this.target[0].rotation.vectorRotateBy(this._scaledTorque);this.target[0].rotation.normalize();a=Math.pow(0.1,this._i.Timer.quantum);this._motion=a*this._motion+(1-a)*(this.linearVelocity.size()+this.angularVelocity.size());this._motion<this.sleeping&&(this.clearInfluences(),this.addCach(Ovoid.CACH_PHYSICS));this.target[0].unCach(Ovoid.CACH_WORLD|Ovoid.CACH_TRANSFORM)}};
Ovoid.Physics.prototype.toJSON=function(){var a={};a.t=Ovoid.PHYSICS;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ct=[];for(b=0;b<this.target.length;b++)a.ct[b]=this.target[b].uid;
a.im=this.imass;a.it=this.itensor;a.md=this.model;a.dm=this.damping;a.uf=this.useFriction;a.re=this.restitution;a.sl=this.sleeping;a.oc=Ovoid.compact(this.oncontact);return a};Ovoid.Skin=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.SKIN;this.name=a;this.mesh=null;this.joint=[];this.bindJointMatrix=[];this.bindShapeMatrix=new Ovoid.Matrix4;this.infWorldMatrix=[];this.infNormalMatrix=[];this.infMxfArray=new Float32Array(16*Ovoid.MAX_JOINT_BY_SKIN);this.infMnrArray=new Float32Array(9*Ovoid.MAX_JOINT_BY_SKIN);this.vertices=Array(Ovoid.MAX_MESH_LOD);this.triangles=Array(Ovoid.MAX_MESH_LOD);this._lod=0;this._i=b};Ovoid.Skin.prototype=new Ovoid.Node;
Ovoid.Skin.prototype.constructor=Ovoid.Skin;Ovoid.Skin.prototype.linkJoint=function(a){this.joint.push(a);this.makeDepend(a);a.skin=this;this.bindJointMatrix.push(new Ovoid.Matrix4);this.infWorldMatrix.push(new Ovoid.Matrix4);this.infNormalMatrix.push(new Ovoid.Matrix3);this.unCach(Ovoid.CACH_SKIN)};
Ovoid.Skin.prototype.unlinkJoint=function(a){for(var b=this.joint.length;b--;)this.joint[b]===a&&(this.joint.splice(b,1),this.bindJointMatrix.splice(b,1),this.infWorldMatrix.splice(b,1),this.infNormalMatrix.splice(b,1));this.breakDepend(a);a.skin=null;this.unCach(Ovoid.CACH_SKIN)};
Ovoid.Skin.prototype._localMirror=function(){for(var a=0;a<Ovoid.MAX_MESH_LOD;a++){this.triangles[a]=Ovoid.Triangle.newArray(this.mesh.triangles[a].length);this.vertices[a]=Ovoid.Vertex.newArray(this.mesh.vertices[a].length);for(var b=0;b<this.mesh.triangles[a].length;b++)this.triangles[a][b].copy(this.mesh.triangles[a][b])}};
Ovoid.Skin.prototype.bindSkin=function(a,b,c,e,f,g){null!=this.mesh&&this.breakDepend(this.mesh);this.mesh=a;this.makeDepend(a);this._i.opt_skinLocalComput&&this._localMirror();for(var h=0;h<Ovoid.MAX_MESH_LOD;h++)for(var k,j,a=this.mesh.vertices[h].length;a--;)for(j=e.length/3;j--;)k=this.mesh.vertices[h][a].p,k.v[0]==e[3*j+0]&&k.v[1]==e[3*j+1]&&k.v[2]==e[3*j+2]&&(k=4*j,this.mesh.vertices[h][a].i.setv(f.subarray(k,k+4)),this.mesh.vertices[h][a].w.setv(g.subarray(k,k+4)));this.bindShapeMatrix=b;b=
c.length;for(a=0;a<b;a++)this.bindJointMatrix[a]=new Ovoid.Matrix4,this.bindJointMatrix[a].multOf(this.bindShapeMatrix,c[a]);this.mesh._createBuffers(this.mesh._vformat|Ovoid.VERTEX_VEC4_I|Ovoid.VERTEX_VEC4_W,Ovoid.BUFFER_STATIC);this.unCach(Ovoid.CACH_SKIN)};
Ovoid.Skin.prototype.cachSkin=function(){if(!(this.cach&Ovoid.CACH_SKIN)){for(var a=this.joint.length,b=0;b<a;b++)this.infWorldMatrix[b].multOf(this.bindJointMatrix[b],this.joint[b].worldMatrix),this.infNormalMatrix[b].fromMat4(this.infWorldMatrix[b]),this.infNormalMatrix[b].toNormalTransform(),this.infMxfArray.set(this.infWorldMatrix[b].m,16*b),this.infMnrArray.set(this.infNormalMatrix[b].m,9*b),this.joint[b].addCach(Ovoid.CACH_WORLD);if(this._i.opt_skinLocalComput&&this.mesh){for(var c=new Ovoid.Point(Ovoid.FLOAT_MAX,
Ovoid.FLOAT_MAX,Ovoid.FLOAT_MAX,1),e=new Ovoid.Point(Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,1),f=0,g,h,k=this._lod,a=this.mesh.vertices[k].length,b=0;b<a;b++)h=this.vertices[k][b],g=this.mesh.vertices[k][b],h.p.set(0,0,0,0),0!=g.w.v[0]&&h.p.addWeightTransform4Of(g.p,this.infWorldMatrix[g.i.v[0]],g.w.v[0]),0!=g.w.v[1]&&h.p.addWeightTransform4Of(g.p,this.infWorldMatrix[g.i.v[1]],g.w.v[1]),0!=g.w.v[2]&&h.p.addWeightTransform4Of(g.p,this.infWorldMatrix[g.i.v[2]],g.w.v[2]),0!=g.w.v[3]&&h.p.addWeightTransform4Of(g.p,
this.infWorldMatrix[g.i.v[3]],g.w.v[3]),h.p.normalizeWeight(),g=h.p.size(),h.p.v[0]>e.v[0]&&(e.v[0]=h.p.v[0]),h.p.v[1]>e.v[1]&&(e.v[1]=h.p.v[1]),h.p.v[2]>e.v[2]&&(e.v[2]=h.p.v[2]),h.p.v[0]<c.v[0]&&(c.v[0]=h.p.v[0]),h.p.v[1]<c.v[1]&&(c.v[1]=h.p.v[1]),h.p.v[2]<c.v[2]&&(c.v[2]=h.p.v[2]),f<g&&(f=g);if(this._i.opt_renderShadowCasting){g=new Ovoid.Vector;for(var j=new Ovoid.Vector,m=0;m<this.triangles[k].length;m++)a=this.vertices[k][this.triangles[k][m].index[0]].p,b=this.vertices[k][this.triangles[k][m].index[1]].p,
h=this.vertices[k][this.triangles[k][m].index[2]].p,g.subOf(a,b),j.subOf(a,h),this.triangles[k][m].normal.crossOf(g,j),this.triangles[k][m].center.set((a.v[0]+b.v[0]+h.v[0])/3,(a.v[1]+b.v[1]+h.v[1])/3,(a.v[2]+b.v[2]+h.v[2])/3,1)}this.boundingBox.setBound(c,e);this.boundingSphere.setBound(c,e,f);for(b=0;b<this.link.length;b++)this.link[b].unCach(Ovoid.CACH_BOUNDING_SHAPE)}this.addCach(Ovoid.CACH_SKIN)}};
Ovoid.Skin.prototype.toJSON=function(){var a={};a.t=Ovoid.SKIN;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.mh=this.mesh?this.mesh.uid:"null";a.jt=[];for(b=0;b<this.joint.length;b++)a.jt[b]=
this.joint[b].uid;a.bjm=this.bindJointMatrix;a.bsm=this.bindShapeMatrix;return a};Ovoid.Emitter=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.EMITTER;this.name=a;this.model=3;this.life=this.mass=1;this.rate=100;this.velocity=5;this.damping=0.1;this.delta=0.2;this.scattering=3.14;this.color=Ovoid.Color.newArray(2);this.color[0].set(1,1,1,1);this.color[1].set(1,1,1,0);this.size=Array(2);this.size[0]=1;this.size[1]=10;this.emits=!0;this.texture=null;this.billboard=!0;this._alives=this._ctdown=0;this._vmatrix=new Ovoid.Matrix3;this._particles=Ovoid.Particle.newArray(Ovoid.MAX_EMITTER_PARTICLES);
this._fbuffer=new Float32Array(11*Ovoid.MAX_EMITTER_PARTICLES);this._i=b;this.addCach(Ovoid.CACH_GEOMETRY)};Ovoid.Emitter.prototype=new Ovoid.Node;Ovoid.Emitter.prototype.constructor=Ovoid.Emitter;Ovoid.Emitter.prototype.setColoursRgba=function(a,b,c,e,f,g,h,k){this.color[0].set(a,b,c,e);this.color[1].set(f,g,h,k)};Ovoid.Emitter.prototype.setColours=function(a,b){this.color[0].copy(a);this.color[1].copy(b)};
Ovoid.Emitter.prototype.setSprite=function(a){null!=this.texture&&this.breakDepend(this.texture);this.texture=a;null!=a&&this.makeDepend(a)};Ovoid.Emitter.prototype.setSizes=function(a,b){this.size[0]=a;this.size[1]=b};Ovoid.Emitter.prototype.setVelocity=function(a,b,c){this.velocity=a;this.delta=b;this.damping=c};Ovoid.Emitter.prototype.setScattering=function(a){this.scattering=Ovoid.deg2Rad(a)};Ovoid.Emitter.prototype.getAlives=function(){return this._alives};
Ovoid.Emitter.prototype.cachEmitter=function(){if(this.link[0]){var a=0;if(this.emits&&(this._ctdown-=this._i.Timer.quantum,0>=this._ctdown))a=Math.round(this.rate*this._i.Timer.quantum),1>a&&(a=1),this._ctdown=1/this.rate;if(0<this._alives||0<a){this.unCach(Ovoid.CACH_GEOMETRY);for(var b,c=0;c<this.link.length;c++)this.link[c].type&Ovoid.BODY&&(b=this.link[c]);var e=new Ovoid.Point(Ovoid.FLOAT_MAX,Ovoid.FLOAT_MAX,Ovoid.FLOAT_MAX,1),f=new Ovoid.Point(Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,Ovoid.FLOAT_MIN,
1),g=0,h=new Ovoid.Point,k,j=new Ovoid.Vector(this.mass*this._i.opt_gravity[0],this.mass*this._i.opt_gravity[1],this.mass*this._i.opt_gravity[2]);j.scaleBy(this._i.Timer.quantum);var m=Math.pow(this.damping,this._i.Timer.quantum),l,s,u,p,x;this._alives=0;for(c=this._particles.length;c--;)if(0<this._particles[c].l)this._particles[c].l-=this._i.Timer.quantum,l=this._particles[c].l/this.life,s=this._particles[c].p,u=this._particles[c].v,p=this._particles[c].c,x=this._particles[c].u,h.copy(s),h.transform4Inverse(b.worldMatrix),
k=h.size(),h.v[0]>f.v[0]&&(f.v[0]=h.v[0]),h.v[1]>f.v[1]&&(f.v[1]=h.v[1]),h.v[2]>f.v[2]&&(f.v[2]=h.v[2]),h.v[0]<e.v[0]&&(e.v[0]=h.v[0]),h.v[1]<e.v[1]&&(e.v[1]=h.v[1]),h.v[2]<e.v[2]&&(e.v[2]=h.v[2]),g<k&&(g=k),s.v[0]+=u.v[0]*this._i.Timer.quantum,s.v[1]+=u.v[1]*this._i.Timer.quantum,s.v[2]+=u.v[2]*this._i.Timer.quantum,u.addBy(j),u.scaleBy(m),p.v[0]=this.color[1].v[0]+(this.color[0].v[0]-this.color[1].v[0])*l,p.v[1]=this.color[1].v[1]+(this.color[0].v[1]-this.color[1].v[1])*l,p.v[2]=this.color[1].v[2]+
(this.color[0].v[2]-this.color[1].v[2])*l,p.v[3]=this.color[1].v[3]+(this.color[0].v[3]-this.color[1].v[3])*l,x.v[2]=this.size[1]+(this.size[0]-this.size[1])*l,this.billboard||this._particles[c].bufferCopy(this._fbuffer,11*this._alives),this._alives++;else if(0<a){s=this._particles[c].p;u=this._particles[c].v;p=this._particles[c].c;x=this._particles[c].u;this._particles[c].l=this.life;s.copy(b.worldPosition);1==a&&(h.copy(s),h.transform4Inverse(b.worldMatrix),k=h.size(),h.v[0]>f.v[0]&&(f.v[0]=h.v[0]),
h.v[1]>f.v[1]&&(f.v[1]=h.v[1]),h.v[2]>f.v[2]&&(f.v[2]=h.v[2]),h.v[0]<e.v[0]&&(e.v[0]=h.v[0]),h.v[1]<e.v[1]&&(e.v[1]=h.v[1]),h.v[2]<e.v[2]&&(e.v[2]=h.v[2]),g<k&&(g=k));u.copy(b.worldDirection);var v=(1-2*Math.random())*this.scattering,y=(1-2*Math.random())*this.scattering,o=(1-2*Math.random())*this.scattering;k=Math.cos(v);l=Math.cos(y);s=Math.cos(o);var v=Math.sin(v),y=Math.sin(y),o=Math.sin(o),A=k*s,z=k*o,t=v*s,q=v*o;this._vmatrix.m[0]=l*s;this._vmatrix.m[1]=l*o;this._vmatrix.m[2]=-y;this._vmatrix.m[3]=
y*t-z;this._vmatrix.m[4]=y*q+A;this._vmatrix.m[5]=l*v;this._vmatrix.m[6]=y*A+q;this._vmatrix.m[7]=y*z-t;this._vmatrix.m[8]=l*k;u.transform3(this._vmatrix);u.normalize();u.scaleBy(this.velocity+(1-2*Math.random())*this.delta);x.set(0,1,this.size[0]);p.copy(this.color[0]);this.billboard||this._particles[c].bufferCopy(this._fbuffer,11*this._alives);this._alives++;a--}}if(!(this.cach&Ovoid.CACH_GEOMETRY)){this.boundingBox.setBound(e,f);this.boundingSphere.setBound(e,f,g);for(c=0;c<this.link.length;c++)this.link[c].unCach(Ovoid.CACH_BOUNDING_SHAPE);
this.addCach(Ovoid.CACH_GEOMETRY)}}};
Ovoid.Emitter.prototype.toJSON=function(){var a={};a.t=Ovoid.EMITTER;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.md=this.model;a.ms=this.mass;a.lf=this.life;a.rt=this.rate;a.vl=
this.velocity;a.dm=this.damping;a.dt=this.delta;a.sc=this.scattering;a.cl=this.color;a.sz=this.size;a.em=this.emits;a.tx=this.texture.uid;a.bb=this.billboard;return a};Ovoid.Layer=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.LAYER;this.name=a;this.size=new Ovoid.Coord(1,1,1);this.fgColor=new Ovoid.Color(0,0,0,1);this.bgColor=new Ovoid.Color(1,1,1,1);this.bgTexture=null;this.layerMatrix=new Ovoid.Matrix4;this._i=b;this.unCach(Ovoid.CACH_LAYER)};Ovoid.Layer.prototype=new Ovoid.Transform;Ovoid.Layer.prototype.constructor=Ovoid.Layer;Ovoid.Layer.prototype.setSize=function(a,b){this.size.set(a,b,1)};
Ovoid.Layer.prototype.setBgColorRgba=function(a,b,c,e){this.bgColor.set(a,b,c,e)};Ovoid.Layer.prototype.setBgColor=function(a){this.bgColor.copy(a)};Ovoid.Layer.prototype.setBgTexture=function(a){null!=this.bgTexture&&this.breakDepend(this.bgTexture);this.bgTexture=a;null!=a&&this.makeDepend(a)};Ovoid.Layer.prototype.setFgColorRgba=function(a,b,c,e){this.fgColor.set(a,b,c,e)};Ovoid.Layer.prototype.setFgColor=function(a){this.fgColor.copy(a)};
Ovoid.Layer.prototype.isPointOver=function(a){return a.v[0]>=this.worldMatrix.m[12]&&a.v[0]<=this.worldMatrix.m[12]+this.size.v[0]&&a.v[1]>=this.worldMatrix.m[13]&&a.v[1]<=this.worldMatrix.m[13]+this.size.v[1]};
Ovoid.Layer.prototype.cachLayer=function(){if(!(this.cach&Ovoid.CACH_WORLD)||!(this.cach&Ovoid.CACH_LAYER))this.layerMatrix.copy(this.worldMatrix),this.layerMatrix.m[0]*=this.size.v[0],this.layerMatrix.m[1]*=this.size.v[1],this.layerMatrix.m[4]*=this.size.v[0],this.layerMatrix.m[5]*=this.size.v[1],this.layerMatrix.m[8]*=this.size.v[0],this.layerMatrix.m[9]*=this.size.v[1],this.addCach(Ovoid.CACH_LAYER)};
Ovoid.Layer.prototype.toJSON=function(){var a={};a.t=Ovoid.LAYER;a.n=this.name;a.v=this.visible;a.k=this.pickable;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pivot=this.pivot;a.ts=this.scaling;a.tt=this.translation;
a.to=this.orientation;a.tr=this.rotation;a.sz=this.size;a.fc=this.fgColor;a.bc=this.bgColor;a.bt=this.bgTexture?this.bgTexture.uid:"null";return a};Ovoid.Text=function(a,b){Ovoid.Layer.call(this);this.type|=Ovoid.TEXT;this.name=a;this.fontmap=null;this.string="";this.param=new Ovoid.Coord(16,0.5,1);this._i=b};Ovoid.Text.prototype=new Ovoid.Layer;Ovoid.Text.prototype.constructor=Ovoid.Text;Ovoid.Text.prototype.setFormat=function(a,b,c){this.param.set(a,b,c)};Ovoid.Text.prototype.setFontmap=function(a){null!=this.fontmap&&this.breakDepend(this.fontmap);this.fontmap=a;null!=a&&this.makeDepend(a)};
Ovoid.Text.prototype.getWidth=function(){for(var a,b,c=a=b=0;c<this.string.length;c++)"\n"==this.string[c]&&(a>b&&(b=a),a=0),a++;a>b&&(b=a);return b*this.param.v[0]*this.param.v[1]};
Ovoid.Text.prototype.toJSON=function(){var a={};a.t=Ovoid.TEXT;a.n=this.name;a.v=this.visible;a.k=this.pickable;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pivot=this.pivot;a.ts=this.scaling;a.tt=this.translation;
a.to=this.orientation;a.tr=this.rotation;a.sz=this.size;a.fc=this.fgColor;a.bc=this.bgColor;a.bt=this.bgTexture?this.bgTexture.uid:"null";a.fm=this.fontmap?this.fontmap.uid:"null";a.st=this.string;a.pr=this.param;return a};Ovoid.Audio=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.AUDIO;this.name=a;this.url="";this.loadStatus=this.duration=this.samplerate=this.channels=0;this._albuffer=b.al?b.al.createBuffer(1,1,22050):null;this._i=b};Ovoid.Audio.prototype=new Ovoid.Node;Ovoid.Audio.prototype.constructor=Ovoid.Audio;
Ovoid.Audio.prototype._handleLoad=function(){if(this.i.al){var a=this.o,b=this.i;this.i.al.decodeAudioData(this.response,function(c){Ovoid._log(2,b,"::Audio.loadSource",a.name+":: loaded");a._albuffer=c;a.loadStatus=1},function(){Ovoid._log(2,b,"::Audio.loadSource",a.name+":: unable to decode audio '"+a.src+"'");a.loadStatus=-1})}};Ovoid.Audio.prototype._handleError=function(){Ovoid._log(2,this._i,"::Audio.loadSource",this.o.name+":: ' unable to load '"+this.o.src+"'");this.o.loadStatus=-1};
Ovoid.Audio.prototype.loadSource=function(a){this.loadStatus=0;a=this.url=a;this._i.opt_debugMode&&(a+="?"+Math.random());if(this._i.al){var b=new XMLHttpRequest;b.o=this;b.i=this._i;b.onload=this._handleLoad;b.onerror=this._handleError;b.open("GET",a,!0);b.responseType="arraybuffer";b.send()}};
Ovoid.Audio.prototype.toJSON=function(){var a={};a.t=Ovoid.AUDIO;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.url=this.url;return a};Ovoid.Sound=function(a,b){Ovoid.Transform.call(this);this.type|=Ovoid.SOUND;this.name=a;this.audio=null;this.flat=!0;this.outerCone=this.innerCone=360;this.outerGain=0.5;this.refDistance=1;this.maxDistance=0;this.rolloffFactor=0.5;this._alpanner=this._algain=this._alsource=null;this._loop=!1;this._rate=1;this._playing=!1;b.al?(this._alsource=null,this._algain=b.al.createGain(),this._alpanner=b.al.createPanner(),this._alpanner.distanceModel="inverse",this._alpanner.panningModel="HRTF",this._algain.connect(b.al.destination)):
this._alpanner=this._algain=this._alsource=null;this._lastwp=[0,0,0];this._i=b;this.unCach(Ovoid.CACH_SOUND)};Ovoid.Sound.prototype=new Ovoid.Transform;Ovoid.Sound.prototype.constructor=Ovoid.Sound;
Ovoid.Sound.prototype._resetSrc=function(){this._alsource=this._i.al.createBufferSource();this._alsource.o=this;this._alsource.buffer=this.audio._albuffer;this._alsource.loop=this._loop;this._alsource.playbackRate.value=this._rate;this._alsource.onended=function(){this.o._playing=!1};this.flat?this._alsource.connect(this._algain):this._alsource.connect(this._alpanner)};
Ovoid.Sound.prototype.spatialize=function(a){this._i.al?(this._alpanner.disconnect(),this._algain.disconnect(),a?(this._alpanner.connect(this._algain),this._algain.connect(this._i.al.destination),this.flat=!1,this.unCach(Ovoid.CACH_SOUND)):(this._algain.connect(this._i.al.destination),this.flat=!0)):this.flat=!0};Ovoid.Sound.prototype.setPannerCone=function(a,b,c){this.innerCone=a;this.outerCone=b;this.outerGain=c;this.unCach(Ovoid.CACH_SOUND)};
Ovoid.Sound.prototype.setPannerDist=function(a,b,c){this.refDistance=a;this.maxDistance=b;this.rolloffFactor=c;this.unCach(Ovoid.CACH_SOUND)};Ovoid.Sound.prototype.setAudio=function(a){null!=this.audio&&this.breakDepend(this.audio);this.audio=a;this.makeDepend(a)};Ovoid.Sound.prototype.setLoop=function(a){this._loop=a;if(this._alsource)this._alsource.loop=a};Ovoid.Sound.prototype.play=function(){if(!this._playing)this._resetSrc(),this._alsource.start(0),this._playing=!0};
Ovoid.Sound.prototype.stop=function(){if(this._playing)this._alsource.stop(0),this._playing=!1};Ovoid.Sound.prototype.volum=function(a){if(this._algain)this._algain.gain.value=a};Ovoid.Sound.prototype.pitch=function(a){this._rate=a;if(this._alsource)this._alsource.playbackRate.value=a};
Ovoid.Sound.prototype.cachSound=function(){if(!(this.cach&Ovoid.CACH_SOUND)){if(this._alpanner)this._alpanner.coneInnerAngle=this.innerCone,this._alpanner.coneOuterAngle=this.outerCone,this._alpanner.coneOuterGain=this.outerGain,this._alpanner.refDistance=this.refDistance,this._alpanner.maxDistance=this.maxDistance,this._alpanner.rolloffFactor=this.rolloffFactor;this.addCach(Ovoid.CACH_SOUND)}!this.flat&&!(this.cach&Ovoid.CACH_WORLD)&&(this._alpanner.setPosition(this.worldMatrix.m[12],this.worldMatrix.m[13],
this.worldMatrix.m[14]),this._alpanner.setOrientation(-this.worldMatrix.m[8],-this.worldMatrix.m[9],-this.worldMatrix.m[10]),this._alpanner.setVelocity(this.worldMatrix.m[12]-this._lastwp[0],this.worldMatrix.m[13]-this._lastwp[1],this.worldMatrix.m[14]-this._lastwp[2]),this._lastwp[0]=this.worldMatrix.m[12],this._lastwp[1]=this.worldMatrix.m[13],this._lastwp[2]=this.worldMatrix.m[14],this.addCach(Ovoid.CACH_WORLD))};
Ovoid.Sound.prototype.toJSON=function(){var a={};a.t=Ovoid.SOUND;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pivot=this.pivot;a.ts=this.scaling;a.tt=this.translation;a.to=this.orientation;
a.tr=this.rotation;a.au=this.audio?this.audio.uid:"null";a.fl=this.flat;if(this._alpanner)a.ia=this._alpanner.coneInnerAngle,a.oa=this._alpanner.coneOuterAngle,a.og=this._alpanner.coneOuterGain,a.rd=this._alpanner.refDistance,a.md=this._alpanner.maxDistance,a.rf=this._alpanner.rolloffFactor;a.lo=this._alsource?this._alsource.loop:!1;return a};Ovoid.Track=function(a,b){Ovoid.Node.call(this);this.type|=Ovoid.TRACK;this.name=a;this.ended=this.loop=this.playing=!1;this.factor=1;this.animation=[];this.onended=function(){};this._time=0;this._i=b};Ovoid.Track.prototype=new Ovoid.Node;Ovoid.Track.prototype.constructor=Ovoid.Track;Ovoid.Track.prototype.addAnimation=function(a){this.animation.push(a);this.makeDepend(a)};
Ovoid.Track.prototype.remAnimation=function(a){for(var b=this.animation.length;b--;)this.animation[b]===a&&this.animation.splice(b,1);this.breakDepend(a)};Ovoid.Track.prototype.setLoop=function(a){this.loop=a};Ovoid.Track.prototype.setFactor=function(a){this.factor=a;for(a=this.animation.length;a--;)this.animation[a].factor=this.factor};
Ovoid.Track.prototype.play=function(a){if(a)this.factor=a;this.ended&&this.rewind();for(a=this.animation.length;a--;)this.animation[a].play(this.factor);this.playing=!0};Ovoid.Track.prototype.stop=function(){for(var a=this.animation.length;a--;)this.animation[a].stop();this.playing=!1};Ovoid.Track.prototype.rewind=function(a){if(a)this.factor=a;for(a=this.animation.length;a--;)this.animation[a].rewind(this.factor);this.ended=!1;this._time=0};Ovoid.Track.prototype.time=function(){return this._time};
Ovoid.Track.prototype.cachTrack=function(){if(this.playing){this.playing=!1;for(var a=this.animation.length;a--;)if(this.animation[a].playing){this.playing=!0;break}this._time+=this._i.Timer.quantum*this.factor;if(!this.playing){try{this.onended(this)}catch(b){Ovoid._log(0,this._i,"::Track.cachTrack",this.name+":: Custom onended() function exception thrown:\n"+b.stack)}if(this.loop){for(a=this.animation.length;a--;)this.animation[a].rewind(),this.animation[a].play();this._time=0;this.ended=!1;this.playing=
!0}else this.ended=!0}}};
Ovoid.Track.prototype.toJSON=function(){var a={};a.t=Ovoid.TRACK;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.pl=this.playing;a.lo=this.loop;a.en=this.ended;a.an=[];for(b=0;b<
this.animation.length;b++)a.an[b]=this.animation[b].uid;a.oe=Ovoid.compact(this.onended);return a};Ovoid.Aim=function(a,b){Ovoid.Constraint.call(this);this.type|=Ovoid.AIM;this.name=a;this.upvector=new Ovoid.Vector(0,1,0);this.aimat=null;this.invert=!0;this._x=new Ovoid.Vector;this._y=new Ovoid.Vector;this._z=new Ovoid.Vector;this._a=new Ovoid.Point;this._amoved=!0;this._i=b};Ovoid.Aim.prototype=new Ovoid.Constraint;Ovoid.Aim.prototype.constructor=Ovoid.Aim;Ovoid.Aim.prototype.setAimedNode=function(a){this.aimat=a&&a.type&&a.type&Ovoid.TRANSFORM?a:null};Ovoid.Aim.prototype.setUpVector=function(a){this.upvector.copy(a)};
Ovoid.Aim.prototype.setUpVectorXyz=function(a,b,c){this.upvector.set(a,b,c)};Ovoid.Aim.prototype.setInvert=function(a){this.invert=a};
Ovoid.Aim.prototype.cachAim=function(){if(this.aimat){this._a.equal(this.aimat.worldPosition)?this._amoved=!1:(this._amoved=!0,this._a.copy(this.aimat.worldPosition));for(var a=this.target.length;a--;)if(!(this.target[a].cach&Ovoid.CACH_WORLD)||this._amoved){this.invert?this._z.subOf(this.target[a].worldPosition,this._a):this._z.subOf(this._a,this.target[a].worldPosition);if(0==this._z.v[0]&&0==this._z.v[1]&&0==this._z.v[2])break;this._z.normalize();this._x.crossOf(this.upvector,this._z);this._y.crossOf(this._z,
this._x);var b,c,e;c=Math.sqrt(this._x.v[0]*this._x.v[0]+this._x.v[1]*this._x.v[1]);0.001<c?(b=Math.atan2(this._y.v[2],this._z.v[2]),c=Math.atan2(-this._x.v[2],c),e=Math.atan2(this._x.v[1],this._x.v[0])):(b=Math.atan2(-this._z.v[1],this._y.v[1]),c=Math.atan2(-this._x.v[2],c),e=0);if(NaN==b||NaN==c||NaN==e)break;this.target[a].rotateXyz(0,0,0,0,1);this.target[a].rotateXyz(b,c,e)}}};
Ovoid.Aim.prototype.toJSON=function(){var a={};a.t=Ovoid.EXPRESSION;a.n=this.name;a.v=this.visible;a.u=this.uid;a.p=this.parent?this.parent.uid:"null";a.c=[];for(var b=0;b<this.child.length;b++)a.c[b]=this.child[b].uid;a.dp=[];for(b=0;b<this.depend.length;b++)a.dp[b]=this.depend[b].uid;a.lk=[];for(b=0;b<this.link.length;b++)a.lk[b]=this.link[b].uid;a.bmn=this.boundingBox.min;a.bmx=this.boundingBox.max;a.brd=this.boundingSphere.radius;a.ct=[];for(b=0;b<this.target.length;b++)a.ct[b]=this.target[b].uid;
a.up=this.upvector;a.at=this.aimat?this.aimat.uid:"null";return a};Ovoid.WgIterator=function(a){this.current=this.root=a;this.queue=Array(128);for(a=128;a--;)this.queue[a]=0;this.depth=0;this.completed=!1};Ovoid.WgIterator.prototype.init=function(a){this.current=this.root=a;for(a=128;a--;)this.queue[a]=0;this.depth=0;this.completed=!1};
Ovoid.WgIterator.prototype.explore=function(){if(!this.completed){for(;this.queue[this.depth]==this.current.child.length;){this.queue[this.depth]=0;if(0==this.depth)return this.completed=!0,!1;this.depth--;this.current=this.current.parent}this.current=this.current.child[this.queue[this.depth]];this.queue[this.depth]++;this.depth++}return!this.completed};Ovoid.DgIterator=function(a){this.current=this.root=a;this.currentParent=null;this.depth=0;this.queue=Array(128);this.parent=Array(128);for(a=128;a--;)this.queue[a]=0,this.parent[a]=null;this.completed=!1};Ovoid.DgIterator.prototype.init=function(a){this.current=this.root=a;this.currentParent=null;for(a=128;a--;)this.queue[a]=0,this.parent[a]=null;this.depth=0;this.completed=!1};
Ovoid.DgIterator.prototype.exploreDepend=function(){if(!this.completed){for(;this.queue[this.depth]==this.current.depend.length;){this.queue[this.depth]=0;this.parent[this.depth]=null;if(0==this.depth)return this.completed=!0,!1;this.depth--;this.current=this.parent[this.depth]}this.currentParent=this.parent[this.depth]=this.current;this.current=this.current.depend[this.queue[this.depth]];this.queue[this.depth]++;this.depth++}return!this.completed};
Ovoid.DgIterator.prototype.exploreLink=function(){if(!this.completed){for(;this.queue[this.depth]==this.current.link.length;){this.queue[this.depth]=0;this.parent[this.depth]=null;if(0==this.depth)return this.completed=!0,!1;this.depth--;this.current=this.parent[this.depth]}this.currentParent=this.parent[this.depth]=this.current;this.current=this.current.link[this.queue[this.depth]];this.queue[this.depth]++;this.depth++}return!this.completed};
Ovoid.DgIterator.prototype.jumpDepend=function(){this.queue[this.depth]=0;this.parent[this.depth]=null;if(0==this.depth)return this.completed=!0,!1;this.depth--;this.current=this.parent[this.depth]};Ovoid.Scene=function(a,b){this.name=a;this.world=new Ovoid.Node("world",b);this.overlay=new Ovoid.Node("overlay",b);this.node=[];this.light=[];this.camera=[];this.transform=[];this.shape=[];this.material=[];this.action=[];this.texture=[];this.animation=[];this.expression=[];this.aim=[];this.track=[];this.physics=[];this.layer=[];this.audio=[];this.sound=[];this._uidn=1E3+Math.floor(9999*Math.random());this.activeCamera=new Ovoid.Camera("defaultView",b);this.camera.push(this.activeCamera);this.transform.push(this.activeCamera);
this.activeCamera.setParent(this.world);var c=b.opt_sceneDefaultViewPosition;this.activeCamera.moveXyz(c[0],c[1],c[2],0,1);c=b.opt_sceneDefaultViewRotation;this.activeCamera.rotateXyz(c[0],c[1],c[2],0,0);this._i=b};
Ovoid.Scene.prototype.newNode=function(a,b,c){if(this.findNode(b)){Ovoid._log(2,this._i,"::Scene.create",this.name+":: name collision '"+b+"'");for(var e=1,f=b;this.findNode(b);)b=f+"#"+e.toString(),e++}var g;switch(a){case Ovoid.TRANSFORM:a=new Ovoid.Transform(b,this._i);this.transform.push(a);g=this.world;break;case Ovoid.CAMERA:a=new Ovoid.Camera(b,this._i);this.camera.push(a);this.transform.push(a);g=this.world;break;case Ovoid.LIGHT:a=new Ovoid.Light(b,this._i);this.light.push(a);this.transform.push(a);
g=this.world;break;case Ovoid.BODY:a=new Ovoid.Body(b,this._i);this.transform.push(a);g=this.world;break;case Ovoid.JOINT:a=new Ovoid.Joint(b,this._i);this.transform.push(a);g=this.world;break;case Ovoid.MESH:a=new Ovoid.Mesh(b,this._i);this.shape.push(a);break;case Ovoid.MATERIAL:a=new Ovoid.Material(b,this._i);this.material.push(a);break;case Ovoid.TEXTURE:a=new Ovoid.Texture(b,this._i);this.texture.push(a);break;case Ovoid.ACTION:a=new Ovoid.Action(b,this._i);this.action.push(a);break;case Ovoid.PHYSICS:a=
new Ovoid.Physics(b,this._i);this.physics.push(a);break;case Ovoid.ANIMATION:a=new Ovoid.Animation(b,this._i);this.animation.push(a);break;case Ovoid.AIM:a=new Ovoid.Aim(b,this._i);this.aim.push(a);break;case Ovoid.EXPRESSION:a=new Ovoid.Expression(b,this._i);this.expression.push(a);break;case Ovoid.TRACK:a=new Ovoid.Track(b,this._i);this.track.push(a);break;case Ovoid.SKIN:a=new Ovoid.Skin(b,this._i);this.shape.push(a);break;case Ovoid.EMITTER:a=new Ovoid.Emitter(b,this._i);this.shape.push(a);break;
case Ovoid.AUDIO:a=new Ovoid.Audio(b,this._i);this.audio.push(a);break;case Ovoid.TEXT:a=new Ovoid.Text(b,this._i);this.layer.push(a);g=this.overlay;break;case Ovoid.LAYER:a=new Ovoid.Layer(b,this._i);this.layer.push(a);g=this.overlay;break;case Ovoid.SOUND:a=new Ovoid.Sound(b,this._i);this.sound.push(a);this.transform.push(a);g=this.world;break;default:a=new Ovoid.Node(b,this._i)}this.node.push(a);null==c?c=g:this.ownsNode(c)||(c=g);a.setParent(c);a.uid=this._uidn;this._uidn++;return a};
Ovoid.Scene.prototype.remNode=function(a,b){var c,e,f;if("number"==typeof a||"string"==typeof a){if(f=this.findNode(a),!f)return}else f=a;var g=[],h=[];for(c=0;c<f.link.length;c++)h.push(f.link[c]);for(c=0;c<h.length;c++)h[c].breakDepend(f),Ovoid._log(2,this._i,"::Scene.remove",this.name+":: Break link "+h[c].name),h[c].type&Ovoid.TRACK&&(Ovoid._log(2,this._i,"::Scene.remove",this.name+":: Removing animation from "+h[c].name),h[c].remAnimation(f)),h[c].type&Ovoid.SKIN&&(Ovoid._log(2,this._i,"::Scene.remove",
this.name+":: Removing joint from "+h[c].name),h[c].unlinkJoint(f));h=[];for(c=0;c<f.depend.length;c++)h.push(f.depend[c]);for(c=0;c<h.length;c++)f.breakDepend(h[c]),Ovoid._log(2,this._i,"::Scene.remove",this.name+":: Break Dependency "+h[c].name),0==h[c].link.length&&b&&(Ovoid._log(2,this._i,"::Scene.remove",this.name+":: Removes unused dependency "+h[c].name),g.push(h[c]));for(c=new Ovoid.WgIterator(f);c.explore();)g.push(c.current);for(c=0;c<g.length;c++)this.remNode(g[c],b);if(f.type&Ovoid.CAMERA)e=
this.camera;if(f.type&Ovoid.LIGHT)e=this.light;if(f.type&Ovoid.MESH||f.type&Ovoid.SKIN||f.type&Ovoid.EMITTER)e=this.shape;if(f.type&Ovoid.MATERIAL)e=this.material;if(f.type&Ovoid.TEXTURE)e=this.texture;if(f.type&Ovoid.ANIMATION)e=this.animation;if(f.type&Ovoid.EXPRESSION)e=this.expression;if(f.type&Ovoid.AIM)e=this.aim;if(f.type&Ovoid.TRACK)e=this.track;if(f.type&Ovoid.PHYSICS)e=this.physics;if(f.type&Ovoid.ACTION)e=this.action;if(f.type&Ovoid.LAYER)e=this.layer;if(f.type&Ovoid.SOUND)e=this.sound;
if(f.type&Ovoid.AUDIO)e=this.audio;if(e)for(c=e.length;c--;)e[c]===f&&e.splice(c,1);if(f.type&Ovoid.TRANSFORM)for(c=this.transform.length;c--;)this.transform[c]===f&&this.transform.splice(c,1);for(c=this.node.length;c--;)this.node[c]===f&&this.node.splice(c,1);f.setParent(null);delete f;Ovoid._log(2,this._i,"::Scene.remove",this.name+":: Removing node "+f.name)};
Ovoid.Scene.prototype.remMatches=function(a){var b=this.node.length,c=!1;if("string"==typeof a)for(;b--;)-1!=this.node[b].name.indexOf(a,0)&&(this.remNode(this.node[b]),c=!0);else if("number"==typeof a)for(;b--;)this.node[b].type&a&&(this.remNode(this.node[b]),c=!0);return c};
Ovoid.Scene.prototype.insNode=function(a,b,c,e){if(a._i!=this._i)return Ovoid._log(2,this._i,"::Scene.insNode",this.name+":: node has wrong Instance '"+a.name+"'"),!1;if(this.ownsNode(a))return!1;if(this.findNode(a.name)){Ovoid._log(2,this._i,"::Scene.insNode",this.name+":: name collision '"+a.name+"'");for(var f=1,g=a.name;this.findNode(a.name);)a.name=g+"#"+f.toString(),f++}if(a.type&Ovoid.NODE)this.node.push(a);else return!1;if(!e)a.uid=this._uidn,this._uidn++;a.type&Ovoid.MATERIAL&&this.material.push(a);
a.type&Ovoid.TEXTURE&&this.texture.push(a);a.type&Ovoid.ACTION&&this.action.push(a);a.type&Ovoid.ANIMATION&&this.animation.push(a);a.type&Ovoid.EXPRESSION&&this.expression.push(a);a.type&Ovoid.AIM&&this.aim.push(a);a.type&Ovoid.TRACK&&this.track.push(a);a.type&Ovoid.PHYSICS&&this.physics.push(a);a.type&Ovoid.CAMERA&&this.camera.push(a);a.type&Ovoid.LIGHT&&this.light.push(a);a.type&Ovoid.SOUND&&this.sound.push(a);(a.type&Ovoid.SKIN||a.type&Ovoid.MESH||a.type&Ovoid.EMITTER)&&this.shape.push(a);a.type&
Ovoid.AUDIO&&this.audio.push(a);var h;if(a.type&Ovoid.TRANSFORM)this.transform.push(a),h=this.world;if(a.type&Ovoid.LAYER)this.layer.push(a),h=this.overlay;c||(null==b?b=h:this.ownsNode(b)||(b=h),a.setParent(b));return!0};
Ovoid.Scene.prototype.insTree=function(a){var b,c=new Ovoid.DgIterator,e=new Ovoid.DagIterator;for(e.init(a);e.explore();){b=e.current;this.insNode(b,null,!0);for(c.init(b);c.exploreDepend();)b=c.current,this.insNode(b,null,!0)}e=Array(a.child.length);for(c=a.child.length;c--;)e[c]=a.child[c];for(c=e.length;c--;)e[c].type&Ovoid.TRANSFORM&&e[c].setParent(this.world),e[c].type&Ovoid.LAYER&&e[c].setParent(this.overlay)};
Ovoid.Scene.prototype.parentNode=function(a,b){var c,e;if("string"===typeof a||"number"===typeof a){if(c=this.findNode(a),!c){Ovoid._log(2,this._i,"::Scene.parent",this.name+":: No node matches with name or UID:"+a);return}}else c=a;if("string"===typeof b||"number"===typeof b){if(e=this.findNode(b),!e){Ovoid._log(2,this._i,"::Scene.parent",this.name+":: No node matches with name or UID:"+b);return}}else e=b;c.setParent(e)};
Ovoid.Scene.prototype.findNode=function(a){var b=this.node.length;if("string"==typeof a)for(;b--;){if(this.node[b].name==a)return this.node[b]}else if("number"==typeof a)for(;b--;)if(this.node[b].uid==a)return this.node[b];return null};Ovoid.Scene.prototype.findMatches=function(a){var b=[],c=this.node.length;if("string"==typeof a)for(;c--;)-1!=this.node[c].name.indexOf(a,0)&&b.push(this.node[c]);else if("number"==typeof a)for(;c--;)this.node[c].type&a&&b.push(this.node[c]);return b};
Ovoid.Scene.prototype.ownsNode=function(a){for(var b=this.node.length;b--;)if(this.node[b]===a)return!0;return!1};Ovoid.Scene.prototype.useCamera=function(a){if("object"===typeof a)if(null!=a){if(this.ownsNode(a))this.activeCamera=a}else this.activeCamera=null;else this.activeCamera=this.findNode(a);this.activeCamera&&(this.activeCamera.setView(this._i.Frame.size.v[0],this._i.Frame.size.v[1]),this.activeCamera.cachTransform(),this.activeCamera.cachCamera())};
Ovoid.Scene.prototype.clean=function(){Ovoid._log(3,this._i,"::Scene.clean",this.name+":: start scene cleaning");var a,b=[];for(a=0;a<this.material.length;a++)b.push(this.material[a]);for(a=0;a<this.texture.length;a++)b.push(this.texture[a]);for(a=0;a<this.audio.length;a++)b.push(this.audio[a]);for(a=0;a<this.shape.length;a++)b.push(this.shape[a]);for(a=0;a<this.animation.length;a++)b.push(this.animation[a]);for(a=0;a<this.expression.length;a++)b.push(this.expression[a]);for(a=0;a<this.action.length;a++)b.push(this.action[a]);
for(a=0;a<this.physics.length;a++)b.push(this.physics[a]);for(a=0;a<this.aim.length;a++)b.push(this.aim[a]);for(a=b.length;a--;)b[a].link.length||(Ovoid._log(3,this._i,"::Scene.clean",this.name+":: found unreferenced node '"+b[a].name+"'"),this.remNode(b[a],!0));Ovoid._log(3,this._i,"::Scene.clean",this.name+":: scene cleaning finished")};Ovoid.Scene.prototype.toJSON=function(){var a={};a.n=this.name;a.u=this._uidn;a.ac=this.activeCamera?this.activeCamera.uid:"null";a.nl=this.node;return a};Ovoid.Collada=function(){this.url=this.name="";this.loadStatus=0;this._upaxis=-1;this._dae=null;this._mask=0;this._sfix=this._pfix="";this._i=this._dstsc=null};Ovoid.Collada.prototype._gTxtData=function(a){for(var b="",c=a.length,e=0;e<c;e++)b+=a[e].data;return b};Ovoid.Collada.prototype._gTxtDataSplit=function(a){for(var b="",c=a.length,e=0;e<c;e++)b+=a[e].data;32==b.charCodeAt(0)&&(b=b.slice(1));return b.split(/\s+/)};
Ovoid.Collada.prototype._getById=function(a,b){for(var c=this._dae.getElementsByTagName(a),e=c.length,f=0;f<e;f++)if(c[f].getAttribute("id")==b||c[f].getAttribute("sid")==b)return c[f];return null};Ovoid.Collada.prototype._getNameById=function(a,b){for(var c=this._dae.getElementsByTagName(a),e=c.length,f=0;f<e;f++)if(c[f].getAttribute("id")==b||c[f].getAttribute("sid")==b)return c[f].getAttribute("name");return null};
Ovoid.Collada.prototype._getChildByTag=function(a,b){for(var c=[],e=a.childNodes.length,f=0;f<e;f++)a.childNodes[f].tagName==b&&c.push(a.childNodes[f]);return c};Ovoid.Collada.prototype._getChildById=function(a,b){for(var c=a.childNodes.length,e=0;e<c;e++)if(1==a.childNodes[e].nodeType&&(a.childNodes[e].getAttribute("id")==b||a.childNodes[e].getAttribute("sid")==b))return a.childNodes[e];return null};
Ovoid.Collada.prototype._hasChildByTag=function(a,b){for(var c=a.childNodes.length,e=0;e<c;e++)if(a.childNodes[e].tagName==b)return!0;return!1};Ovoid.Collada.prototype._retrieveNode=function(a){var b=null;if(this._mask&Ovoid.DAE_MERGE_DEPENDENCIES){a=this._pfix+a;if(b=this._dstsc.findNode(a))return b;a+=this._sfix}else a=this._pfix+a+this._sfix;return b=this._dstsc.findNode(a)};Ovoid.Collada.prototype._switch2YVect=function(a){switch(this._upaxis){case 2:var b;b=a.v[1];a.v[1]=-a.v[2];a.v[2]=b}};
Ovoid.Collada.prototype._switch2YMat4=function(a){switch(this._upaxis){case 2:var b=new Ovoid.Matrix4;b.m[5]=0;b.m[6]=-1;b.m[9]=1;b.m[10]=0;a.multBy(b)}};
Ovoid.Collada.prototype._switch2YNode=function(a){switch(this._upaxis){case 2:var b=new Float32Array([0,0,0]),c=new Float32Array([0,0,0]);a.cachTransform();var e=a.matrix;this._switch2YMat4(e);b[0]=e.m[12];b[1]=e.m[13];b[2]=e.m[14];var f=Math.sqrt(e.m[0]*e.m[0]+e.m[1]*e.m[1]);0.001<f?(c[0]=Math.atan2(e.m[6],e.m[10]),c[1]=Math.atan2(-e.m[2],f),c[2]=Math.atan2(e.m[1],e.m[0])):(c[0]=Math.atan2(-e.m[9],e.m[5]),c[1]=Math.atan2(-e.m[2],f),c[2]=0);a.moveXyz(0,0,0,Ovoid.WORLD,Ovoid.ABSOLUTE);a.rotateXyz(0,
0,0,Ovoid.WORLD,Ovoid.ABSOLUTE);a.moveXyz(b[0],b[1],b[2],Ovoid.WORLD,Ovoid.ABSOLUTE);a.rotateXyz(c[0],c[1],c[2],Ovoid.LOCAL,Ovoid.RELATIVE)}};
Ovoid.Collada.prototype._procCam=function(a){var b=this._pfix+a.getAttribute("id")+this._sfix,b=new Ovoid.Camera(b,this._i);Ovoid._log(3,this._i,"::Collada._procCam",this.name+":: Camera '"+b.name+"' created");a=a.getElementsByTagName("technique_common");if(a.length){var c=a[0].getElementsByTagName("yfov");if(c.length)b.fov=parseFloat(c[0].childNodes[0].data);else if(c=a[0].getElementsByTagName("xfov"),c.length)b.fov=parseFloat(c[0].childNodes[0].data);c=a[0].getElementsByTagName("znear");if(c.length)b.clipNear=
parseFloat(c[0].childNodes[0].data);c=a[0].getElementsByTagName("zfar");if(c.length)b.clipFar=parseFloat(c[0].childNodes[0].data)}else return Ovoid._log(2,this._i,"::Collada._procCam",this.name+":: Camera '"+b.name+"' missing <technique_common>: Camera data not found."),null;return b};
Ovoid.Collada.prototype._procLig=function(a){var b=this._pfix+a.getAttribute("id")+this._sfix,b=new Ovoid.Light(b,this._i);Ovoid._log(3,this._i,"::Collada._procLig",this.name+":: Light '"+b.name+"' created");a=a.getElementsByTagName("technique_common");if(a.length){var c;c=a[0].getElementsByTagName("color");c.length?(c=this._gTxtDataSplit(c[0].childNodes),b.setColorRgba(parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),1)):Ovoid._log(2,this._i,"::Collada._procLig",this.name+":: Light '"+b.name+"' missing <color>: Light color data not found.");
c=a[0].getElementsByTagName("intensity");if(c.length)b.intensity=parseFloat(c[0].childNodes[0].data);b.model=-1;if(a[0].getElementsByTagName("ambient").length)b.model=Ovoid.LIGHT_AMBIENT;if(a[0].getElementsByTagName("point").length)b.model=Ovoid.LIGHT_POINT;if(a[0].getElementsByTagName("directional").length)b.model=Ovoid.LIGHT_DIRECTIONAL;if(a[0].getElementsByTagName("spot").length&&(b.model=Ovoid.LIGHT_SPOT,a[0].getElementsByTagName("falloff_angle").length?b.spotAngle=0.5*Ovoid.deg2Rad(parseFloat(a[0].getElementsByTagName("falloff_angle")[0].childNodes[0].data)):
Ovoid._log(2,this._i,"::Collada._procLig",this.name+"::Light '"+b.name+"' missing <spot>/<falloff_angle>: Light data not found."),a[0].getElementsByTagName("falloff_exponent").length))b.falloff=0.1*parseFloat(a[0].getElementsByTagName("falloff_exponent")[0].childNodes[0].data);-1==b.kind&&Ovoid._log(2,this._i,"::Collada._procLig",this.name+":: Light '"+b.name+"' missing <ambient>|<point>|<directional>|<spot>: Light data not found.");if(b.kind!=Ovoid.LIGHT_AMBIENT&&b.kind!=Ovoid.LIGHT_DIRECTIONAL){var e,
f,g;c=a[0].getElementsByTagName("constant_attenuation");c.length&&(e=parseFloat(c[0].childNodes[0].data));c=a[0].getElementsByTagName("linear_attenuation");c.length&&(f=parseFloat(c[0].childNodes[0].data));c=a[0].getElementsByTagName("quadratic_attenuation");c.length&&(g=parseFloat(c[0].childNodes[0].data));void 0!=e&&void 0!=f&&void 0!=g&&b.setAttenuation(e,f,g)}}else return Ovoid._log(2,this._i,"::Collada._procLig",this.name+":: Light '"+b.name+"' missing <technique_common>: Light data not found."),
null;return b};
Ovoid.Collada.prototype._procImg=function(a){var b=this._pfix+a.getAttribute("name")+this._sfix,b=new Ovoid.Texture(b,this._i);Ovoid._log(3,this._i,"::Collada._procImg",this.name+":: Texture '"+b.name+"' created");a=a.getElementsByTagName("init_from");if(a.length){var a=a[0].childNodes[0].data,a=a.split("/"),c=a[a.length-1],c=c.split(".");if(1<c.length)b.url=a[a.length-1];else return Ovoid._log(2,this._i,"::Collada._procImg",this.name+":: Texture '"+b.name+"' invalid URI."),null}else return Ovoid._log(2,this._i,
"::Collada._procImg",this.name+":: Texture '"+b.name+"' missing <init_from>: Image data not found."),null;return b};
Ovoid.Collada.prototype._procEfxComp=function(a,b,c,e){b=b.getElementsByTagName(c);if(b.length){var f=b[0].getElementsByTagName("color");if(f.length)c=this._gTxtDataSplit(f[0].childNodes),a.setColorRgba(e,parseFloat(c[0]),parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]));else if(b=b[0].getElementsByTagName("texture"),b.length){var f=null,g=this._getById("newparam",b[0].getAttribute("texture"));g?g.getElementsByTagName("source").length&&(g=this._getById("newparam",g.getElementsByTagName("source")[0].childNodes[0].data),
g.getElementsByTagName("init_from").length&&(f=this._getById("image",g.getElementsByTagName("init_from")[0].childNodes[0].data))):f=this._getById("image",b[0].getAttribute("texture"));f?(c=this._retrieveNode(f.getAttribute("name")))?(a.setColorRgba(e,1,1,1,1),a.setTexture(e,c)):a.setColorRgba(e,0,0,0,1):Ovoid._log(2,this._i,"::Collada._procEfxComp",this.name+":: Material '"+a.name+"' missing <"+c+">/<texture>/<image>: Material/Texture data not found.")}else Ovoid._log(2,this._i,"::Collada._procEfxComp",
this.name+":: Material '"+a.name+"' missing <"+c+">/<color>|<texture>: Material/Texture data not found.")}else a.setColorRgba(e,0,0,0,1)};
Ovoid.Collada.prototype._procMat=function(a){var b=this._pfix+a.getAttribute("name")+this._sfix,b=new Ovoid.Material(b,this._i);Ovoid._log(3,this._i,"::Collada._procMat",this.name+":: Material '"+b.name+"' created");a=this._getById("effect",a.getElementsByTagName("instance_effect")[0].getAttribute("url").substring(1));this._procEfxComp(b,a,"ambient",0);this._procEfxComp(b,a,"diffuse",1);this._procEfxComp(b,a,"specular",2);this._procEfxComp(b,a,"emission",3);this._procEfxComp(b,a,"reflective",4);var c;
c=a.getElementsByTagName("shininess");c.length?(c=c[0].getElementsByTagName("float"),c=parseFloat(c[0].childNodes[0].data),b.shininess=c):b.shininess=1;c=a.getElementsByTagName("reflectivity");if(c.length)c=c[0].getElementsByTagName("float"),c=parseFloat(c[0].childNodes[0].data),b.reflectivity=c;c=a.getElementsByTagName("transparency");if(c.length)c=c[0].getElementsByTagName("float"),c=parseFloat(c[0].childNodes[0].data),b.opacity=c;return b};
Ovoid.Collada.prototype._procPset=function(a,b,c,e,f){if(!e.length)return 0;for(b=e.length;b--;){var g=0,h=e[b].getAttribute("count");if(1==f)var k=2*h;4==f&&(k=3*h);var j=e[b].getAttribute("material");j||(j="null",Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/polyset "+b+"' missing material symbol."));for(var m={enable:{},source:{},offset:{}},l=e[b].getElementsByTagName("input"),s,u,p,x=l.length;x--;){if("VERTEX"==l[x].getAttribute("semantic")){p=this._getById("vertices",
l[x].getAttribute("source").substring(1)).getElementsByTagName("input");for(var v=p.length;v--;){if("POSITION"==p[v].getAttribute("semantic")){s=p[v].getAttribute("source").substring(1);for(u=c.id.length;u--;)if(c.id[u]==s)m.source.p=u,m.enable.p=!0,m.offset.p=parseInt(l[x].getAttribute("offset")),g|=Ovoid.VERTEX_VEC4_P}if("NORMAL"==p[v].getAttribute("semantic")){s=p[v].getAttribute("source").substring(1);for(u=c.id.length;u--;)if(c.id[u]==s)m.source.n=u,m.enable.n=!0,m.offset.n=parseInt(l[x].getAttribute("offset")),
g|=Ovoid.VERTEX_VEC3_N}}if(-1==m.source.p){Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/"+j+"' missing vertices POSITION source: polyset ignored.");continue}}if("NORMAL"==l[x].getAttribute("semantic")){s=l[x].getAttribute("source").substring(1);for(u=c.id.length;u--;)if(c.id[u]==s)m.source.n=u,m.enable.n=!0,m.offset.n=parseInt(l[x].getAttribute("offset")),g|=Ovoid.VERTEX_VEC3_N}if("TEXCOORD"==l[x].getAttribute("semantic")){s=l[x].getAttribute("source").substring(1);
for(u=c.id.length;u--;)if(c.id[u]==s)m.source.u=u,m.enable.u=!0,m.offset.u=parseInt(l[x].getAttribute("offset")),g|=Ovoid.VERTEX_VEC3_U}}s=e[b].getElementsByTagName("p");if(1==f)var y=new Uint16Array(2*h*l.length);4==f&&(y=new Uint16Array(3*h*l.length));u=0;p=s.length;for(x=0;x<p;x++)for(var h=this._gTxtDataSplit(s[x].childNodes),o=h.length,v=0;v<o;v++)y[u]=parseInt(h[v]),isNaN(y[u])||u++;y.length!=u&&Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/"+j+"' found indices mismatch triangles count ("+
u+"/"+y.length+")");u=Ovoid.Vertex.newArray(k);s=l.length;if(m.enable.p){x=m.source.p;l=m.offset.p;v=c.stride[x];h=c.data[x];for(x=0;x<k;x++)p=y[x*s+l]*v,u[x].p.set(h[p+0],h[p+1],h[p+2],1)}if(m.enable.n){x=m.source.n;l=m.offset.n;v=c.stride[x];h=c.data[x];for(x=0;x<k;x++)p=y[x*s+l]*v,u[x].n.set(h[p+0],h[p+1],h[p+2])}if(m.enable.u){x=m.source.u;l=m.offset.u;v=c.stride[x];h=c.data[x];for(x=0;x<k;x++)p=y[x*s+l]*v,u[x].u.set(h[p+0],h[p+1],0)}m=null;if("null"!=j){h=this._dae.getElementsByTagName("instance_material");
for(x=h.length;x--;)if(h[x].getAttribute("symbol")==j){m=this._retrieveNode(this._getNameById("material",h[x].getAttribute("target").substring(1)));break}m||(Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/"+j+"' material not found"),m=new Ovoid.Material("newmaterial#"+this._dstsc.material.length,this._i),Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/polyset "+b+"' : assign new material node "+m.name),this._dstsc.insNode(m))}else m=new Ovoid.Material("newmaterial#"+
this._dstsc.material.length,this._i),Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"/polyset "+b+"' assign new material node "+m.name),this._dstsc.insNode(m);Ovoid._log(3,this._i,"::Collada._procGeo",this.name+":: Geometry '"+a.name+"' polyset#"+b+": "+u.length+" vertices.");a.addPolyset(0,u,m,f,g,Ovoid.BUFFER_STATIC)}return e.length};
Ovoid.Collada.prototype._procGeo=function(a){var b=this._pfix+a.getAttribute("id")+this._sfix,b=new Ovoid.Mesh(b,this._i);Ovoid._log(3,this._i,"::Collada._procGeo",this.name+":: Mesh '"+b.name+"' created");for(var c={id:[],count:[],stride:[],data:[]},e=a.getElementsByTagName("source"),f,g,h=e.length;h--;){c.id.push(e[h].getAttribute("id"));f=e[h].getElementsByTagName("accessor");c.stride.push(parseInt(f[0].getAttribute("stride")));c.count.push(parseInt(f[0].getAttribute("count")));g=e[h].getElementsByTagName("float_array");
f=this._gTxtDataSplit(g[0].childNodes);g=new Float32Array(parseInt(g[0].getAttribute("count")));for(var k=f.length,j=0,m=0;m<k;m++)g[j]=parseFloat(f[m]),isNaN(g[j])||j++;c.data.push(g)}e=0+this._procPset(b,a,c,a.getElementsByTagName("lines"),1);e+=this._procPset(b,a,c,a.getElementsByTagName("polylist"),4);e+=this._procPset(b,a,c,a.getElementsByTagName("polygons"),4);if(e+=this._procPset(b,a,c,a.getElementsByTagName("triangles"),4))Ovoid._log(3,this._i,"::Collada._procGeo",this.name+":: Geometry '"+
b.name+"' "+e+" polyset(s) extracted.");else return Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+b.name+"' no supported geometry type (<polylist>|<lines>) found: no Mesh data loaded."),null;this._mask&Ovoid.DAE_OPTIMIZE_MESH_VERTICES&&(Ovoid._log(3,this._i,"::Collada._procGeo",this.name+":: Geometry '"+b.name+"' Optimize vertices."),5E3<b.vertices[0].length&&Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+b.name+"' Vertices optimization with more than 5000 triangles: May take long time."),
b.optimizeVertices());this._mask&Ovoid.DAE_OPTIMIZE_MESH_TRIANGLES&&(Ovoid._log(3,this._i,"::Collada._procGeo",this.name+":: Geometry '"+b.name+"' Optimize triangles."),1E3<b.triangles[0].length&&Ovoid._log(2,this._i,"::Collada._procGeo",this.name+":: Geometry '"+b.name+"' Triangles optimization with more than 1000 triangles: May take VERY LONG time."),b.optimizeTriangles());return b};
Ovoid.Collada.prototype._procCtr=function(a){var b=a.getAttribute("id"),c;if(this._hasChildByTag(a,"skin")){c=this._retrieveNode(b);if(null==c)return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+b+"' not found as instanced: Ignored. "),null;var e,f,g,h,k,a=a.getElementsByTagName("skin")[0];h={weight:{}};h.weight.offset=-1;h.weight.data=null;h.bonesi={};h.bonesi.offset=-1;h.bonesi.data=null;e=a.getElementsByTagName("vertex_weights");k=e[0].getElementsByTagName("input");for(b=k.length;b--;){if("WEIGHT"==
k[b].getAttribute("semantic")){h.weight.offset=parseInt(k[b].getAttribute("offset"));var j=this._getChildById(a,k[b].getAttribute("source").substring(1)),j=j.getElementsByTagName("float_array")[0],m=this._gTxtDataSplit(j.childNodes);g=new Float32Array(parseInt(j.getAttribute("count")));for(var l=m.length,s=0,j=0;j<l;j++)g[s]=parseFloat(m[j]),isNaN(g[s])||s++;h.weight.data=g}if("JOINT"==k[b].getAttribute("semantic")){h.bonesi.offset=parseInt(k[b].getAttribute("offset"));j=this._getChildById(a,k[b].getAttribute("source").substring(1));
m=this._gTxtDataSplit(j.getElementsByTagName("Name_array")[0].childNodes);g=[];l=m.length;for(j=0;j<l;j++)1<m[j].length&&g.push(m[j]);h.bonesi.data=g}}if(-1==h.weight.offset||-1==h.bonesi.offset||null==h.weight.data||null==h.bonesi.data)return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' missing <input> informations: Aborting."),null;k=parseInt(e[0].getAttribute("count"));if(0==k)return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' no weights data found: Aborting."),
null;b=0;m=this._gTxtDataSplit(e[0].getElementsByTagName("vcount")[0].childNodes);g=new Uint16Array(k);l=m.length;for(j=s=0;j<l;j++)g[s]=parseInt(m[j]),isNaN(g[s])||(b+=2*g[s],s++);for(var m=this._gTxtDataSplit(e[0].getElementsByTagName("v")[0].childNodes),u=new Uint16Array(b),l=m.length,j=s=0;j<l;j++)u[s]=parseFloat(m[j]),isNaN(u[s])||s++;ijointa=new Float32Array(4*k);e=new Float32Array(4*k);for(b=0;b<4*k;b++)ijointa[b]=-1;for(var j=0,s=h.weight.offset,p=h.bonesi.offset,b=0;b<k;b++){m=g[b];for(l=
0;l<m;l++)ijointa[4*b+l]=u[j+2*l+p],e[4*b+l]=h.weight.data[u[j+2*l+s]];j+=2*m}g=this._getById("geometry",a.getAttribute("source").substring(1));u=g.getElementsByTagName("vertices")[0].getElementsByTagName("input");for(b=u.length;b--;)if("POSITION"==u[b].getAttribute("semantic")){j=this._getChildById(g.getElementsByTagName("mesh")[0],u[b].getAttribute("source").substring(1)).getElementsByTagName("float_array")[0];m=this._gTxtDataSplit(j.childNodes);f=new Float32Array(parseInt(j.getAttribute("count")));
l=m.length;for(j=s=0;j<l;j++)f[s]=parseFloat(m[j]),isNaN(f[s])||s++}if(f.length/3!=k)return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' positions/wheights count mismatch ("+f.length/3+"/"+k+"): Aborting."),null;k=[];l=h.bonesi.data.length;for(b=0;b<l;b++)j=this._retrieveNode(h.bonesi.data[b]),k.push(j),Ovoid._log(3,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' has influence joint '"+j.name+"'");h=[];j=a.getElementsByTagName("joints")[0].getElementsByTagName("input");
for(b=j.length;b--;)if("INV_BIND_MATRIX"==j[b].getAttribute("semantic")){j=this._getChildById(a,j[b].getAttribute("source").substring(1)).getElementsByTagName("float_array")[0];m=this._gTxtDataSplit(j.childNodes);g=new Float32Array(16);l=m.length;for(j=s=0;j<l;j++)g[s]=parseFloat(m[j]),isNaN(g[s])||s++,15<s&&(mat=new Ovoid.Matrix4(g),mat.toTranspose(),h.push(mat),s=0);break}if(h.length!=k.length)return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' joints list / bind matrices count mismatch. Aborting."),
null;g=new Ovoid.Matrix4;m=this._gTxtDataSplit(a.getElementsByTagName("bind_shape_matrix")[0].childNodes);l=m.length;for(j=s=0;j<l;j++)g.m[s]=parseFloat(m[j]),isNaN(g.m[s])||s++;g.toTranspose();if(j=this._retrieveNode(a.getAttribute("source").substring(1)))Ovoid._log(3,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' has binded mesh '"+j.name+"'");else return Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: Skin '"+c.name+"' binded mesh '"+this._pfix+a.getAttribute("source").substring(1)+
"' not found. Aborting."),null;l=k.length;for(b=0;b<l;b++)c.linkJoint(k[b]);c.bindSkin(j,g,h,f,ijointa,e);this._mask&Ovoid.DAE_REPARENT_SKIN&&k[0].setParent(c.link[0]);return c}this._hasChildByTag(daeController,"morph")?Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: controller '"+b+"' <morph> controller not yet supported"):Ovoid._log(2,this._i,"::Collada._procCtr",this.name+":: controller '"+b+"' unknow controller type");return null};
Ovoid.Collada.prototype._procNod=function(a){var b=this._pfix+a.getAttribute("id")+this._sfix,c=null;if(this._hasChildByTag(a,"instance_camera")){var e=this._getChildByTag(a,"instance_camera"),f=e[0].getAttribute("url").substring(1);if(c=this._retrieveNode(f))Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: '"+c.name+"' is instance camera '"+b+"'"),c.name=b;else return Ovoid._log(2,this._i,"::Collada._procNod",this.name+":: '"+f+"' instance camera not found '"+b+"'"),null}if(this._hasChildByTag(a,
"instance_light"))if(e=this._getChildByTag(a,"instance_light"),f=e[0].getAttribute("url").substring(1),c=this._retrieveNode(f))Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: '"+c.name+"' is instance light '"+b+"'"),c.name=b;else return Ovoid._log(2,this._i,"::Collada._procNod",this.name+":: '"+f+"' instance light not found '"+b+"'"),null;this._hasChildByTag(a,"instance_geometry")&&(c=new Ovoid.Body(b,this._i),Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Body '"+c.name+"' created"),
e=this._getChildByTag(a,"instance_geometry"),f=e[0].getAttribute("url").substring(1),(e=this._retrieveNode(f))?(c.setShape(e),Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: '"+c.name+"' has geometry shape '"+e.name+"'")):Ovoid._log(2,this._i,"::Collada._procNod",this.name+":: '"+c.name+"' geometry shape not found '"+f+"'"));if(this._hasChildByTag(a,"instance_controller")){c=new Ovoid.Body(b,this._i);Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Body '"+c.name+"' created");var e=
this._getChildByTag(a,"instance_controller"),g=this._getById("controller",e[0].getAttribute("url").substring(1));g?this._hasChildByTag(g,"skin")?(f=this._pfix+e[0].getAttribute("url").substring(1)+this._sfix,e=new Ovoid.Skin(f,this._i),c.setShape(e),this._dstsc.insNode(e),Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: '"+c.name+"' has shape '"+e.name+"'")):Ovoid._log(2,this._i,"::Collada._procNod",this.name+":: '"+f+"' unsuported controller type'"):Ovoid._log(2,this._i,"::Collada._procNod",
this.name+":: '"+f+"' <controller> instance not found.'")}a.getAttribute("type")&&"JOINT"==a.getAttribute("type")&&(c=new Ovoid.Joint(b,this._i),Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Joint '"+c.name+"' created"));c||(c=new Ovoid.Transform(b,this._i),Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Transform (NULL) '"+c.name+"' created"));var h=this._getChildByTag(a,"matrix"),k=this._getChildByTag(a,"translate"),b=this._getChildByTag(a,"rotate"),a=this._getChildByTag(a,"scale"),
f=new Float32Array([0,0,0]),e=new Float32Array([0,0,0]),g=new Float32Array([1,1,1]),j=new Float32Array([0,0,0]);if(h.length){h=this._gTxtDataSplit(h[0].childNodes);h=new Ovoid.Matrix4(h);h.toTranspose();f[0]+=h.m[12];f[1]+=h.m[13];f[2]+=h.m[14];var m=Math.sqrt(h.m[0]*h.m[0]+h.m[1]*h.m[1]);0.001<m?(e[0]+=Math.atan2(h.m[6],h.m[10]),e[1]+=Math.atan2(-h.m[2],m),e[2]+=Math.atan2(h.m[1],h.m[0])):(e[0]+=Math.atan2(-h.m[9],h.m[5]),e[1]+=Math.atan2(-h.m[2],m),e[2]=0)}k.length&&(k=this._gTxtDataSplit(k[0].childNodes),
f[0]+=parseFloat(k[0]),f[1]+=parseFloat(k[1]),f[2]+=parseFloat(k[2]));if(b.length)for(k=b.length;k--;)h=this._gTxtDataSplit(b[k].childNodes),-1!=b[k].getAttribute("sid").indexOf("Orient",0)?(j[0]+=parseFloat(h[0])*Ovoid.deg2Rad(parseFloat(h[3])),j[1]+=parseFloat(h[1])*Ovoid.deg2Rad(parseFloat(h[3])),j[2]+=parseFloat(h[2])*Ovoid.deg2Rad(parseFloat(h[3]))):(e[0]+=parseFloat(h[0])*Ovoid.deg2Rad(parseFloat(h[3])),e[1]+=parseFloat(h[1])*Ovoid.deg2Rad(parseFloat(h[3])),e[2]+=parseFloat(h[2])*Ovoid.deg2Rad(parseFloat(h[3])));
a.length&&(h=this._gTxtDataSplit(a[0].childNodes),g[0]=parseFloat(h[0]),g[1]=parseFloat(h[1]),g[2]=parseFloat(h[2]));c.moveXyz(f[0],f[1],f[2],Ovoid.LOCAL,Ovoid.RELATIVE);c.rotateXyz(e[0],e[1],e[2],Ovoid.LOCAL,Ovoid.RELATIVE);c.orientXyz(j[0],j[1],j[2],Ovoid.LOCAL,Ovoid.RELATIVE);c.scaleXyz(g[0],g[1],g[2],Ovoid.ABSOLUTE);Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Transform '"+c.name+"' move:"+f[0]+", "+f[1]+", "+f[2]);Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Transform '"+
c.name+"' rotate:"+e[0]+", "+e[1]+", "+e[2]);Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Transform '"+c.name+"' orient:"+j[0]+", "+j[1]+", "+j[2]);Ovoid._log(3,this._i,"::Collada._procNod",this.name+":: Transform '"+c.name+"' scale:"+g[0]+", "+g[1]+", "+g[2]);return c};
Ovoid.Collada.prototype._procAni=function(a){for(var b=a.getAttribute("id"),c={id:[],count:[],stride:[],data:[],type:[]},e=a.getElementsByTagName("source"),f=e.length;f--;){if(e[f].getElementsByTagName("float_array").length){c.id.push(e[f].getAttribute("id"));c.count.push(parseInt(e[f].getElementsByTagName("accessor")[0].getAttribute("count")));c.stride.push(parseInt(e[f].getElementsByTagName("accessor")[0].getAttribute("stride")));c.type.push(e[f].getElementsByTagName("param")[0].getAttribute("type"));
for(var g=e[f].getElementsByTagName("float_array")[0],h=this._gTxtDataSplit(g.childNodes),k=new Float32Array(parseInt(g.getAttribute("count"))),j=h.length,m=0,g=0;g<j;g++)k[m]=parseFloat(h[g]),isNaN(k[m])||m++;c.data.push(k)}if(e[f].getElementsByTagName("Name_array").length){c.id.push(e[f].getAttribute("id"));c.count.push(parseInt(e[f].getElementsByTagName("accessor")[0].getAttribute("count")));c.stride.push(parseInt(e[f].getElementsByTagName("accessor")[0].getAttribute("stride")));c.type.push(e[f].getElementsByTagName("param")[0].getAttribute("type"));
g=e[f].getElementsByTagName("Name_array")[0];h=this._gTxtDataSplit(g.childNodes);k=Array(parseInt(g.getAttribute("count")));j=h.length;for(g=m=0;g<j;g++)k[m]=h[g];c.data.push(k)}}h={name:[],tname:[],ttsid:[],ttaxis:[],xdata:[],ydata:[],ytype:[],idata:[],odata:[],xerp:[]};a=a.getElementsByTagName("channel");for(f=a.length;f--;){g=a[f].getAttribute("target").split("/");h.tname.push(g[0]);h.name.push(g[0]+"Animation");g=g[1].split(".");h.ttsid.push(g[0]);h.ttaxis.push(g[1]);e=this._getById("sampler",
a[f].getAttribute("source").substring(1));si=e.getElementsByTagName("input");for(e=si.length;e--;){if("INPUT"==si[e].getAttribute("semantic")){j=si[e].getAttribute("source").substring(1);for(g=c.id.length;g--;)c.id[g]==j&&h.xdata.push(c.data[g])}if("OUTPUT"==si[e].getAttribute("semantic")){j=si[e].getAttribute("source").substring(1);for(g=c.id.length;g--;)c.id[g]==j&&(h.ydata.push(c.data[g]),h.ytype.push(c.type[g]))}if("IN_TANGENT"==si[e].getAttribute("semantic")){j=si[e].getAttribute("source").substring(1);
for(g=c.id.length;g--;)c.id[g]==j&&h.idata.push(c.data[g])}if("OUT_TANGENT"==si[e].getAttribute("semantic")){j=si[e].getAttribute("source").substring(1);for(g=c.id.length;g--;)c.id[g]==j&&h.odata.push(c.data[g])}if("INTERPOLATION"==si[e].getAttribute("semantic")){j=si[e].getAttribute("source").substring(1);for(g=c.id.length;g--;)c.id[g]==j&&h.xerp.push(c.data[g])}}}for(f=h.name.length;f--;)if(2>h.xdata[f].length)Ovoid._log(2,this._i,"::Collada._procAni",this.name+":: Animation '"+b+"' has only one keyframe: ignored.");
else{var c=-1,l,s,u;if(this._mask&Ovoid.DAE_FORCE_CSPLINE)h.xerp[f]=Ovoid.INTERPOLATION_CSPLINE;else if("BEZIER"==h.xerp[f][0])if(h.xerp[f]=Ovoid.INTERPOLATION_BSPLINE,h.idata[f].length==2*h.xdata[f].length){j=h.xdata[f].length;l=new Float32Array(2*j);s=new Float32Array(2*j);for(var p=0,g=0;g<j;g++)l[p]=h.idata[f][2*g],s[p]=h.idata[f][2*g+1],p++,l[p]=h.odata[f][2*g],s[p]=h.odata[f][2*g+1],p++}else if(h.idata[f].length==h.xdata[f].length){j=h.xdata[f].length;l=new Float32Array(2*j);s=new Float32Array(2*
j);for(g=p=0;g<j;g++)l[p]=h.xdata[f][g-1]+0.9*(h.xdata[f][g]-h.xdata[f][g-1]),s[p]=h.idata[f][2*g+1],p++,l[p]=h.xdata[f][g]+0.1*(h.xdata[f][g+1]-h.xdata[f][g]),s[p]=h.odata[f][2*g+1],p++}else Ovoid._log(3,this._i,"::Collada._procAni",this.name+":: Animation '"+b+"' inconsistant tangent/keyframe count ratio"),h.xerp[f]=Ovoid.INTERPOLATION_CSPLINE;else if("HERMITE"==h.xerp[f][0])if(h.idata[f].length==h.xdata[f].length){h.xerp[f]=Ovoid.INTERPOLATION_HSPLINE;j=h.xdata[f].length;u=new Float32Array(2*j);
for(g=p=0;g<j;g++)u[p]=h.idata[f][g],p++,u[p]=h.odata[f][g],p++}else Ovoid._log(2,this._i,"::Collada._procAni",this.name+":: Animation '"+b+"' wrong tangent/keyframe count ratio"),h.xerp[f]=Ovoid.INTERPOLATION_CSPLINE;else h.xerp[f]=Ovoid.INTERPOLATION_CSPLINE;p=this._retrieveNode(h.name[f]);if(!p)if(p=new Ovoid.Animation(this._pfix+h.name[f]+this._sfix,this._i),this._dstsc.insNode(p),Ovoid._log(3,this._i,"::Collada._procAni",this.name+":: Animation '"+p.name+"' created"),g=this._retrieveNode(h.tname[f]))p.setTarget(g),
Ovoid._log(3,this._i,"::Collada._procAni",this.name+":: Animation '"+p.name+"' has target '"+g.name+"'");else{Ovoid._log(2,this._i,"::Collada._procAni",this.name+":: Animation '"+p.name+"' target '"+h.tname[f]+"' not found");continue}if(0==this._dae.getElementsByTagName("visual_scene").length)return Ovoid._log(2,this._i,"::Collada._procAni",this.name+":: Animation : <visual_scene> not found (Is DAE source corrupted ?)."),null;var x;this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("matrix").length&&
(x=this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("matrix")[0].getAttribute("sid"));if(h.ttsid[f]==x)if("float4x4"==h.ytype[f]){for(var c=h.ydata[f].length/16,e=new Ovoid.Matrix4,a=new Float32Array(c),j=new Float32Array(c),k=new Float32Array(c),m=new Float32Array(c),v=new Float32Array(c),y=new Float32Array(c),g=0;g<c;g++){e.setv(h.ydata[f].subarray(16*g,16*g+16));e.toTranspose();a[g]=e.m[12];j[g]=e.m[13];k[g]=e.m[14];var o=Math.sqrt(e.m[0]*e.m[0]+e.m[1]*e.m[1]);0.001<o?(m[g]=
Math.atan2(e.m[6],e.m[10]),v[g]=Math.atan2(-e.m[2],o),y[g]=Math.atan2(e.m[1],e.m[0])):(m[g]=Math.atan2(-e.m[9],e.m[5]),v[g]=Math.atan2(-e.m[2],o),y[g]=0)}switch(h.xerp[f]){case Ovoid.INTERPOLATION_BSPLINE:p.setBspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_X,h.xdata[f],a,l,s);p.setBspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y,h.xdata[f],j,l,s);p.setBspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z,h.xdata[f],k,l,s);p.setBspline(Ovoid.ANIMATION_CHANNEL_ROTATE_X,h.xdata[f],m,l,s);p.setBspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Y,
h.xdata[f],v,l,s);p.setBspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Z,h.xdata[f],y,l,s);break;case Ovoid.INTERPOLATION_HSPLINE:p.setHspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_X,h.xdata[f],a,u);p.setHspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y,h.xdata[f],j,u);p.setHspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z,h.xdata[f],k,u);p.setHspline(Ovoid.ANIMATION_CHANNEL_ROTATE_X,h.xdata[f],m,u);p.setHspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Y,h.xdata[f],v,u);p.setHspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Z,h.xdata[f],y,u);
break;default:p.setCspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_X,h.xdata[f],a),p.setCspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y,h.xdata[f],j),p.setCspline(Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z,h.xdata[f],k),p.setCspline(Ovoid.ANIMATION_CHANNEL_ROTATE_X,h.xdata[f],m),p.setCspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Y,h.xdata[f],v),p.setCspline(Ovoid.ANIMATION_CHANNEL_ROTATE_Z,h.xdata[f],y)}Ovoid._log(3,this._i,"::Collada._procAni",this.name+":: '"+p.name+"' add curve channels from matrix")}else Ovoid._log(2,
this._i,"::Collada._procAni",this.name+":: Animation '"+p.name+"' unsuported matrix data type '"+h.ytype[f]+"': Aborting.");else{var A,z,t;this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("translate").length&&(A=this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("translate")[0].getAttribute("sid"));if(this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("rotate").length){j=this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("rotate").length;
z=Array(j);for(g=0;g<j;g++)z[g]=this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("rotate")[g].getAttribute("sid")}this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("scale").length&&(t=this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("scale")[0].getAttribute("sid"));c=-1;if(h.ttsid[f]==A)c=Ovoid.ANIMATION_CHANNEL_TRANSLATE;if(h.ttsid[f]==t)c=Ovoid.ANIMATION_CHANNEL_SCALE;if(z)for(g=z.length;g--;)if(h.ttsid[f]==z[g]){g=this._gTxtDataSplit(this._dae.getElementsByTagName("visual_scene")[0].getElementsByTagName("rotate")[g].childNodes);
if(1==parseFloat(g[0]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_X;if(1==parseFloat(g[1]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Y;if(1==parseFloat(g[2]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Z;switch(this._upaxis){case 2:if(1==parseFloat(g[0]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_X;if(1==parseFloat(g[1]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Z;if(1==parseFloat(g[2]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Y;break;case 0:break;default:if(1==parseFloat(g[0]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_X;if(1==parseFloat(g[1]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Y;
if(1==parseFloat(g[2]))c=Ovoid.ANIMATION_CHANNEL_ROTATE_Z}break}if(c==Ovoid.ANIMATION_CHANNEL_TRANSLATE)switch(this._upaxis){case 2:if("X"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_X;if("Y"==h.ttaxis[f]){c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z;for(g=h.ydata[f].length;g--;)h.ydata[f][g]=-h.ydata[f][g]}if("Z"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y;break;case 0:break;default:if("X"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_X;if("Y"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_Y;
if("Z"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_TRANSLATE_Z}if(c==Ovoid.ANIMATION_CHANNEL_ROTATE_X){g=h.ydata[f].length;switch(this._upaxis){case 2:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(h.ydata[f][g]-90);break;case 0:break;default:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(h.ydata[f][g])}if(h.xerp[f]==Ovoid.INTERPOLATION_BSPLINE)for(g=s.length;g--;)s[g]=Ovoid.deg2Rad(s[g])}if(c==Ovoid.ANIMATION_CHANNEL_ROTATE_Y){g=h.ydata[f].length;switch(this._upaxis){case 2:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(h.ydata[f][g]);
break;case 0:break;default:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(h.ydata[f][g])}if(h.xerp[f]==Ovoid.INTERPOLATION_BSPLINE)for(g=s.length;g--;)s[g]=Ovoid.deg2Rad(s[g])}if(c==Ovoid.ANIMATION_CHANNEL_ROTATE_Z){g=h.ydata[f].length;switch(this._upaxis){case 2:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(-h.ydata[f][g]);break;case 0:break;default:for(;g--;)h.ydata[f][g]=Ovoid.deg2Rad(h.ydata[f][g])}if(h.xerp[f]==Ovoid.INTERPOLATION_BSPLINE)for(g=s.length;g--;)s[g]=Ovoid.deg2Rad(s[g])}if(c==Ovoid.ANIMATION_CHANNEL_SCALE){if("X"==
h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_SCALE_X;if("Y"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_SCALE_Y;if("Z"==h.ttaxis[f])c=Ovoid.ANIMATION_CHANNEL_SCALE_Z}if(-1!=c){switch(h.xerp[f]){case Ovoid.INTERPOLATION_BSPLINE:p.setBspline(c,h.xdata[f],h.ydata[f],l,s);break;case Ovoid.INTERPOLATION_HSPLINE:p.setHspline(c,h.xdata[f],h.ydata[f],u);break;default:p.setCspline(c,h.xdata[f],h.ydata[f])}Ovoid._log(3,this._i,"::Collada._procAni",this.name+":: '"+p.name+"' add curve channel "+h.ttsid[f]+"."+h.ttaxis[f])}else Ovoid._log(2,
this._i,"::Collada._procAni",this.name+":: Animation '"+p.name+"' unsuported channel '"+h.ttsid[f]+"'")}}return p};
Ovoid.Collada.prototype._importDae=function(a,b,c,e){if(!this._dae)return Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: no DAE data, you should use loadSource method to load DAE file first."),!1;Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: begin");this._dstsc=a;this._sfix=e?"."+e:"";this._pfix=c?c+".":"";this._mask=b;a=this._dae.getElementsByTagName("up_axis")[0].childNodes[0].data;if("Z_UP"==a)this._upaxis=2;if("Y_UP"==a)this._upaxis=1;if("X_UP"==a)this._upaxis=0;if(this._mask&
Ovoid.DAE_CONVERT_UPAXIS)switch(this._upaxis){case 0:Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: DAE scene is X-Up axis, Conversion from X-Up axis not supported, data will be imported without modification.");this._upaxis=1;break;case 2:Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: DAE scene is Z-Up axis, Conversion from Z-Up axis to Y-Up axis")}else{switch(this._upaxis){case 0:Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: DAE scene is X-Up axis, OvoiD.JS usually work in Right-Handed Y-Up.");
break;case 2:Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: DAE scene is Z-Up axis, OvoiD.JS usually work in Right-Handed Y-Up. Use option Ovoid.DAE_CONVERT_UPAXIS to convert Z-up to Y-up.")}this._upaxis=1}if(this._mask&Ovoid.DAE_CREATE_TRACK){Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_CREATE_TRACK: creating tracks...");var f=new Ovoid.Track(this.name+"Track",this._i);Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Track '"+f.name+"' created")}var g;
if(this._mask&Ovoid.DAE_MATERIALS){Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_MATERIALS: import materials...");if(this._dae.getElementsByTagName("library_images").length){b=this._dae.getElementsByTagName("library_images")[0].childNodes;for(a=b.length;a--;)if(1==b[a].nodeType){try{g=this._procImg(b[a])}catch(h){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procImg exception: "+h.stack+". (Is DAE source corrupted ?).")}g&&this._dstsc.insNode(g)}}if(this._dae.getElementsByTagName("library_materials").length){b=
this._dae.getElementsByTagName("library_materials")[0].childNodes;for(a=b.length;a--;)if(1==b[a].nodeType){try{g=this._procMat(b[a])}catch(k){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procMat exception: "+k.stack+". (Is DAE source corrupted ?).")}g&&this._dstsc.insNode(g)}}}if(this._mask&Ovoid.DAE_CAMERAS&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_CAMERAS: import cameras..."),this._dae.getElementsByTagName("library_cameras").length)){b=this._dae.getElementsByTagName("library_cameras")[0].childNodes;
for(a=b.length;a--;)if(1==b[a].nodeType){try{g=this._procCam(b[a])}catch(j){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procCam exception: "+j.stack+". (Is DAE source corrupted ?).")}g&&this._dstsc.insNode(g)}}if(this._mask&Ovoid.DAE_LIGHTS&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_LIGHTS: import lights..."),this._dae.getElementsByTagName("library_lights").length)){b=this._dae.getElementsByTagName("library_lights")[0].childNodes;for(a=b.length;a--;)if(1==
b[a].nodeType){try{g=this._procLig(b[a])}catch(m){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procLig exception: "+m.stack+". (Is DAE source corrupted ?).")}g&&this._dstsc.insNode(g)}}if(this._mask&Ovoid.DAE_MESHS&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_MESHS: import meshs..."),this._dae.getElementsByTagName("library_geometries").length)){b=this._dae.getElementsByTagName("library_geometries")[0].childNodes;for(a=b.length;a--;)if(1==b[a].nodeType){try{g=
this._procGeo(b[a])}catch(l){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procGeo exception: "+l.stack+". (Is DAE source corrupted ?).")}g&&this._dstsc.insNode(g)}}if(this._mask&Ovoid.DAE_TRANSFORMS||this._mask&Ovoid.DAE_BONES)if(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_TRANSFORMS || DAE_BONES: import transforms nodes..."),this._dae.getElementsByTagName("library_visual_scenes").length){a=this._dae.getElementsByTagName("library_visual_scenes")[0].getElementsByTagName("visual_scene")[0];
b=new Uint32Array(128);c=0;for(e=!1;!e;){for(;b[c]==this._getChildByTag(a,"node").length;){b[c]=0;if(0==c){e=!0;break}c--;a=a.parentNode}if(e)break;a=this._getChildByTag(a,"node")[b[c]];b[c]++;c++;try{g=this._procNod(a)}catch(s){Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Collada._procNod exception: "+s+". (Is DAE source corrupted ?).")}if(g){this._dstsc.insNode(g);var u=this._retrieveNode(a.parentNode.getAttribute("id"));u?(g.setParent(u),Ovoid._log(3,this._i,"::Collada._importDae",
this.name+":: '"+g.name+"' child of '"+u.name+"'")):(this._switch2YNode(g),Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: '"+g.name+"' in scene root"));g.cachTransform()}}}if(this._mask&Ovoid.DAE_CONTROLLERS&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_CONTROLLERS: import controlers..."),this._dae.getElementsByTagName("library_controllers").length)){b=this._dae.getElementsByTagName("library_controllers")[0].childNodes;for(a=b.length;a--;)if(1==b[a].nodeType)try{this._procCtr(b[a])}catch(p){Ovoid._log(2,
this._i,"::Collada._importDae",this.name+":: Collada._procCtr exception: "+p.stack+". (Is DAE source corrupted ?).")}}if(this._mask&Ovoid.DAE_ANIMATIONS&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: Mask option DAE_ANIMATIONS: import animations..."),this._dae.getElementsByTagName("library_animations").length)){b=this._dae.getElementsByTagName("library_animations")[0].childNodes;for(a=b.length;a--;)if(1==b[a].nodeType){try{g=this._procAni(b[a])}catch(x){Ovoid._log(2,this._i,"::Collada._importDae",
this.name+":: Collada._procAni exception: "+x.stack+". (Is DAE source corrupted ?).")}g&&this._mask&Ovoid.DAE_CREATE_TRACK&&(Ovoid._log(3,this._i,"::Collada._importDae",this.name+":: adding animation '"+g.name+"' to Track '"+f.name+"'"),f.addAnimation(g))}}this._mask&Ovoid.DAE_CREATE_TRACK&&0<f.animation.length&&(Ovoid._log(2,this._i,"::Collada._importDae",this.name+":: Importation has generated new Animation Track '"+f.name+"'"),this._dstsc.insNode(f));Ovoid._log(3,this._i,"::Collada._importDae",
this.name+":: done");return!0};
Ovoid.Collada.prototype.loadSource=function(a,b,c,e,f,g){this.loadStatus=0;this.url=a;this._i=b._i;this.name=Ovoid.extractName(this.url);a=new XMLHttpRequest;if(g)a.o=this,a._i=this._i,a.d=b,a.m=c,a.p=e,a.s=f,a.onreadystatechange=function(){if(4==this.readyState)200==this.status||304==this.status?(this.o._dae=(new DOMParser).parseFromString(this.responseText,"text/xml"),this.o.loadStatus=1,this.o._importDae(this.d,this.m,this.p,this.s)):(this.o.loadStatus=-1,Ovoid._log(2,this._i,"::Collada.loadSource",
this.o.name+":: unable to load source '"+this.o.url+"'"))};var h=this.url;this._i.opt_debugMode&&(h+="?"+Math.random());a.open("GET",h,g);a.send(null);if(!g)200==a.status||304==a.status?(this._dae=(new DOMParser).parseFromString(a.responseText,"text/xml"),this.loadStatus=1,this._importDae(b,c,e,f)):(this.loadStatus=-1,Ovoid._log(2,this._i,"::Collada.loadSource",this.name+":: unable to load source '"+this.url+"'"))};Ovoid.Ojson=function(){this.url=this.name="";this._dstsc=this._json=null;this._rlnkstack=[];this.loadStatus=0;this._i=null};Ovoid.Ojson.prototype._parseFunc=function(a){var b=a.indexOf("(")+1,c=a.indexOf(")"),b=a.substring(b,c),c=a.indexOf("{")+1,e=a.lastIndexOf("}"),a=a.substring(c,e);return 0<b.length?new Function(b,a):new Function(a)};Ovoid.Ojson.prototype._linkReport=function(a,b,c){Ovoid._log(3,this._i,"::Ojson._linkReport",this.name+":: relink '"+a.name+"' has "+c+" '"+(b?b.name:"null")+"'")};
Ovoid.Ojson.prototype._importNode=function(a){switch(a.t){case Ovoid.TRANSFORM:n=new Ovoid.Transform(a.n,this._i);this._procTransform(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Transform node '"+a.n+"'");break;case Ovoid.CAMERA:n=new Ovoid.Camera(a.n,this._i);this._procCamera(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Camera node '"+a.n+"'");break;case Ovoid.LIGHT:n=new Ovoid.Light(a.n,this._i);this._procLight(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",
this.name+":: import Light node '"+a.n+"'");break;case Ovoid.BODY:n=new Ovoid.Body(a.n,this._i);this._procBody(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Body node '"+a.n+"'");break;case Ovoid.JOINT:n=new Ovoid.Joint(a.n,this._i);this._procJoint(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Joint node '"+a.n+"'");break;case Ovoid.MESH:n=new Ovoid.Mesh(a.n,this._i);this._procMesh(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Mesh node '"+
a.n+"'");break;case Ovoid.MATERIAL:n=new Ovoid.Material(a.n,this._i);this._procMaterial(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Material node '"+a.n+"'");break;case Ovoid.TEXTURE:n=new Ovoid.Texture(a.n,this._i);this._procTexture(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Texture node '"+a.n+"'");break;case Ovoid.ACTION:n=new Ovoid.Action(a.n,this._i);this._procAction(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Action node '"+
a.n+"'");break;case Ovoid.PHYSICS:n=new Ovoid.Physics(a.n,this._i);this._procPhysic(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Physics node '"+a.n+"'");break;case Ovoid.ANIMATION:n=new Ovoid.Animation(a.n,this._i);this._procAnimation(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+"import Animation node '"+a.n+"'");break;case Ovoid.EXPRESSION:n=new Ovoid.Expression(a.n,this._i);this._procExpression(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Expression node '"+
a.n+"'");break;case Ovoid.AIM:n=new Ovoid.Aim(a.n,this._i);this._procAim(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Aim node '"+a.n+"'");break;case Ovoid.TRACK:n=new Ovoid.Track(a.n,this._i);this._procTrack(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Track node '"+a.n+"'");break;case Ovoid.SKIN:n=new Ovoid.Skin(a.n,this._i);this._procSkin(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Skin node '"+a.n+"'");break;case Ovoid.EMITTER:n=
new Ovoid.Emitter(a.n,this._i);this._procEmitter(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Emitter node '"+a.n+"'");break;case Ovoid.AUDIO:n=new Ovoid.Audio(a.n,this._i);this._procAudio(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Audio node '"+a.n+"'");break;case Ovoid.TEXT:n=new Ovoid.Text(a.n,this._i);this._procText(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Text node '"+a.n+"'");break;case Ovoid.LAYER:n=new Ovoid.Layer(a.n,
this._i);this._procLayer(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Layer node '"+a.n+"'");break;case Ovoid.SOUND:n=new Ovoid.Sound(a.n,this._i);this._procSound(n,a);Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Sound node '"+a.n+"'");break;default:n=new Ovoid.Node(a.n,this._i),this._procNode(n,a),Ovoid._log(3,this._i,"::Ojson._importNode",this.name+":: import Null node '"+a.n+"'")}this._dstsc.insNode(n,null,!0,!0);this._rlnkstack.push(n)};
Ovoid.Ojson.prototype._relinkNode=function(a){if(null!=a.parent)0!=a.parent?a.parent=this._dstsc.findNode(a.parent):(a.parent=null,a.type&Ovoid.LAYER?a.setParent(this._dstsc.overlay):a.type&Ovoid.TRANSFORM&&a.setParent(this._dstsc.world));for(var b=0;b<a.child.length;b++)a.child[b]=this._dstsc.findNode(a.child[b]);for(b=0;b<a.depend.length;b++)a.depend[b]=this._dstsc.findNode(a.depend[b]);for(b=0;b<a.link.length;b++)a.link[b]=this._dstsc.findNode(a.link[b]);if(a.type&Ovoid.CONSTRAINT)for(b=0;b<a.target.length;b++)a.target[b]=
this._dstsc.findNode(a.target[b]);a.type&Ovoid.AIM&&(a.aimat[b]=this._dstsc.findNode(a.aimat[b]));if(a.type&Ovoid.BODY)a.shape=this._dstsc.findNode(a.shape);if(a.type&Ovoid.SKIN){a.mesh=this._dstsc.findNode(a.mesh);for(b=0;b<a.joint.length;b++)a.joint[b]=this._dstsc.findNode(a.joint[b]),this._linkReport(a,a.joint[b],"joint"),a.bindJointMatrix.push(new Ovoid.Matrix4),a.infWorldMatrix.push(new Ovoid.Matrix4),a.infNormalMatrix.push(new Ovoid.Matrix3),a.unCach(Ovoid.CACH_SKIN);Ovoid.opt_localSkinData&&
a._localMirror()}if(a.type&Ovoid.JOINT)a.skin=this._dstsc.findNode(a.skin);if(a.type&Ovoid.SOUND)a.audio=this._dstsc.findNode(a.audio);if(a.type&Ovoid.LAYER)a.bgTexture=this._dstsc.findNode(a.bgTexture);if(a.type&Ovoid.TEXT)a.fontmap=this._dstsc.findNode(a.fontmap);if(a.type&Ovoid.MATERIAL)for(b=0;b<a.texture.length;b++)a.texture[b]=this._dstsc.findNode(a.texture[b]);if(a.type&Ovoid.TRACK)for(b=0;b<a.animation.length;b++)a.animation[b]=this._dstsc.findNode(a.animation[b]);if(a.type&Ovoid.MESH)for(b=
0;b<Ovoid.MAX_MESH_LOD;b++)for(var c=0;c<a.polyset[b].length;c++)a.polyset[b][c].material=this._dstsc.findNode(a.polyset[b][c].material),a.polyset[b][c].material||Ovoid._log(2,this._i,"::Ojson._relinkNode",this.name+":: polyset #"+b+" of '"+a.name+"' has null material.");if(a.type&Ovoid.EMITTER)a.texture=this._dstsc.findNode(a.texture);if(a.type&Ovoid.ACTION){for(b=0;b<a.onIntersect[0].length;b++)a.onIntersect[0][b]=this._dstsc.findNode(a.onIntersect[0][b]);for(b=0;b<a.onIntersectEnter[0].length;b++)a.onIntersectEnter[0][b]=
this._dstsc.findNode(a.onIntersectEnter[0][b]);for(b=0;b<a.onIntersectLeave[0].length;b++)a.onIntersectLeave[0][b]=this._dstsc.findNode(a.onIntersectLeave[0][b])}};
Ovoid.Ojson.prototype._procNode=function(a,b){a.visible=b.v;a.pickable=b.k;a.uid=b.u;"null"==b.p?a.parent=null:a.parent=b.p;for(var c=0;c<b.c.length;c++)a.child.push(b.c[c]);for(c=0;c<b.dp.length;c++)a.depend.push(b.dp[c]);for(c=0;c<b.lk.length;c++)a.link.push(b.lk[c]);var c=new Ovoid.Point,e=new Ovoid.Point;c.setv(b.bmn);e.setv(b.bmx);a.boundingBox.setBound(c,e);a.boundingSphere.setBound(c,e);a.boundingSphere.setRadius(b.brd)};
Ovoid.Ojson.prototype._procMaterial=function(a,b){this._procNode(a,b);for(var c=0;c<b.cl.length;c++)a.color[c].setv(b.cl[c]);for(c=0;c<b.tx.length;c++)"null"!=a.texture[c]&&(a.texture[c]=b.tx[c]);a.shininess=b.sh;a.reflectivity=b.re;a.opacity=b.op};Ovoid.Ojson.prototype._procTexture=function(a,b){this._procNode(a,b);a.url=b.url;a.filter=b.fl};Ovoid.Ojson.prototype._procAudio=function(a,b){this._procNode(a,b);a.url=b.url};
Ovoid.Ojson.prototype._procTrack=function(a,b){this._procNode(a,b);a.playing=b.pl;a.loop=b.lo;a.ended=b.en;for(var c=0;c<b.an.length;c++)a.animation.push(b.an[c]);a.onended=this._parseFunc(b.oe)};
Ovoid.Ojson.prototype._procMesh=function(a,b){this._procNode(a,b);for(var c=0;c<Ovoid.MAX_MESH_LOD;c++){if(0<b.mp[c].length)for(var e=0;e<b.mp[c].length;e++){var f=new Ovoid.Polyset;f.ioffset=b.mp[c][e][0];f.icount=b.mp[c][e][1];f.material=b.mp[c][e][2];a.polyset[c].push(f)}0<b.mv[c].length&&(Ovoid._log(3,this._i,"::Ojson._procMesh",this.name+":: unpack vertices buffer:"+b.mv[c].length+" floats"),a.vertices[c]=Ovoid.Vertex.upack(b.mf,b.mv[c]));if(0<b.mt[c].length)for(e=0;e<b.mt[c].length;e++)f=new Ovoid.Triangle,
f.index[0]=b.mt[c][e][0],f.index[1]=b.mt[c][e][1],f.index[2]=b.mt[c][e][2],f.adjacent[0]=b.mt[c][e][3],f.adjacent[1]=b.mt[c][e][4],f.adjacent[2]=b.mt[c][e][5],a.triangles[c].push(f);a._lodt[c]=b.lt[c];a.recalcTriangles(c)}a._vfbytes=b.mb;a._vformat=b.mf;"null"==b.mm?a.modifier=null:a.modifier=b.mm;a._createBuffers(a._vformat,Ovoid.BUFFER_STATIC)};Ovoid.Ojson.prototype._procConstraint=function(a,b){this._procNode(a,b);for(var c=0;c<b.ct.length;c++)a.target.push(b.ct[c])};
Ovoid.Ojson.prototype._procAnimation=function(a,b){this._procConstraint(a,b);a._format=b.ft;a.playing=b.pl;a.loop=b.lo;a.ended=b.en;a.smooth=b.sm;a.factor=b.fc;for(var c=0;21>c;c++)if("null"==b.cn[c])a._channel[c]=null;else{var e;switch(b.cn[c].type){case "Bspline":e=new Ovoid.Bspline(new Float32Array(b.cn[c].x),new Float32Array(b.cn[c].y),new Float32Array(b.cn[c].cx),new Float32Array(b.cn[c].cy));break;case "Hspline":e=new Ovoid.Hspline(new Float32Array(b.cn[c].x),new Float32Array(b.cn[c].y),new Float32Array(b.cn[c].v));
break;default:e=new Ovoid.Cspline(new Float32Array(b.cn[c].x),new Float32Array(b.cn[c].y))}a._channel[c]=e}a.onended=this._parseFunc(b.oe)};Ovoid.Ojson.prototype._procPhysic=function(a,b){this._procConstraint(a,b);a.imass=b.im;a.itensor.setv(b.it);a.model=b.md;a.damping=b.dm;a.useFriction=b.uf;a.restitution=b.re;a.sleeping=b.sl;a.oncontact=this._parseFunc(b.oc)};
Ovoid.Ojson.prototype._procSkin=function(a,b){this._procNode(a,b);"null"==b.mh?a.mesh=null:a.mesh=b.mh;for(var c=0;c<b.jt.length;c++)a.joint.push(b.jt[c]);a.bindJointMatrix=Array(b.bjm.length);for(c=0;c<a.bindJointMatrix.length;c++)a.bindJointMatrix[c]=new Ovoid.Matrix4,a.bindJointMatrix[c].setv(b.bjm[c]);a.bindShapeMatrix.setv(b.bsm)};
Ovoid.Ojson.prototype._procEmitter=function(a,b){this._procNode(a,b);a.model=b.md;a.mass=b.ms;a.life=b.lf;a.rate=b.rt;a.velocity=b.vl;a.damping=b.dm;a.delta=b.dt;a.scattering=b.sc;for(var c=0;c<b.cl.length;c++)a.color[c].setv(b.cl[c]);a.size[0]=b.sz[0];a.size[1]=b.sz[1];a.emits=b.em;"null"==b.tx?a.texture=null:a.texture=b.tx;a.billboard=b.bb};Ovoid.Ojson.prototype._procTransform=function(a,b){this._procNode(a,b);a.scaling.setv(b.ts);a.translation.setv(b.tt);a.orientation.setv(b.to);a.rotation.setv(b.tr)};
Ovoid.Ojson.prototype._procCamera=function(a,b){this._procTransform(a,b);a.viewX=b.vx;a.viewY=b.vy;a.fov=b.fv;a.aspect=b.ar;a.clipNear=b.cn;a.clipFar=b.cf};Ovoid.Ojson.prototype._procLight=function(a,b){this._procTransform(a,b);a.model=b.md;a.color.setv(b.cl);a.intensity=b.it;a.attenuationC=b.ac;a.attenuationL=b.al;a.attenuationQ=b.aq;a.range=b.rn;a.falloff=b.ff;a.spotAngle=b.sa;a.shadowCasting=b.sc};
Ovoid.Ojson.prototype._procBody=function(a,b){this._procTransform(a,b);"null"==b.shape?a.shape=null:a.shape=b.bs;a.intersectable=b.bi;a.shadowCasting=b.bc;a.renderLayer=b.bl;a.renderAlpha=b.ba;a.visibleRange=b.vr};Ovoid.Ojson.prototype._procJoint=function(a,b){this._procTransform(a,b);a.sz=b.size;"null"==b.sk?a.skin=null:a.skin=b.sk};
Ovoid.Ojson.prototype._procSound=function(a,b){this._procTransform(a,b);"null"==b.au?a.audio=null:a.audio=b.au;a.spatialize(!b.fl);if(a.alpanner&&b.ia)a.alpanner.coneInnerAngle=b.ia,a.alpanner.coneOuterAngle=b.oa,a.alpanner.coneOuterGain=b.og,a.alpanner.refDistance=b.rd,a.alpanner.maxDistance=b.md,a.alpanner.rolloffFactor=b.rf;a.setLoop(b.lo)};
Ovoid.Ojson.prototype._procLayer=function(a,b){this._procTransform(a,b);a.size.setv(b.sz);a.fgColor.setv(b.fc);a.bgColor.setv(b.bc);"null"==b.bt?a.bgTexture=null:a.bgTexture=b.bt};Ovoid.Ojson.prototype._procText=function(a,b){this._procLayer(a,b);"null"==b.fm?a.fontmap=null:a.fontmap=b.fm;a.string=b.st;a.param.setv(b.pr)};Ovoid.Ojson.prototype._procExpression=function(a,b){this._procConstraint(a,b);a.playing=b.pl;a.factor=b.fc;for(var c=0;c<b.ex.length;c++)a.exprfunc.push(this._parseFunc(b.ex[c]))};
Ovoid.Ojson.prototype._procAim=function(a,b){this._procConstraint(a,b);a.upvector.set(b.up);"null"==b.at?a.aimat=null:a.aimat=b.at};
Ovoid.Ojson.prototype._procAction=function(a,b){this._procNode(a,b);a.onEnter=this._parseFunc(b.onEnter);a.onLeave=this._parseFunc(b.onLeave);a.onOver=this._parseFunc(b.onOver);a.onLmbDn=this._parseFunc(b.onLmbDn);a.onLmbUp=this._parseFunc(b.onLmbUp);a.onLmbHl=this._parseFunc(b.onLmbHl);a.onMmbDn=this._parseFunc(b.onMmbDn);a.onMmbUp=this._parseFunc(b.onMmbUp);a.onMmbHl=this._parseFunc(b.onMmbHl);a.onRmbDn=this._parseFunc(b.onRmbDn);a.onRmbUp=this._parseFunc(b.onRmbUp);a.onRmbHl=this._parseFunc(b.onRmbHl);
a.onGrabd=this._parseFunc(b.onGrabd);a.onUgrabd=this._parseFunc(b.onUgrabd);for(var c=0;c<b.onIntersect[0].length;c++)"null"==b.onIntersect[0][c]?a.onIntersect[0][c]=null:a.onIntersect[0][c]=b.onIntersect[0][c],a.onIntersect[1][c]=this._parseFunc(b.onIntersect[1][c]);for(c=0;c<b.onIntersectEnter[0].length;c++)"null"==b.onIntersectEnter[0][c]?a.onIntersectEnter[0][c]=null:a.onIntersectEnter[0][c]=b.onIntersectEnter[0][c],a.onIntersectEnter[1][c]=this._parseFunc(b.onIntersectEnter[1][c]);for(c=0;c<
b.onIntersectLeave[0].length;c++)"null"==b.onIntersectLeave[0][c]?a.onIntersectLeave[0][c]=null:a.onIntersectLeave[0][c]=b.onIntersectLeave[0][c],a.onIntersectLeave[1][c]=this._parseFunc(b.onIntersectLeave[1][c])};
Ovoid.Ojson.prototype.save=function(a){this.name=a.name;var b={};b.OJSN=Ovoid.VERSION;if(a instanceof Ovoid.Scene)Ovoid._log(3,this._i,"::Ojson.save",this.name+":: Scene data export."),this._i=a._i,b.TYPE="SCN",b.SCENE=a,a=".ojs";else if(a instanceof Ovoid.Instance)Ovoid._log(3,this._i,"::Ojson.save",this.name+":: Instance's env data export."),this._i=a,b.TYPE="ENV",b.INENV=a,a=".oje";else return Ovoid._log(1,this._i,"::Ojson.save",this.name+":: invalid object type to export, expected Scene or Instance."),
null;Ovoid._log(3,this._i,"::Ojson.save",this.name+":: stringify data.");try{this._json=JSON.stringify(b),delete b,Ovoid._log(3,this._i,"::Ojson.save",this.name+":: "+Math.round(8*this._json.length/1E3)+" Ko of JSON data created.")}catch(c){return Ovoid._log(1,this._i,"::Ojson.save",this.name+":: stringify exception thrown: "+c),null}if(b=document.createElement("a"))try{this._json=this._json.replace(/ /g,"%20"),b.setAttribute("href","data:text/plain;charset=utf-8,"+this._json),b.setAttribute("download",
this.name+a),document.body.appendChild(b),b.click()}catch(e){Ovoid._log(1,this._i,"::Ojson.save",this.name+":: download exception thrown: "+e)}else Ovoid._log(1,this._i,"::Ojson.save",this.name+":: unable to create download link"),alert("Ovoid :: Ojson.save :: unable to create download link.");return this._json};
Ovoid.Ojson.prototype._importScene=function(a){if(!this._json.SCENE)return Ovoid._log(1,this._i,"::Ojson._importScene",this.name+":: no scene object found in Ovoid JSON"),!1;Ovoid._log(3,this._i,"::Ojson._importScene",this.name+":: begin");this._rlnkstack=[];this._dstsc=a;a=this._json.SCENE.nl;Ovoid._log(3,this._i,"::Ojson._importScene",this.name+":: importing nodes...");for(var b=0;b<a.length;b++)try{this._importNode(a[b])}catch(c){return Ovoid._log(1,this._i,"::Ojson._importScene",this.name+":: error during node importation:"+
c.stack+" file may be corrupted."),!1}Ovoid._log(3,this._i,"::Ojson._importScene",this.name+":: relinking nodes...");for(b=0;b<this._rlnkstack.length;b++)this._relinkNode(this._rlnkstack[b]);this._dstsc.name=this._json.SCENE.n;this._dstsc._uidn=this._json.SCENE.u;Ovoid._log(3,this._i,"::Ojson._importScene",this.name+":: done");return!0};
Ovoid.Ojson.prototype._importEnv=function(){if(!this._json.INENV)return Ovoid._log(1,this._i,"::Ojson._importEnv",this.name+":: no Instance Env object found in Ovoid JSON"),!1;var a=this._json.INENV;Ovoid._log(3,this._i,"::Ojson._importEnv",this.name+":: begin");try{var b,c,e,f;for(b=0;3>b;b++){c=a.oi[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(0,a.oi[b][e][0],b,this._parseFunc(a.oi[b][e][1]));c=a.oci[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(1,a.oci[b][e][0],b,this._parseFunc(a.oci[b][e][1]));
c=a.oai[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(2,a.oai[b][e][0],b,this._parseFunc(a.oai[b][e][1]));c=a.osi[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(3,a.osi[b][e][0],b,this._parseFunc(a.osi[b][e][1]));c=a.olsi[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(4,a.olsi[b][e][0],b,this._parseFunc(a.olsi[b][e][1]));c=a.orsi[b].length;for(e=0;e<c;e++)this._i.Input.setTrigger(5,a.orsi[b][e][0],b,this._parseFunc(a.orsi[b][e][1]))}this._i.onloop=this._parseFunc(a.olp);this._i.ondraw=
this._parseFunc(a.odw);this._i.waitdraw=this._parseFunc(a.wdw);this._i.Drawer._splib[f]=[];c=a.sl.length;for(f=0;f<c;f++)b=new Ovoid.Shader(a.sl[f].n,this._i),b.setSources(a.sl[f].vs,a.sl[f].fs,a.sl[f].ws),this._i.Drawer._splib[f]=b;this._i.Drawer._sppipe=Array(Ovoid.MAX_RENDER_LAYER);c=a.sp.length;for(f=0;f<c;f++)this._i.Drawer._sppipe[f]=a.sp[f];this._i.opt_debugMode=a.o[0];this._i.opt_enableAlerts=a.o[1];this._i.opt_logLevel=a.o[2];this._i.opt_customErrContent=a.o[3];this._i.opt_showHud=a.o[4];
this._i.opt_showDebug=a.o[5];this._i.opt_gravity=a.o[6];this._i.opt_preloadStyle=a.o[7];this._i.opt_preloadBgColor=a.o[8];this._i.opt_preloadFgColor=a.o[9];this._i.opt_preloadAcColor=a.o[10];this._i.opt_frameMode=a.o[11];this._i.opt_renderClearColor=a.o[12];this._i.opt_renderAmbientColor=a.o[13];this._i.opt_renderFogColor=a.o[14];this._i.opt_renderFogDensity=a.o[15];this._i.opt_renderPickingMode=a.o[16];this._i.opt_renderLopLevel=a.o[17];this._i.opt_renderAdaptLop=a.o[18];this._i.opt_renderAdaptLopThreshold=
a.o[19];this._i.opt_renderPerLightPass=a.o[20];this._i.opt_renderShadowCasting=a.o[21];this._i.opt_renderShadowCastingExclusion=a.o[22];this._i.opt_renderDrawLayers=a.o[23];this._i.opt_renderDrawHelpers=a.o[24];this._i.opt_renderDrawAxis=a.o[25];this._i.opt_renderDrawBoundingBox=a.o[26];this._i.opt_renderDrawBoundingSphere=a.o[27];this._i.opt_renderDrawJoints=a.o[28];this._i.opt_renderDrawLights=a.o[29];this._i.opt_renderDrawCameras=a.o[30];this._i.opt_renderDrawNormals=a.o[31];this._i.opt_renderJointSize=
a.o[32];this._i.opt_renderNormalScale=a.o[33];this._i.opt_sceneViewcull=a.o[34];this._i.opt_sceneLightcull=a.o[35];this._i.opt_sceneIntersectDetect=a.o[36];this._i.opt_sceneDefaultViewPosition=a.o[37];this._i.opt_sceneDefaultViewRotation=a.o[38];this._i.opt_physicsIterativeSolver=a.o[39];this._i.opt_physicsContactItFactor=a.o[40];this._i.opt_renderCullFace=a.o[41];this._i.opt_audioDopplerFactor=a.o[42];this._i.opt_skinLocalComput=a.o[43];this._i.opt_frameWidth=a.o[44];this._i.opt_frameHeight=a.o[45]}catch(g){return Ovoid._log(1,
this._i,"::Ojson._importEnv",this.name+":: error during Env importation:"+g.stack+" file may be corrupted."),!1}Ovoid._log(3,this._i,"::Ojson._importEnv",this.name+":: done");return!0};
Ovoid.Ojson.prototype._importOjson=function(a){if(!this._json)return Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: no JSON data."),!1;if(this._json.OJSN){if(this._json.OJSN!=Ovoid.VERSION)return Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: wrong Ovoid.JSON version, is:"+this._json.OJSN+" expected:"+Ovoid.VERSION),!1}else return Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: is not a valid Ovoid.JSON format"),!1;if("SCN"==this._json.TYPE){if(a instanceof Ovoid.Scene)return this._importScene(a);
Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: invalid destination object for Scene type Ovoid.JSON, Ovoid.Scene object expected");return!1}if("ENV"==this._json.TYPE){if(a instanceof Ovoid.Instance)return this._importEnv(a);Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: invalid destination object for Env type Ovoid.JSON, Ovoid.Instance object expected");return!1}Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: unknow Ovoid.JSON type.");return!1};
Ovoid.Ojson.prototype.loadSource=function(a,b,c){this.loadStatus=0;this.url=a;if(b instanceof Ovoid.Scene)this._i=b._i;else if(b instanceof Ovoid.Instance)this._i=b;else return Ovoid._log(1,this._i,"::Ojson._importOjson",this.name+":: invalid destination object, expected Scene or Instance"),!1;this.name=Ovoid.extractName(this.url);Ovoid._log(3,this._i,"::Ojson.loadSource",this.name+":: loading source file '"+this.url+"'");a=new XMLHttpRequest;if(c)a.o=this,a._i=this._i,a.d=b,a.onreadystatechange=
function(){if(4==this.readyState)if(200==this.status||304==this.status){Ovoid._log(3,this._i,"::Ojson.loadSource",this.o.name+":: parsing source file '"+this.o.url+"'");try{this.o._json=JSON.parse(this.responseText)}catch(a){Ovoid._log(2,this._i,"::Ojson.loadSource",this.o.name+":: parse error '"+a.stack+"'")}this.o.loadStatus=1;this.o._importOjson(this.d)}else this.o.loadStatus=-1,Ovoid._log(2,this._i,"Ojson.loadSource",+this.o.name+":: unable to load source '"+this.o.url+"'")};var e=this.url;this._i.opt_debugMode&&
(e+="?"+Math.random());a.open("GET",e,c);a.send(null);if(!c)if(200==a.status||304==a.status){Ovoid._log(3,this._i,"::Ojson.loadSource",this.name+":: parsing source file '"+this.url+"'");try{this._json=JSON.parse(a.responseText)}catch(f){Ovoid._log(2,this._i,"::Ojson.loadSource",this.name+":: parse error '"+f.stack+"'")}this.loadStatus=1;this._importOjson(b)}else this.loadStatus=-1,Ovoid._log(2,this._i,"Ojson.loadSource",+this.name+":: unable to load source '"+this.url+"'")};Ovoid.Contact=function(){this._f=!1;this._r=0.5;this._b=Array(2);this._p=0;this._c=new Ovoid.Point;this._n=new Ovoid.Vector;this._v=new Ovoid.Vector;this._rc=[new Ovoid.Vector,new Ovoid.Vector];this._rt=[new Ovoid.Vector,new Ovoid.Vector];this._d=0;this._li=[new Ovoid.Vector,new Ovoid.Vector];this._ti=[new Ovoid.Vector,new Ovoid.Vector];this._ap=[new Ovoid.Vector,new Ovoid.Vector];this._ar=[new Ovoid.Vector,new Ovoid.Vector];this._as=[0,0];this._matrix=new Ovoid.Matrix3};
Ovoid.Contact.prototype._solveDelta=function(a){var b=new Ovoid.Vector,c;b.copy(this._b[0]._oldLinear);b.scaleBy(a);c=b.dot(this._n);this._b[1]&&(b.copy(this._b[1]._oldLinear),b.scaleBy(a),c-=b.dot(this._n));a=this._r;0.25>Math.abs(this._v.v[0])&&(a=0);this._d=-this._v.v[0]-a*(this._v.v[0]-c)};
Ovoid.Contact.prototype.set=function(a,b,c,e,f,g){b?(this._f=a.useFriction&&b.useFriction,this._r=a.restitution*b.restitution):(this._f=a.useFriction,this._r=a.restitution);if(!(0>this._r))this._b[0]=a,this._b[1]=b,this._c.copy(c),this._n.copy(e),this._p=f,this._matrix.m[0]=this._n.v[0],this._matrix.m[1]=this._n.v[1],this._matrix.m[2]=this._n.v[2],Math.abs(this._n.v[0])>Math.abs(this._n.v[1])?(a=1/Math.sqrt(this._n.v[2]*this._n.v[2]+this._n.v[0]*this._n.v[0]),this._matrix.m[3]=this._n.v[2]*a,this._matrix.m[4]=
0,this._matrix.m[5]=-this._n.v[0]*a,this._matrix.m[6]=this._n.v[1]*this._matrix.m[3],this._matrix.m[7]=this._n.v[2]*this._matrix.m[3]-this._n.v[0]*this._matrix.m[5],this._matrix.m[8]=-this._n.v[1]*this._matrix.m[3]):(a=1/Math.sqrt(this._n.v[2]*this._n.v[2]+this._n.v[1]*this._n.v[1]),this._matrix.m[3]=0,this._matrix.m[4]=-this._n.v[2]*a,this._matrix.m[5]=this._n.v[1]*a,this._matrix.m[6]=this._n.v[1]*this._matrix.m[5]-this._n.v[2]*this._matrix.m[4],this._matrix.m[7]=-this._n.v[0]*this._matrix.m[5],
this._matrix.m[8]=this._n.v[0]*this._matrix.m[4]),this._rc[0].subOf(this._c,this._b[0].target[0].worldPosition),this._b[1]&&this._rc[1].subOf(this._c,this._b[1].target[0].worldPosition),a=new Ovoid.Vector,b=new Ovoid.Vector,a.crossOf(this._b[0].angularVelocity,this._rc[0]),a.addBy(this._b[0].linearVelocity),a.transform3Inverse(this._matrix),b.copy(this._b[0]._oldLinear),b.scaleBy(g),b.transform3Inverse(this._matrix),b.v[0]=0,a.addBy(b),this._v.copy(a),this._b[1]&&(a.crossOf(this._b[1].angularVelocity,
this._rc[1]),a.addBy(this._b[1].linearVelocity),a.transform3Inverse(this._matrix),b.copy(this._b[1]._oldLinear),b.scaleBy(g),b.transform3Inverse(this._matrix),b.v[0]=0,a.addBy(b),this._v.subBy(a)),this._solveDelta(g),this._rt[0].crossOf(this._rc[0],this._n),this._rt[0].transform3(this._b[0].itensor),this._b[1]&&(this._rt[1].crossOf(this._rc[1],this._n),this._rt[1].transform3(this._b[1].itensor))};
Ovoid.Contact.prototype._adjustPositions=function(a){if(!(0>this._r)){for(var b=new Ovoid.Vector,c=new Ovoid.Vector,e=0,f=[0,0],g=[0,0],h=0;2>h;h++)if(this._b[h])b.crossOf(this._rt[h],this._rc[h]),g[h]=b.dot(this._n),f[h]=this._b[h].imass,e+=g[h]+f[h];var k=[0,0],j=[0,0];k[0]=a*g[0]/e;j[0]=a*f[0]/e;this._b[1]&&(k[1]=-1*(a*g[1]/e),j[1]=-1*(a*f[1]/e));for(h=0;2>h;h++)this._b[h]&&(0!=k[h]?(this._ar[h].copy(this._rt[h]),this._as[h]=k[h]/g[h]):(this._ar[h].set(0,0,0),this._as[h]=1),c.copy(this._n),c.scaleBy(j[h]),
this._b[h].target[0].translation.addBy(c),b.copy(this._ar[h]),b.scaleBy(0.5*this._as[h]),this._b[h].target[0].rotation.vectorRotateBy(b),this._b[h].target[0].rotation.normalize(),this._ap[h].copy(this._n),this._ap[h].scaleBy(j[h]/this._as[h]))}};
Ovoid.Contact.prototype._applyImpulses=function(){if(!(0>this._r)){var a=new Ovoid.Vector;if(this._f){var b=new Ovoid.Matrix3,c=new Float32Array(9),e=new Float32Array(9);c[0]=-this._rc[0].v[2]*this._b[0].itensor.m[3]+this._rc[0].v[1]*this._b[0].itensor.m[6];c[1]=-this._rc[0].v[2]*this._b[0].itensor.m[4]+this._rc[0].v[1]*this._b[0].itensor.m[7];c[2]=-this._rc[0].v[2]*this._b[0].itensor.m[5]+this._rc[0].v[1]*this._b[0].itensor.m[8];c[3]=this._rc[0].v[2]*this._b[0].itensor.m[0]+-this._rc[0].v[0]*this._b[0].itensor.m[6];
c[4]=this._rc[0].v[2]*this._b[0].itensor.m[1]+-this._rc[0].v[0]*this._b[0].itensor.m[7];c[5]=this._rc[0].v[2]*this._b[0].itensor.m[2]+-this._rc[0].v[0]*this._b[0].itensor.m[8];c[6]=-this._rc[0].v[1]*this._b[0].itensor.m[0]+this._rc[0].v[0]*this._b[0].itensor.m[3];c[7]=-this._rc[0].v[1]*this._b[0].itensor.m[1]+this._rc[0].v[0]*this._b[0].itensor.m[4];c[8]=-this._rc[0].v[1]*this._b[0].itensor.m[2]+this._rc[0].v[0]*this._b[0].itensor.m[5];e[0]=-1*(c[1]*this._rc[0].v[2]+c[2]*-this._rc[0].v[1]);e[1]=-1*
(c[0]*-this._rc[0].v[2]+c[2]*this._rc[0].v[0]);e[2]=-1*(c[0]*this._rc[0].v[1]+c[1]*-this._rc[0].v[0]);e[3]=-1*(c[4]*this._rc[0].v[2]+c[5]*-this._rc[0].v[1]);e[4]=-1*(c[3]*-this._rc[0].v[2]+c[5]*this._rc[0].v[0]);e[5]=-1*(c[3]*this._rc[0].v[1]+c[4]*-this._rc[0].v[0]);e[6]=-1*(c[7]*this._rc[0].v[2]+c[8]*-this._rc[0].v[1]);e[7]=-1*(c[6]*-this._rc[0].v[2]+c[8]*this._rc[0].v[0]);e[8]=-1*(c[6]*this._rc[0].v[1]+c[7]*-this._rc[0].v[0]);var f=this._b[0].imass;this._b[1]&&(c[0]=-this._rc[1].v[2]*this._b[1].itensor.m[3]+
this._rc[1].v[1]*this._b[1].itensor.m[6],c[1]=-this._rc[1].v[2]*this._b[1].itensor.m[4]+this._rc[1].v[1]*this._b[1].itensor.m[7],c[2]=-this._rc[1].v[2]*this._b[1].itensor.m[5]+this._rc[1].v[1]*this._b[1].itensor.m[8],c[3]=this._rc[1].v[2]*this._b[1].itensor.m[0]+-this._rc[1].v[0]*this._b[1].itensor.m[6],c[4]=this._rc[1].v[2]*this._b[1].itensor.m[1]+-this._rc[1].v[0]*this._b[1].itensor.m[7],c[5]=this._rc[1].v[2]*this._b[1].itensor.m[2]+-this._rc[1].v[0]*this._b[1].itensor.m[8],c[6]=-this._rc[1].v[1]*
this._b[1].itensor.m[0]+this._rc[1].v[0]*this._b[1].itensor.m[3],c[7]=-this._rc[1].v[1]*this._b[1].itensor.m[1]+this._rc[1].v[0]*this._b[1].itensor.m[4],c[8]=-this._rc[1].v[1]*this._b[1].itensor.m[2]+this._rc[1].v[0]*this._b[1].itensor.m[5],e[0]+=-1*(c[1]*this._rc[1].v[2]+c[2]*-this._rc[1].v[1]),e[1]+=-1*(c[0]*-this._rc[1].v[2]+c[2]*this._rc[1].v[0]),e[2]+=-1*(c[0]*this._rc[1].v[1]+c[1]*-this._rc[1].v[0]),e[3]+=-1*(c[4]*this._rc[1].v[2]+c[5]*-this._rc[1].v[1]),e[4]+=-1*(c[3]*-this._rc[1].v[2]+c[5]*
this._rc[1].v[0]),e[5]+=-1*(c[3]*this._rc[1].v[1]+c[4]*-this._rc[1].v[0]),e[6]+=-1*(c[7]*this._rc[1].v[2]+c[8]*-this._rc[1].v[1]),e[7]+=-1*(c[6]*-this._rc[1].v[2]+c[8]*this._rc[1].v[0]),e[8]+=-1*(c[6]*this._rc[1].v[1]+c[7]*-this._rc[1].v[0]),f+=this._b[1].imass);c[0]=this._matrix.m[0]*e[0]+this._matrix.m[3]*e[3]+this._matrix.m[6]*e[6];c[1]=this._matrix.m[0]*e[1]+this._matrix.m[3]*e[4]+this._matrix.m[6]*e[7];c[2]=this._matrix.m[0]*e[2]+this._matrix.m[3]*e[5]+this._matrix.m[6]*e[8];c[3]=this._matrix.m[1]*
e[0]+this._matrix.m[4]*e[3]+this._matrix.m[7]*e[6];c[4]=this._matrix.m[1]*e[1]+this._matrix.m[4]*e[4]+this._matrix.m[7]*e[7];c[5]=this._matrix.m[1]*e[2]+this._matrix.m[4]*e[5]+this._matrix.m[7]*e[8];c[6]=this._matrix.m[2]*e[0]+this._matrix.m[5]*e[3]+this._matrix.m[8]*e[6];c[7]=this._matrix.m[2]*e[1]+this._matrix.m[5]*e[4]+this._matrix.m[8]*e[7];c[8]=this._matrix.m[2]*e[2]+this._matrix.m[5]*e[5]+this._matrix.m[8]*e[8];b.m[0]=c[0]*this._matrix.m[0]+c[1]*this._matrix.m[3]+c[2]*this._matrix.m[6];b.m[1]=
c[0]*this._matrix.m[1]+c[1]*this._matrix.m[4]+c[2]*this._matrix.m[7];b.m[2]=c[0]*this._matrix.m[2]+c[1]*this._matrix.m[5]+c[2]*this._matrix.m[8];b.m[3]=c[3]*this._matrix.m[0]+c[4]*this._matrix.m[3]+c[5]*this._matrix.m[6];b.m[4]=c[3]*this._matrix.m[1]+c[4]*this._matrix.m[4]+c[5]*this._matrix.m[7];b.m[5]=c[3]*this._matrix.m[2]+c[4]*this._matrix.m[5]+c[5]*this._matrix.m[8];b.m[6]=c[6]*this._matrix.m[0]+c[7]*this._matrix.m[3]+c[8]*this._matrix.m[6];b.m[7]=c[6]*this._matrix.m[1]+c[7]*this._matrix.m[4]+
c[8]*this._matrix.m[7];b.m[8]=c[6]*this._matrix.m[2]+c[7]*this._matrix.m[5]+c[8]*this._matrix.m[8];b.m[0]+=f;b.m[4]+=f;b.m[8]+=f;c=b.m[0];e=b.m[1];f=b.m[2];b.toInverse();a.set(this._d,-this._v.v[1],-this._v.v[2]);a.transform3(b);b=Math.sqrt(a.v[1]*a.v[1]+a.v[2]*a.v[2]);b>a.v[0]*this._f&&(a.v[1]/=b,a.v[2]/=b,a.v[0]=c+e*this._f*a.v[1]+f*this._f*a.v[2],a.v[0]=this._d/a.v[0],a.v[1]*=this._f*a.v[0],a.v[2]*=this._f*a.v[0])}else{for(var c=new Ovoid.Vector,b=0,e=0;2>e;e++)this._b[e]&&(c.crossOf(this._rt[e],
this._rc[e]),b+=c.dot(this._n),b+=this._b[e].imass);a.v[0]=this._d/b;a.v[1]=0;a.v[2]=0}a.transform3(this._matrix);this._ti[0].crossOf(this._rc[0],a);this._ti[0].transform3(this._b[0].itensor);this._li[0].copy(a);this._li[0].scaleBy(this._b[0].imass);this._b[0].linearVelocity.addBy(this._li[0]);this._b[0].angularVelocity.addBy(this._ti[0]);this._b[0].unCach(Ovoid.CACH_INFLUENCES|Ovoid.CACH_PHYSICS);this._b[1]&&(this._ti[1].crossOf(a,this._rc[1]),this._ti[1].transform3(this._b[1].itensor),this._li[1].copy(a),
this._li[1].scaleBy(-this._b[1].imass),this._b[1].linearVelocity.addBy(this._li[1]),this._b[1].angularVelocity.addBy(this._ti[1]),this._b[1].unCach(Ovoid.CACH_INFLUENCES|Ovoid.CACH_PHYSICS))}};Ovoid.Solver=function(a){this._i=a;this._contactq=new Ovoid.Stack(Ovoid.MAX_CONTACT_BY_CYCLE);this._tmpVect=Ovoid.Vector.newArray(22);this._tmpPoint=Ovoid.Point.newArray(11);this._tmpc=new Ovoid.Point;this._tmpn=new Ovoid.Vector};Ovoid.Solver.prototype._init=function(){for(var a=this._contactq.length;a--;)this._contactq[a]=new Ovoid.Contact;Ovoid._log(3,this._i,".Solver._init"," done");return!0};
Ovoid.Solver.prototype._hasContact=function(a,b){for(var c=this._contactq.count;c--;)if(this._contactq[c]._b[0]==b&&this._contactq[c]._b[1]==a||this._contactq[c]._b[0]==a&&this._contactq[c]._b[1]==b)return!0;return!1};Ovoid.Solver.prototype._canContact=function(a,b,c){return a.target[0].boundingSphere.worldCenter.dist(b.target[0].boundingSphere.worldCenter)<=a.target[0].boundingSphere.radius+b.target[0].boundingSphere.radius+c};
Ovoid.Solver.prototype._addContact=function(a,b,c,e,f){if(this._contactq.isFull())Ovoid._log(2,this._i,".Solver._addContact"," contact stack overflow.");else if(this._contactq.current().set(a,b,c,e,f,this._i.Timer.quantum),this._contactq.forward(),a.oncontact(b,c,e),b)b.oncontact(a,c,e)};
Ovoid.Solver.prototype._getContactB2L=function(a,b){var c=null;if(b.target[0].shape&&b.target[0].shape.type&Ovoid.MESH)c=b.target[0].shape;if(c){var e=a.target[0].boundingBox,f=b.target[0].worldMatrix,g=a.target[0].worldMatrix,h=this._tmpPoint[8];h.transform4InverseOf(e.worldCenter,f);var k=e.max.dist(e.min),j=Array(8);j[0]=this._tmpPoint[0];j[0].set(e.min.v[0],e.min.v[1],e.min.v[2],1);j[1]=this._tmpPoint[1];j[1].set(e.min.v[0],e.min.v[1],e.max.v[2],1);j[2]=this._tmpPoint[2];j[2].set(e.max.v[0],e.min.v[1],
e.min.v[2],1);j[3]=this._tmpPoint[3];j[3].set(e.max.v[0],e.min.v[1],e.max.v[2],1);j[4]=this._tmpPoint[4];j[4].set(e.min.v[0],e.max.v[1],e.min.v[2],1);j[5]=this._tmpPoint[5];j[5].set(e.min.v[0],e.max.v[1],e.max.v[2],1);j[6]=this._tmpPoint[6];j[6].set(e.max.v[0],e.max.v[1],e.min.v[2],1);j[7]=this._tmpPoint[7];j[7].set(e.max.v[0],e.max.v[1],e.max.v[2],1);for(e=8;e--;)j[e].transform4(g),j[e].transform4Inverse(f);var g=0,m=this._tmpc;m.set(0,0,0,1);var l=this._tmpn;l.set(0,0,0);for(var s=0,u=new Ovoid.Vector,
p=new Ovoid.Point,x,v,y,o,A=this._tmpVect[1],z=this._tmpVect[2],t=this._tmpVect[3],q,w,r,C,B=c.triangles[0].length;B--;)if(o=c.triangles[0][B].normal,C=h.dot(o)+c.triangles[0][B].equation,!(0>C)&&!(C>k)){for(e=8;e--&&!(C=j[e].dot(o)+c.triangles[0][B].equation,0>=C&&(x=c.vertices[0][c.triangles[0][B].index[0]].p,v=c.vertices[0][c.triangles[0][B].index[1]].p,y=c.vertices[0][c.triangles[0][B].index[2]].p,A.subOf(y,x),z.subOf(v,x),t.subOf(h,x),x=A.dot(A),v=A.dot(z),q=z.dot(z),y=A.dot(t),w=z.dot(t),r=
1/(x*q-v*v),q=(q*y-v*w)*r,x=(x*w-v*y)*r,0<=q&&0<=x&&1>q+x&&(u.transform4Of(o,f),p.transform4Of(j[e],f),s+=-C,l.addBy(u),m.addBy(p),g++,4==g))););if(g){1<g&&(l.normalize(),s/=g,m.v[0]/=g,m.v[1]/=g,m.v[2]/=g,m.v[3]=1);this._addContact(a,null,m,l,1.5*s);delete u;delete p;return}}delete u;delete p}};
Ovoid.Solver.prototype._getContactS2L=function(a,b){var c=null;if(b.target[0].shape&&b.target[0].shape.type&Ovoid.MESH)c=b.target[0].shape;if(c){var e=a.target[0].boundingSphere,f=b.target[0].worldMatrix,g=this._tmpPoint[0];g.transform4InverseOf(e.worldCenter,f);for(var h,k,j,m,l=this._tmpVect[1],s=this._tmpVect[2],u=this._tmpVect[3],p,x,v,y,o=c.triangles[0].length;o--;)if(m=c.triangles[0][o].normal,y=g.dot(m)+c.triangles[0][o].equation,!(0>y)&&y<e.radius&&(h=c.vertices[0][c.triangles[0][o].index[0]].p,
k=c.vertices[0][c.triangles[0][o].index[1]].p,j=c.vertices[0][c.triangles[0][o].index[2]].p,l.subOf(j,h),s.subOf(k,h),u.subOf(g,h),h=l.dot(l),k=l.dot(s),j=l.dot(u),p=s.dot(s),x=s.dot(u),v=1/(h*p-k*k),p=(p*j-k*x)*v,h=(h*x-k*j)*v,0<=p&&0<=h&&1>p+h)){c=0;g=this._tmpc;l=this._tmpn;c=e.radius-y;l.transform4Of(m,f);f=this._tmpVect[0];f.copy(l);f.scaleBy(-1);f.scaleBy(e.radius);g.addOf(e.worldCenter,f);g.v[3]=1;this._addContact(a,null,g,l,c);break}}};
Ovoid.Solver.prototype._getContactS2S=function(a,b){var c=a.target[0].boundingSphere,e=b.target[0].boundingSphere,f=this._tmpVect[16];f.subOf(c.worldCenter,e.worldCenter);var g=f.size(),e=c.radius+e.radius;if(!(g>e)){var h=0,k=this._tmpc,j=this._tmpn,h=e-g;f.normalize();j.copy(f);f.scaleBy(c.radius);k.addOf(c.worldCenter,f);this._addContact(a,b,k,j,h)}};
Ovoid.Solver.prototype._getContactB2S=function(a,b){var c=a.target[0].boundingBox,e=b.target[0].boundingSphere,f=a.target[0].worldMatrix,g=this._tmpPoint[0];g.transform4InverseOf(e.worldCenter,f);var h=0,h=this._tmpc,k=this._tmpn;h.copy(g);g.v[0]>c.hsize.v[0]&&(h.v[0]=c.hsize.v[0]);g.v[0]<-c.hsize.v[0]&&(h.v[0]=-c.hsize.v[0]);g.v[1]>c.hsize.v[1]&&(h.v[1]=c.hsize.v[1]);g.v[1]<-c.hsize.v[1]&&(h.v[1]=-c.hsize.v[1]);g.v[2]>c.hsize.v[2]&&(h.v[2]=c.hsize.v[2]);g.v[2]<-c.hsize.v[2]&&(h.v[2]=-c.hsize.v[2]);
h.addBy(c.center);h.v[3]=1;c=e.radius;g=h.dist(g);g>c||(h.transform4(f),k.subOf(h,e.worldCenter),k.normalize(),this._addContact(a,b,h,k,c-g))};
Ovoid.Solver.prototype._getContactB2B=function(a,b){var c,e=a.target[0].boundingBox,f=b.target[0].boundingBox,g=a.target[0].worldMatrix,h=b.target[0].worldMatrix,k=this._tmpVect[16];k.subOf(f.worldCenter,e.worldCenter);var j=this._tmpVect;j[0].set(g.m[0],g.m[1],g.m[2]);j[1].set(g.m[4],g.m[5],g.m[6]);j[2].set(g.m[8],g.m[9],g.m[10]);j[3].set(h.m[0],h.m[1],h.m[2]);j[4].set(h.m[4],h.m[5],h.m[6]);j[5].set(h.m[8],h.m[9],h.m[10]);j[6].crossOf(j[0],j[3]);j[7].crossOf(j[0],j[4]);j[8].crossOf(j[0],j[5]);j[9].crossOf(j[1],
j[3]);j[10].crossOf(j[1],j[4]);j[11].crossOf(j[1],j[5]);j[12].crossOf(j[2],j[3]);j[13].crossOf(j[2],j[4]);j[14].crossOf(j[2],j[5]);var m,l,s,u=Ovoid.FLOAT_MAX,p=-1,x=-1;for(c=0;15>c;c++){m=e.hsize.v[0]*Math.abs(j[c].dot(j[0]))+e.hsize.v[1]*Math.abs(j[c].dot(j[1]))+e.hsize.v[2]*Math.abs(j[c].dot(j[2]));l=f.hsize.v[0]*Math.abs(j[c].dot(j[3]))+f.hsize.v[1]*Math.abs(j[c].dot(j[4]))+f.hsize.v[2]*Math.abs(j[c].dot(j[5]));s=Math.abs(k.dot(j[c]));m=m+l-s;if(0>m)return;m<u&&(u=m,p=c,6>c&&(x=p))}if(-1!=p){c=
0;m=this._tmpc;l=this._tmpn;c=u;if(5<p){s=Math.floor((p-6)/3);u=(p-6)%3;0==j[p].v[0]+j[p].v[1]+j[p].v[2]?l.copy(j[x]):l.copy(j[p]);l.normalize();0<l.dot(k)&&l.scaleBy(-1);k=this._tmpVect[17];k.copy(e.hsize);p=this._tmpVect[18];p.copy(f.hsize);k.v[s]=0;0<j[0].dot(l)&&(k.v[0]*=-1);0<j[1].dot(l)&&(k.v[1]*=-1);0<j[2].dot(l)&&(k.v[2]*=-1);k.addBy(e.center);p.v[u]=0;0>j[3].dot(l)&&(p.v[0]*=-1);0>j[4].dot(l)&&(p.v[1]*=-1);0>j[5].dot(l)&&(p.v[2]*=-1);p.addBy(f.center);var v,y;v=k.v[0]*g.m[0]+k.v[1]*g.m[4]+
k.v[2]*g.m[8]+g.m[12];y=k.v[0]*g.m[1]+k.v[1]*g.m[5]+k.v[2]*g.m[9]+g.m[13];g=k.v[0]*g.m[2]+k.v[1]*g.m[6]+k.v[2]*g.m[10]+g.m[14];k.set(v,y,g);v=p.v[0]*h.m[0]+p.v[1]*h.m[4]+p.v[2]*h.m[8]+h.m[12];y=p.v[0]*h.m[1]+p.v[1]*h.m[5]+p.v[2]*h.m[9]+h.m[13];g=p.v[0]*h.m[2]+p.v[1]*h.m[6]+p.v[2]*h.m[10]+h.m[14];p.set(v,y,g);h=j[s];j=j[u+3];e=e.hsize.v[s];f=f.hsize.v[u];y=this._tmpVect[19];y.subOf(k,p);u=h.size2();g=j.size2();s=j.dot(h);v=h.dot(y);y=j.dot(y);var o=u*g-s*s;if(0.001>Math.abs(o))return 2<x?m.copy(k):
m.copy(p),this._addContact(a,b,m,l,c),!0;g=(s*y-g*v)/o;u=(u*y-s*v)/o;g>e||g<-e||u>f||u<-f?2<x?m.copy(k):m.copy(p):(x=this._tmpVect[20],f=this._tmpVect[21],h.scaleBy(g),j.scaleBy(u),x.addOf(k,h),x.scaleBy(0.5),f.addOf(p,j),f.scaleBy(0.5),m.addOf(x,f))}else l.copy(j[p]),l.normalize(),2<p?(0<l.dot(k)&&l.scaleBy(-1),m.copy(e.hsize),0>j[0].dot(l)&&(m.v[0]*=-1),0>j[1].dot(l)&&(m.v[1]*=-1),0>j[2].dot(l)&&(m.v[2]*=-1),m.addBy(e.center),m.v[3]=1,m.transform4(g)):(k.scaleBy(-1),0<l.dot(k)&&l.scaleBy(-1),m.copy(f.hsize),
0>j[3].dot(l)&&(m.v[0]*=-1),0>j[4].dot(l)&&(m.v[1]*=-1),0>j[5].dot(l)&&(m.v[2]*=-1),m.addBy(f.center),m.v[3]=1,m.transform4(h));this._addContact(a,b,m,l,c)}};
Ovoid.Solver.prototype._detectContacts=function(){this._contactq.empty();var a,b,c,e;for(c=this._i.Queuer.qphycs.count;c--;)for(e=this._i.Queuer.qphycs.count;e--;)if(e!=c&&!this._contactq.isFull()&&(a=this._i.Queuer.qphycs[c],b=this._i.Queuer.qphycs[e],this._canContact(a,b,0)&&!this._hasContact(a,b)))switch(a.model){case 2:switch(b.model){case 2:this._getContactS2S(a,b);break;case 0:a.cach&Ovoid.CACH_PHYSICS||this._getContactS2L(a,b);break;default:this._getContactB2S(b,a)}break;case 0:continue;default:switch(b.model){case 2:this._getContactB2S(a,
b);break;case 0:a.cach&Ovoid.CACH_PHYSICS||this._getContactB2L(a,b);break;default:this._getContactB2B(a,b)}}};
Ovoid.Solver.prototype._solveContactsHr=function(){var a=this._contactq.count*this._i.opt_physicsContactItFactor,b,c,e,f=new Ovoid.Vector,g;for(g=0;g<a;){b=0;for(c=e=this._contactq.count;c--;)if(this._contactq[c]._p>b)b=this._contactq[c]._p,e=c;if(e==this._contactq.count)break;e=this._contactq[e];e._adjustPositions(b);for(c=this._contactq.count;c--;)b=this._contactq[c],b._b[0]===e._b[0]?(f.crossOf(b._ar[0],b._rc[0]),f.addBy(b._ap[0]),b._p-=b._as[0]*f.dot(b._n)):b._b[0]===e._b[1]&&(f.crossOf(b._ar[1],
b._rc[0]),f.addBy(b._ap[1]),b._p-=b._as[1]*f.dot(b._n)),b._b[1]&&(b._b[1]===e._b[0]?(f.crossOf(b._ar[0],b._rc[1]),f.addBy(b._ap[0]),b._p+=b._as[0]*f.dot(b._n)):b._b[1]===e._b[1]&&(f.crossOf(b._ar[1],b._rc[1]),f.addBy(b._ap[1]),b._p+=b._as[1]*f.dot(b._n)));g++}for(g=0;g<a;){d=0;for(c=e=this._contactq.count;c--;)if(this._contactq[c]._d>d)d=this._contactq[c]._d,e=c;if(e==this._contactq.count)break;e=this._contactq[e];e._applyImpulses();for(c=this._contactq.count;c--;)b=this._contactq[c],b._b[0]&&(b._b[0]===
e._b[0]?(f.crossOf(b._ti[0],b._rc[0]),f.addBy(b._li[0]),f.transform3Inverse(b._matrix),b._v.addBy(f),b._solveDelta(this._i.Timer.quantum)):b._b[0]===e._b[1]&&(f.crossOf(b._ti[1],b._rc[0]),f.addBy(b._li[1]),f.transform3Inverse(b._matrix),b._v.addBy(f),b._solveDelta(this._i.Timer.quantum))),b._b[1]&&(b._b[1]==e._b[0]?(f.crossOf(b._ti[0],b._rc[1]),f.addBy(b._li[0]),f.transform3Inverse(b._matrix),b._v.subBy(f),b._solveDelta(this._i.Timer.quantum)):b._b[1]==e._b[1]&&(f.crossOf(b._ti[1],b._rc[1]),f.addBy(b._li[1]),
f.transform3Inverse(b._matrix),b._v.subBy(f),b._solveDelta(this._i.Timer.quantum)));g++}};Ovoid.Solver.prototype._solveContactsLr=function(){for(var a=this._contactq.count;a--;)this._contactq[a]._adjustPositions(this._contactq[a]._p),this._contactq[a]._applyImpulses()};Ovoid.Solver.prototype._solveQueue=function(){this._detectContacts();this._i.opt_physicsIterativeSolver?this._solveContactsHr():this._solveContactsLr()};Ovoid.Frame=function(a){this._i=a;this.mode=0;this.page=this.canvas=null;this.fixed=new Ovoid.Coord(0,0,0);this.position=new Ovoid.Coord(0,0,0);this.size=new Ovoid.Coord(0,0,0);this.scroll=new Ovoid.Coord(0,0,0);this.center=new Ovoid.Coord(0,0,0);this.matrix=new Ovoid.Matrix4;this.changed=!1;this._offsety=this._offsetx=0};
Ovoid.Frame.prototype._init=function(a){this.canvas=a;this.page=document.getElementsByTagName("BODY")[0];this.mode=this._i.opt_frameMode;switch(this.mode){case 0:this.fixed.set(this._i.opt_frameWidth,this._i.opt_frameHeight,0);break;case 1:this.fixed.set(this.canvas.clientWidth,this.canvas.clientHeight,0);break;case 3:this.fixed.set(this._i.opt_frameWidth,this._i.opt_frameHeight,0)}this.matrix.m[10]=1;this.matrix.m[3]=0;this.matrix.m[7]=0;this.matrix.m[11]=0;this.matrix.m[12]=-1;this.matrix.m[13]=
1;this.matrix.m[14]=0;this.matrix.m[15]=1;this._updatesize();this._offsetx+=document.body.parentNode.offsetLeft;this._offsetx+=parseInt(document.defaultView.getComputedStyle(a,null).paddingLeft,10)||0;this._offsetx+=parseInt(document.defaultView.getComputedStyle(a,null).borderLeftWidth,10)||0;this._offsety+=document.body.parentNode.offsetTop;this._offsety+=parseInt(document.defaultView.getComputedStyle(a,null).paddingTop,10)||0;this._offsety+=parseInt(document.defaultView.getComputedStyle(a,null).borderTopWidth,
10)||0;this._updatepos();Ovoid._log(3,this._i,".Frame._init"," done");return!0};Ovoid.Frame.prototype._update=function(){this.changed=!1};Ovoid.Frame.prototype.setMode=function(a){this.mode=a;(0==this.mode||0==this.mode)&&this.resize(this.fixed.v[0],this.fixed.v[1]);this._updatepos();this._updatesize();this.changed=!0};
Ovoid.Frame.prototype.resize=function(a,b){switch(this.mode){case 0:this.fixed.set(a,b,0);break;case 1:Ovoid._log(3,this._i,".Frame.resize"," resizing frame in FRAME_CLIENT_SIZE has no effect");break;case 3:this.fixed.set(a,b,0)}this._updatesize()};
Ovoid.Frame.prototype._updatepos=function(){this.position.set(0,0,0);for(var a=this.canvas;"BODY"!=a.tagName;)this.position.v[1]+=a.offsetTop,this.position.v[0]+=a.offsetLeft,a=a.offsetParent;this.position.v[1]+=this._offsety;this.position.v[0]+=this._offsetx;this.scroll.set(window.pageXOffset,window.pageYOffset,0);this.changed=!0};
Ovoid.Frame.prototype._updatesize=function(){switch(this.mode){case 0:this.canvas.width=this.fixed.v[0];this.canvas.height=this.fixed.v[1];break;case 1:this.canvas.width=this.canvas.clientWidth;this.canvas.height=this.canvas.clientHeight;break;case 3:var a=this.canvas.width,b=this.canvas.height;this.canvas.width=this.fixed.v[0];this.canvas.height=this.fixed.v[1];this.canvas.clientWidth=a;this.canvas.clientHeight=b}this.size.set(this.canvas.width,this.canvas.height,0);this.center.set(0.5*this.size.v[0],
0.5*this.size.v[1],0);this.matrix.m[0]=2/this.size.v[0];this.matrix.m[5]=2/-this.size.v[1];this.changed=!0};Ovoid.Frame.prototype._ffhack=function(){this.canvas.width=2;this.canvas.height=2;switch(this.mode){case 0:this.canvas.width=this.fixed.v[0];this.canvas.height=this.fixed.v[1];break;case 1:this.canvas.width=this.canvas.clientWidth;this.canvas.height=this.canvas.clientHeight;break;case 3:this.canvas.width=this.fixed.v[0],this.canvas.height=this.fixed.v[1]}};Ovoid.Queuer=function(a){this._i=a;this._wgit=new Ovoid.WgIterator;this.qsolid=Array(Ovoid.MAX_RENDER_LAYER);this.qalpha=Array(Ovoid.MAX_RENDER_LAYER);this.qtform=new Ovoid.Stack(Ovoid.MAX_BODY_BY_DRAW);this.qlight=new Ovoid.Stack(Ovoid.MAX_LIGHT_BY_DRAW);this.qlayer=new Ovoid.Stack(Ovoid.MAX_LAYER_BY_DRAW);this.qtext=new Ovoid.Stack(Ovoid.MAX_LAYER_BY_DRAW);this.qphycs=new Ovoid.Stack(Ovoid.MAX_BODY_BY_DRAW);this._rcamera=null;this._lastlwp=[0,0,0]};
Ovoid.Queuer.prototype._init=function(){for(var a=0;a<Ovoid.MAX_RENDER_LAYER;a++)this.qsolid[a]=new Ovoid.Stack(Ovoid.MAX_BODY_BY_DRAW),this.qalpha[a]=new Ovoid.Stack(Ovoid.MAX_BODY_BY_DRAW);Ovoid._log(3,this._i,".Queuer._init"," done");return!0};
Ovoid.Queuer.prototype._cachDependencies=function(a){for(var b=a.depend.length;b--;)a.depend[b].type&Ovoid.ACTION&&a.depend[b].cachAction(),a.depend[b].type&Ovoid.PHYSICS&&a.depend[b].cachPhysics(),a.depend[b].type&Ovoid.ANIMATION&&a.depend[b].cachAnimation(),a.depend[b].type&Ovoid.AIM&&a.depend[b].cachAim(),a.depend[b].type&Ovoid.EXPRESSION&&a.depend[b].cachExpression(),a.depend[b].type&Ovoid.MESH&&a.depend[b].cachMesh(),a.depend[b].type&Ovoid.SKIN&&a.depend[b].cachSkin(),a.depend[b].type&Ovoid.EMITTER&&
a.depend[b].cachEmitter(),a.depend[b].addCach(Ovoid.CACH_WORLD)};Ovoid.Queuer.prototype._lightcull=function(a,b){if(this._i.opt_sceneLightcull)for(var c=b.length;c--;)if(b[c].visible&&b[c].isLightening(a)&&!this.qlight.has(b[c]))b[c].rendered=!0,this.qlight.add(b[c])};
Ovoid.Queuer.prototype._viewcull=function(a){if(this._i.opt_sceneViewcull){if(this._rcamera.isWatching(a)&&(a.visibleRange>=a.distFromEye||0>=a.visibleRange)){a.rendered=!0;if(a.shape.type&Ovoid.EMITTER)a.distFromEye=Ovoid.FLOAT_MIN;if(a.shape&&a.shape.type&Ovoid.MESH)for(var b=a.shape._lod=0;b<Ovoid.MAX_MESH_LOD;b++)if(!(0>a.shape._lodt[b])&&a.distFromEye>=a.shape._lodt[b])a.shape._lod=b;a.renderAlpha?this.qalpha[a.renderLayer].add(a):this.qsolid[a.renderLayer].add(a);return!0}}else return a.rendered=
!0,a.distFromEye=a.shape.type&Ovoid.EMITTER?Ovoid.FLOAT_MIN:a.worldPosition.dist(this._rcamera.worldPosition)-a.boundingSphere.radius,a.renderAlpha?this.qalpha[a.renderLayer].add(a):this.qsolid[a.renderLayer].add(a),!0;return!1};Ovoid.Queuer.prototype._physicscull=function(a){a.visible&&3>a.model&&this.qphycs.add(a)};
Ovoid.Queuer.prototype._QSzParter=function(a,b,c){for(var e=a[b].distFromEye,b=b-1,c=c+1,f;;){do c--;while(a[c].distFromEye<e);do b++;while(a[b].distFromEye>e);if(b<c)f=a[b],a[b]=a[c],a[c]=f;else return c}};Ovoid.Queuer.prototype._QSzSort=function(a,b,c){if(b<c){var e=this._QSzParter(a,b,c);this._QSzSort(a,b,e);this._QSzSort(a,e+1,c)}};
Ovoid.Queuer.prototype._reset=function(){for(var a=0;a<Ovoid.MAX_RENDER_LAYER;a++)this.qsolid[a].empty(),this.qalpha[a].empty();this.qlayer.empty();this.qtext.empty();this.qlight.empty();this.qtform.empty();this.qphycs.empty()};
Ovoid.Queuer.prototype._queueScene=function(a){var b,c;this._rcamera=a.activeCamera;this._i.Frame.changed&&(3==this._i.Frame.mode?this._rcamera.setView(this._i.Frame.fixed.v[0],this._i.Frame.fixed.v[1]):this._rcamera.setView(this._i.Frame.size.v[0],this._i.Frame.size.v[1]),this._rcamera.cachCamera());this._cachDependencies(this._rcamera);if(this._i.al)this._i.al.listener.dopplerFactor=this._i.opt_audioDopplerFactor,c=this._rcamera.worldMatrix,this._i.al.listener.setPosition(c.m[12],c.m[13],c.m[14]),
this._i.al.listener.setOrientation(-c.m[8],-c.m[9],-c.m[10],c.m[4],c.m[5],c.m[6]),this._i.al.listener.setVelocity(c.m[12]-this._lastlwp[0],c.m[13]-this._lastlwp[1],c.m[14]-this._lastlwp[2]),this._lastlwp[0]=c.m[12],this._lastlwp[1]=c.m[13],this._lastlwp[2]=c.m[14];for(c=a.action.length;c--;)a.action[c].unCach(Ovoid.CACH_ACTION);for(c=a.expression.length;c--;)a.expression[c].unCach(Ovoid.CACH_EXPRESSION);for(c=a.material.length;c--;)this._cachDependencies(a.material[c]);for(this._wgit.init(a.world);this._wgit.explore();)b=
this._wgit.current,this._cachDependencies(b),b.rendered=!1,b.visible&&b.type&Ovoid.TRANSFORM&&(b.cachTransform(),this._i.opt_renderDrawHelpers&&this.qtform.add(b),b.type&Ovoid.BODY&&b.shape&&(b.cachBody(),this._viewcull(b)&&this._lightcull(b,a.light)),b.type&Ovoid.JOINT?b.skin&&b.cachJoint():b.type&Ovoid.SOUND?b.audio&&b.cachSound():b.type&Ovoid.CAMERA?(this._i.Frame.changed&&b.setView(this._i.Frame.size.v[0],this._i.Frame.size.v[1]),b.cachCamera()):b.type&Ovoid.LIGHT&&b.cachLight());if(this._i.opt_sceneIntersectDetect){var e,
f,g=new Ovoid.Stack(Ovoid.MAX_BODY_INTERSECT);for(c=a.transform.length;c--;)if(e=a.transform[c],e.intersectable){b=a.transform.length;for(g.empty();b--;)f=a.transform[b],b!=c&&f.intersectable&&e.boundingSphere.worldCenter.dist(f.boundingSphere.worldCenter)<=e.boundingSphere.radius+f.boundingSphere.radius&&g.add(f);e.enter.empty();e.leave.empty();for(b=g.count;b--;)e.intersect.has(g[b])||e.enter.add(g[b]);for(b=e.intersect.count;b--;)g.has(e.intersect[b])||e.leave.add(e.intersect[b]);e.intersect.empty();
for(b=g.count;b--;)e.intersect.add(g[b])}}for(c=a.physics.length;c--;)this._physicscull(a.physics[c]);for(c=a.track.length;c--;)a.track[c].cachTrack();for(c=0;c<Ovoid.MAX_RENDER_LAYER;c++)1<this.qalpha[c].count&&this._QSzSort(this.qalpha[c],0,this.qalpha[c].count-1);if(!this._i.opt_sceneLightcull)for(c=a.light.length;c--;)if(a.light[c].visible&&!this.qlight.has(a.light[c]))a.light[c].rendered=!0,this.qlight.add(a.light[c]);c=0;for(this._wgit.init(a.overlay);this._wgit.explore();)if(b=this._wgit.current,
this._cachDependencies(b),b.visible)if(b.cachTransform(),b.cachLayer(),b.type&Ovoid.TEXT)this.qtext.add(b);else{if(0==this._i.opt_renderPickingMode&&b.isPointOver(this._i.Input.mousePosition))c=b.uid;this.qlayer.add(b)}if(0==this._i.opt_renderPickingMode)c==this._i.Input.mouseOverUid?this._i.Input.mouseEnterUid=this._i.Input.mouseLeaveUid=0:(this._i.Input.mouseLeaveUid=this._i.Input.mouseOverUid,this._i.Input.mouseEnterUid=this._i.Input.mouseOverUid=c)};Ovoid.Drawer=function(a){this._i=a;this.glInfo={};this._renderpasses=this._drawnshadow=this._drawnparticle=this._drawnchar=this._drawnsymbolic=this._drawnsprite=this._drawndynamic=this._drawnpolyset=0;this._tcolor=Ovoid.Color.newArray(12);this._tcolor[0].set(1,1,1,1);this._tcolor[1].set(0,0,0,1);this._tcolor[2].set(0.5,0.5,0.5,1);this._tcolor[3].set(1,0,0,1);this._tcolor[4].set(1,0.5,0,1);this._tcolor[5].set(1,1,0,1);this._tcolor[6].set(0.5,1,0.5,1);this._tcolor[7].set(0,1,0,1);this._tcolor[8].set(0.3,
0.6,1,1);this._tcolor[9].set(0,0,1,1);this._tcolor[10].set(0.5,0,1,1);this._tcolor[11].set(1,0,1,1);this._fbrpixel=this._bdynamic=this._bprimitive=this._tfontm=this._tblank=this._mblank=null;this._splib=[];this._sppipe=Array(Ovoid.MAX_RENDER_LAYER);this.sp=null;this._swpipe=Array(2);this._swlayer=Array(2);this._swshader=Array(2);this._swblend=Array(2);this._swdepth=Array(2);this._abcolor=new Float32Array(4);this._fogcolor=new Float32Array(4);this._rpcolor=new Uint8Array(256);this._rpdepth=new Float32Array(1);
this._dV=new Float32Array(12E5);this._lp=new Float32Array(4*Ovoid.MAX_LIGHT_BY_DRAW);this._ld=new Float32Array(3*Ovoid.MAX_LIGHT_BY_DRAW);this._lc=new Float32Array(4*Ovoid.MAX_LIGHT_BY_DRAW);this._li=new Float32Array(Ovoid.MAX_LIGHT_BY_DRAW);this._lr=new Float32Array(Ovoid.MAX_LIGHT_BY_DRAW);this._lf=new Float32Array(Ovoid.MAX_LIGHT_BY_DRAW);this._la=new Float32Array(Ovoid.MAX_LIGHT_BY_DRAW);this._le=new Int32Array(Ovoid.MAX_LIGHT_BY_DRAW);this._tM=new Float32Array(16);this._tMi=new Float32Array(16);
this._lop=2;this._pipeLp=this._lopfps=0;this._pipe1p=1;this.gl=null};
Ovoid.Drawer.prototype._init=function(){this.gl=this._i.gl;var a;this._i._clearGlerror();var b=(new Date).getTime();this.glInfo.VENDOR=this.gl.getParameter(this.gl.VENDOR);Ovoid._log(3,this._i,".Drawer._init"," VENDOR : "+this.glInfo.VENDOR);this.glInfo.VERSION=this.gl.getParameter(this.gl.VERSION);Ovoid._log(3,this._i,".Drawer._init"," VERSION : "+this.glInfo.VERSION);this.glInfo.SHADING_LANGUAGE_VERSION=this.gl.getParameter(this.gl.SHADING_LANGUAGE_VERSION);Ovoid._log(3,this._i,".Drawer._init",
" SHADING_LANGUAGE_VERSION : "+this.glInfo.SHADING_LANGUAGE_VERSION);this.glInfo.MAX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_TEXTURE_IMAGE_UNITS);Ovoid._log(3,this._i,".Drawer._init"," MAX_TEXTURE_IMAGE_UNITS : "+this.glInfo.MAX_TEXTURE_IMAGE_UNITS);this.glInfo.MAX_COMBINED_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_COMBINED_TEXTURE_IMAGE_UNITS);Ovoid._log(3,this._i,".Drawer._init"," MAX_COMBINED_TEXTURE_IMAGE_UNITS : "+this.glInfo.MAX_COMBINED_TEXTURE_IMAGE_UNITS);this.glInfo.MAX_VARYING_VECTORS=
this.gl.getParameter(this.gl.MAX_VARYING_VECTORS);Ovoid._log(3,this._i,".Drawer._init"," MAX_VARYING_VECTORS : "+this.glInfo.MAX_VARYING_VECTORS);this.glInfo.MAX_VERTEX_ATTRIBS=this.gl.getParameter(this.gl.MAX_VERTEX_ATTRIBS);Ovoid._log(3,this._i,".Drawer._init"," MAX_VERTEX_ATTRIBS : "+this.glInfo.MAX_VERTEX_ATTRIBS);this.glInfo.MAX_VERTEX_UNIFORM_VECTORS=this.gl.getParameter(this.gl.MAX_VERTEX_UNIFORM_VECTORS);Ovoid._log(3,this._i,".Drawer._init"," MAX_VERTEX_UNIFORM_VECTORS : "+this.glInfo.MAX_VERTEX_UNIFORM_VECTORS);
this.glInfo.MAX_FRAGMENT_UNIFORM_VECTORS=this.gl.getParameter(this.gl.MAX_FRAGMENT_UNIFORM_VECTORS);Ovoid._log(3,this._i,".Drawer._init"," MAX_FRAGMENT_UNIFORM_VECTORS : "+this.glInfo.MAX_FRAGMENT_UNIFORM_VECTORS);this.glInfo.MAX_VERTEX_TEXTURE_IMAGE_UNITS=this.gl.getParameter(this.gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS);Ovoid._log(3,this._i,".Drawer._init"," MAX_VERTEX_TEXTURE_IMAGE_UNITS : "+this.glInfo.MAX_VERTEX_TEXTURE_IMAGE_UNITS);this.gl.pixelStorei(this.gl.UNPACK_FLIP_Y_WEBGL,!0);this._tblank=
new Ovoid.Texture("Drawer.blank_texture",this._i);var c=new Uint8Array(256);for(a=0;256>a;a++)c[a]=255;if(!this._tblank.create2dFromRaw(this.gl.RGBA,8,8,c))return!1;a=Ovoid.genFontmap(256,16,7,"firefox"==Ovoid._curBrower?9:8,Ovoid.DEFAULT_FONT_MAP);this._tfontm=new Ovoid.Texture("Drawer.defaut_fontmap",this._i);if(!this._tfontm.create2dFromImg(this.gl.RGBA,a))return!1;this._mblank=new Ovoid.Material("blank",this._i);this._bprimitive=Array(6);c=[0,0,0,1,0,1,0,0,1,0,1,0,0,0,1,1,0,1,1,0,0,0,0,0,1,0,
1,0,1,1,0,1,1,0,0,1,0,0,1,1,1,0];this._bprimitive[0]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[0]);this.gl.bufferData(34962,new Float32Array(c),35044);c=[-0.5,-0.5,0,0,0,1,0,-0.5,0.5,0,0,0,0,0,0.5,-0.5,0,0,1,1,0,0.5,0.5,0,0,1,0,0];this._bprimitive[6]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[6]);this.gl.bufferData(34962,new Float32Array(c),35044);c=[0.5,0.5,0.5,1,1,1,1,1,-0.5,0.5,0.5,1,1,1,1,1,-0.5,0.5,0.5,1,1,1,1,1,-0.5,0.5,-0.5,1,1,1,1,1,0.5,0.5,-0.5,
1,1,1,1,1,-0.5,0.5,-0.5,1,1,1,1,1,0.5,0.5,0.5,1,1,1,1,1,0.5,0.5,-0.5,1,1,1,1,1,0.5,-0.5,0.5,1,1,1,1,1,-0.5,-0.5,0.5,1,1,1,1,1,-0.5,-0.5,0.5,1,1,1,1,1,-0.5,-0.5,-0.5,1,1,1,1,1,0.5,-0.5,-0.5,1,1,1,1,1,-0.5,-0.5,-0.5,1,1,1,1,1,0.5,-0.5,0.5,1,1,1,1,1,0.5,-0.5,-0.5,1,1,1,1,1,0.5,0.5,0.5,1,1,1,1,1,0.5,-0.5,0.5,1,1,1,1,1,-0.5,0.5,0.5,1,1,1,1,1,-0.5,-0.5,0.5,1,1,1,1,1,0.5,0.5,-0.5,1,1,1,1,1,0.5,-0.5,-0.5,1,1,1,1,1,-0.5,0.5,-0.5,1,1,1,1,1,-0.5,-0.5,-0.5,1,1,1,1,1];this._bprimitive[1]=this.gl.createBuffer();
this.gl.bindBuffer(34962,this._bprimitive[1]);this.gl.bufferData(34962,new Float32Array(c),35044);var c=Ovoid.Vertex.newArray(144),e,f,g,h,k,j,m,l=0;for(a=0;48>a;a+=2)e=Math.sin(Ovoid._2PI*(l/24)),f=Math.cos(Ovoid._2PI*(l/24)),g=Math.sin(Ovoid._2PI*((l+1)/24)),h=Math.cos(Ovoid._2PI*((l+1)/24)),k=a,j=k+48,m=j+48,c[k].p.set(f,0,e,1),c[k+1].p.set(h,0,g,1),c[j].p.set(f,e,0,1),c[j+1].p.set(h,g,0,1),c[m].p.set(0,f,e,1),c[m+1].p.set(0,h,g,1),c[k].c.set(1,1,1,1),c[k+1].c.set(1,1,1,1),c[j].c.set(1,1,1,1),
c[j+1].c.set(1,1,1,1),c[m].c.set(1,1,1,1),c[m+1].c.set(1,1,1,1),l++;this._bprimitive[2]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[2]);this.gl.bufferData(34962,Ovoid.Vertex.bufferize(Ovoid.VERTEX_VEC4_P|Ovoid.VERTEX_VEC4_C,c),35044);c=[0,0,0,1,1,0,0,1,0.25,0,0,1,1,0,0,1,0,0,0,1,0,1,0,1,0,0.25,0,1,0,1,0,1,0,0,0,1,0,0,1,1,0,0,0.25,1,0,0,1,1];this._bprimitive[3]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[3]);this.gl.bufferData(34962,new Float32Array(c),35044);
c=[0,0,0,1,1,1,1,1,0.5,0.5,-1,1,1,1,1,1,0,0,0,1,1,1,1,1,-0.5,0.5,-1,1,1,1,1,1,0,0,0,1,1,1,1,1,-0.5,-0.5,-1,1,1,1,1,1,0,0,0,1,1,1,1,1,0.5,-0.5,-1,1,1,1,1,1,0.5,0.5,-1,1,1,1,1,1,-0.5,0.5,-1,1,1,1,1,1,-0.5,0.5,-1,1,1,1,1,1,-0.5,-0.5,-1,1,1,1,1,1,-0.5,-0.5,-1,1,1,1,1,1,0.5,-0.5,-1,1,1,1,1,1,0.5,-0.5,-1,1,1,1,1,1,0.5,0.5,-1,1,1,1,1,1];this._bprimitive[4]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[4]);this.gl.bufferData(34962,new Float32Array(c),35044);c=[0.25,0,0,1,1,1,1,1,-0.25,
0,0,1,1,1,1,1,0,0.25,0,1,1,1,1,1,0,-0.25,0,1,1,1,1,1,0,0,0.25,1,1,1,1,1,0,0,-1,1,1,1,1,1,0.125,0.125,0.125,1,1,1,1,1,-0.125,-0.125,-0.125,1,1,1,1,1,-0.125,0.125,0.125,1,1,1,1,1,0.125,-0.125,-0.125,1,1,1,1,1];this._bprimitive[5]=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bprimitive[5]);this.gl.bufferData(34962,new Float32Array(c),35044);if(this._i._logGlerror(".Drawer._init:: Primitive buffer creation"))return!1;this._bdynamic=this.gl.createBuffer();this.gl.bindBuffer(34962,this._bdynamic);
this.gl.bufferData(34962,48E5,35048);if(this._i._logGlerror(".Drawer._init:: Dynamic buffer creation"))return!1;this.gl.bindBuffer(34962,null);this.gl.bindBuffer(34963,null);a=Ovoid.PICKING_OFFSCREEN_FRAME_X;c=Ovoid.PICKING_OFFSCREEN_FRAME_Y;e=this.gl.createTexture();this.gl.bindTexture(3553,e);this.gl.texImage2D(3553,0,6408,a,c,0,6408,5121,null);this.gl.bindTexture(3553,null);f=this.gl.createRenderbuffer();this.gl.bindRenderbuffer(36161,f);this.gl.renderbufferStorage(36161,33189,a,c);this.gl.bindRenderbuffer(36161,
null);this._fbrpixel=this.gl.createFramebuffer();this.gl.bindFramebuffer(36160,this._fbrpixel);this.gl.framebufferTexture2D(36160,36064,3553,e,0);this.gl.framebufferRenderbuffer(36160,36096,36161,f);this.gl.bindFramebuffer(36160,null);if(this._i._logGlerror(".Drawer._init:: RP Frame buffer creation"))return!1;for(a=0;a<Ovoid.MAX_RENDER_LAYER;a++)this._sppipe[a]=[];a=new Ovoid.Shader("PIPE_L2_GEOMETRY_LP",this._i);if(!a.setSources(Ovoid.GLSL_PNUIW_HYBRID_VS,Ovoid.GLSL_AERDS_FULLTEX_LP_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,
this._i,".Drawer._init"," error wrapping default PIPE_L2_GEOMETRY_LP pipeline shader program."),!1;this.plugShader(this.addShader(a),0,-1);a=new Ovoid.Shader("PIPE_L2_GEOMETRY_1P",this._i);if(!a.setSources(Ovoid.GLSL_PNUIW_HYBRID_VS,Ovoid.GLSL_AERDS_FULLTEX_1P_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_L2_GEOMETRY_1P pipeline shader program."),!1;this.plugShader(this.addShader(a),1,-1);a=new Ovoid.Shader("PIPE_L1_GEOMETRY_LP",this._i);if(!a.setSources(Ovoid.GLSL_VL_PNUIW_HYBRID_LP_VS,
Ovoid.GLSL_VL_AERDS_FULLTEX_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_L1_GEOMETRY_LP pipeline shader program."),!1;this.plugShader(this.addShader(a),10,-1);a=new Ovoid.Shader("PIPE_L1_GEOMETRY_1P",this._i);if(!a.setSources(Ovoid.GLSL_VL_PNUIW_HYBRID_1P_VS,Ovoid.GLSL_VL_AERDS_FULLTEX_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_L1_GEOMETRY_1P pipeline shader program."),!1;this.plugShader(this.addShader(a),
11,-1);a=new Ovoid.Shader("PIPE_L0_GEOMETRY_LP",this._i);if(!a.setSources(Ovoid.GLSL_VL_PNUIW_HYBRID_LP_VS,Ovoid.GLSL_VL_ADS_1TEX_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_L0_GEOMETRY_LP pipeline shader program."),!1;this.plugShader(this.addShader(a),13,-1);a=new Ovoid.Shader("PIPE_L0_GEOMETRY_1P",this._i);if(!a.setSources(Ovoid.GLSL_VL_PNUIW_HYBRID_1P_VS,Ovoid.GLSL_VL_ADS_1TEX_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init",
" error wrapping default PIPE_L0_GEOMETRY_1P pipeline shader program."),!1;this.plugShader(this.addShader(a),14,-1);a=new Ovoid.Shader("PIPE_PARTICLE",this._i);if(!a.setSources(Ovoid.GLSL_PUC_PARTICLE_VS,Ovoid.GLSL_VC_TEX_PARTICLE_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_PARTICLE pipeline shader program."),!1;this.plugShader(this.addShader(a),2,-1);a=new Ovoid.Shader("PIPE_LAYER",this._i);if(!a.setSources(Ovoid.GLSL_PU_VS,Ovoid.GLSL_C_TEX_FS,
Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_LAYER pipeline shader program."),!1;this.plugShader(this.addShader(a),3,-1);a=new Ovoid.Shader("PIPE_STRING",this._i);if(!a.setSources(Ovoid.GLSL_P_ZWSTRING_VS,Ovoid.GLSL_C_TEX_STRING_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_STRING pipeline shader program."),!1;this.plugShader(this.addShader(a),4,-1);a=new Ovoid.Shader("PIPE_HELPER",this._i);if(!a.setSources(Ovoid.GLSL_PC_VS,
Ovoid.GLSL_VCC_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_HELPER pipeline shader program."),!1;this.plugShader(this.addShader(a),5,-1);a=new Ovoid.Shader("PIPE_SHADOW_VOLUME",this._i);if(!a.setSources(Ovoid.GLSL_P_VS,Ovoid.GLSL_BLACK_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_SHADOW_VOLUME pipeline shader program."),!1;this.plugShader(this.addShader(a),6,-1);a=new Ovoid.Shader("PIPE_BILLBOARD",
this._i);if(!a.setSources(Ovoid.GLSL_PU_BILLBOARD_VS,Ovoid.GLSL_C_TEX_BILLBOARD_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_BILLBOARD pipeline shader program."),!1;this.plugShader(this.addShader(a),7,-1);a=new Ovoid.Shader("PIPE_FOG_LP",this._i);if(!a.setSources(Ovoid.GLSL_PIW_HYBRID_VS,Ovoid.GLSL_FOG_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_FOG_LP pipeline shader program."),!1;this.plugShader(this.addShader(a),
8,-1);a=new Ovoid.Shader("PIPE_RP_GEOMETRY",this._i);if(!a.setSources(Ovoid.GLSL_PIW_HYBRID_VS,Ovoid.GLSL_C_ADEPTH_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_RP_GEOMETRY pipeline shader program."),!1;this.plugShader(this.addShader(a),20,-1);a=new Ovoid.Shader("PIPE_RP_PARTICLE",this._i);if(!a.setSources(Ovoid.GLSL_PU_PARTICLE_VS,Ovoid.GLSL_C_ADEPTH_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_RP_PARTICLE pipeline shader program."),
!1;this.plugShader(this.addShader(a),22,-1);a=new Ovoid.Shader("PIPE_RP_LAYER",this._i);if(!a.setSources(Ovoid.GLSL_P_VS,Ovoid.GLSL_C_ADEPTH_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_RP_LAYER pipeline shader program."),!1;this.plugShader(this.addShader(a),23,-1);a=new Ovoid.Shader("PIPE_RP_STRING",this._i);if(!a.setSources(Ovoid.GLSL_P_ZSTRING_VS,Ovoid.GLSL_C_ADEPTH_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_RP_STRING pipeline shader program."),
!1;this.plugShader(this.addShader(a),24,-1);a=new Ovoid.Shader("PIPE_RP_BILLBOARD",this._i);if(!a.setSources(Ovoid.GLSL_PU_BILLBOARD_VS,Ovoid.GLSL_C_ADEPTH_FS,Ovoid.GLSL_WRAPMAP))return Ovoid._log(1,this._i,".Drawer._init"," error wrapping default PIPE_RP_BILLBOARD pipeline shader program."),!1;this.plugShader(this.addShader(a),27,-1);if(this._i._logGlerror(".Drawer._init:: Shader program creation."))return!1;this.gl.viewport(0,0,this._i.Frame.canvas.width,this._i.Frame.canvas.height);this.gl.clear(16640);
this.gl.enable(3042);this.gl.blendFunc(770,771);this.gl.lineWidth(1);this.gl.disable(2884);this.gl.cullFace(1029);this.gl.depthMask(1);this.gl.enable(2929);this.gl.depthFunc(513);this.gl.disable(2960);if(this._i._logGlerror("Drawer._init:: Default settings"))return!1;Ovoid._log(3,this._i,".Drawer._init"," done in: "+0.001*((new Date).getTime()-b)+"s");return!0};
Ovoid.Drawer.prototype.addShader=function(a){if(!a.linkStatus)return Ovoid._log(2,this._i,".Drawer.addShader"," adding shader '"+a.name+"' fail, shader is not linked"),-1;var b=this._splib.length;this._splib.push(a);Ovoid._log(3,this._i,".Drawer.addShader"," adding shader '"+a.name+"' in stock with id:"+b);return b};
Ovoid.Drawer.prototype.plugShader=function(a,b,c){if(c>Ovoid.MAX_RENDER_LAYER)return Ovoid._log(2,this._i,".Drawer.plugShader"," invalid layer index"),!1;if("number"==typeof a){if(!this._splib[a])return Ovoid._log(2,this._i,".Drawer.plugShader"," no such shader with id "+a),!1}else if("string"==typeof a){for(var e=-1,f=0;f<this._splib.length;f++)if(this._splib[f].name==a){e=f;break}if(0>e)return Ovoid._log(2,this._i,".Drawer.plugShader"," no such shader with name "+a),!1;a=e}if(-1==c){Ovoid._log(3,
this._i,".Drawer.plugShader"," plug shader "+a+" to pipe "+b+" for all layers");for(f=0;f<Ovoid.MAX_RENDER_LAYER;f++)this._sppipe[f][b]=a}else Ovoid._log(3,this._i,".Drawer.plugShader"," plug shader "+a+" to pipe "+b+" for layer "+c),this._sppipe[c][b]=a;return!0};Ovoid.Drawer.prototype.switchSp=function(a){this._swshader[0]=this._swshader[1];this._swshader[1]=a;this.sp=this._splib[a];this.sp.use()};Ovoid.Drawer.prototype.restorSp=function(){this.switchSp(this._swshader[0])};
Ovoid.Drawer.prototype.switchPipe=function(a,b){this._swpipe[0]=this._swpipe[1];this._swpipe[1]=a;this._swlayer[0]=this._swlayer[1];this._swlayer[1]=b;this.sp=this._splib[this._sppipe[b][a]];this.sp.use()};Ovoid.Drawer.prototype.restorePipe=function(){this.switchPipe(this._swpipe[0],this._swlayer[0])};
Ovoid.Drawer.prototype.switchBlend=function(a){this._swblend[0]=this._swblend[1];this._swblend[1]=a;switch(a){case 0:this.gl.disable(3042);break;case 1:this.gl.enable(3042);this.gl.blendFunc(770,1);break;case 2:this.gl.enable(3042);this.gl.blendFunc(1,1);break;default:this.gl.enable(3042),this.gl.blendFunc(770,771)}};Ovoid.Drawer.prototype.restoreBlend=function(){this.switchBlend(this._swblend[0])};
Ovoid.Drawer.prototype.switchDepth=function(a){this._swdepth[0]=this._swdepth[1];this._swdepth[1]=a;switch(a){case 0:this.gl.depthMask(0);this.gl.disable(2929);break;case 1:this.gl.depthMask(1);this.gl.enable(2929);this.gl.depthFunc(513);break;case 2:this.gl.depthMask(0);this.gl.enable(2929);this.gl.depthFunc(513);break;case 4:this.gl.depthMask(0);this.gl.enable(2929);this.gl.depthFunc(514);break;default:this.gl.depthMask(0),this.gl.enable(2929),this.gl.depthFunc(515)}};
Ovoid.Drawer.prototype.restoreDepth=function(){this.switchDepth(this._swdepth[0])};Ovoid.Drawer.prototype.setCull=function(a){switch(a){case 0:this.gl.disable(2884);break;case 2:this.gl.enable(2884);this.gl.cullFace(1028);break;default:this.gl.enable(2884),this.gl.cullFace(1029)}};
Ovoid.Drawer.prototype.beginDraw=function(){this._pc=(new Date).getTime();this._i.Frame.changed&&this.gl.viewport(0,0,this._i.Frame.canvas.width,this._i.Frame.canvas.height);var a;a=this._i.opt_renderAmbientColor;this._abcolor[0]=a[0];this._abcolor[1]=a[1];this._abcolor[2]=a[2];this._abcolor[3]=a[3];if(0<this._i.opt_renderFogDensity)a=this._i.opt_renderFogColor,this._fogcolor[0]=a[0],this._fogcolor[1]=a[1],this._fogcolor[2]=a[2],this._fogcolor[3]=a[3];a=this._i.opt_renderClearColor;this.gl.clearColor(a[0],
a[1],a[2],a[3]);this.gl.depthMask(1);this.gl.clear(16640);this._drawnshadow=this._drawnchar=this._drawnsymbolic=this._drawnsprite=this._drawndynamic=this._renderpasses=this._drawnparticle=this._drawnpolyset=0;if(this._i.opt_renderAdaptLop){this._lopfps=this._i.Timer.framerate;a=this._i.opt_renderAdaptLopThreshold;var b=this._i.opt_renderLopLevel;if(this._lopfps<a)this._lop--,this._lopfps=a;58<=this._lopfps&&this._lop++;if(this._lop>b)this._lop=b;if(0>this._lop)this._lop=0}else this._lop=b;switch(this._lop){case 0:this._pipeLp=
13;this._pipe1p=14;break;case 1:this._pipeLp=10;this._pipe1p=11;break;default:this._pipeLp=0,this._pipe1p=1}};Ovoid.Drawer.prototype.endDraw=function(){this.gl.flush()};Ovoid.Drawer.prototype.beginRpDraw=function(){this.gl.bindFramebuffer(36160,this._fbrpixel);this.gl.clearColor(0,0,0,1);this.gl.clear(16640)};
Ovoid.Drawer.prototype.endRpDraw=function(){this.gl.readPixels(this._i.Input.mousePosition.v[0],this._i.Frame.size.v[1]-this._i.Input.mousePosition.v[1],1,1,6408,5121,this._rpcolor);this.gl.bindFramebuffer(36160,null);this._i.Input.mouseLeaveUid=this._i.Input.mouseOverUid;this._i.Input.mouseOverUid=0|this._rpcolor[0]<<16|this._rpcolor[1]<<8|this._rpcolor[2];this._rpdepth[0]=this._rpcolor[3]/255;this._i.Queuer._rcamera.unproject(this._i.Input.mousePosition.v[0],this._i.Frame.size.v[1]-this._i.Input.mousePosition.v[1],
this._rpdepth[0],this._i.Input.mouseCursor);this._i.Input.mouseEnterUid=this._i.Input.mouseLeaveUid!=this._i.Input.mouseOverUid?this._i.Input.mouseOverUid:this._i.Input.mouseLeaveUid=0};
Ovoid.Drawer.prototype.light=function(a){if(a.count){for(var b=0;b<Ovoid.MAX_LIGHT_BY_DRAW;b++)b<a.count?(this._lp.set(a[b].worldPosition.v,4*b),this._ld.set(a[b].worldDirection.v,3*b),this._lc.set(a[b].color.v,4*b),this._li[b]=a[b].intensity,this._lr[b]=a[b].range,this._lf[b]=a[b].falloff,this._la[b]=a[b].spotAngle,this._le[b]=1):this._le[b]=0;this.sp.setUniform4fv(20,this._lp);this.sp.setUniform3fv(21,this._ld);this.sp.setUniform4fv(22,this._lc);this.sp.setUniform1fv(23,this._li);this.sp.setUniform1fv(24,
this._lr);this.sp.setUniform1fv(25,this._lf);this.sp.setUniform1fv(26,this._la);this.sp.setUniform1iv(28,this._le)}else a.type&&(this.sp.setUniform4fv(20,a.worldPosition.v),this.sp.setUniform3fv(21,a.worldDirection.v),this.sp.setUniform4fv(22,a.color.v),this.sp.setUniform1f(23,a.intensity),this.sp.setUniform1f(24,a.range),this.sp.setUniform1f(25,a.falloff),this.sp.setUniform1f(26,a.spotAngle))};
Ovoid.Drawer.prototype.ambient=function(){this.sp.setUniform4fv(40,this._abcolor);0<this._i.opt_renderFogDensity&&(this.sp.setUniform4fv(44,this._fogcolor),this.sp.setUniform1f(45,this._i.opt_renderFogDensity))};Ovoid.Drawer.prototype.persp=function(a){this.sp.setUniformMatrix4fv(3,a.eyeview.m);this.sp.setUniformMatrix4fv(4,a.perspective.m);this.sp.setUniformMatrix4fv(5,a.lookat.m);this.sp.setUniform4fv(30,a.worldPosition.v)};
Ovoid.Drawer.prototype.ortho=function(a){this.sp.setUniformMatrix4fv(3,a.orthographic.m)};Ovoid.Drawer.prototype.screen=function(a){this.sp.setUniformMatrix4fv(3,a.m)};Ovoid.Drawer.prototype.model=function(a,b){this.sp.setUniformMatrix4fv(0,a);b&&this.sp.setUniformMatrix3fv(1,b)};Ovoid.Drawer.prototype.enable=function(a){this.sp.setUniform1i(a,1)};Ovoid.Drawer.prototype.disable=function(a){this.sp.setUniform1i(a,0)};
Ovoid.Drawer.prototype.sprite=function(){this.gl.bindBuffer(34962,this._bprimitive[0]);this.sp.setVertexAttribPointers(5,28);this.gl.drawArrays(4,0,6);this._drawnsprite++};Ovoid.Drawer.prototype.symBox=function(a){this.sp.setUniform4fv(9,a.v);this.gl.bindBuffer(34962,this._bprimitive[1]);this.sp.setVertexAttribPointers(33,32);this.gl.drawArrays(1,0,24);this._drawnsymbolic++};
Ovoid.Drawer.prototype.symSphere=function(a){this.sp.setUniform4fv(9,a.v);this.gl.bindBuffer(34962,this._bprimitive[2]);this.sp.setVertexAttribPointers(33,32);this.gl.drawArrays(1,0,144);this._drawnsymbolic++};Ovoid.Drawer.prototype.symAxis=function(a){this.sp.setUniform4fv(9,a.v);this.gl.bindBuffer(34962,this._bprimitive[3]);this.sp.setVertexAttribPointers(33,32);this.gl.drawArrays(1,0,6);this._drawnsymbolic++};
Ovoid.Drawer.prototype.symPyramid=function(a){this.sp.setUniform4fv(9,a.v);this.gl.bindBuffer(34962,this._bprimitive[4]);this.sp.setVertexAttribPointers(33,32);this.gl.drawArrays(1,0,16);this._drawnsymbolic++};Ovoid.Drawer.prototype.symStar=function(a){this.sp.setUniform4fv(9,a.v);this.gl.bindBuffer(34962,this._bprimitive[5]);this.sp.setVertexAttribPointers(33,32);this.gl.drawArrays(1,0,10);this._drawnsymbolic++};
Ovoid.Drawer.prototype.string=function(a,b,c,e){for(var f=this._dV,g=0,h,k=0,j=0,a=c*a,m=c*b,l=0;l<e.length;l++)b=h,h=e.charCodeAt(l),10==h?(j++,k=0):9==h?k+=4:194==h||195==h||(195==b&&(h+=64),f[g]=a+k*a,f[g+1]=0.5*m+j*m,f[g+2]=c,f[g+3]=h-32,g+=4,k++);this.gl.bindBuffer(34962,this._bdynamic);this.gl.bufferSubData(34962,0,f.subarray(0,g));this.sp.setVertexAttribPointers(1,16);this.gl.drawArrays(0,0,g/4);this._drawnchar+=g/4};
Ovoid.Drawer.prototype.raw=function(a,b,c,e,f){this.gl.bindBuffer(34962,this._bdynamic);this.gl.bufferSubData(34962,0,f);this.sp.setVertexAttribPointers(a,b);this.gl.drawArrays(c,0,e);this._drawndynamic++};Ovoid.Drawer.prototype.layer=function(a,b){this.gl.activeTexture(33985);b?(this.sp.setUniform4fv(9,b.v),this._tblank.bind()):(this.sp.setUniform4fv(9,a.bgColor.v),a.bgTexture?a.bgTexture.bind():this._tblank.bind());this.sp.setUniformSampler(1,1);this.sprite()};
Ovoid.Drawer.prototype.text=function(a,b){this.gl.activeTexture(33985);b?(this.sp.setUniform4fv(9,b.v),this._tblank.bind()):(this.sp.setUniform4fv(9,a.fgColor.v),a.fontmap?a.fontmap.bind():this._tfontm.bind());this.sp.setUniformSampler(1,1);this.string(a.param.v[1],a.param.v[2],a.param.v[0],a.string)};
Ovoid.Drawer.prototype.mesh=function(a,b,c){var e,f,g,h;e=a._lod;this.gl.bindBuffer(34962,a._vbuffer[e]);this.gl.bindBuffer(34963,a._ibuffer[e]);this.sp.setVertexAttribPointers(a._vformat,a._vfbytes);f=a.polyset[e].length;if(b)for(this.sp.setUniform4fv(9,b.v);f--;)g=a.polyset[e][f],this.gl.drawElements(g.mode,g.icount,5123,g.ioffset),this._drawnpolyset++;else for(;f--;){g=a.polyset[e][f];g.material?h=g.material:h=this._mblank;this.sp.setUniform4fv(10,h.color[0].v);this.sp.setUniform4fv(11,h.color[1].v);
this.sp.setUniform4fv(12,h.color[2].v);this.sp.setUniform4fv(13,h.color[3].v);this.sp.setUniform4fv(14,h.color[4].v);this.sp.setUniform1f(15,h.shininess);this.sp.setUniform1f(16,h.opacity);this.sp.setUniform1f(17,h.reflectivity);this.sp.setUniform1f(18,h.bumpiness);for(b=0;6>b;b++)-1!=this.sp.uniformSampler[b]&&(this.gl.activeTexture(33984+b),h.texture[b]?h.texture[b].bind():this._tblank.bind(),this.gl.uniform1i(this.sp.uniformSampler[b],b));c?(this.setCull(2),this.gl.drawElements(g.mode,g.icount,
5123,g.ioffset),this.setCull(3),this.gl.drawElements(g.mode,g.icount,5123,g.ioffset),this.setCull(this._i.opt_renderCullFace)):this.gl.drawElements(g.mode,g.icount,5123,g.ioffset);this._drawnpolyset++}};
Ovoid.Drawer.prototype.emitter=function(a,b,c){this.setCull(0);if(c)if(a.billboard?this.switchPipe(27,b):this.switchPipe(22,b),this.sp.setUniform4fv(9,c.v),this.persp(this._i.Queuer._rcamera),this.gl.activeTexture(33985),this._tblank.bind(),this.sp.setUniformSampler(1,1),this.switchBlend(0),this.switchDepth(2),a.billboard){this.gl.bindBuffer(34962,this._bprimitive[6]);this.sp.setVertexAttribPointers(5,28);var e,b=this._tM;b.set(this._tMi);for(e=a._particles.length;e--;)c=a._particles[e],0<c.l&&(b[0]=
c.u.v[2],b[12]=c.p.v[0],b[13]=c.p.v[1],b[14]=c.p.v[2],b[15]=1,this.model(b),this.gl.drawArrays(5,0,4),this._drawnsprite++)}else b=a._alives,this.raw(Ovoid.VERTEX_PARTICLE,44,0,b,a._fbuffer.subarray(0,11*b)),this._drawnparticle+=b;else if(3==a.model?this.switchBlend(1):this.switchBlend(3),a.billboard?this.switchPipe(7,b):this.switchPipe(2,b),this.persp(this._i.Queuer._rcamera),this.gl.activeTexture(33985),a.texture?a.texture.bind():this._tblank.bind(),this.sp.setUniformSampler(1,1),this.switchDepth(2),
a.billboard){this.gl.bindBuffer(34962,this._bprimitive[6]);this.sp.setVertexAttribPointers(5,28);b=this._tM;b.set(this._tMi);for(e=a._particles.length;e--;)c=a._particles[e],0<c.l&&(b[0]=c.u.v[2],b[12]=c.p.v[0],b[13]=c.p.v[1],b[14]=c.p.v[2],b[15]=1,this.sp.setUniform4fv(9,c.c.v),this.model(b),this.gl.drawArrays(5,0,4),this._drawnsprite++)}else b=a._alives,this.raw(Ovoid.VERTEX_PARTICLE,44,0,b,a._fbuffer.subarray(0,11*b)),this._drawnparticle+=b;this.restoreBlend();this.restoreDepth();this.restorePipe();
this.setCull(this._i.opt_renderCullFace)};
Ovoid.Drawer.prototype.shadow=function(a,b){var c;if(b.shape.type&Ovoid.MESH)this.model(b.worldMatrix.m),c=b.shape;if(b.shape.type&Ovoid.SKIN&&b.shape.mesh){if(!this._i.opt_localSkinData)return;this.model((new Ovoid.Matrix4).m);c=b.shape.mesh}if(c){c=c.triangles[0].length;var e=Array(6);e[3]=new Ovoid.Point;e[4]=new Ovoid.Point;e[5]=new Ovoid.Point;var f=new Ovoid.Point,g=new Ovoid.Vector;if(!(24*c>this._dV.length)){var h=this._dV;1==a.model?(g.copy(a.worldDirection),b.shape.type&Ovoid.MESH&&g.transform4Inverse(b.worldMatrix),
f.copy(g),g.scaleBy(-1)):(f.copy(a.worldPosition),b.shape.type&Ovoid.MESH&&f.transform4Inverse(b.worldMatrix));var k,j,m,l=0;for(k=0;k<c;k++)if(1!=a.model&&g.subOf(f,b.shape.triangles[0][k].center),0<g.dot(b.shape.triangles[0][k].normal)){e[0]=b.shape.vertices[0][b.shape.triangles[0][k].index[0]].p;e[1]=b.shape.vertices[0][b.shape.triangles[0][k].index[1]].p;e[2]=b.shape.vertices[0][b.shape.triangles[0][k].index[2]].p;1==a.model?(e[3].copy(f),e[4].copy(f),e[5].copy(f)):(e[3].subOf(e[0],f),e[4].subOf(e[1],
f),e[5].subOf(e[2],f));h[l]=e[0].v[0];l++;h[l]=e[0].v[1];l++;h[l]=e[0].v[2];l++;h[l]=1;l++;h[l]=e[1].v[0];l++;h[l]=e[1].v[1];l++;h[l]=e[1].v[2];l++;h[l]=1;l++;h[l]=e[2].v[0];l++;h[l]=e[2].v[1];l++;h[l]=e[2].v[2];l++;h[l]=1;l++;h[l]=e[3].v[0];l++;h[l]=e[3].v[1];l++;h[l]=e[3].v[2];l++;h[l]=0;l++;h[l]=e[5].v[0];l++;h[l]=e[5].v[1];l++;h[l]=e[5].v[2];l++;h[l]=0;l++;h[l]=e[4].v[0];l++;h[l]=e[4].v[1];l++;h[l]=e[4].v[2];l++;h[l]=0;l++;for(j=0;3>j;j++)m=b.shape.triangles[0][k].adjacent[j],-1!=m?(1!=a.model&&
g.subOf(f,b.shape.triangles[0][m].center),0>=g.dot(b.shape.triangles[0][m].normal)&&(m=(j+1)%3,1==a.model?(e[3].copy(f),e[4].copy(f)):(e[3].subOf(e[j],f),e[4].subOf(e[m],f)),h[l]=e[j].v[0],l++,h[l]=e[j].v[1],l++,h[l]=e[j].v[2],l++,h[l]=1,l++,h[l]=e[4].v[0],l++,h[l]=e[4].v[1],l++,h[l]=e[4].v[2],l++,h[l]=0,l++,h[l]=e[m].v[0],l++,h[l]=e[m].v[1],l++,h[l]=e[m].v[2],l++,h[l]=1,l++,h[l]=e[j].v[0],l++,h[l]=e[j].v[1],l++,h[l]=e[j].v[2],l++,h[l]=1,l++,h[l]=e[3].v[0],l++,h[l]=e[3].v[1],l++,h[l]=e[3].v[2],l++,
h[l]=0,l++,h[l]=e[4].v[0],l++,h[l]=e[4].v[1],l++,h[l]=e[4].v[2],l++,h[l]=0,l++)):(m=(j+1)%3,1==a.model?(e[3].copy(f),e[4].copy(f)):(e[3].subOf(e[j],f),e[4].subOf(e[m],f)),h[l]=e[j].v[0],l++,h[l]=e[j].v[1],l++,h[l]=e[j].v[2],l++,h[l]=1,l++,h[l]=e[4].v[0],l++,h[l]=e[4].v[1],l++,h[l]=e[4].v[2],l++,h[l]=0,l++,h[l]=e[m].v[0],l++,h[l]=e[m].v[1],l++,h[l]=e[m].v[2],l++,h[l]=1,l++,h[l]=e[j].v[0],l++,h[l]=e[j].v[1],l++,h[l]=e[j].v[2],l++,h[l]=1,l++,h[l]=e[3].v[0],l++,h[l]=e[3].v[1],l++,h[l]=e[3].v[2],l++,h[l]=
0,l++,h[l]=e[4].v[0],l++,h[l]=e[4].v[1],l++,h[l]=e[4].v[2],l++,h[l]=0,l++)}delete e[3];delete e[4];delete e[5];delete e;delete f;delete g;this.gl.bindBuffer(34962,this._bdynamic);this.gl.bufferSubData(34962,0,h.subarray(0,l));this.sp.setVertexAttribPointers(1,16);this.gl.cullFace(1028);this.gl.stencilOp(7680,7682,7680);this.gl.drawArrays(4,0,l/4);this._drawndynamic++;this.gl.cullFace(1029);this.gl.stencilOp(7680,7683,7680);this.gl.drawArrays(4,0,l/4);this._drawndynamic++;this._drawnshadow++}}};
Ovoid.Drawer.prototype.normals=function(a,b){if(a.shape.triangles){var c=a.shape._lod;this.model(a.worldMatrix.m);triangles=a.shape.triangles[c];for(var c=this._dV,e,f,g=0,h=0;h<triangles.length;h++)e=triangles[h].center,f=triangles[h].normal,c[g]=e.v[0],g++,c[g]=e.v[1],g++,c[g]=e.v[2],g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++,c[g]=e.v[0]+f.v[0]*b,g++,c[g]=e.v[1]+f.v[1]*b,g++,c[g]=e.v[2]+f.v[2]*b,g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++,c[g]=1,g++;this.sp.setUniform4fv(9,this._tcolor[10].v);
this.raw(33,32,1,g/8,c.subarray(0,g))}};
Ovoid.Drawer.prototype.helpers=function(a){this.model(a.worldMatrix.m);var b=this._tM;this._i.opt_renderDrawAxis&&this.symAxis(this._tcolor[0]);a.type&Ovoid.CAMERA&&this._i.opt_renderDrawCameras&&this.symPyramid(this._tcolor[1]);a.type&Ovoid.LIGHT&&this._i.opt_renderDrawLights&&this.symStar(this._tcolor[4]);if(a.type&Ovoid.JOINT&&this._i.opt_renderDrawJoints){b.set(a.worldMatrix.m);var c=this._i.opt_renderJointSize*a.size;b[0]*=c;b[1]*=c;b[2]*=c;b[4]*=c;b[5]*=c;b[6]*=c;b[8]*=c;b[9]*=c;b[10]*=c;this.model(b);
this.symSphere(this._tcolor[2])}if(a.type&Ovoid.BODY){if(this._i.opt_renderDrawBoundingBox){b.set(a.worldMatrix.m);var c=2*a.boundingBox.hsize.v[0],e=2*a.boundingBox.hsize.v[1],f=2*a.boundingBox.hsize.v[2],g=a.boundingBox.center.v[0],h=a.boundingBox.center.v[1],k=a.boundingBox.center.v[2];b[0]*=c;b[1]*=c;b[2]*=c;b[4]*=e;b[5]*=e;b[6]*=e;b[8]*=f;b[9]*=f;b[10]*=f;b[12]+=g*a.worldMatrix.m[0]+h*a.worldMatrix.m[4]+k*a.worldMatrix.m[8];b[13]+=g*a.worldMatrix.m[1]+h*a.worldMatrix.m[5]+k*a.worldMatrix.m[9];
b[14]+=g*a.worldMatrix.m[2]+h*a.worldMatrix.m[6]+k*a.worldMatrix.m[10];this.model(b);this.symBox(this._tcolor[8])}if(this._i.opt_renderDrawBoundingSphere)b.set(a.worldMatrix.m),c=a.boundingSphere.radius,g=a.boundingSphere.center.v[0],h=a.boundingSphere.center.v[1],k=a.boundingSphere.center.v[2],b[0]*=c,b[1]*=c,b[2]*=c,b[4]*=c,b[5]*=c,b[6]*=c,b[8]*=c,b[9]*=c,b[10]*=c,b[12]+=g*a.worldMatrix.m[0]+h*a.worldMatrix.m[4]+k*a.worldMatrix.m[8],b[13]+=g*a.worldMatrix.m[1]+h*a.worldMatrix.m[5]+k*a.worldMatrix.m[9],
b[14]+=g*a.worldMatrix.m[2]+h*a.worldMatrix.m[6]+k*a.worldMatrix.m[10],this.model(b),this.symSphere(this._tcolor[6])}};
Ovoid.Drawer.prototype.body=function(a,b,c,e){a.shape.type&Ovoid.MESH?(this.model(a.worldMatrix.m,a.normalMatrix.m),this.mesh(a.shape,c,e),a.addCach(Ovoid.CACH_WORLD)):a.shape.type&Ovoid.SKIN?(a.shape.mesh&&(this.model(a.shape.infMxfArray,a.shape.infMnrArray),this.enable(6),this.mesh(a.shape.mesh,c,e),this.disable(6)),a.addCach(Ovoid.CACH_WORLD)):a.shape.type&Ovoid.EMITTER&&(this.model(a.worldMatrix.m),this.emitter(a.shape,b,c),a.addCach(Ovoid.CACH_WORLD))};
Ovoid.Drawer.prototype.bodyStack=function(a,b,c,e){var f=a.count;if(c)for(c=new Ovoid.Color;f--;)a[f].pickable&&(c.fromInt(a[f].uid),this.body(a[f],b,c,e));else for(;f--;)this.body(a[f],b,null,e)};Ovoid.Drawer.prototype.layerStack=function(a,b){var c,e=a.count;if(b){var f=new Ovoid.Color;for(c=0;c<e;c++)a[c].pickable&&(f.fromInt(a[c].uid),this.model(a[c].layerMatrix.m),this.layer(a[c],f),a[c].addCach(Ovoid.CACH_WORLD))}else for(c=0;c<e;c++)this.model(a[c].layerMatrix.m),this.layer(a[c],f),a[c].addCach(Ovoid.CACH_WORLD)};
Ovoid.Drawer.prototype.textStack=function(a,b){var c,e=a.count;if(b){var f=new Ovoid.Color;for(c=0;c<e;c++)a[c].pickable&&(f.fromInt(a[c].uid),this.model(a[c].layerMatrix.m),this.text(a[c],f),a[c].addCach(Ovoid.CACH_WORLD))}else for(c=0;c<e;c++)this.model(a[c].layerMatrix.m),this.text(a[c],f),a[c].addCach(Ovoid.CACH_WORLD)};Ovoid.Drawer.prototype.helpersStack=function(a){for(var b=a.count;b--;)this.helpers(a[b])};
Ovoid.Drawer.prototype.normalsStack=function(a){for(var b=a.count;b--;)this.normals(a[b],this._i.opt_renderNormalScale)};Ovoid.Drawer.prototype.zfailStack=function(a,b){for(var c=b.count;c--;)b[c].shadowCasting&&this.shadow(a,b[c])};
Ovoid.Drawer.prototype.drawQueueRP=function(){if(this._i.opt_renderPickingMode){this.beginRpDraw();this.switchBlend(0);this.switchDepth(1);this.setCull(this._i.opt_renderCullFace);if(this._i.opt_renderPickingMode&2)for(var a=0;a<Ovoid.MAX_RENDER_LAYER;a++)this.switchPipe(20,0),this.persp(this._i.Queuer._rcamera),this.bodyStack(this._i.Queuer.qsolid[a],0,!0,!1),this.bodyStack(this._i.Queuer.qalpha[a],0,!0,!0);this._i.opt_renderDrawLayers&&this._i.opt_renderPickingMode&1&&(this.switchDepth(0),this.switchPipe(23,
0),this.screen(this._i.Frame.matrix),this.layerStack(this._i.Queuer.qlayer,!0),this.switchPipe(24,0),this.screen(this._i.Frame.matrix),this.textStack(this._i.Queuer.qtext,!0));this.endRpDraw();this._renderpasses++}};
Ovoid.Drawer.prototype.drawQueueHL=function(){this.switchDepth(0);if(this._i.opt_renderDrawHelpers){this.switchPipe(5,0);this.persp(this._i.Queuer._rcamera);if(this._i.opt_renderDrawNormals)for(var a=0;a<Ovoid.MAX_RENDER_LAYER;a++)this.normalsStack(this._i.Queuer.qsolid[a]),this.normalsStack(this._i.Queuer.qalpha[a]);this.helpersStack(this._i.Queuer.qtform);this.model(this._i.Input.mouseCursor.m);this.symSphere(this._tcolor[1])}this._i.opt_renderDrawLayers&&(this.switchBlend(3),this._i.Queuer.qlayer.count&&
(this.switchPipe(3,0),this.screen(this._i.Frame.matrix),this.layerStack(this._i.Queuer.qlayer,!1)),this._i.Queuer.qtext.count&&(this.switchPipe(4,0),this.screen(this._i.Frame.matrix),this.textStack(this._i.Queuer.qtext,!1)))};
Ovoid.Drawer.prototype.drawQueueLP=function(a){var b;this.setCull(this._i.opt_renderCullFace);this.switchBlend(3);this.switchDepth(1);this.switchPipe(6,0);this.persp(this._i.Queuer._rcamera);for(b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qsolid[b].count&&(this.switchPipe(a,b),this.persp(this._i.Queuer._rcamera),this.ambient(),this.disable(0),this.enable(1),this.bodyStack(this._i.Queuer.qsolid[b],b,!1,!1));this._renderpasses++;this.switchBlend(2);this.switchDepth(3);for(var c=this._i.Queuer.qlight.count;c--;){if(this._i.Queuer.qlight[c].shadowCasting&&
this._i.opt_renderShadowCasting){this.switchPipe(6,0);this.switchBlend(0);this.switchDepth(2);this.gl.enable(2960);this.gl.clear(1024);this.gl.colorMask(0,0,0,0);this.gl.stencilFunc(519,0,0);for(b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qsolid[b].count&&this.zfailStack(this._i.Queuer.qlight[c],this._i.Queuer.qsolid[b]),this._i.Queuer.qalpha[b].count&&this.zfailStack(this._i.Queuer.qlight[c],this._i.Queuer.qalpha[b]);this.gl.stencilFunc(514,0,-1);this.gl.stencilOp(7680,7680,7680);this.gl.colorMask(1,
1,1,1);this.setCull(this._i.opt_renderCullFace);this.restoreBlend();this.restoreDepth()}for(b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qsolid[b].count&&(this.switchPipe(a,b),this.ambient(),this.enable(0),this.disable(1),this.light(this._i.Queuer.qlight[c]),this.bodyStack(this._i.Queuer.qsolid[b],b,!1,!1));this._renderpasses++}this.gl.disable(2960);this.switchBlend(3);this.gl.depthMask(1);this.gl.enable(2929);this.gl.depthFunc(515);this.switchPipe(8,0);this.persp(this._i.Queuer._rcamera);this.ambient();
for(b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qsolid[b].count&&this.bodyStack(this._i.Queuer.qsolid[b],b,!1,!1);this._renderpasses++};
Ovoid.Drawer.prototype.drawQueue1P=function(a){this.setCull(this._i.opt_renderCullFace);this.switchBlend(3);this.switchDepth(1);for(var b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qsolid[b].count&&(this.switchPipe(a,b),this.persp(this._i.Queuer._rcamera),this.ambient(),this.enable(0),this.enable(1),this.light(this._i.Queuer.qlight),this.bodyStack(this._i.Queuer.qsolid[b],b,!1,!1));this._renderpasses++};
Ovoid.Drawer.prototype.drawQueueFX=function(a){this.switchBlend(3);this.switchDepth(2);for(var b=0;b<Ovoid.MAX_RENDER_LAYER;b++)this._i.Queuer.qalpha[b].count&&(this.switchPipe(a,b),this.persp(this._i.Queuer._rcamera),this.ambient(),this.light(this._i.Queuer.qlight),this.bodyStack(this._i.Queuer.qalpha[b],b,!1,!0));this._renderpasses++};
Ovoid.Drawer.prototype.drawQueue=function(){this.beginDraw();this.drawQueueRP();this._i.opt_renderPerLightPass?this.drawQueueLP(this._pipeLp):this.drawQueue1P(this._pipe1p);this.drawQueueFX(this._pipe1p);this.drawQueueHL();this.endDraw()};Ovoid.Input=function(a){this._i=a;this.mouseWheel=Array(3);this.mouseWheelDelta=0;this.mousePosition=new Ovoid.Coord(0,0,0);this.mouseVelocity=new Ovoid.Vector(0,0,0);this.mouseCursor=new Ovoid.Matrix4;this.grabbedNode=null;this.mouseLeaveUid=this.mouseEnterUid=this.mouseOverUid=0;this.mouseOverNode=null;this.intDn=new Uint8Array(256);this.intUp=new Uint8Array(256);this.intHl=new Uint8Array(256);this.gpAxis=new Ovoid.Point(0,0,0,0);this._onInt=[[],[],[]];this._onCTRInt=[[],[],[]];this._onALTInt=[[],
[],[]];this._onSHFInt=[[],[],[]];this._onLSUInt=[[],[],[]];this._onRSUInt=[[],[],[]]};Ovoid.Input.prototype._init=function(){Ovoid._log(3,this._i,".Input._init"," done");return!0};
Ovoid.Input.prototype._update=function(){var a=this._onInt;if(this.intHl[16])a=this._onSHFInt;if(this.intHl[17])a=this._onCTRInt;if(this.intHl[18])a=this._onALTInt;if(this.intHl[91])a=this._onLSUInt;if(this.intHl[92])a=this._onRSUInt;try{var b;for(b=a[0].length;b--;)if(this.intUp[a[0][b][0]])a[0][b][1]();for(b=a[1].length;b--;)if(this.intDn[a[1][b][0]])a[1][b][1]();for(b=a[2].length;b--;)if(this.intHl[a[2][b][0]])a[2][b][1]()}catch(c){Ovoid._log(0,this._i,".Input._update"," custom trigger function exception thrown:\n"+
c.stack)}this.mouseVelocity.set(0,0,0);for(a=this.mouseWheelDelta=0;255>a;a++)this.intDn[a]=!1,this.intUp[a]=!1};
Ovoid.Input.prototype.setTrigger=function(a,b,c,e){if(2<c)Ovoid._log(2,this._i,".Input.setTrigger"," invalid key status code.");else if(255<b)Ovoid._log(2,this._i,".Input.setTrigger"," invalid key code.");else if(e instanceof Function){var f=Array(2);f[0]=b;f[1]=e;switch(a){case 1:a=this._onCTRInt;break;case 2:a=this._onALTInt;break;case 3:a=this._onSHFInt;break;case 4:a=this._onLSUInt;break;case 5:a=this._onRSUInt;break;default:a=this._onInt}for(e=a[c].length;e--;)if(a[c][e][0]==b){a[c][e]=f;return}a[c].push(f)}else Ovoid._log(2,
this._i,".Input.setTrigger"," non-Function instance given as trigger function")};Ovoid.Input.prototype.grabNode=function(a){this.grabbedNode=a};Ovoid.Input.prototype.grabRelease=function(){this.grabbedNode=null;document.body.style.cursor="default"};Ovoid.Timer=function(a){this._i=a;this.framerate=this.quantum=this.clock=0;this._ttime=[0,0];this._fcount=this._fclock=0};Ovoid.Timer.prototype._init=function(){this._reset();Ovoid._log(3,this._i,".Timer._init"," done");return!0};
Ovoid.Timer.prototype._update=function(){this._ttime[0]=(new Date).getTime();this.quantum=0.001*(this._ttime[0]-this._ttime[1]);this._ttime[1]=this._ttime[0];if(0.2<this.quantum)this.quantum=0.001;this.clock+=this.quantum;this._fclock+=this.quantum;if(0.1<this._fclock)this.framerate=Math.floor(this._fcount/this._fclock),this._fclock=this._fcount=0;this._fcount++};Ovoid.Timer.prototype._reset=function(){this._ttime[0]=this._ttime[1]=(new Date).getTime();this.quantum=0.01;this.clock=0};Ovoid.Instance=function(a){this.name=a;this.opt_GLalpha=!1;this.opt_GLpremultipliedAlpha=this.opt_GLstencil=this.opt_GLantialias=this.opt_GLpreserveDrawingBuffer=!0;this.opt_debugMode=!1;this.opt_enableAlerts=!0;this.opt_logLevel=0;this.opt_customErrContent=null;this.opt_showHud=!0;this.opt_showDebug=!1;this.opt_gravity=[0,-9.8,0];this.opt_preloadStyle=1;this.opt_preloadBgColor=[0.95,0.95,0.95,1];this.opt_preloadFgColor=[0.5,0.5,0.5,1];this.opt_preloadAcColor=[0,0,0,0.5];this.opt_frameMode=Ovoid.FRAME_CLIENT_SIZE;
this.opt_frameWidth=960;this.opt_frameHeight=540;this.opt_renderClearColor=[0,1,0,1];this.opt_renderAmbientColor=[0.2,0.2,0.2,1];this.opt_renderFogColor=[1,1,1,1];this.opt_renderFogDensity=0;this.opt_renderPickingMode=Ovoid.RP_WORLD|Ovoid.RP_OVERLAY;this.opt_renderCullFace=1;this.opt_renderLopLevel=2;this.opt_renderAdaptLop=!1;this.opt_renderAdaptLopThreshold=45;this.opt_renderPerLightPass=!0;this.opt_renderShadowCasting=!1;this.opt_renderShadowCastingExclusion=2;this.opt_renderDrawLayers=!0;this.opt_renderDrawHelpers=
!1;this.opt_renderDrawCameras=this.opt_renderDrawLights=this.opt_renderDrawJoints=this.opt_renderDrawBoundingSphere=this.opt_renderDrawBoundingBox=this.opt_renderDrawAxis=!0;this.opt_renderDrawNormals=!1;this.opt_renderNormalScale=this.opt_renderJointSize=0.25;this.opt_sceneIntersectDetect=this.opt_sceneLightcull=this.opt_sceneViewcull=!0;this.opt_sceneDefaultViewPosition=[0,0,5];this.opt_sceneDefaultViewRotation=[0,0,0];this.opt_physicsIterativeSolver=!0;this.opt_physicsContactItFactor=4;this.opt_audioDopplerFactor=
1;this.opt_skinLocalComput=!1;this.al=this.gl=null;this.Frame=new Ovoid.Frame(this);this.Timer=new Ovoid.Timer(this);this.Input=new Ovoid.Input(this);this.Drawer=new Ovoid.Drawer(this);this.Queuer=new Ovoid.Queuer(this);this.Solver=new Ovoid.Solver(this);this.Scene=this._dScene=new Ovoid.Scene(a+"Scene",this);this.waitdraw=function(){};this.onload=function(){};this.onloop=function(){};this.ondraw=function(){this.Drawer.drawQueue()};this._log="";this._glerror=this._nerror=0;this._runstat=-1;this._loadstage=
[!0,!1,!1,!1];this._loadremains=[0,0,0,0];this.preloadRatio=this._loadloaded=this._loadtotal=0;this._loadstkscn=[];this._loadstktex=[];this._loadstkaud=[];this._loadstkgls=[];this._loaditem=this._loadobj=null;this.preloadTimer=0;this._loadel=[];this._hudbg=new Ovoid.Layer;this._dbgbg=new Ovoid.Layer;this._dbg=[];for(a=0;8>a;a++)this._dbg[a]=new Ovoid.Text};
Ovoid.Instance.prototype._setoptions=function(a){this.opt_GLalpha=a.opt_GLalpha;this.opt_GLpreserveDrawingBuffer=a.opt_GLpreserveDrawingBuffer;this.opt_GLantialias=a.opt_GLantialias;this.opt_GLstencil=a.opt_GLstencil;this.opt_GLpremultipliedAlpha=a.opt_GLpremultipliedAlpha;this.opt_debugMode=a.opt_debugMode;this.opt_enableAlerts=a.opt_enableAlerts;this.opt_logLevel=a.opt_logLevel;this.opt_customErrContent=a.opt_customErrContent;this.opt_showHud=a.opt_showHud;this.opt_showDebug=a.opt_showDebug;this.opt_gravity=
a.opt_gravity;this.opt_preloadStyle=a.opt_preloadStyle;this.opt_preloadBgColor=a.opt_preloadBgColor;this.opt_preloadFgColor=a.opt_preloadFgColor;this.opt_preloadAcColor=a.opt_preloadAcColor;this.opt_frameMode=a.opt_frameMode;this.opt_frameWidth=a.opt_frameWidth;this.opt_frameHeight=a.opt_frameHeight;this.opt_renderClearColor=a.opt_renderClearColor;this.opt_renderAmbientColor=a.opt_renderAmbientColor;this.opt_renderFogColor=a.opt_renderFogColor;this.opt_renderFogDensity=a.opt_renderFogDensity;this.opt_renderPickingMode=
a.opt_renderPickingMode;this.opt_renderCullFace=a.opt_renderCullFace;this.opt_renderLopLevel=a.opt_renderLopLevel;this.opt_renderAdaptLop=a.opt_renderAdaptLop;this.opt_renderAdaptLopThreshold=a.opt_renderAdaptLopThreshold;this.opt_renderPerLightPass=a.opt_renderPerLightPass;this.opt_renderShadowCasting=a.opt_renderShadowCasting;this.opt_renderShadowCastingExclusion=a.opt_renderShadowCastingExclusion;this.opt_renderDrawLayers=a.opt_renderDrawLayers;this.opt_renderDrawHelpers=a.opt_renderDrawHelpers;
this.opt_renderDrawAxis=a.opt_renderDrawAxis;this.opt_renderDrawBoundingBox=a.opt_renderDrawBoundingBox;this.opt_renderDrawBoundingSphere=a.opt_renderDrawBoundingSphere;this.opt_renderDrawJoints=a.opt_renderDrawJoints;this.opt_renderDrawLights=a.opt_renderDrawLights;this.opt_renderDrawCameras=a.opt_renderDrawCameras;this.opt_renderDrawNormals=a.opt_renderDrawNormals;this.opt_renderJointSize=a.opt_renderJointSize;this.opt_renderNormalScale=a.opt_renderNormalScale;this.opt_sceneViewcull=a.opt_sceneViewcull;
this.opt_sceneLightcull=a.opt_sceneLightcull;this.opt_sceneIntersectDetect=a.opt_sceneIntersectDetect;this.opt_sceneDefaultViewPosition=a.opt_sceneDefaultViewPosition;this.opt_sceneDefaultViewRotation=a.opt_sceneDefaultViewRotation;this.opt_physicsIterativeSolver=a.opt_physicsIterativeSolver;this.opt_physicsContactItFactor=a.opt_physicsContactItFactor;this.opt_audioDopplerFactor=a.opt_audioDopplerFactor;this.opt_skinLocalComput=a.opt_skinLocalComput;Ovoid._log(3,this,"._setoptions"," done")};
Ovoid.Instance.prototype._init=function(a){Ovoid._log(3,this,"._init"," start");var b=(new Date).getTime();this.opt_debugMode&&Ovoid._log(2,this,"._init"," debug mode is enabled, external contents will be redownloaded.");if(!window.WebGLRenderingContext)return Ovoid._log(0,this,"._init"," window.WebGLRenderingContext is null"),Ovoid._err(7,this,"browser does not support WebGL"),!1;Ovoid._log(3,this,"._init"," using '"+a.id+"' as render canvas");var c={alpha:this.opt_GLalpha,preserveDrawingBuffer:this.opt_GLpreserveDrawingBuffer,
antialias:this.opt_GLantialias,stencil:this.opt_GLstencil,premultipliedAlpha:this.opt_GLpremultipliedAlpha},e=["webgl","experimental-webgl","webkit-3d","moz-webgl"];Ovoid._log(3,this,"._init"," search for WebGL context...");for(var f,g=0;g<e.length;g++)try{if(this.gl=a.getContext(e[g],c)){f=e[g];break}}catch(h){return Ovoid._log(1,this,"._init"," getContext 'webgl' error : "+h),Ovoid._err(1,this,"WebGL context creation exception"),!1}if(!this.gl)return Ovoid._log(0,this,"._init"," no suitable WebGL context found"),
Ovoid._err(7,this,"unable to find a suitable WebGL context"),!1;Ovoid._log(3,this,"._init"," WebGL '"+f+"' context created in: "+0.001*((new Date).getTime()-b)+"s");Ovoid._log(3,this,"._init"," search for Web Audio API context...");if(window.AudioContext)try{Ovoid._log(3,this,"._init"," found Web Audio API."),this.al=new AudioContext}catch(k){Ovoid._log(2,this,"._init"," new AudioContext() error : "+k)}else if(window.webkitAudioContext)try{Ovoid._log(3,this,"._init"," found Webkit Audio API."),this.al=
new webkitAudioContext}catch(j){Ovoid._log(2,this,"._init"," new webkitAudioContext() error : "+j)}else this.al=null,Ovoid._log(2,this,"._init"," no suitable Web Audio API found.");Ovoid._log(3,this,"._init"," initilizing classes");try{if(this.Frame._init(a))if(this.Drawer._init())if(this.Input._init())if(this.Timer._init())if(this.Queuer._init()){if(void 0!=this.Solver&&!this.Solver._init())return Ovoid._log(0,this,"._init"," solver class initialization error"),Ovoid._err(4,this,"solver class initialization error"),
!1;this._hudbg.setBgColorRgba(0.6,0.6,0.6,1);this._hudbg.setSize(this.Frame.size.v[0],17,1);this._dbg[7].setFormat(16,0.5,1);this._dbg[7].moveXyz(4,0,0);this._dbg[7].setFgColorRgba(1,1,1,0.6);this._dbgbg.setBgColorRgba(0,0,0,0.5);this._dbgbg.setSize(this.Frame.size.v[0],this.Frame.size.v[1]-17,1);this._dbgbg.moveXyz(0,16,0);this._dbg[0].setFormat(16,0.5,1);this._dbg[0].moveXyz(1,20,0);this._dbg[0].setFgColorRgba(1,1,1,1);this._dbg[1].setFormat(16,0.5,1);this._dbg[1].moveXyz(250,20,0);this._dbg[1].setFgColorRgba(1,
1,1,1);this._dbg[2].setFormat(16,0.5,1);this._dbg[2].moveXyz(470,20,0);this._dbg[2].setFgColorRgba(1,1,1,1);this._dbg[3].setFormat(16,0.5,1);this._dbg[3].moveXyz(720,20,0);this._dbg[3].setFgColorRgba(1,1,1,1);this._dbg[4].setFormat(16,0.5,1);this._dbg[4].moveXyz(1,216,0);this._dbg[4].setFgColorRgba(1,1,1,1);this._dbg[5].setFormat(16,0.5,1);this._dbg[5].moveXyz(300,216,0);this._dbg[5].setFgColorRgba(1,1,1,1);this._dbg[6].setFormat(16,0.5,1);this._dbg[6].moveXyz(600,216,0);this._dbg[6].setFgColorRgba(1,
1,1,1);this._dbg[0].cachTransform();this._dbg[0].cachLayer();this._dbg[1].cachTransform();this._dbg[1].cachLayer();this._dbg[2].cachTransform();this._dbg[2].cachLayer();this._dbg[3].cachTransform();this._dbg[3].cachLayer();this._dbg[4].cachTransform();this._dbg[4].cachLayer();this._dbg[5].cachTransform();this._dbg[5].cachLayer();this._dbg[6].cachTransform();this._dbg[6].cachLayer()}else return Ovoid._log(0,this,"._init"," queuer class initialization error"),Ovoid._err(2,this,"queuer class initialization error"),
!1;else return Ovoid._log(0,this,"._init"," timer class initialization error"),Ovoid._err(2,this,"timer class initialization error"),!1;else return Ovoid._log(0,this,"._init"," input class initialization error"),Ovoid._err(2,this,"input class initialization error"),!1;else return Ovoid._log(0,this,"._init"," drawer class initialization error"),Ovoid._err(2,this,"drawer class initialization error"),!1;else return Ovoid._log(0,this,"._init"," frame class initialization error"),Ovoid._err(2,this,"frame class initialization error"),
!1}catch(m){return Ovoid._log(0,this,"._init"," (Exception) "+m.stack),Ovoid._err(2,this,"initialization Exception thrown"),!1}Ovoid._log(3,this,"._init"," done in: "+0.001*((new Date).getTime()-b)+"s");return!0};Ovoid.Instance.prototype._hasError=function(){return 0!=this._nerror};Ovoid.Instance.prototype.getLog=function(){return this._log};Ovoid.Instance.prototype._clearGlerror=function(){this.gl.getError()};
Ovoid.Instance.prototype._hasGlerror=function(){return(this._glerror=this.gl.getError())?!0:!1};Ovoid.Instance.prototype._getGlerror=function(){switch(this._glerror){case 0:return null;case 1280:return"GL_INVALID_ENUM";case 1281:return"GL_INVALID_VALUE";case 1282:return"GL_INVALID_OPERATION";case 1283:return"GL_STACK_OVERFLOW";case 1284:return"GL_STACK_UNDERFLOW";case 1285:return"GL_OUT_OF_MEMORY"}};
Ovoid.Instance.prototype._logGlerror=function(a){return this._hasGlerror()?(Ovoid._log(2,this,a," WebGL error: "+this._getGlerror()),!0):!1};
Ovoid.Instance.prototype._mainloop=function(){try{this.Timer._update();try{this.onloop()}catch(a){Ovoid._log(0,this,".onloop"," (Exception)\n"+a.stack),Ovoid._err(5,this,".onloop() Exception thrown")}this.Queuer._reset();this.Queuer._queueScene(this.Scene);this.Solver._solveQueue();this.ondraw();if(this.opt_showHud&&(this.Drawer.switchPipe(4,0),this.Drawer.screen(this.Frame.matrix),this.Drawer.switchPipe(3,0),this.Drawer.screen(this.Frame.matrix),this.Drawer.switchDepth(0),this.Drawer.switchBlend(3),
this._hudbg.setSize(this.Frame.size.v[0],17,1),this._dbg[7].string=Ovoid.Debug.Sumary(this),this._hudbg.cachTransform(),this._hudbg.cachLayer(),this.Drawer.model(this._hudbg.layerMatrix.m),this.Drawer.layer(this._hudbg),this.Drawer.switchPipe(4,0),this.Drawer.model(this._dbg[7].layerMatrix.m),this.Drawer.text(this._dbg[7]),this.opt_showDebug)){this._dbgbg.setSize(this.Frame.size.v[0],this.Frame.size.v[1]-17,1);this._dbgbg.cachTransform();this._dbgbg.cachLayer();if(this.Input.mouseOverUid){var b=this.Scene.findNode(this.Input.mouseOverUid);
if(b)this._dbg[5].string=Ovoid.Debug.Node(b)+"\n",this._dbg[5].string+=Ovoid.Debug.Transform(b,!0)+"\n",b.shape&&(this._dbg[5].string+=Ovoid.Debug.Body(b)+"\n",b.shape.type&Ovoid.MESH&&(this._dbg[5].string+=Ovoid.Debug.Mesh(b.shape,!0)),b.shape.type&Ovoid.SKIN&&b.shape.mesh&&(this._dbg[5].string+=Ovoid.Debug.Mesh(b.shape.mesh,!0))),b.type&Ovoid.LAYER&&(this._dbg[5].string+=Ovoid.Debug.Layer(b,!1)),this._dbg[6].string=Ovoid.Debug.DependTree(b)}else this._dbg[5].string="",this._dbg[6].string="";this._dbg[0].string=
Ovoid.Debug.Drawer(this);this._dbg[1].string=Ovoid.Debug.Queuer(this);this._dbg[2].string=Ovoid.Debug.Input(this);this._dbg[3].string=Ovoid.Debug.Timer(this)+"\n";this._dbg[3].string+=Ovoid.Debug.Frame(this);this._dbg[4].string=Ovoid.Debug.WorldGraph(this.Scene);this.Drawer.switchPipe(3,0);this.Drawer.model(this._dbgbg.layerMatrix.m);this.Drawer.layer(this._dbgbg);this.Drawer.switchPipe(4,0);for(b=0;7>b;b++)this.Drawer.model(this._dbg[b].layerMatrix.m),this.Drawer.text(this._dbg[b])}this.gl.finish();
this.gl.flush();this.Input._update();this.Frame._update()}catch(c){Ovoid._log(0,this,"._mainloop"," (Exception)\n"+c.stack),Ovoid._err(5,this,"._mainloop() Exception thrown")}};
Ovoid.Instance.prototype._loadstart=function(){this._loadtcnt=(new Date).getTime();if(this._loadtotal)if(Ovoid._log(3,this,"._loadstart"," entering loading loop"),this._runstat=1,this.Frame._ffhack(),this.opt_preloadStyle){var a=this.opt_preloadBgColor,b=this.opt_preloadFgColor,c=this.opt_preloadAcColor;this._loadel[0]=new Ovoid.Layer;this._loadel[1]=new Ovoid.Layer;this._loadel[56]=new Ovoid.Text;this._loadel[57]=new Ovoid.Text;this._loadel[0].setBgColorRgba(a[0],a[1],a[2],a[3]);this._loadel[0].setSize(this.Frame.size.v[0],
this.Frame.size.v[1],1);this._loadel[0].cachTransform();this._loadel[0].cachLayer();switch(this.opt_preloadStyle){case 1:for(var e=2;52>e;e+=2)this._loadel[e]=new Ovoid.Layer,this._loadel[e+1]=new Ovoid.Transform;for(var f=50,g=2,h=4,e=2;e<f+2;e+=2)this._loadel[e].setBgColorRgba(c[0],c[1],c[2],0.25*c[3]),this._loadel[e].setSize(1,1,1),this._loadel[e].setParent(this._loadel[e+1]),this._loadel[e].moveXyz(0,4,0),this._loadel[e].cachTransform(),this._loadel[e].cachLayer(),this._loadel[e+1].scaleXyz(g,
h,1,1),this._loadel[e+1].rotateXyz(0,0,2*e/f*Math.PI),this._loadel[e+1].setParent(this._loadel[1]),this._loadel[e+1].cachTransform();break;case 2:this._loadel[54]=new Ovoid.Layer;this._loadel[55]=new Ovoid.Layer;for(e=2;52>e;e++)this._loadel[e]=new Ovoid.Layer;for(var f=50,g=6,h=8,k=f*(g+0),j=-(0.5*k),e=0;e<f;e++)this._loadel[e+2].setBgColorRgba(c[0],c[1],c[2],0.25*c[3]),this._loadel[e+2].setSize(g,h,1),this._loadel[e+2].setParent(this._loadel[1]),this._loadel[e+2].moveXyz(j+e*(g+0),10,0),this._loadel[e+
2].cachTransform(),this._loadel[e+2].cachLayer();this._loadel[54].setBgColorRgba(b[0],b[1],b[2],b[3]);this._loadel[54].setSize(k+2,h+2,1);this._loadel[54].setParent(this._loadel[1]);this._loadel[54].moveXyz(j-1,9,0);this._loadel[54].cachTransform();this._loadel[54].cachLayer();this._loadel[55].setBgColorRgba(a[0],a[1],a[2],a[3]);this._loadel[55].setSize(k,h,1);this._loadel[55].setParent(this._loadel[1]);this._loadel[55].moveXyz(j,10,0);this._loadel[55].cachTransform();this._loadel[55].cachLayer();
a=Ovoid.genFontmap(256,16,7,8,"normal 6pt arial");e=new Ovoid.Texture("Preload_fontmap",this);e.create2dFromImg(this.gl.RGBA,a)||Ovoid._log(1,this,"._loadstart"," Preload fontmap texture creation failled");this._loadel[56].setFontmap(e);this._loadel[56].string="LOADING";this._loadel[56].setFormat(16,0.5,1);a=this._loadel[56].getWidth();this._loadel[56].setParent(this._loadel[1]);this._loadel[56].moveXyz(-0.5*a,-10,0);this._loadel[56].setFgColorRgba(b[0],b[1],b[2],b[3]);this._loadel[56].cachTransform();
this._loadel[56].cachLayer();this._loadel[57].setFontmap(e);this._loadel[57].string="...";this._loadel[57].setFormat(16,0.5,1);a=this._loadel[57].getWidth();this._loadel[57].setParent(this._loadel[1]);this._loadel[57].moveXyz(-0.5*a,10,0);this._loadel[57].setFgColorRgba(b[0],b[1],b[2],b[3]);this._loadel[57].cachTransform();this._loadel[57].cachLayer()}this._loadel[1].setBgColorRgba(1,1,1,0);this._loadel[1].setSize(1,1,1);this._loadel[1].moveXyz(this.Frame.center.v[0],this.Frame.center.v[1],0);this._loadel[1].cachTransform();
this._loadel[1].cachLayer()}else{for(e=0;e<this._loadstkscn.length;e++){this._loaditem=this._loadstkscn[e];switch(this._loaditem[0]){case Ovoid.OJSON:this._loadobj=new Ovoid.Ojson(this);this._loadobj.loadSource(this._loaditem[1],!1);this._loadobj.importScene(this._loaditem[3]);break;default:this._loadobj=new Ovoid.Collada(this),this._loadobj.loadSource(this._loaditem[1],!1),this._loadobj.importDae(this._loaditem[2],this._loaditem[3],this._loaditem[4],this._loaditem[5])}for(b=this._loaditem[3].texture.length;b--;)this.includeTexture(this._loaditem[3].texture[b],
1);for(b=this._loaditem[3].audio.length;b--;)this.includeAudio(this._loaditem[3].audio[b])}for(e=0;e<this._loadstktex.length;e++)this._loadstktex[e][0].loadSource(this._loadstktex[e][0].url,this._loadstktex[e][1]);for(e=0;e<this._loadstkaud.length;e++)this._loadstkaud[e][0].loadSource(this._loadstkaud[e][0].url);for(e=0;e<this._loadstkgls.length;e++)this._loaditem=this._loadstkgls[e],this._loadobj=new Ovoid.Shader(this._loaditem[4],this),this._loadobj.loadSource(this._loaditem[1],this._loaditem[2],
this._loaditem[3],!1),this._loadobj.linkWrap()&&(b=this._i.Drawer.addShader(this._loadobj),-1!=this._loaditem[0]&&this.Drawer.plugShader(this._loaditem[0],b));this._loaddone()}else Ovoid._log(3,this,"._loadstart"," nothing to preload, skip loading loop"),this._loaddone()};
Ovoid.Instance.prototype._loadstep=function(){var a,b,c;this.preloadTimer=(new Date).getTime()-this._loadtcnt;this._clearGlerror();this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT);this.gl.viewport(0,0,this.Frame.canvas.width,this.Frame.canvas.height);this.Drawer.switchPipe(4,0);this.Drawer.screen(this.Frame.matrix);this.Drawer.switchPipe(3,0);this.Drawer.screen(this.Frame.matrix);this.Drawer.switchDepth(0);this.Drawer.switchBlend(3);this.Drawer.switchPipe(3,0);this.Drawer.model(this._loadel[0].layerMatrix.m);
this.Drawer.layer(this._loadel[0]);this._loadel[1].moveXyz(this.Frame.center.v[0],this.Frame.center.v[1],1,0,1);this._loadel[1].cachTransform();this._loadel[1].cachLayer();b=this.opt_preloadAcColor;switch(this.opt_preloadStyle){case 1:for(a=2;52>a;a+=2){this._loadel[a+1].cachTransform();var e=0.01*this.preloadTimer,f=0.12*a,e=0.25*(1+Math.sin(e-f));this._loadel[a].setBgColorRgba(b[0],b[1],b[2],b[3]*e);this._loadel[a].cachTransform();this._loadel[a].cachLayer();this.Drawer.model(this._loadel[a].layerMatrix.m);
this.Drawer.layer(this._loadel[a])}break;case 2:this._loadel[54].cachTransform();this._loadel[54].cachLayer();this.Drawer.model(this._loadel[54].layerMatrix.m);this.Drawer.layer(this._loadel[54]);this._loadel[55].cachTransform();this._loadel[55].cachLayer();this.Drawer.model(this._loadel[55].layerMatrix.m);this.Drawer.layer(this._loadel[55]);for(a=2;52>a;a++)c=0,this.preloadRatio>2*a&&(c=0.75),e=0.01*this.preloadTimer,f=0.1*a,e=0.125*(1+Math.sin(e-f)),this._loadel[a].setBgColorRgba(b[0],b[1],b[2],
b[3]*c+e),this._loadel[a].cachTransform(),this._loadel[a].cachLayer(),this.Drawer.model(this._loadel[a].layerMatrix.m),this.Drawer.layer(this._loadel[a]);this.Drawer.switchPipe(4,0);this._loadel[56].cachTransform();this._loadel[56].cachLayer();this.Drawer.model(this._loadel[56].layerMatrix.m);this.Drawer.text(this._loadel[56]);this._loadel[57].moveXyz(-0.5*this._loadel[57].getWidth(),20,0,0,1);this._loadel[57].cachTransform();this._loadel[57].cachLayer();this.Drawer.model(this._loadel[57].layerMatrix.m);
this.Drawer.text(this._loadel[57])}this.waitdraw();this.gl.finish();this.gl.flush();this.Frame._update();if(this._loadstage[3]&&0!=this._loadremains[3])if(null!=this._loadobj){if(0!=this._loadobj.loadStatus)1==this._loadobj.loadStatus&&(a=this.Drawer.addShader(this._loadobj),-1<this._loaditem.p&&this.Drawer.plugShader(a,this._loaditem.p,this._loaditem.l)),this._loadloaded++,this._loadobj=null,this._loadremains[3]--}else if(0<this._loadstkgls.length)this._loaditem=this._loadstkgls.pop(),this._loadobj=
new Ovoid.Shader(this._loaditem.n,this),this._loadobj.loadSource(this._loaditem.v,this._loaditem.f,this._loaditem.w,!0),this._loadel[57].string=this._loadobj.name,Ovoid._log(3,this,"._loadstep"," start loading Shader '"+this._loadobj.name+"'");if(this._loadstage[2])if(0!=this._loadremains[2])if(null!=this._loadobj){if(0!=this._loadobj.loadStatus)this._loadloaded++,this._loadobj=null,this._loadremains[2]--}else{if(0<this._loadstkaud.length)this._loaditem=this._loadstkaud.pop(),this._loadobj=this._loaditem.o,
this._loadobj.loadSource(this._loaditem.u),this._loadel[57].string=Ovoid.extractName(this._loadobj.url,!0).toUpperCase(),Ovoid._log(3,this,"._loadstep"," start loading Audio '"+this._loadobj.url+"'")}else this._loadstage[3]||(this._loadstage[3]=!0);if(this._loadstage[1])if(0!=this._loadremains[1])if(null!=this._loadobj){if(0!=this._loadobj.loadStatus)this._loadloaded++,this._loadobj=null,this._loadremains[1]--}else{if(0<this._loadstktex.length)this._loaditem=this._loadstktex.pop(),this._loadobj=this._loaditem.o,
this._loadobj.loadSource(this._loaditem.u,this._loaditem.f),this._loadel[57].string=Ovoid.extractName(this._loadobj.url,!0).toUpperCase(),Ovoid._log(3,this,"._loadstep"," start loading Texture '"+this._loadobj.url+"'")}else this._loadstage[2]||(this._loadstage[2]=!0);if(0!=this._loadremains[0])if(null!=this._loadobj){if(0!=this._loadobj.loadStatus){if(1==this._loadobj.loadStatus){for(a=this._loaditem.d.texture.length;a--;)if(0==this._loaditem.d.texture[a].loadStatus){c=!1;for(b=0;b<this._loadstktex.length;b++)if(this._loaditem.d.texture[a]===
this._loadstktex[b].o){c=!0;break}if(!c)this._loadstktex.unshift({}),this._loadstktex[0].o=this._loaditem.d.texture[a],this._loadstktex[0].u=this._loaditem.d.texture[a].url,this._loadstktex[0].f=!0,this._loadtotal++,this._loadremains[1]++}for(a=this._loaditem.d.audio.length;a--;)if(0==this._loaditem.d.audio[a].loadStatus){c=!1;for(b=0;b<this._loadstkaud.length;b++)if(this._loaditem.d.audio[a]===this._loadstkaud[b].o){c=!0;break}if(!c)this._loadstkaud.unshift({}),this._loadstkaud[0].o=this._loaditem.d.audio[a],
this._loadstkaud[0].u=this._loaditem.d.audio[a].url,this._loadtotal++,this._loadremains[2]++}}this._loadloaded++;this._loadobj=null;this._loadremains[0]--}}else{if(0<this._loadstkscn.length){this._loaditem=this._loadstkscn.pop();switch(this._loaditem.o){case Ovoid.OJSON:this._loadobj=new Ovoid.Ojson(this);"OJS"==Ovoid.extractExt(this._loaditem.u).toUpperCase()?this._loadobj.loadSource(this._loaditem.u,this._loaditem.d,!0):this._loadobj.loadSource(this._loaditem.u,this,!0);break;default:this._loadobj=
new Ovoid.Collada(this),this._loadobj.loadSource(this._loaditem.u,this._loaditem.d,this._loaditem.m,this._loaditem.p,this._loaditem.s,!0)}this._loadel[57].string=Ovoid.extractName(this._loadobj.url,!0).toUpperCase();Ovoid._log(3,this,"._loadstep"," start loading Scene '"+this._loadobj.url+"'")}}else this._loadstage[1]||(this._loadstage[1]=!0);this.preloadRatio=100*(this._loadloaded/this._loadtotal);this._logGlerror("._loadstep");this._loadloaded<this._loadtotal||(Ovoid._log(3,this,"._loadstep"," loading done in: "+
0.001*((new Date).getTime()-this._loadtcnt)+"s"),this._loaddone())};
Ovoid.Instance.prototype._loaddone=function(){this._loadstage=[!0,!1,!1,!1];this._loadremains=[0,0,0,0];this.preloadRatio=this._loadloaded=this._loadtotal=0;this._loadstkscn=[];this._loadstktex=[];this._loadstkaud=[];this._loadstkgls=[];this._loaditem=this._loadobj=null;this._loadel=[];Ovoid._log(3,this,"._loaddone"," run onload()");var a=(new Date).getTime();try{this.onload()}catch(b){Ovoid._log(0,this,".onload"," (Exception)\n"+b.stack),Ovoid._err(4,this,"onload() Exception thrown")}Ovoid._log(3,
this,".onload"," executed in: "+0.001*((new Date).getTime()-a)+"s");this.Timer._reset();this.Frame._ffhack();this.Frame.changed=!0;Ovoid._log(3,this,"._loaddone"," instance jump to main loop...now!");this._runstat=2};Ovoid.Instance.prototype.start=function(){if(-1==this._runstat)this._runstat=0;if(3==this._runstat)this._runstat=2};Ovoid.Instance.prototype.pause=function(){if(2==this._runstat)this._runstat=3};
Ovoid.Instance.prototype.includeOjson=function(a,b){if(!b)b=this.Scene;this._loadstkscn.unshift(Array(6));this._loadstkscn[0].o=Ovoid.OJSON;this._loadstkscn[0].u=a;this._loadstkscn[0].d=b;this._loadtotal++;this._loadremains[0]++;this._runstat=0};
Ovoid.Instance.prototype.includeDaeScene=function(a,b,c,e,f){if(!f)f=this.Scene;b||(b=Ovoid.DAE_ALL_NODES|Ovoid.DAE_CREATE_TRACK|Ovoid.DAE_FORCE_CSPLINE|Ovoid.DAE_MERGE_DEPENDENCIES|Ovoid.DAE_OPTIMIZE_ALL|Ovoid.DAE_CONVERT_UPAXIS,Ovoid._log(3,this,".includeDaeScene"," null options, use default."));this._loadstkscn.unshift({});this._loadstkscn[0].o=Ovoid.COLLADA;this._loadstkscn[0].u=a;this._loadstkscn[0].m=b;this._loadstkscn[0].p=c;this._loadstkscn[0].s=e;this._loadstkscn[0].d=f;this._loadtotal++;
this._loadremains[0]++;this._runstat=0};Ovoid.Instance.prototype.includeDaeAnimation=function(a,b,c,e){if(!e)e=this.Scene;this.includeDaeScene(a,Ovoid.DAE_ANIMATIONS|Ovoid.DAE_CREATE_TRACK|Ovoid.DAE_MERGE_DEPENDENCIES|Ovoid.DAE_FORCE_CSPLINE|Ovoid.DAE_CONVERT_UPAXIS,b,c,e);this._runstat=0};
Ovoid.Instance.prototype.includeDaeMesh=function(a,b,c,e){if(!e)e=this.Scene;this.includeDaeScene(a,Ovoid.DAE_MESHS|Ovoid.DAE_MATERIALS|Ovoid.DAE_MERGE_DEPENDENCIES|Ovoid.DAE_OPTIMIZE_ALL|Ovoid.DAE_CONVERT_UPAXIS,b,c,e);this._runstat=0};Ovoid.Instance.prototype.includeTexture=function(a,b,c,e){if(!e)e=this.Scene;this._loadstktex.unshift({});this._loadstktex[0].o=e.newNode(Ovoid.TEXTURE,a);this._loadstktex[0].u=b;this._loadstktex[0].f=c;this._loadtotal++;this._loadremains[1]++;this._runstat=0};
Ovoid.Instance.prototype.includeAudio=function(a,b,c){if(!c)c=this.Scene;this._loadstkaud.unshift({});this._loadstkaud[0].o=c.newNode(Ovoid.AUDIO,a);this._loadstkaud[0].u=b;this._loadtotal++;this._loadremains[2]++;this._runstat=0};
Ovoid.Instance.prototype.includeShader=function(a,b,c,e,f,g){this._loadstkgls.unshift({});this._loadstkgls[0].n=a;this._loadstkgls[0].v=b;this._loadstkgls[0].f=c;this._loadstkgls[0].w=e;this._loadstkgls[0].p=f;this._loadstkgls[0].l=g;this._loadtotal++;this._loadremains[3]++;this._runstat=0};Ovoid.Instance.prototype.useScene=function(a){if(a){if(a._i===this)this.Scene=a}else this.Scene=this._dScene};Ovoid.Instance.prototype.newScene=function(a){return new Ovoid.Scene(a,this)};
Ovoid.Instance.prototype.newShader=function(a){return new Ovoid.Shader(a,this)};
Ovoid.Instance.prototype.setAction=function(a,b,c,e){if(16<a)Ovoid._log(2,this,".setAction"," unknown event ("+a+").");else{if(c instanceof Function){var f=null;if(e)if("string"==typeof e){var g=this.Scene.findMatches(e);if(0==g.length){Ovoid._log(2,this,".setAction"," no node found with matching name '"+e+"' in the current active scene '"+this.Scene.name+"'.");return}f=g}else if(e.type&Ovoid.BODY)f=[],f.push(e);else{Ovoid._log(2,this,".setAction"," node "+e.name+" is not a Body instance.");return}if("string"==
typeof b){g=this.Scene.findMatches(b);if(0==g.length){Ovoid._log(2,this,".setAction"," no node found with matching name '"+b+"' in the current active scene '"+this.Scene.name+"'.");return}b=new Ovoid.Action(b+"Action",this)}else if(b.type&Ovoid.BODY||b.type&Ovoid.LAYER)g=[],g.push(b),b=new Ovoid.Action(b.name+"Action",this);else{Ovoid._log(2,this,".setAction"," node "+b.name+" is not a Body or Layer instance.");return}for(var e=!1,h,k=!1,j=g.length;j--;)if(g[j].type&Ovoid.BODY||g[j].type&Ovoid.LAYER){h=
null;for(var m=g[j].depend.length;m--;)if(g[j].depend[m].type&Ovoid.ACTION&&g[j].depend[m].name==b.name){h=g[j].depend[m];break}if(h)k=!0,Ovoid._log(3,this,".setAction"," updating action "+h.name);else if(h=b,h.linkNode(g[j]),Ovoid._log(3,this,".setAction"," linking action "+h.name+" to "+g[j].name),e)continue;else Ovoid._log(3,this,".setAction"," adding action node "+h.name+" to active scene"),this.Scene.insNode(h),e=!0;if(f)for(m=f.length;m--;)h.setTrigger(a,c,f[m]);else h.setTrigger(a,c);if(k)break}else Ovoid._log(2,
this,".setAction"," node "+g[j].name+" is not a Body or Layer instance.");return h}Ovoid._log(2,this,".setAction"," not valid Function ("+c+").")}};
Ovoid.Instance.prototype.setConstraint=function(a,b){var c;if("string"==typeof b){if(c=this.Scene.findMatches(b),0==c.length){Ovoid._log(2,this,".setConstraint"," no node found with matching name '"+b+"' in the current active scene '"+this.Scene.name+"'.");return}}else if(b.type&Ovoid.TRANSFORM||a==Ovoid.EXPRESSION)c=[],c.push(b);else{Ovoid._log(2,this,".setConstraint"," node "+b.name+" has wrong type for the chosen Constraint, aborted.");return}for(var e=[],f,g=c.length;g--;)if(!(c[g].type&Ovoid.TRANSFORM)&&
a!=Ovoid.EXPRESSION)Ovoid._log(2,this,".setConstraint"," node "+c[g].name+" has wrong type for the chosen Constraint, aborted.");else{switch(a){case Ovoid.PHYSICS:f=this.Scene.newNode(a,c[g].name+"Phys",null);Ovoid._log(3,this,".setConstraint"," creating Physics node "+f.name+" in active scene");break;case Ovoid.ANIMATION:f=this.Scene.newNode(a,c[g].name+"Anim",null);Ovoid._log(3,this,".setConstraint"," creating Animation node "+f.name+" in active scene");break;case Ovoid.EXPRESSION:f=this.Scene.newNode(a,
c[g].name+"Expr",null);Ovoid._log(3,this,".setConstraint"," creating Expression node "+f.name+" in active scene");break;case Ovoid.AIM:f=this.Scene.newNode(a,c[g].name+"Aim",null);Ovoid._log(3,this,".setConstraint"," creating Aim node "+f.name+" in active scene");break;default:Ovoid._log(2,this,".setConstraint"," invalid Constraint type.");return}Ovoid._log(3,this,".setConstraint"," adding "+c[g].name+" as Targer of "+f.name);f.setTarget(c[g]);e.push(f)}return e};
Ovoid.Instance.prototype.toJSON=function(){var a={};a.n=this.name;a.oi=[[],[],[]];a.oci=[[],[],[]];a.oai=[[],[],[]];a.osi=[[],[],[]];a.olsi=[[],[],[]];a.orsi=[[],[],[]];var b,c,e;for(b=0;3>b;b++){c=this.Input._onInt[b].length;a.oi[b]=Array(c);for(e=0;e<c;e++)a.oi[b][e]=Array(2),a.oi[b][e][0]=this.Input._onInt[b][e][0],a.oi[b][e][1]=Ovoid.compact(this.Input._onInt[b][e][1]);c=this.Input._onCTRInt[b].length;a.oci[b]=Array(c);for(e=0;e<c;e++)a.oci[b][e]=Array(2),a.oci[b][e][0]=this.Input._onCTRInt[b][e][0],
a.oci[b][e][1]=Ovoid.compact(this.Input._onCTRInt[b][e][1]);c=this.Input._onALTInt[b].length;a.oai[b]=Array(c);for(e=0;e<c;e++)a.oai[b][e]=Array(2),a.oai[b][e][0]=this.Input._onALTInt[b][e][0],a.oai[b][e][1]=Ovoid.compact(this.Input._onALTInt[b][e][1]);c=this.Input._onSHFInt[b].length;a.osi[b]=Array(c);for(e=0;e<c;e++)a.osi[b][e]=Array(2),a.osi[b][e][0]=this.Input._onSHFInt[b][e][0],a.osi[b][e][1]=Ovoid.compact(this.Input._onSHFInt[b][e][1]);c=this.Input._onLSUInt[b].length;a.olsi[b]=Array(c);for(e=
0;e<c;e++)a.olsi[b][e]=Array(2),a.olsi[b][e][0]=this.Input._onLSUInt[b][e][0],a.olsi[b][e][1]=Ovoid.compact(this.Input._onLSUInt[b][e][1]);c=this.Input._onRSUInt[b].length;a.orsi[b]=Array(c);for(e=0;e<c;e++)a.orsi[b][e]=Array(2),a.orsi[b][e][0]=this.Input._onRSUInt[b][e][0],a.orsi[b][e][1]=Ovoid.compact(this.Input._onRSUInt[b][e][1])}a.olp=Ovoid.compact(this.onloop);a.odw=Ovoid.compact(this.ondraw);a.wdw=Ovoid.compact(this.waitdraw);c=this.Drawer._splib.length;a.sl=Array(c);for(b=0;b<c;b++)a.sl[b]=
this.Drawer._splib[b];c=this.Drawer._sppipe.length;a.sp=Array(c);for(b=0;b<c;b++)a.sp[b]=this.Drawer._sppipe[b];a.o=Array(46);a.o[0]=this.opt_debugMode;a.o[1]=this.opt_enableAlerts;a.o[2]=this.opt_logLevel;a.o[3]=this.opt_customErrContent;a.o[4]=this.opt_showHud;a.o[5]=this.opt_showDebug;a.o[6]=this.opt_gravity;a.o[7]=this.opt_preloadStyle;a.o[8]=this.opt_preloadBgColor;a.o[9]=this.opt_preloadFgColor;a.o[10]=this.opt_preloadAcColor;a.o[11]=this.opt_frameMode;a.o[12]=this.opt_renderClearColor;a.o[13]=
this.opt_renderAmbientColor;a.o[14]=this.opt_renderFogColor;a.o[15]=this.opt_renderFogDensity;a.o[16]=this.opt_renderPickingMode;a.o[17]=this.opt_renderLopLevel;a.o[18]=this.opt_renderAdaptLop;a.o[19]=this.opt_renderAdaptLopThreshold;a.o[20]=this.opt_renderPerLightPass;a.o[21]=this.opt_renderShadowCasting;a.o[22]=this.opt_renderShadowCastingExclusion;a.o[23]=this.opt_renderDrawLayers;a.o[24]=this.opt_renderDrawHelpers;a.o[25]=this.opt_renderDrawAxis;a.o[26]=this.opt_renderDrawBoundingBox;a.o[27]=
this.opt_renderDrawBoundingSphere;a.o[28]=this.opt_renderDrawJoints;a.o[29]=this.opt_renderDrawLights;a.o[30]=this.opt_renderDrawCameras;a.o[31]=this.opt_renderDrawNormals;a.o[32]=this.opt_renderJointSize;a.o[33]=this.opt_renderNormalScale;a.o[34]=this.opt_sceneViewcull;a.o[35]=this.opt_sceneLightcull;a.o[36]=this.opt_sceneIntersectDetect;a.o[37]=this.opt_sceneDefaultViewPosition;a.o[38]=this.opt_sceneDefaultViewRotation;a.o[39]=this.opt_physicsIterativeSolver;a.o[40]=this.opt_physicsContactItFactor;
a.o[41]=this.opt_renderCullFace;a.o[42]=this.opt_audioDopplerFactor;a.o[43]=this.opt_skinLocalComput;a.o[44]=this.opt_frameWidth;a.o[45]=this.opt_frameHeight;return a};Ovoid.Config=function(){this.opt_GLalpha=!1;this.opt_GLpremultipliedAlpha=this.opt_GLstencil=this.opt_GLantialias=this.opt_GLpreserveDrawingBuffer=!0;this.opt_debugMode=!1;this.opt_enableAlerts=!0;this.opt_logLevel=0;this.opt_customErrContent=null;this.opt_showHud=!0;this.opt_showDebug=!1;this.opt_gravity=[0,-9.8,0];this.opt_preloadStyle=1;this.opt_preloadBgColor=[0.95,0.95,0.95,1];this.opt_preloadFgColor=[0.5,0.5,0.5,1];this.opt_preloadAcColor=[0,0,0,0.5];this.opt_frameMode=Ovoid.FRAME_CLIENT_SIZE;
this.opt_frameWidth=960;this.opt_frameHeight=540;this.opt_renderClearColor=[0,1,0,1];this.opt_renderAmbientColor=[0.2,0.2,0.2,1];this.opt_renderFogColor=[1,1,1,1];this.opt_renderFogDensity=0;this.opt_renderPickingMode=Ovoid.RP_WORLD|Ovoid.RP_OVERLAY;this.opt_renderCullFace=1;this.opt_renderLopLevel=2;this.opt_renderAdaptLop=!1;this.opt_renderAdaptLopThreshold=45;this.opt_renderPerLightPass=!0;this.opt_renderShadowCasting=!1;this.opt_renderShadowCastingExclusion=2;this.opt_renderDrawLayers=!0;this.opt_renderDrawHelpers=
!1;this.opt_renderDrawCameras=this.opt_renderDrawLights=this.opt_renderDrawJoints=this.opt_renderDrawBoundingSphere=this.opt_renderDrawBoundingBox=this.opt_renderDrawAxis=!0;this.opt_renderDrawNormals=!1;this.opt_renderNormalScale=this.opt_renderJointSize=0.25;this.opt_sceneIntersectDetect=this.opt_sceneLightcull=this.opt_sceneViewcull=!0;this.opt_sceneDefaultViewPosition=[0,0,5];this.opt_sceneDefaultViewRotation=[0,0,0];this.opt_physicsIterativeSolver=!0;this.opt_physicsContactItFactor=4;this.opt_audioDopplerFactor=
1;this.opt_skinLocalComput=!1};Ovoid.Debug={};Ovoid.Debug.Float16v=function(a,b){b||(b="");var c;c=""+(b+Ovoid.frnd(a[0])+"\t"+Ovoid.frnd(a[1])+"\t"+Ovoid.frnd(a[2])+"\t"+Ovoid.frnd(a[3])+"\n");c+=b+Ovoid.frnd(a[4])+"\t"+Ovoid.frnd(a[5])+"\t"+Ovoid.frnd(a[6])+"\t"+Ovoid.frnd(a[7])+"\n";c+=b+Ovoid.frnd(a[8])+"\t"+Ovoid.frnd(a[9])+"\t"+Ovoid.frnd(a[10])+"\t"+Ovoid.frnd(a[11])+"\n";return c+=b+Ovoid.frnd(a[12])+"\t"+Ovoid.frnd(a[13])+"\t"+Ovoid.frnd(a[14])+"\t"+Ovoid.frnd(a[15])};
Ovoid.Debug.Float9v=function(a,b){b||(b="");var c;c=""+(b+Ovoid.frnd(a[0])+"\t"+Ovoid.frnd(a[1])+"\t"+Ovoid.frnd(a[2])+"\n");c+=b+Ovoid.frnd(a[3])+"\t"+Ovoid.frnd(a[4])+"\t"+Ovoid.frnd(a[5])+"\n";return c+=b+Ovoid.frnd(a[6])+"\t"+Ovoid.frnd(a[7])+"\t"+Ovoid.frnd(a[8])};Ovoid.Debug.Float3v=function(a,b){b||(b="");var c;return c=""+(b+Ovoid.frnd(a[0])+", "+Ovoid.frnd(a[1])+", "+Ovoid.frnd(a[2]))};
Ovoid.Debug.Float4v=function(a,b){b||(b="");var c;return c=""+(b+Ovoid.frnd(a[0])+", "+Ovoid.frnd(a[1])+", "+Ovoid.frnd(a[2])+", "+Ovoid.frnd(a[3]))};Ovoid.Debug.Vertex=function(a,b){b||(b="");var c;c=""+(b+"[p:"+Ovoid.Debug.Float4v(a.p.v,"")+"]");c+="[n:"+Ovoid.Debug.Float3v(a.n.v,"")+"]";return c+="[u:"+Ovoid.Debug.Float3v(a.u.v,"")+"]"};
Ovoid.Debug.Node=function(a){for(var b='Ovoid.Node "'+a.name+'" infos\n{\n',b=b+("  visible: "+a.visible+"\n"),b=b+("  uid:     "+a.uid+"\n"),b=b+"  parent:  "+(a.parent?a.parent.name:"null"),b=b+"\n  child: ",c=0;c<a.child.length;c++)b+="\n   > "+a.child[c].name;b+="\n  link: ";for(c=0;c<a.link.length;c++)b+="\n   > "+a.link[c].name;b+="\n  depend: ";for(c=0;c<a.depend.length;c++)b+="\n   > "+a.depend[c].name;return b+"\n}"};
Ovoid.Debug.Mesh=function(a,b){var c=Ovoid.MAX_MESH_LOD;b&&(c=1);for(var e='Ovoid.Mesh "'+a.name+'" infos\n{\n',f=0;f<c;f++){b||(e+=" LOD#"+f+" {\n");for(var g=0;g<a.polyset[f].length;g++)e+="  polyset#"+g+" {",e+=" "+a.polyset[f][g].ioffset,e+=", "+a.polyset[f][g].icount,e+=", ",e=a.polyset[f][g].material?e+a.polyset[f][g].material.name:e+"null",e+=" }\n";e+="  vertices: "+a.vertices[f].length;if(!b){e+=" {\n";for(g=0;g<a.vertices[f].length;g++)e+=Ovoid.Debug.Vertex(a.vertices[f][g],"      ")+"\n";
e+="\n }"}e+="\n";e+="  triangles: "+a.triangles[f].length;if(!b){e+=" {\n";e+="      indices: {";for(g=0;g<a.triangles[f].length;g++)e+="["+a.triangles[f][g].index[0]+","+a.triangles[f][g].index[1]+","+a.triangles[f][g].index[2]+"]";e+="\n   }\n";e+="\n }\n"}e+="\n"}return e+"}"};
Ovoid.Debug.Material=function(a){var b='Ovoid.Material "'+a.name+'" infos\n{\n',b=b+("  ambient: "+Ovoid.Debug.Float4v(a.color[0].v,"  ")+"\n");a.texture[0]&&(b+="    texture: "+a.texture[0].name+"\n");b+="  diffuse: "+Ovoid.Debug.Float4v(a.color[1].v,"  ")+"\n";a.texture[1]&&(b+="    texture: "+a.texture[1].name+"\n");b+="  specular: "+Ovoid.Debug.Float4v(a.color[2].v,"  ")+"\n";a.texture[2]&&(b+="    texture: "+a.texture[2].name+"\n");b+="  emissive: "+Ovoid.Debug.Float4v(a.color[3].v,"  ")+"\n";
a.texture[3]&&(b+="    texture: "+a.texture[3].name+"\n");b+="  reflect: "+Ovoid.Debug.Float4v(a.color[4].v,"  ")+"\n";a.texture[4]&&(b+="    texture: "+a.texture[4].name+"\n");a.texture[5]&&(b+="  normal map: "+a.texture[5].name+"\n");b+="  shininess: "+a.shininess+"\n";b+="  reflectivity: "+a.reflectivity+"\n";b+="  opacity: "+a.opacity+"\n";return b+"}"};
Ovoid.Debug.Transform=function(a,b){var c='Ovoid.Transform "'+a.name+'" infos\n{\n',c=c+("  scaling:     "+Ovoid.Debug.Float3v(a.scaling.v,"")+"\n"),c=c+("  translation: "+Ovoid.Debug.Float3v(a.translation.v,"")+"\n"),c=c+("  rotation:    "+Ovoid.Debug.Float4v(a.rotation.v,"")+"\n"),c=c+("  orientation: "+Ovoid.Debug.Float4v(a.orientation.v,"")+"\n");b||(c=c+"\n  matrix {\n"+(Ovoid.Debug.Float16v(a.matrix.m,"    ")+"\n"),c=c+"  }\n  worldMatrix {\n"+(Ovoid.Debug.Float16v(a.worldMatrix.m,"    ")+"\n"),
c=c+"  }\n  normalMatrix {\n"+(Ovoid.Debug.Float9v(a.normalMatrix.m,"    ")+"\n"),c+="  }\n");c+="  worldDirection: "+Ovoid.Debug.Float3v(a.worldDirection.v,"")+"\n";c+="  worldPosition:  "+Ovoid.Debug.Float3v(a.worldPosition.v,"")+"\n";return c+"}"};
Ovoid.Debug.Body=function(a){var b='Ovoid.Body "'+a.name+'" infos\n{\n',b=b+"  shape: ";a.shape?b+=a.shape.name:b+="null";for(var b=b+"\n  intersect: ",c=0;c<a.intersect.count;c++)b+="\n   > "+a.intersect[c].name;b+="\n  enter: ";for(c=0;c<a.enter.count;c++)b+="\n   > "+a.enter[c].name;b+="\n  leave: ";for(c=0;c<a.leave.count;c++)b+="\n   > "+a.leave[c].name;return b+"\n}"};
Ovoid.Debug.Light=function(a){var b='Ovoid.Light "'+a.name+'" infos\n{\n',b=b+("  model: "+a.model+"\n"),b=b+("  Color: "+Ovoid.Debug.Float4v(a.color.v,"")+"\n"),b=b+("  intensity: "+a.intensity+"\n"),b=b+("  Constant Att: "+a.attenuationC+"\n"),b=b+("  Linear Att: "+a.attenuationL+"\n"),b=b+("  Quadratic Att: "+a.attenuationQ+"\n"),b=b+("  Range: "+a.range+"\n\n"),b=b+("  Falloff: "+a.falloff+"\n\n"),b=b+("  Spot angle: "+a.spotAngle+"\n\n"),b=b+("  Cast shadows: "+a.shadowCasting+"\n\n");return b+
"}"};
Ovoid.Debug.Camera=function(a,b){var c='Ovoid.Camera "'+a.name+'" infos\n{\n',c=c+("  viewX:    "+a.viewX+"\n"),c=c+("  viewY:    "+a.viewY+"\n"),c=c+("  fov:      "+a.fov+"\n"),c=c+("  aspect:   "+a.aspect+"\n"),c=c+("  clipNear: "+a.clipNear+"\n"),c=c+("  clipFar:  "+a.clipFar+"\n\n");b||(c=c+"  perspective {\n"+(Ovoid.Debug.Float16v(a.perspective.m,"    ")+"\n"),c=c+"  }\n\n  lookat {\n"+(Ovoid.Debug.Float16v(a.lookat.m,"    ")+"\n"),c=c+"  }\n\n  orthographic {\n"+(Ovoid.Debug.Float16v(a.orthographic.m,"    ")+
"\n"),c=c+"  }\n\n  eyeview {\n"+(Ovoid.Debug.Float16v(a.eyeview.m,"    ")+"\n"),c+="  }\n\n");return c+"}"};
Ovoid.Debug.Layer=function(a,b){var c='Ovoid.Layer "'+a.name+'" infos\n{\n',c=c+("  size:      "+Ovoid.Debug.Float3v(a.size.v,"")+"\n"),c=c+("  fgColor:   "+Ovoid.Debug.Float4v(a.fgColor.v,"")+"\n"),c=c+("  bgColor:   "+Ovoid.Debug.Float4v(a.bgColor.v,"")+"\n"),c=c+"  bgTexture: ";a.bgTexture?c+=a.bgTexture.name+"\n":c+="null\n";b||(c=c+"  layerMatrix {\n"+(Ovoid.Debug.Float16v(a.layerMatrix.m,"    ")+"\n"),c+="  }\n");return c+"}"};
Ovoid.Debug.NodeList=function(a){var b='Ovoid.Scene "'+a.name+'" node list\n{\n',c;if(a.audio.length)for(var b=b+" Audios:\n",e=0;e<a.audio.length;e++)c=a.audio[e],b+="  "+c.name+"\n";if(a.texture.length){b+=" Textures:\n";for(e=0;e<a.texture.length;e++)c=a.texture[e],b+=" "+c.name+"\n"}if(a.material.length){b+=" Materials:\n";for(e=0;e<a.material.length;e++)c=a.material[e],b+="  "+c.name+"\n"}if(a.shape.length){b+=" Shapes:\n";for(e=0;e<a.shape.length;e++)c=a.shape[e],b+="  "+c.name+"\n"}a.transform.length&&
(b+=" Transforms:\n");if(a.sound.length){b+="   Sounds:\n";for(e=0;e<a.sound.length;e++)c=a.sound[e],b+="    "+c.name+"\n"}if(a.light.length){b+="   Lights:\n";for(e=0;e<a.light.length;e++)c=a.light[e],b+="    "+c.name+"\n"}if(a.camera.length){b+="   Cameras:\n";for(e=0;e<a.camera.length;e++)c=a.camera[e],b+="    "+c.name+"\n"}if(a.transform.length){b+="   Commons:\n";for(e=0;e<a.transform.length;e++)c=a.transform[e],c.type&Ovoid.LIGHT||c.type&Ovoid.CAMERA||c.type&Ovoid.SOUND||(b+="    "+c.name+"\n")}if(a.layer.length){b+=
" Layer:\n";for(e=0;e<a.layer.length;e++)c=a.layer[e],b+=" "+c.name+"\n"}if(a.animation.length){b+=" Animation:\n";for(e=0;e<a.animation.length;e++)c=a.animation[e],b+="  "+c.name+"\n"}if(a.physics.length){b+=" Physics:\n";for(e=0;e<a.physics.length;e++)c=a.physics[e],b+="  "+c.name+"\n"}if(a.action.length){b+=" Actions:\n";for(e=0;e<a.action.length;e++)c=a.action[e],b+="  "+c.name+"\n"}if(a.track.length){b+=" Track:\n";for(e=0;e<a.track.length;e++)c=a.track[e],b+="  "+c.name+"\n"}return b+"}"};
Ovoid.Debug.WorldGraph=function(a){var b='Ovoid.Scene "'+a.name+'" world graph\n{\n',b=b+" \u00a4 World\n",c,e=new Ovoid.WgIterator;for(e.init(a.world);e.explore();){c=e.current;for(var b=b+"",f=0;f<e.depth;f++)b+="  ";b+=" > "+c.name+"\n"}b+="\n \u00a4 Overlay\n";for(e.init(a.overlay);e.explore();){c=e.current;b+="";for(f=0;f<e.depth;f++)b+="  ";b+=" > "+c.name+"\n"}return b+"}"};
Ovoid.Debug.DependGraph=function(a){for(var b='Ovoid.Scene "'+a.name+'" dependency graph\n{\n',c,e=new Ovoid.DgIterator,f=0;f<a.transform.length;f++){b+=" \u00a4 "+a.transform[f].name+"\n";for(e.init(a.transform[f]);e.exploreDepend();){c=e.current;for(var b=b+"",g=0;g<e.depth;g++)b+="  ";b+=" > "+c.name+"\n";c.type&Ovoid.TRANSFORM&&e.jumpDepend()}}return b+"}"};
Ovoid.Debug.DependTree=function(a){var b='Ovoid.Node "'+a.name+'" dependency tree\n{\n',c=new Ovoid.DgIterator,b=b+(" \u00a4 "+a.name+"\n");for(c.init(a);c.exploreDepend();){for(var a=c.current,b=b+"",e=0;e<c.depth;e++)b+="  ";b+=" > "+a.name+"\n"}return b+"}"};
Ovoid.Debug.Queuer=function(a){var b,c;b="Ovoid.Queuer status\n{\n"+("  rcamera:   "+a.Queuer._rcamera.name+"\n");b+="  viewcull:  ";a.Queuer.opt_viewcull?b+="on\n":b+="off\n";b+="  lightcull: ";a.Queuer.opt_lightcull?b+="on\n":b+="off\n";c=a.Queuer.qlight.count;b+="  qlight: "+c+" node(s)\n";for(var e=c=0;e<Ovoid.MAX_RENDER_LAYER;e++)c+=a.Queuer.qsolid[e].count;b+="  qsolid: "+c+" node(s)\n";for(e=c=0;e<Ovoid.MAX_RENDER_LAYER;e++)c+=a.Queuer.qalpha[e].count;b+="  qalpha: "+c+" node(s)\n";c=a.Queuer.qphycs.count;
b+="  qphycs: "+c+" node(s)\n";c=a.Queuer.qlayer.count;b+="  qlayer: "+c+" node(s)\n";c=a.Queuer.qtext.count;return b+("  qtext:  "+c+" node(s)\n")+"}"};
Ovoid.Debug.Input=function(a){var b;b="Ovoid.Input status\n{\n   intDn: [";for(var c=0;256>c;c++)a.Input.intDn[c]&&(b+=c+" ");b+="]\n   intUp: [";for(c=0;256>c;c++)a.Input.intUp[c]&&(b+=c+" ");b+="]\n   intHl: [";for(c=0;256>c;c++)a.Input.intHl[c]&&(b+=c+" ");b=b+"]\n"+("   mousePosition: "+a.Input.mousePosition.v[0]+", "+a.Input.mousePosition.v[1]+"\n");b+="   mouseVelocity: "+a.Input.mouseVelocity.v[0]+", "+a.Input.mouseVelocity.v[1]+"\n";b+="   mouseOverUid:  "+a.Input.mouseOverUid+"\n";b+="   mouseEnterUid: "+
a.Input.mouseEnterUid+"\n";b+="   mouseLeaveUid: "+a.Input.mouseLeaveUid+"\n";b=b+"   mouseCursor: "+(Ovoid.frnd(a.Input.mouseCursor.m[12])+", ");b+=Ovoid.frnd(a.Input.mouseCursor.m[13])+", ";b+=Ovoid.frnd(a.Input.mouseCursor.m[14]);return b+"\n}"};
Ovoid.Debug.Drawer=function(a){var b;b="Ovoid.Drawer status\n{\n   rp:"+a.Drawer.opt_pickingMode;b+=" lp:";a.Drawer.opt_perLightPass?b+="yes":b+="no";b+=" zf:";a.Drawer.opt_shadowCasting?b+="yes\n":b+="no\n";b+="   renderpasses:  "+a.Drawer._renderpasses+" call(s)\n";b+="   drawndynamic:  "+a.Drawer._drawndynamic+" call(s)\n";b+="   drawnsprite:   "+a.Drawer._drawnsprite+" call(s)\n";b+="   drawnchar:     "+a.Drawer._drawnchar+" point(s)\n";b+="   drawnsymbolic: "+a.Drawer._drawnsymbolic+" call(s)\n";
b+="   drawnpolyset:  "+a.Drawer._drawnpolyset+" call(s)\n";b+="   drawnparticle: "+a.Drawer._drawnparticle+" point(s)\n";b+="   drawnshadow:   "+a.Drawer._drawnshadow+" call(s)\n";return b+"}"};Ovoid.Debug.Timer=function(a){var b;b="Ovoid.Timer status\n{\n"+("   quantum:   "+Math.round(1E4*a.Timer.quantum)/1E4+"\n");b+="   framerate: "+a.Timer.framerate+"\n";return b+"}"};
Ovoid.Debug.Frame=function(a){var b;b="Ovoid.Frame status\n{\n"+("   position: "+a.Frame.position.v[0]+", "+a.Frame.position.v[1]+"\n");b+="   size:     "+a.Frame.size.v[0]+", "+a.Frame.size.v[1]+"\n";b+="   scroll:   "+a.Frame.scroll.v[0]+", "+a.Frame.scroll.v[1]+"\n";return b+"}"};
Ovoid.Debug.Shader=function(a){var b="VERTEX_VEC4_P,VERTEX_VEC3_N,VERTEX_VEC3_U,VERTEX_VEC3_T,VERTEX_VEC3_B,VERTEX_VEC4_C,VERTEX_VEC4_I,VERTEX_VEC4_W".split(","),c="UNIFORM_MATRIX_TRANSFORM_MAT4,UNIFORM_MATRIX_NORMAL_MAT3,UNIFORM_MATRIX_MODELVIEW_MAT4,UNIFORM_MATRIX_EYEVIEW_MAT4,UNIFORM_MATRIX_PROJECTION_MAT4,UNIFORM_MATRIX_LOOKAT_MAT4,UNIFORM_MATRIX_BONES_MAT4".split(","),e="UNIFORM_ENABLE_DIFFUSE_LIGHTING_BOOL,UNIFORM_ENABLE_AMBIENT_LIGHTING_BOOL,UNIFORM_ENABLE_SPECULAR_BOOL,UNIFORM_ENABLE_REFLECT_BOOL,UNIFORM_ENABLE_PARALAX_BOOL,UNIFORM_ENABLE_MATERIAL_BOOL,UNIFORM_ENABLE_VERTEX_WEIGHT_BOOL,UNIFORM_ENABLE_COMPUT_TANGENT_BOOL,UNIFORM_ZOFFSET_FLOAT,UNIFORM_COLOR_VEC4,UNIFORM_MATERIAL_AMBIENT_VEC4,UNIFORM_MATERIAL_DIFFUSE_VEC4,UNIFORM_MATERIAL_SPECULAR_VEC4,UNIFORM_MATERIAL_EMISSIVE_VEC4,UNIFORM_MATERIAL_REFLECT_VEC4,UNIFORM_MATERIAL_SHININESS_FLOAT,UNIFORM_MATERIAL_OPACITY_FLOAT,UNIFORM_MATERIAL_REFLECTIVITY_FLOAT,UNIFORM_MATERIAL_BUMPINESS_FLOAT,,UNIFORM_LIGHT_POSITION_VEC4,UNIFORM_LIGHT_DIRECTION_VEC3,UNIFORM_LIGHT_COLOR_VEC4,UNIFORM_LIGHT_CONSTANT_ATTENUATION_FLOAT,UNIFORM_LIGHT_RANGE_FLOAT,UNIFORM_LIGHT_FALLOFF_FLOAT,UNIFORM_LIGHT_SPOTANGLE_FLOAT,UNIFORM_LIGHT_LINEAR_ATTENUATION_FLOAT,UNIFORM_LIGHT_ENABLED_BOOL,UNIFORM_LIGHT_QUADRIC_ATTENUATION_FLOAT,UNIFORM_EYE_POSITION_VEC4,UNIFORM_EYE_DIRECTION_VEC4,UNIFORM_EYE_VIEWSIZE_VEC3,Unassigned Slot #33,Unassigned Slot #34,Unassigned Slot #35,Unassigned Slot #36,Unassigned Slot #37,Unassigned Slot #38,Unassigned Slot #39,UNIFORM_AMBIENT_COLOR_VEC4,#41,UNIFORM_LAYER_SIZE_VEC3".split(","),
f="SAMPLER_AMBIENT,SAMPLER_DIFFUSE,SAMPLER_SPECULAR,SAMPLER_EMISSIVE,SAMPLER_REFLECT,SAMPLER_NORMAL".split(","),g;g="Ovoid.Shader [] debug\n{\n\tvertex attribs {\n";for(var h=0;h<Ovoid.MAX_VERTEX_ATTRIB;h++)-1!=a.attribute[h]&&(g+="\t\t"+b[h]+" \n");g+="\t}\n\tuniforms {\n";for(h=0;h<Ovoid.MAX_UNIFORM;h++)-1!=a.uniform[h]&&(g+="\t\t"+e[h]+" \n");g+="\t}\n\tuniforms matrices {\n";for(h=0;h<Ovoid.MAX_UNIFORM_MATRIX;h++)-1!=a.uniformMatrix[h]&&(g+="\t\t"+c[h]+" \n");g+="\t}\n\tuniforms samplers {\n";
for(h=0;h<Ovoid.MAX_UNIFORM_SAMPLER;h++)-1!=a.uniformSampler[h]&&(g+="\t\t #"+h+" "+f[h]+" \n");return g+"\t}\n}\n"};
Ovoid.Debug.Sumary=function(a){var b="",b="Fps:["+a.Timer.framerate+"]",b=b+" Drawer:[mode:";if(a.opt_renderPerLightPass)switch(b+="LP/",a.Drawer._pipeLp){case 0:b+="PS";break;case 10:b+="VL";break;case 13:b+="LE"}else switch(b+=" 1P/",a.Drawer._pipe1p){case 1:b+="PS";break;case 11:b+="VL";break;case 14:b+="LE"}var b=b+(" set:"+a.Drawer._drawnpolyset),b=b+(" dyn:"+a.Drawer._drawndynamic),b=b+(" spr:"+a.Drawer._drawnsprite),b=b+(" sym:"+a.Drawer._drawnsymbolic),b=b+(" prt:"+a.Drawer._drawnparticle),
b=b+(" sdw:"+a.Drawer._drawnshadow),b=b+"]"+(" Mouse:[x"+a.Input.mousePosition.v[0]),b=b+(" y"+a.Input.mousePosition.v[1]+"]"),b=b+" Picking:[",c=a.opt_renderPickingMode;1==c&&(b+="off");1==c&&(b+="O");2==c&&(b+="W");3==c&&(b+="O+W");b=b+"]"+(" Timer:[q:"+Math.round(1E3*a.Timer.quantum)/1E3);return b+=" c:"+Math.round(100*a.Timer.clock)/100+"]"};
